(() => {
var exports = {};
exports.id = 7578;
exports.ids = [7578];
exports.modules = {

/***/ 55752:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/react-dom-experimental/server-rendering-stub");

/***/ }),

/***/ 17640:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/react-experimental");

/***/ }),

/***/ 76931:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/react-experimental/jsx-runtime");

/***/ }),

/***/ 67597:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/react-server-dom-webpack-experimental/client");

/***/ }),

/***/ 5868:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/app-render");

/***/ }),

/***/ 41844:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/get-segment-param");

/***/ }),

/***/ 96624:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/future/helpers/interception-routes");

/***/ }),

/***/ 75281:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/future/route-modules/route-module");

/***/ }),

/***/ 57085:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/app-router-context");

/***/ }),

/***/ 20199:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/hash");

/***/ }),

/***/ 39569:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/hooks-client-context");

/***/ }),

/***/ 17160:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router-context");

/***/ }),

/***/ 30893:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/add-path-prefix");

/***/ }),

/***/ 12336:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/format-url");

/***/ }),

/***/ 17887:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/handle-smooth-scroll");

/***/ }),

/***/ 98735:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/is-bot");

/***/ }),

/***/ 60120:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/is-local-url");

/***/ }),

/***/ 68231:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/parse-path");

/***/ }),

/***/ 54614:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/path-has-prefix");

/***/ }),

/***/ 53750:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/remove-trailing-slash");

/***/ }),

/***/ 70982:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/resolve-href");

/***/ }),

/***/ 79618:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/server-inserted-html");

/***/ }),

/***/ 78423:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/utils");

/***/ }),

/***/ 6113:
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ 9523:
/***/ ((module) => {

"use strict";
module.exports = require("dns");

/***/ }),

/***/ 82361:
/***/ ((module) => {

"use strict";
module.exports = require("events");

/***/ }),

/***/ 57147:
/***/ ((module) => {

"use strict";
module.exports = require("fs");

/***/ }),

/***/ 13685:
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ 85158:
/***/ ((module) => {

"use strict";
module.exports = require("http2");

/***/ }),

/***/ 41808:
/***/ ((module) => {

"use strict";
module.exports = require("net");

/***/ }),

/***/ 22037:
/***/ ((module) => {

"use strict";
module.exports = require("os");

/***/ }),

/***/ 71017:
/***/ ((module) => {

"use strict";
module.exports = require("path");

/***/ }),

/***/ 77282:
/***/ ((module) => {

"use strict";
module.exports = require("process");

/***/ }),

/***/ 12781:
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ 24404:
/***/ ((module) => {

"use strict";
module.exports = require("tls");

/***/ }),

/***/ 57310:
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ 73837:
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ }),

/***/ 59796:
/***/ ((module) => {

"use strict";
module.exports = require("zlib");

/***/ }),

/***/ 224:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   GlobalError: () => (/* reexport default from dynamic */ next_dist_client_components_error_boundary__WEBPACK_IMPORTED_MODULE_2___default.a),
/* harmony export */   __next_app__: () => (/* binding */ __next_app__),
/* harmony export */   originalPathname: () => (/* binding */ originalPathname),
/* harmony export */   pages: () => (/* binding */ pages),
/* harmony export */   routeModule: () => (/* binding */ routeModule),
/* harmony export */   tree: () => (/* binding */ tree)
/* harmony export */ });
/* harmony import */ var next_dist_server_future_route_modules_app_page_module__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(7262);
/* harmony import */ var next_dist_server_future_route_modules_app_page_module__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_page_module__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(19513);
/* harmony import */ var next_dist_client_components_error_boundary__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(31823);
/* harmony import */ var next_dist_client_components_error_boundary__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_client_components_error_boundary__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var next_dist_server_app_render_entry_base__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(12502);
/* harmony import */ var next_dist_server_app_render_entry_base__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_app_render_entry_base__WEBPACK_IMPORTED_MODULE_3__);
/* harmony reexport (unknown) */ var __WEBPACK_REEXPORT_OBJECT__ = {};
/* harmony reexport (unknown) */ for(const __WEBPACK_IMPORT_KEY__ in next_dist_server_app_render_entry_base__WEBPACK_IMPORTED_MODULE_3__) if(["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(__WEBPACK_IMPORT_KEY__) < 0) __WEBPACK_REEXPORT_OBJECT__[__WEBPACK_IMPORT_KEY__] = () => next_dist_server_app_render_entry_base__WEBPACK_IMPORTED_MODULE_3__[__WEBPACK_IMPORT_KEY__]
/* harmony reexport (unknown) */ __webpack_require__.d(__webpack_exports__, __WEBPACK_REEXPORT_OBJECT__);
// @ts-ignore this need to be imported from next/dist to be external


const AppPageRouteModule = next_dist_server_future_route_modules_app_page_module__WEBPACK_IMPORTED_MODULE_0__.AppPageRouteModule;
// We inject the tree and pages here so that we can use them in the route
// module.
const tree = {
        children: [
        '',
        {
        children: [
        'admin',
        {
        children: [
        'rapoarte',
        {
        children: [
        'proiecte',
        {
        children: ['__PAGE__', {}, {
          page: [() => Promise.resolve(/* import() eager */).then(__webpack_require__.bind(__webpack_require__, 84309)), "/home/teodor/PM1-2025-07-17/unitar-admin/app/admin/rapoarte/proiecte/page.tsx"],
          
        }]
      },
        {
        
        
      }
      ]
      },
        {
        'layout': [() => Promise.resolve(/* import() eager */).then(__webpack_require__.bind(__webpack_require__, 61705)), "/home/teodor/PM1-2025-07-17/unitar-admin/app/admin/rapoarte/layout.tsx"],
        
      }
      ]
      },
        {
        'layout': [() => Promise.resolve(/* import() eager */).then(__webpack_require__.bind(__webpack_require__, 85093)), "/home/teodor/PM1-2025-07-17/unitar-admin/app/admin/layout.tsx"],
        
      }
      ]
      },
        {
        'layout': [() => Promise.resolve(/* import() eager */).then(__webpack_require__.bind(__webpack_require__, 51921)), "/home/teodor/PM1-2025-07-17/unitar-admin/app/layout.tsx"],
'not-found': [() => Promise.resolve(/* import() eager */).then(__webpack_require__.t.bind(__webpack_require__, 95493, 23)), "next/dist/client/components/not-found-error"],
        
      }
      ]
      }.children;
const pages = ["/home/teodor/PM1-2025-07-17/unitar-admin/app/admin/rapoarte/proiecte/page.tsx"];

// @ts-expect-error - replaced by webpack/turbopack loader

const __next_app_require__ = __webpack_require__
const __next_app_load_chunk__ = () => Promise.resolve()
const originalPathname = "/admin/rapoarte/proiecte/page";
const __next_app__ = {
    require: __next_app_require__,
    loadChunk: __next_app_load_chunk__
};

// Create and export the route module that will be consumed.
const routeModule = new AppPageRouteModule({
    definition: {
        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_PAGE,
        page: "/admin/rapoarte/proiecte/page",
        pathname: "/admin/rapoarte/proiecte",
        // The following aren't used in production.
        bundlePath: "",
        filename: "",
        appPaths: []
    },
    userland: {
        loaderTree: tree
    }
});

//# sourceMappingURL=app-page.js.map

/***/ }),

/***/ 16902:
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

Promise.resolve(/* import() eager */).then(__webpack_require__.bind(__webpack_require__, 49742))

/***/ }),

/***/ 49742:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__);

// EXPORTS
__webpack_require__.d(__webpack_exports__, {
  "default": () => (/* binding */ ProiectePage)
});

// EXTERNAL MODULE: external "next/dist/compiled/react-experimental/jsx-runtime"
var jsx_runtime_ = __webpack_require__(76931);
// EXTERNAL MODULE: ./node_modules/styled-jsx/style.js
var style = __webpack_require__(86369);
var style_default = /*#__PURE__*/__webpack_require__.n(style);
// EXTERNAL MODULE: external "next/dist/compiled/react-experimental"
var react_experimental_ = __webpack_require__(17640);
var react_experimental_default = /*#__PURE__*/__webpack_require__.n(react_experimental_);
// EXTERNAL MODULE: ./node_modules/next/navigation.js
var navigation = __webpack_require__(57114);
// EXTERNAL MODULE: ./node_modules/react-firebase-hooks/auth/dist/index.cjs.js
var index_cjs = __webpack_require__(75792);
// EXTERNAL MODULE: ./lib/firebaseConfig.ts
var firebaseConfig = __webpack_require__(79850);
// EXTERNAL MODULE: ./app/components/ModernLayout.tsx
var ModernLayout = __webpack_require__(56128);
// EXTERNAL MODULE: ./app/admin/rapoarte/components/FilterBar.tsx
var FilterBar = __webpack_require__(51289);
;// CONCATENATED MODULE: ./app/admin/rapoarte/proiecte/components/ProiectFilters.tsx
// ==================================================================
// CALEA: app/admin/rapoarte/proiecte/components/ProiectFilters.tsx
// DATA: 15.09.2025 12:30 (ora României)
// MODIFICAT: Schimbat filtrul client din select în text pentru căutare LIKE
// ELIMINAT: Clientii fake din dropdown
// PĂSTRATE: Toate celelalte funcționalități existente
// ==================================================================
/* __next_internal_client_entry_do_not_use__ default auto */ 

function ProiectFilters({ values, onChange, onReset, loading = false }) {
    const filters = [
        {
            key: "search",
            label: "Căutare generală",
            type: "text",
            placeholder: "Caută după nume proiect, client, ID..."
        },
        {
            key: "status",
            label: "Status proiect",
            type: "select",
            placeholder: "Toate statusurile",
            options: [
                {
                    value: "Activ",
                    label: "\uD83D\uDFE2 Activ"
                },
                {
                    value: "\xcen lucru",
                    label: "\uD83D\uDFE1 \xcen lucru"
                },
                {
                    value: "Suspendat",
                    label: "\uD83D\uDFE0 Suspendat"
                },
                {
                    value: "Finalizat",
                    label: "✅ Finalizat"
                },
                {
                    value: "Anulat",
                    label: "\uD83D\uDD34 Anulat"
                }
            ]
        },
        {
            // MODIFICAT: Schimbat din 'select' în 'text' pentru căutare LIKE
            key: "client",
            label: "Client",
            type: "text",
            placeholder: "Caută după nume client..." // Placeholder actualizat
        },
        {
            key: "data_start",
            label: "Perioada \xeenceput",
            type: "dateRange",
            placeholder: "Data \xeenceput"
        },
        {
            key: "valoare_min",
            label: "Valoare minimă (RON)",
            type: "text",
            placeholder: "0"
        },
        {
            key: "valoare_max",
            label: "Valoare maximă (RON)",
            type: "text",
            placeholder: "999999"
        }
    ];
    return /*#__PURE__*/ jsx_runtime_.jsx(FilterBar/* default */.Z, {
        filters: filters,
        values: values,
        onChange: onChange,
        onReset: onReset,
        loading: loading
    });
}

// EXTERNAL MODULE: external "next/dist/compiled/react-dom-experimental/server-rendering-stub"
var server_rendering_stub_ = __webpack_require__(55752);
;// CONCATENATED MODULE: ./app/admin/rapoarte/proiecte/components/ResponsabilSearch.tsx
// ==================================================================
// CALEA: app/admin/rapoarte/proiecte/components/ResponsabilSearch.tsx
// DATA: 19.08.2025 21:35 (ora României)
// DESCRIERE: Componentă pentru căutare și selecție responsabili din tabelul Utilizatori
// ==================================================================
/* __next_internal_client_entry_do_not_use__ default auto */ 

// Toast system cu Z-index compatibil
const showToast = (message, type = "info")=>{
    const toastEl = document.createElement("div");
    toastEl.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(12px);
    color: ${type === "success" ? "#27ae60" : type === "error" ? "#e74c3c" : "#3498db"};
    padding: 16px 20px;
    border-radius: 16px;
    z-index: 70000;
    font-family: 'Inter', Arial, sans-serif;
    font-size: 14px;
    font-weight: 500;
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    border: 1px solid rgba(255, 255, 255, 0.2);
    max-width: 400px;
    word-wrap: break-word;
    transform: translateY(-10px);
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  `;
    toastEl.textContent = message;
    document.body.appendChild(toastEl);
    setTimeout(()=>{
        toastEl.style.transform = "translateY(0)";
        toastEl.style.opacity = "1";
    }, 10);
    setTimeout(()=>{
        toastEl.style.transform = "translateY(-10px)";
        toastEl.style.opacity = "0";
        setTimeout(()=>{
            if (document.body.contains(toastEl)) {
                document.body.removeChild(toastEl);
            }
        }, 300);
    }, type === "success" || type === "error" ? 4000 : 6000);
};
function ResponsabilSearch({ onResponsabilSelected, selectedResponsabil = "", className = "", showInModal = false, disabled = false, placeholder = "Caută responsabil..." }) {
    const [searchTerm, setSearchTerm] = (0,react_experimental_.useState)(selectedResponsabil);
    const [utilizatori, setUtilizatori] = (0,react_experimental_.useState)([]);
    const [loading, setLoading] = (0,react_experimental_.useState)(false);
    const [showSuggestions, setShowSuggestions] = (0,react_experimental_.useState)(false);
    const [selectedUser, setSelectedUser] = (0,react_experimental_.useState)(null);
    // Încarcă utilizatori inițiali (primii 20 activi)
    (0,react_experimental_.useEffect)(()=>{
        loadUtilizatori();
    }, []);
    // Setează valoarea inițială când se primește selectedResponsabil
    (0,react_experimental_.useEffect)(()=>{
        if (selectedResponsabil && selectedResponsabil !== searchTerm) {
            setSearchTerm(selectedResponsabil);
            // Încearcă să găsească utilizatorul în lista existentă
            const foundUser = utilizatori.find((u)=>u.nume_complet === selectedResponsabil || u.email === selectedResponsabil || u.uid === selectedResponsabil);
            if (foundUser) {
                setSelectedUser(foundUser);
            }
        }
    }, [
        selectedResponsabil,
        utilizatori
    ]);
    const loadUtilizatori = async (search)=>{
        setLoading(true);
        try {
            const queryParams = new URLSearchParams();
            if (search && search.trim().length > 0) {
                queryParams.append("search", search.trim());
            }
            queryParams.append("limit", "20");
            const response = await fetch(`/api/rapoarte/utilizatori?${queryParams.toString()}`);
            const data = await response.json();
            if (data.success) {
                setUtilizatori(data.data || []);
            } else {
                showToast("Eroare la \xeencărcarea utilizatorilor", "error");
                setUtilizatori([]);
            }
        } catch (error) {
            console.error("Eroare la \xeencărcarea utilizatorilor:", error);
            showToast("Eroare de conectare", "error");
            setUtilizatori([]);
        } finally{
            setLoading(false);
        }
    };
    const handleSearchChange = (value)=>{
        setSearchTerm(value);
        setSelectedUser(null);
        if (value.trim().length >= 2) {
            setShowSuggestions(true);
            loadUtilizatori(value);
        } else if (value.trim().length === 0) {
            setShowSuggestions(true);
            loadUtilizatori(); // Încarcă utilizatori implicit
        } else {
            setShowSuggestions(false);
        }
        // Notifică părintele că selecția a fost resetată
        if (onResponsabilSelected) {
            onResponsabilSelected(null);
        }
    };
    const handleSelectUser = (user)=>{
        setSearchTerm(user.nume_complet);
        setSelectedUser(user);
        setShowSuggestions(false);
        if (onResponsabilSelected) {
            onResponsabilSelected({
                uid: user.uid,
                email: user.email,
                nume: user.nume,
                prenume: user.prenume,
                nume_complet: user.nume_complet,
                rol: user.rol
            });
        }
    };
    const handleFocus = ()=>{
        if (!disabled && utilizatori.length > 0) {
            setShowSuggestions(true);
        }
    };
    const handleBlur = ()=>{
        // Întârziere pentru a permite click-ul pe sugestii
        setTimeout(()=>{
            setShowSuggestions(false);
        }, 200);
    };
    const getRolIcon = (rol)=>{
        switch(rol){
            case "admin":
                return "\uD83D\uDC51";
            case "manager":
                return "\uD83D\uDC54";
            case "normal":
                return "\uD83D\uDC64";
            default:
                return "\uD83D\uDC64";
        }
    };
    const getRolLabel = (rol)=>{
        switch(rol){
            case "admin":
                return "Administrator";
            case "manager":
                return "Manager";
            case "normal":
                return "Utilizator";
            default:
                return rol;
        }
    };
    const containerStyle = showInModal ? {
        background: "transparent",
        margin: 0
    } : {
        background: "rgba(255, 255, 255, 0.95)",
        backdropFilter: "blur(12px)",
        padding: "1rem",
        borderRadius: "12px",
        border: "1px solid rgba(255, 255, 255, 0.3)",
        boxShadow: "0 4px 16px rgba(0, 0, 0, 0.1)",
        margin: "0.5rem 0"
    };
    return /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
        className: className,
        style: containerStyle,
        children: [
            !showInModal && /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                style: {
                    marginBottom: "0.75rem"
                },
                children: [
                    /*#__PURE__*/ jsx_runtime_.jsx("label", {
                        style: {
                            display: "block",
                            fontSize: "14px",
                            fontWeight: "600",
                            color: "#2c3e50",
                            marginBottom: "0.5rem"
                        },
                        children: "\uD83D\uDC64 Responsabil Proiect"
                    }),
                    /*#__PURE__*/ jsx_runtime_.jsx("p", {
                        style: {
                            margin: 0,
                            fontSize: "12px",
                            color: "#7f8c8d"
                        },
                        children: "Caută și selectează responsabilul din echipă"
                    })
                ]
            }),
            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                style: {
                    position: "relative"
                },
                children: [
                    /*#__PURE__*/ jsx_runtime_.jsx("input", {
                        type: "text",
                        value: searchTerm,
                        onChange: (e)=>handleSearchChange(e.target.value),
                        onFocus: handleFocus,
                        onBlur: handleBlur,
                        disabled: disabled || loading,
                        placeholder: loading ? "Se \xeencarcă utilizatori..." : placeholder,
                        style: {
                            width: "100%",
                            padding: "0.75rem",
                            paddingRight: "2.5rem",
                            border: `1px solid ${selectedUser ? "#27ae60" : "#dee2e6"}`,
                            borderRadius: "8px",
                            fontSize: "14px",
                            backgroundColor: disabled ? "#f8f9fa" : "white",
                            color: disabled ? "#6c757d" : "#2c3e50"
                        }
                    }),
                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                        style: {
                            position: "absolute",
                            right: "0.75rem",
                            top: "50%",
                            transform: "translateY(-50%)",
                            display: "flex",
                            alignItems: "center",
                            gap: "0.25rem"
                        },
                        children: [
                            loading && /*#__PURE__*/ jsx_runtime_.jsx("span", {
                                style: {
                                    color: "#3498db",
                                    fontSize: "12px"
                                },
                                children: "⏳"
                            }),
                            selectedUser && /*#__PURE__*/ jsx_runtime_.jsx("span", {
                                style: {
                                    color: "#27ae60",
                                    fontSize: "12px"
                                },
                                children: "✅"
                            }),
                            !loading && !selectedUser && searchTerm && /*#__PURE__*/ jsx_runtime_.jsx("span", {
                                style: {
                                    color: "#f39c12",
                                    fontSize: "12px"
                                },
                                children: "⚠️"
                            })
                        ]
                    }),
                    showSuggestions && utilizatori.length > 0 && /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                        style: {
                            position: "absolute",
                            top: "100%",
                            left: 0,
                            right: 0,
                            background: "white",
                            border: "1px solid #dee2e6",
                            borderTop: "none",
                            borderRadius: "0 0 8px 8px",
                            boxShadow: "0 4px 12px rgba(0,0,0,0.15)",
                            zIndex: 1000,
                            maxHeight: "200px",
                            overflowY: "auto"
                        },
                        children: [
                            utilizatori.map((user)=>/*#__PURE__*/ jsx_runtime_.jsx("div", {
                                    onClick: ()=>handleSelectUser(user),
                                    style: {
                                        padding: "0.75rem",
                                        cursor: "pointer",
                                        borderBottom: "1px solid #f1f2f6",
                                        transition: "all 0.2s ease"
                                    },
                                    onMouseOver: (e)=>{
                                        e.currentTarget.style.background = "#f8f9fa";
                                    },
                                    onMouseOut: (e)=>{
                                        e.currentTarget.style.background = "white";
                                    },
                                    children: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                        style: {
                                            display: "flex",
                                            justifyContent: "space-between",
                                            alignItems: "flex-start",
                                            gap: "0.5rem"
                                        },
                                        children: [
                                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                style: {
                                                    flex: 1
                                                },
                                                children: [
                                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                        style: {
                                                            fontWeight: "600",
                                                            color: "#2c3e50",
                                                            fontSize: "14px"
                                                        },
                                                        children: user.nume_complet || `${user.prenume || ""} ${user.nume || ""}`.trim()
                                                    }),
                                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                        style: {
                                                            fontSize: "12px",
                                                            color: "#7f8c8d",
                                                            marginTop: "0.25rem"
                                                        },
                                                        children: [
                                                            "\uD83D\uDCE7 ",
                                                            user.email
                                                        ]
                                                    }),
                                                    user.data_ultima_conectare && /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                        style: {
                                                            fontSize: "11px",
                                                            color: "#95a5a6",
                                                            marginTop: "0.25rem"
                                                        },
                                                        children: [
                                                            "Ultima conectare: ",
                                                            new Date(user.data_ultima_conectare).toLocaleDateString("ro-RO")
                                                        ]
                                                    })
                                                ]
                                            }),
                                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                style: {
                                                    display: "flex",
                                                    flexDirection: "column",
                                                    alignItems: "flex-end",
                                                    gap: "0.25rem"
                                                },
                                                children: [
                                                    /*#__PURE__*/ jsx_runtime_.jsx("span", {
                                                        style: {
                                                            fontSize: "16px"
                                                        },
                                                        children: getRolIcon(user.rol)
                                                    }),
                                                    /*#__PURE__*/ jsx_runtime_.jsx("span", {
                                                        style: {
                                                            fontSize: "10px",
                                                            color: "#7f8c8d",
                                                            textAlign: "center"
                                                        },
                                                        children: getRolLabel(user.rol)
                                                    })
                                                ]
                                            })
                                        ]
                                    })
                                }, user.uid)),
                            loading && /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                style: {
                                    padding: "1rem",
                                    textAlign: "center",
                                    color: "#7f8c8d",
                                    fontSize: "14px"
                                },
                                children: "⏳ Se caută utilizatori..."
                            })
                        ]
                    }),
                    showSuggestions && !loading && utilizatori.length === 0 && searchTerm.trim().length >= 2 && /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                        style: {
                            position: "absolute",
                            top: "100%",
                            left: 0,
                            right: 0,
                            background: "white",
                            border: "1px solid #dee2e6",
                            borderTop: "none",
                            borderRadius: "0 0 8px 8px",
                            boxShadow: "0 4px 12px rgba(0,0,0,0.15)",
                            padding: "1rem",
                            textAlign: "center",
                            color: "#7f8c8d",
                            fontSize: "14px"
                        },
                        children: [
                            'Nu au fost găsiți utilizatori pentru "',
                            searchTerm,
                            '"'
                        ]
                    })
                ]
            }),
            selectedUser && /*#__PURE__*/ jsx_runtime_.jsx("div", {
                style: {
                    marginTop: "0.5rem",
                    padding: "0.75rem",
                    background: "linear-gradient(135deg, rgba(39, 174, 96, 0.1) 0%, rgba(46, 204, 113, 0.1) 100%)",
                    border: "1px solid rgba(39, 174, 96, 0.2)",
                    borderRadius: "8px"
                },
                children: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                    style: {
                        display: "flex",
                        justifyContent: "space-between",
                        alignItems: "center"
                    },
                    children: [
                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                            children: [
                                /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                    style: {
                                        fontSize: "12px",
                                        fontWeight: "600",
                                        color: "#27ae60"
                                    },
                                    children: "✅ Responsabil selectat"
                                }),
                                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                    style: {
                                        fontSize: "11px",
                                        color: "#7f8c8d",
                                        marginTop: "0.25rem"
                                    },
                                    children: [
                                        selectedUser.email,
                                        " • ",
                                        getRolLabel(selectedUser.rol)
                                    ]
                                })
                            ]
                        }),
                        /*#__PURE__*/ jsx_runtime_.jsx("button", {
                            onClick: ()=>{
                                setSearchTerm("");
                                setSelectedUser(null);
                                if (onResponsabilSelected) {
                                    onResponsabilSelected(null);
                                }
                            },
                            style: {
                                background: "transparent",
                                border: "none",
                                color: "#e74c3c",
                                cursor: "pointer",
                                fontSize: "14px",
                                padding: "0.25rem"
                            },
                            title: "Șterge selecția",
                            children: "❌"
                        })
                    ]
                })
            })
        ]
    });
}

;// CONCATENATED MODULE: ./app/admin/rapoarte/proiecte/components/SarcinaNouaModal.tsx
// ==================================================================
// CALEA: app/admin/rapoarte/proiecte/components/SarcinaNouaModal.tsx
// DATA: 24.08.2025 22:30 (ora României)
// MODIFICAT: FIXAT sincronizarea timp real status/progres în frontend + păstrate toate funcționalitățile
// PĂSTRATE: Toate funcționalitățile existente cu responsabili multipli și timp estimat
// ==================================================================
/* __next_internal_client_entry_do_not_use__ default auto */ 



// Toast system
const SarcinaNouaModal_showToast = (message, type = "info")=>{
    const toastEl = document.createElement("div");
    toastEl.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(12px);
    color: ${type === "success" ? "#27ae60" : type === "error" ? "#e74c3c" : "#3498db"};
    padding: 16px 20px;
    border-radius: 16px;
    z-index: 70000;
    font-family: 'Inter', Arial, sans-serif;
    font-size: 14px;
    font-weight: 500;
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    border: 1px solid rgba(255, 255, 255, 0.2);
    max-width: 400px;
    word-wrap: break-word;
    transform: translateY(-10px);
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  `;
    toastEl.textContent = message;
    document.body.appendChild(toastEl);
    setTimeout(()=>{
        toastEl.style.transform = "translateY(0)";
        toastEl.style.opacity = "1";
    }, 10);
    setTimeout(()=>{
        toastEl.style.transform = "translateY(-10px)";
        toastEl.style.opacity = "0";
        setTimeout(()=>{
            if (document.body.contains(toastEl)) {
                document.body.removeChild(toastEl);
            }
        }, 300);
    }, type === "success" || type === "error" ? 4000 : 6000);
};
function SarcinaNouaModal({ isOpen, onClose, onSarcinaAdded, proiect, utilizatorCurent }) {
    const [loading, setLoading] = (0,react_experimental_.useState)(false);
    const [responsabiliSelectati, setResponsabiliSelectati] = (0,react_experimental_.useState)([]);
    const [formData, setFormData] = (0,react_experimental_.useState)({
        titlu: "",
        descriere: "",
        prioritate: "Medie",
        status: "De făcut",
        data_scadenta: "",
        observatii: "",
        // Timp estimat
        timp_estimat_zile: "",
        timp_estimat_ore: "",
        // Progres cu sincronizare
        progres_procent: "0",
        progres_descriere: ""
    });
    // State pentru calculul timpului total
    const [timpTotalOre, setTimpTotalOre] = (0,react_experimental_.useState)(0);
    const resetForm = ()=>{
        setFormData({
            titlu: "",
            descriere: "",
            prioritate: "Medie",
            status: "De făcut",
            data_scadenta: "",
            observatii: "",
            timp_estimat_zile: "",
            timp_estimat_ore: "",
            progres_procent: "0",
            progres_descriere: ""
        });
        setResponsabiliSelectati([]);
        setTimpTotalOre(0);
    };
    // Calculează timpul total când se schimbă zilele sau orele
    (0,react_experimental_.useEffect)(()=>{
        const zile = parseInt(formData.timp_estimat_zile) || 0;
        const ore = parseFloat(formData.timp_estimat_ore) || 0;
        const zileInput = formData.timp_estimat_zile;
        if (zileInput && zileInput.includes(".")) {
            setTimpTotalOre(0);
        } else {
            setTimpTotalOre(zile * 8 + ore);
        }
    }, [
        formData.timp_estimat_zile,
        formData.timp_estimat_ore
    ]);
    const handleInputChange = (field, value)=>{
        setFormData((prev)=>({
                ...prev,
                [field]: value
            }));
    };
    // FIXAT: Funcție pentru sincronizarea status/progres în timp real - STATUS
    const handleStatusChangeNou = (newStatus)=>{
        setFormData((prev)=>{
            const updated = {
                ...prev,
                status: newStatus
            };
            // FIXAT: Dacă status devine 'Finalizată', forțează progres la 100%
            if (newStatus === "Finalizată") {
                updated.progres_procent = "100";
                updated.progres_descriere = updated.progres_descriere || "Sarcină finalizată manual - progres setat la 100%";
                SarcinaNouaModal_showToast("Status finalizat - progresul va fi setat automat la 100%", "info");
            }
            return updated;
        });
    };
    // FIXAT: Funcție pentru sincronizarea progres/status în timp real - PROGRES  
    const handleProgresChangeNou = (newProgres)=>{
        const progresNumeric = parseInt(newProgres) || 0;
        setFormData((prev)=>{
            const updated = {
                ...prev,
                progres_procent: newProgres
            };
            // FIXAT: Dacă progres devine 100%, forțează status la 'Finalizată'
            if (progresNumeric === 100) {
                updated.status = "Finalizată";
                updated.progres_descriere = updated.progres_descriere || "Sarcină finalizată automat la 100% progres";
                SarcinaNouaModal_showToast("Progres 100% - sarcina va fi marcată automat ca finalizată", "info");
            }
            return updated;
        });
    };
    const handleResponsabilSelected = (responsabil)=>{
        if (!responsabil) return;
        const existaResponsabil = responsabiliSelectati.find((r)=>r.uid === responsabil.uid);
        if (existaResponsabil) {
            SarcinaNouaModal_showToast("Responsabilul este deja adăugat", "error");
            return;
        }
        const nouResponsabil = {
            uid: responsabil.uid,
            nume_complet: responsabil.nume_complet,
            email: responsabil.email,
            rol_in_sarcina: responsabiliSelectati.length === 0 ? "Principal" : "Normal"
        };
        setResponsabiliSelectati((prev)=>[
                ...prev,
                nouResponsabil
            ]);
        SarcinaNouaModal_showToast(`Responsabil ${responsabil.nume_complet} adăugat`, "success");
    };
    const removeResponsabil = (uid)=>{
        setResponsabiliSelectati((prev)=>prev.filter((r)=>r.uid !== uid));
    };
    const updateRolResponsabil = (uid, nouRol)=>{
        setResponsabiliSelectati((prev)=>prev.map((r)=>r.uid === uid ? {
                    ...r,
                    rol_in_sarcina: nouRol
                } : r));
    };
    // FIXAT: Funcția pentru culoarea progresului + formatDate cu timezone România corect
    const getProgressColor = (procent)=>{
        if (procent < 25) return "#e74c3c"; // Roșu
        if (procent < 75) return "#f39c12"; // Galben/Portocaliu
        return "#27ae60"; // Verde
    };
    // FIXAT: Funcție formatDate cu timezone România (dacă este folosită în componentă)
    const formatDate = (date)=>{
        if (!date) return "N/A";
        try {
            const dateValue = typeof date === "string" ? date : typeof date === "object" && date.value ? date.value : date.toString();
            const parsedDate = new Date(dateValue);
            if (isNaN(parsedDate.getTime())) {
                console.warn("Data invalidă primită:", date);
                return "Data invalidă";
            }
            // FIXAT: Adăugat timeZone pentru conversie corectă UTC -> România  
            return parsedDate.toLocaleDateString("ro-RO", {
                year: "numeric",
                month: "2-digit",
                day: "2-digit",
                hour: "2-digit",
                minute: "2-digit",
                timeZone: "Europe/Bucharest" // FIXAT: timezone România (UTC+2/UTC+3)
            });
        } catch (error) {
            console.error("Eroare la formatarea datei:", date, error);
            return "Eroare dată";
        }
    };
    // Validări pentru timp estimat
    const validateTimpEstimat = ()=>{
        const zileString = formData.timp_estimat_zile;
        const oreString = formData.timp_estimat_ore;
        if (zileString && zileString.includes(".")) {
            SarcinaNouaModal_showToast("Zilele trebuie să fie numere \xeentregi (ex: 1, 2, 3), nu zecimale!", "error");
            return false;
        }
        const zile = parseInt(zileString) || 0;
        const ore = parseFloat(oreString) || 0;
        if (zile < 0) {
            SarcinaNouaModal_showToast("Zilele estimate nu pot fi negative", "error");
            return false;
        }
        if (!Number.isInteger(zile)) {
            SarcinaNouaModal_showToast("Zilele trebuie să fie numere \xeentregi (0, 1, 2, 3...)", "error");
            return false;
        }
        if (ore < 0 || ore >= 8) {
            SarcinaNouaModal_showToast("Orele estimate trebuie să fie \xeentre 0 și 7.9", "error");
            return false;
        }
        if (zile === 0 && ore === 0) {
            SarcinaNouaModal_showToast("Specifică cel puțin o estimare de timp (zile sau ore)", "error");
            return false;
        }
        return true;
    };
    // Validări pentru progres
    const validateProgres = ()=>{
        const procent = parseInt(formData.progres_procent) || 0;
        if (procent < 0 || procent > 100) {
            SarcinaNouaModal_showToast("Progresul trebuie să fie \xeentre 0 și 100 procente", "error");
            return false;
        }
        return true;
    };
    const handleSubmit = async (e)=>{
        e.preventDefault();
        if (!utilizatorCurent) {
            SarcinaNouaModal_showToast("Nu s-au putut prelua datele utilizatorului curent", "error");
            return;
        }
        // Validări
        if (!formData.titlu.trim()) {
            SarcinaNouaModal_showToast("Titlul sarcinii este obligatoriu", "error");
            return;
        }
        if (responsabiliSelectati.length === 0) {
            SarcinaNouaModal_showToast("Cel puțin un responsabil este obligatoriu", "error");
            return;
        }
        const responsabilPrincipal = responsabiliSelectati.find((r)=>r.rol_in_sarcina === "Principal");
        if (!responsabilPrincipal) {
            SarcinaNouaModal_showToast('Cel puțin un responsabil trebuie să aibă rolul "Principal"', "error");
            return;
        }
        if (!validateTimpEstimat()) {
            return;
        }
        if (!validateProgres()) {
            return;
        }
        setLoading(true);
        try {
            // FIXAT: Payload cu sincronizarea aplicată deja în frontend prin handleStatusChangeNou/handleProgresChangeNou
            const sarcinaData = {
                id: `TASK_${Date.now()}_${Math.random().toString(36).substr(2, 6)}`,
                proiect_id: proiect.ID_Proiect,
                tip_proiect: proiect.tip || "proiect",
                titlu: formData.titlu.trim(),
                descriere: formData.descriere.trim() || null,
                prioritate: formData.prioritate,
                // FIXAT: Folosim valorile deja sincronizate din formData
                status: formData.status,
                progres_procent: parseInt(formData.progres_procent) || 0,
                progres_descriere: formData.progres_descriere.trim() || null,
                data_scadenta: formData.data_scadenta || null,
                observatii: formData.observatii.trim() || null,
                created_by: utilizatorCurent.uid,
                // Timp estimat
                timp_estimat_zile: parseInt(formData.timp_estimat_zile) || 0,
                timp_estimat_ore: parseFloat(formData.timp_estimat_ore) || 0,
                responsabili: responsabiliSelectati.map((r)=>({
                        uid: r.uid,
                        nume_complet: r.nume_complet,
                        rol: r.rol_in_sarcina
                    }))
            };
            console.log("Creez sarcină cu progres sincronizat:", sarcinaData);
            const response = await fetch("/api/rapoarte/sarcini", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(sarcinaData)
            });
            const result = await response.json();
            if (result.success) {
                const statusText = formData.status === "Finalizată" ? " (FINALIZATĂ)" : "";
                const progresText = formData.progres_procent === "100" ? " cu progres 100%" : ` cu progres ${formData.progres_procent}%`;
                SarcinaNouaModal_showToast(`Sarcină creată cu succes${statusText}${progresText}!`, "success");
                onSarcinaAdded();
                resetForm();
            } else {
                SarcinaNouaModal_showToast(result.error || "Eroare la crearea sarcinii", "error");
            }
        } catch (error) {
            console.error("Eroare la crearea sarcinii:", error);
            SarcinaNouaModal_showToast("Eroare la crearea sarcinii", "error");
        } finally{
            setLoading(false);
        }
    };
    if (!isOpen) return null;
    const progresProcent = parseInt(formData.progres_procent) || 0;
    return  false ? /*#__PURE__*/ 0 : null;
}

;// CONCATENATED MODULE: ./app/admin/rapoarte/proiecte/components/TimeTrackingNouModal.tsx
// ==================================================================
// CALEA: app/admin/rapoarte/proiecte/components/TimeTrackingNouModal.tsx
// DATA: 24.08.2025 16:30 (ora României)
// MODIFICAT: Corectare poziționare modal cu createPortal
// PĂSTRATE: Toate funcționalitățile existente cu validări timp
// ==================================================================
/* __next_internal_client_entry_do_not_use__ default auto */ 


// Toast system cu z-index crescut pentru a fi deasupra modalului
const TimeTrackingNouModal_showToast = (message, type = "info")=>{
    const toastEl = document.createElement("div");
    toastEl.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(12px);
    color: ${type === "success" ? "#27ae60" : type === "error" ? "#e74c3c" : "#3498db"};
    padding: 16px 20px;
    border-radius: 16px;
    z-index: 70000;
    font-family: 'Inter', Arial, sans-serif;
    font-size: 14px;
    font-weight: 500;
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    border: 1px solid rgba(255, 255, 255, 0.2);
    max-width: 400px;
    word-wrap: break-word;
    transform: translateY(-10px);
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  `;
    toastEl.textContent = message;
    document.body.appendChild(toastEl);
    setTimeout(()=>{
        toastEl.style.transform = "translateY(0)";
        toastEl.style.opacity = "1";
    }, 10);
    setTimeout(()=>{
        toastEl.style.transform = "translateY(-10px)";
        toastEl.style.opacity = "0";
        setTimeout(()=>{
            if (document.body.contains(toastEl)) {
                document.body.removeChild(toastEl);
            }
        }, 300);
    }, type === "success" || type === "error" ? 4000 : 6000);
};
function TimeTrackingNouModal({ isOpen, onClose, onTimeAdded, proiect, sarcini, utilizatorCurent }) {
    const [loading, setLoading] = (0,react_experimental_.useState)(false);
    const [loadingValidari, setLoadingValidari] = (0,react_experimental_.useState)(false);
    const [timpTotalZiua, setTimpTotalZiua] = (0,react_experimental_.useState)(0);
    const [formData, setFormData] = (0,react_experimental_.useState)({
        sarcina_id: "",
        data_lucru: new Date().toISOString().split("T")[0],
        ore_lucrate: "",
        descriere_lucru: ""
    });
    const [errors, setErrors] = (0,react_experimental_.useState)({});
    const resetForm = ()=>{
        setFormData({
            sarcina_id: "",
            data_lucru: new Date().toISOString().split("T")[0],
            ore_lucrate: "",
            descriere_lucru: ""
        });
        setErrors({});
        setTimpTotalZiua(0);
    };
    // Verifică total ore pe zi când se schimbă data
    (0,react_experimental_.useEffect)(()=>{
        if (formData.data_lucru && utilizatorCurent) {
            verificaTotalOreZiua();
        }
    }, [
        formData.data_lucru,
        utilizatorCurent
    ]);
    const verificaTotalOreZiua = async ()=>{
        if (!utilizatorCurent || !formData.data_lucru) return;
        setLoadingValidari(true);
        try {
            const response = await fetch(`/api/rapoarte/timetracking?utilizator_uid=${utilizatorCurent.uid}&data_lucru=${formData.data_lucru}&validare_limita=true`);
            const data = await response.json();
            if (data.success) {
                const totalOre = data.total_ore_ziua || 0;
                setTimpTotalZiua(totalOre);
                if (totalOre >= 8) {
                    setErrors((prev)=>({
                            ...prev,
                            ore_lucrate: `Ai deja ${totalOre}h înregistrate pentru această zi. Limita zilnică: 8h`
                        }));
                } else {
                    setErrors((prev)=>{
                        const newErrors = {
                            ...prev
                        };
                        delete newErrors.ore_lucrate;
                        return newErrors;
                    });
                }
            }
        } catch (error) {
            console.error("Eroare la verificarea timpului zilnic:", error);
        } finally{
            setLoadingValidari(false);
        }
    };
    const handleInputChange = (field, value)=>{
        setFormData((prev)=>({
                ...prev,
                [field]: value
            }));
        // Validări în timp real
        if (field === "ore_lucrate") {
            validateOre(value);
        }
        // Șterge eroarea pentru câmpul curent
        if (errors[field]) {
            setErrors((prev)=>{
                const newErrors = {
                    ...prev
                };
                delete newErrors[field];
                return newErrors;
            });
        }
    };
    const validateOre = (value)=>{
        const ore = parseFloat(value);
        if (isNaN(ore) || ore <= 0) {
            setErrors((prev)=>({
                    ...prev,
                    ore_lucrate: "Orele trebuie să fie un număr pozitiv"
                }));
            return false;
        }
        if (ore > 16) {
            setErrors((prev)=>({
                    ...prev,
                    ore_lucrate: "Maxim 16 ore pe \xeenregistrare"
                }));
            return false;
        }
        const totalCuNoua = timpTotalZiua + ore;
        if (totalCuNoua > 16) {
            setErrors((prev)=>({
                    ...prev,
                    ore_lucrate: `Total zilnic ar fi ${totalCuNoua.toFixed(1)}h. Limita zilnică: 16h`
                }));
            return false;
        }
        if (totalCuNoua > 8) {
            // Avertisment, nu eroare
            setErrors((prev)=>({
                    ...prev,
                    ore_lucrate: `Avertisment: Total zilnic va fi ${totalCuNoua.toFixed(1)}h (peste 8h normale)`
                }));
        }
        return true;
    };
    const validateForm = ()=>{
        const newErrors = {};
        if (!formData.sarcina_id) {
            newErrors.sarcina_id = "Selectează o sarcină";
        }
        if (!formData.data_lucru) {
            newErrors.data_lucru = "Data lucrului este obligatorie";
        }
        if (!formData.ore_lucrate) {
            newErrors.ore_lucrate = "Orele lucrate sunt obligatorii";
        } else if (!validateOre(formData.ore_lucrate)) {
        // Validarea orelor setează deja eroarea
        }
        if (!formData.descriere_lucru.trim()) {
            newErrors.descriere_lucru = "Descrierea lucrului este obligatorie";
        }
        // Verifică dacă data nu este în viitor
        const dataLucru = new Date(formData.data_lucru);
        const astazi = new Date();
        astazi.setHours(23, 59, 59, 999); // Sfârșitul zilei de astăzi
        if (dataLucru > astazi) {
            newErrors.data_lucru = "Data lucrului nu poate fi \xeen viitor";
        }
        setErrors(newErrors);
        return Object.keys(newErrors).length === 0;
    };
    const handleSubmit = async (e)=>{
        e.preventDefault();
        if (!utilizatorCurent) {
            TimeTrackingNouModal_showToast("Nu s-au putut prelua datele utilizatorului curent", "error");
            return;
        }
        if (!validateForm()) {
            TimeTrackingNouModal_showToast("Corectează erorile din formular", "error");
            return;
        }
        setLoading(true);
        try {
            // Găsește titlul sarcinii
            const sarcinaSelectata = sarcini.find((s)=>s.id === formData.sarcina_id);
            const timeData = {
                id: `TIME_${Date.now()}_${Math.random().toString(36).substr(2, 6)}`,
                sarcina_id: formData.sarcina_id,
                utilizator_uid: utilizatorCurent.uid,
                utilizator_nume: utilizatorCurent.nume_complet,
                data_lucru: formData.data_lucru,
                ore_lucrate: parseFloat(formData.ore_lucrate),
                descriere_lucru: formData.descriere_lucru.trim(),
                tip_inregistrare: "manual",
                sarcina_titlu: sarcinaSelectata?.titlu || "Sarcină necunoscută"
            };
            console.log("\xcenregistrez timp:", timeData);
            const response = await fetch("/api/rapoarte/timetracking", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(timeData)
            });
            const result = await response.json();
            if (result.success) {
                TimeTrackingNouModal_showToast("Timp \xeenregistrat cu succes!", "success");
                onTimeAdded();
                resetForm();
            } else {
                TimeTrackingNouModal_showToast(result.error || "Eroare la \xeenregistrarea timpului", "error");
            }
        } catch (error) {
            console.error("Eroare la \xeenregistrarea timpului:", error);
            TimeTrackingNouModal_showToast("Eroare la \xeenregistrarea timpului", "error");
        } finally{
            setLoading(false);
        }
    };
    const getSarcinaStatus = (status)=>{
        switch(status){
            case "\xcen lucru":
                return {
                    color: "#f39c12",
                    icon: "\uD83D\uDD04"
                };
            case "De făcut":
                return {
                    color: "#95a5a6",
                    icon: "\uD83D\uDCCB"
                };
            case "\xcen verificare":
                return {
                    color: "#9b59b6",
                    icon: "\uD83D\uDD0D"
                };
            case "Finalizată":
                return {
                    color: "#27ae60",
                    icon: "✅"
                };
            default:
                return {
                    color: "#7f8c8d",
                    icon: "❓"
                };
        }
    };
    if (!isOpen) return null;
    return  false ? /*#__PURE__*/ 0 : null;
}

;// CONCATENATED MODULE: ./app/admin/rapoarte/proiecte/components/SarciniProiectModal.tsx
// ==================================================================
// CALEA: app/admin/rapoarte/proiecte/components/SarciniProiectModal.tsx
// DATA: 24.08.2025 22:15 (ora României)
// MODIFICAT: FIXAT sincronizarea timp real status/progres în frontend
// PĂSTRATE: Toate funcționalitățile existente + progres + editare inline
// ==================================================================
/* __next_internal_client_entry_do_not_use__ default auto */ 






// Toast system
const SarciniProiectModal_showToast = (message, type = "info")=>{
    const toastEl = document.createElement("div");
    toastEl.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(12px);
    color: ${type === "success" ? "#27ae60" : type === "error" ? "#e74c3c" : "#3498db"};
    padding: 16px 20px;
    border-radius: 16px;
    z-index: 75000;
    font-family: 'Inter', Arial, sans-serif;
    font-size: 14px;
    font-weight: 500;
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    border: 1px solid rgba(255, 255, 255, 0.2);
    max-width: 400px;
    word-wrap: break-word;
    transform: translateY(-10px);
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  `;
    toastEl.textContent = message;
    document.body.appendChild(toastEl);
    setTimeout(()=>{
        toastEl.style.transform = "translateY(0)";
        toastEl.style.opacity = "1";
    }, 10);
    setTimeout(()=>{
        toastEl.style.transform = "translateY(-10px)";
        toastEl.style.opacity = "0";
        setTimeout(()=>{
            if (document.body.contains(toastEl)) {
                document.body.removeChild(toastEl);
            }
        }, 300);
    }, type === "success" || type === "error" ? 4000 : 6000);
};
function SarciniProiectModal({ isOpen, onClose, proiect }) {
    const [activeTab, setActiveTab] = (0,react_experimental_.useState)("sarcini");
    const [loading, setLoading] = (0,react_experimental_.useState)(false);
    // Hook Firebase pentru utilizatorul autentificat
    const [firebaseUser, firebaseLoading, firebaseError] = (0,index_cjs/* useAuthState */.F_)(firebaseConfig/* auth */.I);
    // State pentru utilizatorul curent
    const [utilizatorCurent, setUtilizatorCurent] = (0,react_experimental_.useState)(null);
    const [loadingUtilizator, setLoadingUtilizator] = (0,react_experimental_.useState)(false);
    // State pentru sarcini
    const [sarcini, setSarcini] = (0,react_experimental_.useState)([]);
    const [showSarcinaNouaModal, setShowSarcinaNouaModal] = (0,react_experimental_.useState)(false);
    // State pentru editare inline cu progres - ÎMBUNĂTĂȚIT
    const [editingSarcina, setEditingSarcina] = (0,react_experimental_.useState)(null);
    const [editData, setEditData] = (0,react_experimental_.useState)({});
    const [savingEdit, setSavingEdit] = (0,react_experimental_.useState)(false);
    // State pentru comentarii
    const [comentarii, setComentarii] = (0,react_experimental_.useState)([]);
    const [newComentariu, setNewComentariu] = (0,react_experimental_.useState)("");
    const [tipComentariu, setTipComentariu] = (0,react_experimental_.useState)("General");
    // State pentru time tracking
    const [timeTracking, setTimeTracking] = (0,react_experimental_.useState)([]);
    const [showTimeModal, setShowTimeModal] = (0,react_experimental_.useState)(false);
    // FIXAT: Funcție formatDate compatibilă cu obiectele BigQuery + timezone România corect
    const formatDate = (date)=>{
        if (!date) return "N/A";
        try {
            const dateValue = typeof date === "string" ? date : typeof date === "object" && date.value ? date.value : date.toString();
            const parsedDate = new Date(dateValue);
            if (isNaN(parsedDate.getTime())) {
                console.warn("Data invalidă primită:", date);
                return "Data invalidă";
            }
            // FIXAT: Adăugat timeZone pentru conversie corectă UTC -> România  
            return parsedDate.toLocaleDateString("ro-RO", {
                year: "numeric",
                month: "2-digit",
                day: "2-digit",
                hour: "2-digit",
                minute: "2-digit",
                timeZone: "Europe/Bucharest" // FIXAT: timezone România (UTC+2/UTC+3)
            });
        } catch (error) {
            console.error("Eroare la formatarea datei:", date, error);
            return "Eroare dată";
        }
    };
    // Funcție pentru formatarea timpului estimat
    const formatTimpEstimat = (zile, ore, totalOre)=>{
        const zileNum = Number(zile) || 0;
        const oreNum = Number(ore) || 0;
        const totalOreNum = Number(totalOre) || 0;
        if (totalOreNum === 0) {
            return "Nestabilit";
        }
        const parts = [];
        if (zileNum > 0) {
            parts.push(`${zileNum} ${zileNum === 1 ? "zi" : "zile"}`);
        }
        if (oreNum > 0) {
            parts.push(`${oreNum}h`);
        }
        return parts.length > 0 ? `${parts.join(", ")} (${totalOreNum.toFixed(1)}h total)` : `${totalOreNum.toFixed(1)}h`;
    };
    // Funcție pentru culoarea progresului
    const getProgressColor = (procent)=>{
        const prog = procent || 0;
        if (prog < 25) return "#e74c3c"; // Roșu
        if (prog < 75) return "#f39c12"; // Galben/Portocaliu
        return "#27ae60"; // Verde
    };
    // Componenta bară de progres
    const ProgressBar = ({ procent, size = "normal" })=>{
        const progress = procent || 0;
        const height = size === "small" ? "8px" : "16px";
        const fontSize = size === "small" ? "10px" : "11px";
        return /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
            style: {
                background: "#f8f9fa",
                height,
                borderRadius: height,
                position: "relative",
                border: "1px solid #dee2e6",
                overflow: "hidden",
                minWidth: size === "small" ? "60px" : "100px"
            },
            children: [
                /*#__PURE__*/ jsx_runtime_.jsx("div", {
                    style: {
                        background: `linear-gradient(90deg, ${getProgressColor(progress)} 0%, ${getProgressColor(progress)} 100%)`,
                        height: "100%",
                        width: `${progress}%`,
                        borderRadius: height,
                        transition: "all 0.3s ease"
                    }
                }),
                size === "normal" && progress > 20 && /*#__PURE__*/ (0,jsx_runtime_.jsxs)("span", {
                    style: {
                        position: "absolute",
                        top: "50%",
                        left: "50%",
                        transform: "translate(-50%, -50%)",
                        color: progress > 50 ? "white" : "#2c3e50",
                        fontSize,
                        fontWeight: "bold",
                        textShadow: progress > 50 ? "0 1px 2px rgba(0,0,0,0.3)" : "none"
                    },
                    children: [
                        progress,
                        "%"
                    ]
                })
            ]
        });
    };
    (0,react_experimental_.useEffect)(()=>{
        if (isOpen) {
            loadData();
        }
    }, [
        isOpen,
        activeTab
    ]);
    (0,react_experimental_.useEffect)(()=>{
        if (isOpen && firebaseUser && !firebaseLoading) {
            loadUtilizatorCurent();
        }
    }, [
        isOpen,
        firebaseUser,
        firebaseLoading
    ]);
    const loadUtilizatorCurent = async ()=>{
        if (!firebaseUser) {
            console.error("Nu există utilizator Firebase autentificat");
            SarciniProiectModal_showToast("Nu există utilizator autentificat", "error");
            return;
        }
        setLoadingUtilizator(true);
        try {
            const response = await fetch("/api/utilizatori/curent", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    uid: firebaseUser.uid
                })
            });
            const data = await response.json();
            if (data.success && data.data) {
                const user = data.data;
                setUtilizatorCurent({
                    uid: user.uid,
                    email: user.email,
                    nume: user.nume || "",
                    prenume: user.prenume || "",
                    nume_complet: user.nume_complet,
                    rol: user.rol
                });
            } else {
                // Fallback cu datele din Firebase
                setUtilizatorCurent({
                    uid: firebaseUser.uid,
                    email: firebaseUser.email || "email@necunoscut.com",
                    nume: "",
                    prenume: "",
                    nume_complet: firebaseUser.displayName || firebaseUser.email || "Utilizator Necunoscut",
                    rol: "normal"
                });
                SarciniProiectModal_showToast("S-au folosit datele Firebase ca fallback", "info");
            }
        } catch (error) {
            console.error("Eroare la \xeencărcarea utilizatorului curent:", error);
            // Fallback final cu datele din Firebase
            setUtilizatorCurent({
                uid: firebaseUser.uid,
                email: firebaseUser.email || "email@necunoscut.com",
                nume: "",
                prenume: "",
                nume_complet: firebaseUser.displayName || firebaseUser.email || "Utilizator Necunoscut",
                rol: "normal"
            });
            SarciniProiectModal_showToast("Eroare la \xeencărcarea datelor utilizator, se folosesc datele Firebase", "error");
        } finally{
            setLoadingUtilizator(false);
        }
    };
    const loadData = async ()=>{
        setLoading(true);
        try {
            switch(activeTab){
                case "sarcini":
                    await loadSarcini();
                    break;
                case "comentarii":
                    await loadComentarii();
                    break;
                case "timetracking":
                    await loadTimeTracking();
                    break;
            }
        } catch (error) {
            console.error("Eroare la \xeencărcarea datelor:", error);
            SarciniProiectModal_showToast("Eroare la \xeencărcarea datelor", "error");
        } finally{
            setLoading(false);
        }
    };
    const loadSarcini = async ()=>{
        try {
            const response = await fetch(`/api/rapoarte/sarcini?proiect_id=${encodeURIComponent(proiect.ID_Proiect)}&tip_proiect=${proiect.tip || "proiect"}`);
            const data = await response.json();
            if (data.success) {
                setSarcini(data.data || []);
            } else {
                SarciniProiectModal_showToast("Eroare la \xeencărcarea sarcinilor", "error");
            }
        } catch (error) {
            console.error("Eroare la \xeencărcarea sarcinilor:", error);
            SarciniProiectModal_showToast("Eroare la \xeencărcarea sarcinilor", "error");
        }
    };
    const loadComentarii = async ()=>{
        try {
            const response = await fetch(`/api/rapoarte/comentarii?proiect_id=${encodeURIComponent(proiect.ID_Proiect)}&tip_proiect=${proiect.tip || "proiect"}`);
            const data = await response.json();
            if (data.success) {
                setComentarii(data.data || []);
            } else {
                SarciniProiectModal_showToast("Eroare la \xeencărcarea comentariilor", "error");
            }
        } catch (error) {
            console.error("Eroare la \xeencărcarea comentariilor:", error);
            SarciniProiectModal_showToast("Eroare la \xeencărcarea comentariilor", "error");
        }
    };
    const loadTimeTracking = async ()=>{
        try {
            const response = await fetch(`/api/rapoarte/timetracking?proiect_id=${encodeURIComponent(proiect.ID_Proiect)}`);
            const data = await response.json();
            if (data.success) {
                setTimeTracking(data.data || []);
            } else {
                SarciniProiectModal_showToast("Eroare la \xeencărcarea time tracking", "error");
            }
        } catch (error) {
            console.error("Eroare la \xeencărcarea time tracking:", error);
            SarciniProiectModal_showToast("Eroare la \xeencărcarea time tracking", "error");
        }
    };
    const handleAddComentariu = async ()=>{
        if (!newComentariu.trim()) {
            SarciniProiectModal_showToast("Comentariul nu poate fi gol", "error");
            return;
        }
        if (!utilizatorCurent) {
            SarciniProiectModal_showToast("Nu s-au putut prelua datele utilizatorului curent", "error");
            return;
        }
        try {
            setLoading(true);
            const response = await fetch("/api/rapoarte/comentarii", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    id: `COM_${Date.now()}_${Math.random().toString(36).substr(2, 6)}`,
                    proiect_id: proiect.ID_Proiect,
                    tip_proiect: proiect.tip || "proiect",
                    autor_uid: utilizatorCurent.uid,
                    autor_nume: utilizatorCurent.nume_complet,
                    comentariu: newComentariu.trim(),
                    tip_comentariu: tipComentariu
                })
            });
            const result = await response.json();
            if (result.success) {
                SarciniProiectModal_showToast("Comentariu adăugat cu succes", "success");
                setNewComentariu("");
                setTipComentariu("General");
                await loadComentarii();
            } else {
                SarciniProiectModal_showToast(result.error || "Eroare la adăugarea comentariului", "error");
            }
        } catch (error) {
            console.error("Eroare la adăugarea comentariului:", error);
            SarciniProiectModal_showToast("Eroare la adăugarea comentariului", "error");
        } finally{
            setLoading(false);
        }
    };
    // FIXAT: Funcții pentru editare inline cu logică inteligentă și sincronizare timp real
    const startEdit = (sarcina)=>{
        setEditingSarcina(sarcina.id);
        setEditData({
            titlu: sarcina.titlu,
            descriere: sarcina.descriere || "",
            prioritate: sarcina.prioritate,
            status: sarcina.status,
            data_scadenta: sarcina.data_scadenta ? typeof sarcina.data_scadenta === "string" ? sarcina.data_scadenta : sarcina.data_scadenta.value : "",
            observatii: sarcina.observatii || "",
            timp_estimat_zile: sarcina.timp_estimat_zile || 0,
            timp_estimat_ore: sarcina.timp_estimat_ore || 0,
            progres_procent: sarcina.progres_procent || 0,
            progres_descriere: sarcina.progres_descriere || ""
        });
    };
    const cancelEdit = ()=>{
        setEditingSarcina(null);
        setEditData({});
    };
    // FIXAT: Funcție pentru actualizarea sincronizată status/progres în timp real
    const handleStatusChange = (newStatus)=>{
        setEditData((prev)=>{
            const updated = {
                ...prev,
                status: newStatus
            };
            // FIXAT: Dacă status devine 'Finalizată', forțează progres la 100%
            if (newStatus === "Finalizată") {
                updated.progres_procent = 100;
                updated.progres_descriere = updated.progres_descriere || "Sarcină finalizată manual - progres setat la 100%";
                SarciniProiectModal_showToast("Status finalizat - progresul va fi setat automat la 100%", "info");
            }
            return updated;
        });
    };
    // FIXAT: Funcție pentru actualizarea sincronizată progres/status în timp real
    const handleProgresChange = (newProgres)=>{
        const progresNumeric = parseInt(newProgres) || 0;
        setEditData((prev)=>{
            const updated = {
                ...prev,
                progres_procent: progresNumeric
            };
            // FIXAT: Dacă progres devine 100%, forțează status la 'Finalizată'
            if (progresNumeric === 100) {
                updated.status = "Finalizată";
                updated.progres_descriere = updated.progres_descriere || "Sarcină finalizată automat la 100% progres";
                SarciniProiectModal_showToast("Progres 100% - sarcina va fi marcată automat ca finalizată", "info");
            }
            return updated;
        });
    };
    // FIXAT: Logică inteligentă pentru evitarea duplicate fields
    const saveEdit = async (sarcinaId)=>{
        if (!utilizatorCurent) {
            SarciniProiectModal_showToast("Nu s-au putut prelua datele utilizatorului curent", "error");
            return;
        }
        // Validări
        if (!editData.titlu?.trim()) {
            SarciniProiectModal_showToast("Titlul sarcinii este obligatoriu", "error");
            return;
        }
        const zileString = editData.timp_estimat_zile?.toString() || "";
        const oreString = editData.timp_estimat_ore?.toString() || "";
        // Validare că zilele sunt numere întregi
        if (zileString && zileString.includes(".")) {
            SarciniProiectModal_showToast("Zilele trebuie să fie numere \xeentregi (ex: 1, 2, 3), nu zecimale!", "error");
            return;
        }
        const zile = parseInt(editData.timp_estimat_zile) || 0;
        const ore = parseFloat(editData.timp_estimat_ore) || 0;
        if (zile < 0) {
            SarciniProiectModal_showToast("Zilele estimate nu pot fi negative", "error");
            return;
        }
        if (!Number.isInteger(zile)) {
            SarciniProiectModal_showToast("Zilele trebuie să fie numere \xeentregi (0, 1, 2, 3...)", "error");
            return;
        }
        if (ore < 0 || ore >= 8) {
            SarciniProiectModal_showToast("Orele estimate trebuie să fie \xeentre 0 și 7.9", "error");
            return;
        }
        if (zile === 0 && ore === 0) {
            SarciniProiectModal_showToast("Specifică cel puțin o estimare de timp", "error");
            return;
        }
        // Validare progres
        const progres = parseInt(editData.progres_procent) || 0;
        if (progres < 0 || progres > 100) {
            SarciniProiectModal_showToast("Progresul trebuie să fie \xeentre 0 și 100 procente", "error");
            return;
        }
        setSavingEdit(true);
        try {
            // FIXAT: Construim payload-ul cu logică inteligentă pentru evitarea conflictelor
            const payload = {
                id: sarcinaId,
                updated_by: utilizatorCurent.uid,
                // Câmpurile de bază
                titlu: editData.titlu.trim(),
                descriere: editData.descriere?.trim() || null,
                prioritate: editData.prioritate,
                observatii: editData.observatii?.trim() || null,
                data_scadenta: editData.data_scadenta || null,
                timp_estimat_zile: zile,
                timp_estimat_ore: ore
            };
            // FIXAT: Logică inteligentă pentru status și progres
            // Frontend-ul deja are sincronizarea făcută prin handleStatusChange/handleProgresChange
            // Trimitem valorile finale la backend
            payload.status = editData.status;
            payload.progres_procent = progres;
            payload.progres_descriere = editData.progres_descriere?.trim() || null;
            console.log("Payload pentru actualizare sarcină (cu sincronizare frontend):", JSON.stringify(payload, null, 2));
            const response = await fetch("/api/rapoarte/sarcini", {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(payload)
            });
            const result = await response.json();
            if (result.success) {
                SarciniProiectModal_showToast("Sarcină actualizată cu succes", "success");
                setEditingSarcina(null);
                setEditData({});
                await loadSarcini();
            } else {
                SarciniProiectModal_showToast(result.error || "Eroare la actualizarea sarcinii", "error");
            }
        } catch (error) {
            console.error("Eroare la actualizarea sarcinii:", error);
            SarciniProiectModal_showToast("Eroare la actualizarea sarcinii", "error");
        } finally{
            setSavingEdit(false);
        }
    };
    const handleSarcinaAdded = ()=>{
        setShowSarcinaNouaModal(false);
        loadSarcini();
        SarciniProiectModal_showToast("Sarcină adăugată cu succes", "success");
    };
    const handleTimeAdded = ()=>{
        setShowTimeModal(false);
        loadTimeTracking();
        SarciniProiectModal_showToast("Timp \xeenregistrat cu succes", "success");
    };
    const getPriorityColor = (prioritate)=>{
        switch(prioritate){
            case "Critică":
                return "#e74c3c";
            case "\xcenaltă":
                return "#f39c12";
            case "Medie":
                return "#3498db";
            case "Scăzută":
                return "#95a5a6";
            default:
                return "#7f8c8d";
        }
    };
    const getStatusColor = (status)=>{
        switch(status){
            case "Finalizată":
                return "#27ae60";
            case "\xcen lucru":
                return "#f39c12";
            case "\xcen verificare":
                return "#9b59b6";
            case "De făcut":
                return "#95a5a6";
            default:
                return "#7f8c8d";
        }
    };
    // Nu afișa modalul dacă nu este deschis sau există erori Firebase
    if (!isOpen || firebaseError) {
        if (firebaseError) {
            console.error("Eroare Firebase Auth:", firebaseError);
        }
        return null;
    }
    // Loading pentru Firebase Auth
    if (firebaseLoading) {
        return /*#__PURE__*/ jsx_runtime_.jsx("div", {
            style: {
                position: "fixed",
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                background: "rgba(0,0,0,0.7)",
                zIndex: 50000,
                display: "flex",
                alignItems: "center",
                justifyContent: "center"
            },
            children: /*#__PURE__*/ jsx_runtime_.jsx("div", {
                style: {
                    background: "white",
                    borderRadius: "16px",
                    padding: "2rem",
                    textAlign: "center",
                    color: "#2c3e50"
                },
                children: "Se \xeencarcă autentificarea..."
            })
        });
    }
    // Verificare window pentru SSR
    if (true) {
        return null;
    }
    return /*#__PURE__*/ (0,jsx_runtime_.jsxs)(jsx_runtime_.Fragment, {
        children: [
            /*#__PURE__*/ (0,server_rendering_stub_.createPortal)(/*#__PURE__*/ jsx_runtime_.jsx("div", {
                style: {
                    position: "fixed",
                    top: 0,
                    left: 0,
                    right: 0,
                    bottom: 0,
                    background: "rgba(0,0,0,0.8)",
                    zIndex: 55000,
                    display: "flex",
                    alignItems: "center",
                    justifyContent: "center",
                    padding: "1rem"
                },
                children: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                    style: {
                        background: "white",
                        borderRadius: "16px",
                        boxShadow: "0 20px 40px rgba(0,0,0,0.3)",
                        maxWidth: "1200px",
                        width: "100%",
                        maxHeight: "90vh",
                        display: "flex",
                        flexDirection: "column"
                    },
                    children: [
                        /*#__PURE__*/ jsx_runtime_.jsx("div", {
                            style: {
                                padding: "1.5rem",
                                borderBottom: "1px solid #dee2e6",
                                background: "linear-gradient(135deg, #667eea 0%, #764ba2 100%)",
                                borderRadius: "16px 16px 0 0"
                            },
                            children: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                style: {
                                    display: "flex",
                                    justifyContent: "space-between",
                                    alignItems: "center"
                                },
                                children: [
                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                        children: [
                                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("h2", {
                                                style: {
                                                    margin: 0,
                                                    color: "white",
                                                    fontSize: "1.5rem",
                                                    fontWeight: "700"
                                                },
                                                children: [
                                                    proiect.tip === "subproiect" ? "Subproiect" : "Proiect",
                                                    ": ",
                                                    proiect.ID_Proiect
                                                ]
                                            }),
                                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("p", {
                                                style: {
                                                    margin: "0.5rem 0 0 0",
                                                    color: "rgba(255, 255, 255, 0.9)",
                                                    fontSize: "14px"
                                                },
                                                children: [
                                                    proiect.Denumire,
                                                    " • Client: ",
                                                    proiect.Client
                                                ]
                                            }),
                                            utilizatorCurent && /*#__PURE__*/ (0,jsx_runtime_.jsxs)("p", {
                                                style: {
                                                    margin: "0.25rem 0 0 0",
                                                    color: "rgba(255, 255, 255, 0.8)",
                                                    fontSize: "12px"
                                                },
                                                children: [
                                                    "Conectat ca: ",
                                                    utilizatorCurent.nume_complet,
                                                    " (",
                                                    utilizatorCurent.rol,
                                                    ")"
                                                ]
                                            }),
                                            loadingUtilizator && /*#__PURE__*/ jsx_runtime_.jsx("p", {
                                                style: {
                                                    margin: "0.25rem 0 0 0",
                                                    color: "rgba(255, 255, 255, 0.8)",
                                                    fontSize: "12px"
                                                },
                                                children: "Se incarca datele utilizatorului..."
                                            })
                                        ]
                                    }),
                                    /*#__PURE__*/ jsx_runtime_.jsx("button", {
                                        onClick: onClose,
                                        disabled: loading,
                                        style: {
                                            background: "rgba(255, 255, 255, 0.2)",
                                            border: "none",
                                            borderRadius: "12px",
                                            width: "40px",
                                            height: "40px",
                                            fontSize: "20px",
                                            cursor: "pointer",
                                            color: "white"
                                        },
                                        children: "\xd7"
                                    })
                                ]
                            })
                        }),
                        /*#__PURE__*/ jsx_runtime_.jsx("div", {
                            style: {
                                display: "flex",
                                borderBottom: "1px solid #dee2e6",
                                background: "#f8f9fa"
                            },
                            children: [
                                {
                                    key: "sarcini",
                                    label: "Sarcini",
                                    icon: "\uD83D\uDCCB"
                                },
                                {
                                    key: "comentarii",
                                    label: "Comentarii",
                                    icon: "\uD83D\uDCAC"
                                },
                                {
                                    key: "timetracking",
                                    label: "Time Tracking",
                                    icon: "⏱️"
                                }
                            ].map((tab)=>/*#__PURE__*/ (0,jsx_runtime_.jsxs)("button", {
                                    onClick: ()=>setActiveTab(tab.key),
                                    style: {
                                        padding: "1rem 1.5rem",
                                        border: "none",
                                        background: activeTab === tab.key ? "white" : "transparent",
                                        color: activeTab === tab.key ? "#2c3e50" : "#7f8c8d",
                                        fontWeight: activeTab === tab.key ? "bold" : "normal",
                                        cursor: "pointer",
                                        borderBottom: activeTab === tab.key ? "3px solid #3498db" : "3px solid transparent",
                                        transition: "all 0.3s ease"
                                    },
                                    children: [
                                        tab.icon,
                                        " ",
                                        tab.label
                                    ]
                                }, tab.key))
                        }),
                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                            style: {
                                flex: 1,
                                overflow: "auto",
                                padding: "1.5rem"
                            },
                            children: [
                                loading && /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                    style: {
                                        textAlign: "center",
                                        padding: "2rem",
                                        color: "#7f8c8d"
                                    },
                                    children: "Se incarca datele..."
                                }),
                                activeTab === "sarcini" && !loading && /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                    children: [
                                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                            style: {
                                                display: "flex",
                                                justifyContent: "space-between",
                                                alignItems: "center",
                                                marginBottom: "1.5rem"
                                            },
                                            children: [
                                                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("h3", {
                                                    style: {
                                                        margin: 0,
                                                        color: "#2c3e50"
                                                    },
                                                    children: [
                                                        "Sarcini (",
                                                        sarcini.length,
                                                        ")"
                                                    ]
                                                }),
                                                /*#__PURE__*/ jsx_runtime_.jsx("button", {
                                                    onClick: ()=>setShowSarcinaNouaModal(true),
                                                    disabled: !utilizatorCurent,
                                                    style: {
                                                        padding: "0.75rem 1.5rem",
                                                        background: !utilizatorCurent ? "#bdc3c7" : "linear-gradient(135deg, #27ae60 0%, #2ecc71 100%)",
                                                        color: "white",
                                                        border: "none",
                                                        borderRadius: "8px",
                                                        cursor: !utilizatorCurent ? "not-allowed" : "pointer",
                                                        fontSize: "14px",
                                                        fontWeight: "bold"
                                                    },
                                                    children: "+ Sarcina Noua"
                                                })
                                            ]
                                        }),
                                        sarcini.length === 0 ? /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                            style: {
                                                textAlign: "center",
                                                padding: "3rem",
                                                color: "#7f8c8d",
                                                background: "#f8f9fa",
                                                borderRadius: "8px",
                                                border: "2px dashed #dee2e6"
                                            },
                                            children: [
                                                /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                    style: {
                                                        fontSize: "48px",
                                                        marginBottom: "1rem"
                                                    },
                                                    children: "\uD83D\uDCCB"
                                                }),
                                                /*#__PURE__*/ jsx_runtime_.jsx("h4", {
                                                    style: {
                                                        margin: "0 0 0.5rem 0"
                                                    },
                                                    children: "Nu exista sarcini"
                                                }),
                                                /*#__PURE__*/ jsx_runtime_.jsx("p", {
                                                    style: {
                                                        margin: 0
                                                    },
                                                    children: "Adauga prima sarcina pentru acest proiect"
                                                })
                                            ]
                                        }) : /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                            style: {
                                                display: "grid",
                                                gap: "1rem"
                                            },
                                            children: sarcini.map((sarcina)=>/*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                    style: {
                                                        border: editingSarcina === sarcina.id ? "2px solid #3498db" : "1px solid #dee2e6",
                                                        borderRadius: "8px",
                                                        padding: "1rem",
                                                        background: editingSarcina === sarcina.id ? "#f8f9fa" : "white",
                                                        boxShadow: editingSarcina === sarcina.id ? "0 4px 12px rgba(52, 152, 219, 0.2)" : "0 2px 4px rgba(0,0,0,0.1)"
                                                    },
                                                    children: editingSarcina === sarcina.id ? // Form editabil inline cu progres IMBUNATATIT cu sincronizare timp real
                                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                        children: [
                                                            /*#__PURE__*/ jsx_runtime_.jsx("input", {
                                                                type: "text",
                                                                value: editData.titlu || "",
                                                                onChange: (e)=>setEditData((prev)=>({
                                                                            ...prev,
                                                                            titlu: e.target.value
                                                                        })),
                                                                style: {
                                                                    width: "100%",
                                                                    padding: "0.5rem",
                                                                    border: "1px solid #dee2e6",
                                                                    borderRadius: "4px",
                                                                    fontSize: "16px",
                                                                    fontWeight: "bold",
                                                                    marginBottom: "0.5rem"
                                                                },
                                                                placeholder: "Titlu sarcina..."
                                                            }),
                                                            (editData.progres_procent == 100 || editData.status === "Finalizată") && /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                style: {
                                                                    background: "#d1ecf1",
                                                                    border: "1px solid #bee5eb",
                                                                    color: "#0c5460",
                                                                    padding: "0.5rem",
                                                                    borderRadius: "4px",
                                                                    marginBottom: "1rem",
                                                                    fontSize: "12px"
                                                                },
                                                                children: [
                                                                    /*#__PURE__*/ jsx_runtime_.jsx("strong", {
                                                                        children: "Sincronizare activă:"
                                                                    }),
                                                                    " ",
                                                                    editData.progres_procent == 100 ? 'Progres 100% va seta statusul automat la "Finalizată"' : 'Status "Finalizată" va seta progresul automat la 100%'
                                                                ]
                                                            }),
                                                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                style: {
                                                                    display: "flex",
                                                                    gap: "0.5rem",
                                                                    marginBottom: "1rem"
                                                                },
                                                                children: [
                                                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("select", {
                                                                        value: editData.prioritate || "",
                                                                        onChange: (e)=>setEditData((prev)=>({
                                                                                    ...prev,
                                                                                    prioritate: e.target.value
                                                                                })),
                                                                        style: {
                                                                            padding: "0.25rem 0.5rem",
                                                                            border: "1px solid #dee2e6",
                                                                            borderRadius: "4px",
                                                                            fontSize: "12px"
                                                                        },
                                                                        children: [
                                                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                                                value: "Scăzută",
                                                                                children: "Scăzută"
                                                                            }),
                                                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                                                value: "Medie",
                                                                                children: "Medie"
                                                                            }),
                                                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                                                value: "\xcenaltă",
                                                                                children: "\xcenaltă"
                                                                            }),
                                                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                                                value: "Critică",
                                                                                children: "Critică"
                                                                            })
                                                                        ]
                                                                    }),
                                                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("select", {
                                                                        value: editData.status || "",
                                                                        onChange: (e)=>handleStatusChange(e.target.value),
                                                                        style: {
                                                                            padding: "0.25rem 0.5rem",
                                                                            border: "1px solid #dee2e6",
                                                                            borderRadius: "4px",
                                                                            fontSize: "12px",
                                                                            background: editData.status === "Finalizată" ? "#d4edda" : "white"
                                                                        },
                                                                        children: [
                                                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                                                value: "De făcut",
                                                                                children: "De făcut"
                                                                            }),
                                                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                                                value: "\xcen lucru",
                                                                                children: "\xcen lucru"
                                                                            }),
                                                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                                                value: "\xcen verificare",
                                                                                children: "\xcen verificare"
                                                                            }),
                                                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                                                value: "Finalizată",
                                                                                children: "Finalizată"
                                                                            })
                                                                        ]
                                                                    })
                                                                ]
                                                            }),
                                                            /*#__PURE__*/ jsx_runtime_.jsx("textarea", {
                                                                value: editData.descriere || "",
                                                                onChange: (e)=>setEditData((prev)=>({
                                                                            ...prev,
                                                                            descriere: e.target.value
                                                                        })),
                                                                placeholder: "Descrierea sarcinii...",
                                                                rows: 3,
                                                                style: {
                                                                    width: "100%",
                                                                    padding: "0.5rem",
                                                                    border: "1px solid #dee2e6",
                                                                    borderRadius: "4px",
                                                                    fontSize: "14px",
                                                                    marginBottom: "1rem",
                                                                    resize: "vertical"
                                                                }
                                                            }),
                                                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                style: {
                                                                    marginBottom: "1rem"
                                                                },
                                                                children: [
                                                                    /*#__PURE__*/ jsx_runtime_.jsx("label", {
                                                                        style: {
                                                                            display: "block",
                                                                            marginBottom: "0.5rem",
                                                                            fontWeight: "bold",
                                                                            fontSize: "14px"
                                                                        },
                                                                        children: "Progres"
                                                                    }),
                                                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                        style: {
                                                                            display: "grid",
                                                                            gridTemplateColumns: "100px 1fr auto",
                                                                            gap: "0.5rem",
                                                                            alignItems: "center"
                                                                        },
                                                                        children: [
                                                                            /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                                                children: /*#__PURE__*/ jsx_runtime_.jsx("input", {
                                                                                    type: "number",
                                                                                    min: "0",
                                                                                    max: "100",
                                                                                    step: "1",
                                                                                    value: editData.progres_procent || 0,
                                                                                    onChange: (e)=>handleProgresChange(e.target.value),
                                                                                    placeholder: "0-100",
                                                                                    style: {
                                                                                        width: "100%",
                                                                                        padding: "0.5rem",
                                                                                        border: "1px solid #dee2e6",
                                                                                        borderRadius: "4px",
                                                                                        fontSize: "12px",
                                                                                        background: editData.progres_procent == 100 ? "#d4edda" : "white"
                                                                                    }
                                                                                })
                                                                            }),
                                                                            /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                                                children: /*#__PURE__*/ jsx_runtime_.jsx(ProgressBar, {
                                                                                    procent: parseInt(editData.progres_procent) || 0
                                                                                })
                                                                            }),
                                                                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                                style: {
                                                                                    fontSize: "12px",
                                                                                    fontWeight: "bold",
                                                                                    color: "#2c3e50"
                                                                                },
                                                                                children: [
                                                                                    parseInt(editData.progres_procent) || 0,
                                                                                    "%"
                                                                                ]
                                                                            })
                                                                        ]
                                                                    }),
                                                                    /*#__PURE__*/ jsx_runtime_.jsx("textarea", {
                                                                        value: editData.progres_descriere || "",
                                                                        onChange: (e)=>setEditData((prev)=>({
                                                                                    ...prev,
                                                                                    progres_descriere: e.target.value
                                                                                })),
                                                                        placeholder: "Descriere progres...",
                                                                        rows: 2,
                                                                        style: {
                                                                            width: "100%",
                                                                            padding: "0.5rem",
                                                                            border: "1px solid #dee2e6",
                                                                            borderRadius: "4px",
                                                                            fontSize: "12px",
                                                                            marginTop: "0.5rem",
                                                                            resize: "vertical"
                                                                        }
                                                                    })
                                                                ]
                                                            }),
                                                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                style: {
                                                                    marginBottom: "1rem"
                                                                },
                                                                children: [
                                                                    /*#__PURE__*/ jsx_runtime_.jsx("label", {
                                                                        style: {
                                                                            display: "block",
                                                                            marginBottom: "0.5rem",
                                                                            fontWeight: "bold",
                                                                            fontSize: "14px"
                                                                        },
                                                                        children: "Timp Estimat"
                                                                    }),
                                                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                        style: {
                                                                            display: "grid",
                                                                            gridTemplateColumns: "1fr 1fr auto",
                                                                            gap: "0.5rem",
                                                                            alignItems: "center"
                                                                        },
                                                                        children: [
                                                                            /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                                                children: /*#__PURE__*/ jsx_runtime_.jsx("input", {
                                                                                    type: "number",
                                                                                    min: "0",
                                                                                    step: "1",
                                                                                    value: editData.timp_estimat_zile || "",
                                                                                    onChange: (e)=>{
                                                                                        const value = e.target.value;
                                                                                        if (!value.includes(".")) {
                                                                                            setEditData((prev)=>({
                                                                                                    ...prev,
                                                                                                    timp_estimat_zile: value
                                                                                                }));
                                                                                        }
                                                                                    },
                                                                                    onKeyPress: (e)=>{
                                                                                        if (e.key === "." || e.key === ",") {
                                                                                            e.preventDefault();
                                                                                        }
                                                                                    },
                                                                                    placeholder: "Zile (intregi)",
                                                                                    style: {
                                                                                        width: "100%",
                                                                                        padding: "0.5rem",
                                                                                        border: editData.timp_estimat_zile?.toString().includes(".") ? "2px solid #e74c3c" : "1px solid #dee2e6",
                                                                                        borderRadius: "4px",
                                                                                        fontSize: "12px"
                                                                                    }
                                                                                })
                                                                            }),
                                                                            /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                                                children: /*#__PURE__*/ jsx_runtime_.jsx("input", {
                                                                                    type: "number",
                                                                                    min: "0",
                                                                                    max: "7.9",
                                                                                    step: "0.1",
                                                                                    value: editData.timp_estimat_ore || "",
                                                                                    onChange: (e)=>setEditData((prev)=>({
                                                                                                ...prev,
                                                                                                timp_estimat_ore: e.target.value
                                                                                            })),
                                                                                    placeholder: "Ore",
                                                                                    style: {
                                                                                        width: "100%",
                                                                                        padding: "0.5rem",
                                                                                        border: "1px solid #dee2e6",
                                                                                        borderRadius: "4px",
                                                                                        fontSize: "12px"
                                                                                    }
                                                                                })
                                                                            }),
                                                                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                                style: {
                                                                                    background: "#f39c12",
                                                                                    color: "white",
                                                                                    padding: "0.5rem",
                                                                                    borderRadius: "4px",
                                                                                    textAlign: "center",
                                                                                    fontSize: "12px",
                                                                                    fontWeight: "bold",
                                                                                    minWidth: "60px"
                                                                                },
                                                                                children: [
                                                                                    ((parseInt(editData.timp_estimat_zile) || 0) * 8 + (parseFloat(editData.timp_estimat_ore) || 0)).toFixed(1),
                                                                                    "h"
                                                                                ]
                                                                            })
                                                                        ]
                                                                    })
                                                                ]
                                                            }),
                                                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                style: {
                                                                    display: "grid",
                                                                    gridTemplateColumns: "1fr 2fr",
                                                                    gap: "1rem",
                                                                    marginBottom: "1rem"
                                                                },
                                                                children: [
                                                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                        children: [
                                                                            /*#__PURE__*/ jsx_runtime_.jsx("label", {
                                                                                style: {
                                                                                    display: "block",
                                                                                    marginBottom: "0.25rem",
                                                                                    fontSize: "12px",
                                                                                    fontWeight: "bold"
                                                                                },
                                                                                children: "Data Scadenta"
                                                                            }),
                                                                            /*#__PURE__*/ jsx_runtime_.jsx("input", {
                                                                                type: "date",
                                                                                value: editData.data_scadenta || "",
                                                                                onChange: (e)=>setEditData((prev)=>({
                                                                                            ...prev,
                                                                                            data_scadenta: e.target.value
                                                                                        })),
                                                                                style: {
                                                                                    width: "100%",
                                                                                    padding: "0.5rem",
                                                                                    border: "1px solid #dee2e6",
                                                                                    borderRadius: "4px",
                                                                                    fontSize: "12px"
                                                                                }
                                                                            })
                                                                        ]
                                                                    }),
                                                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                        children: [
                                                                            /*#__PURE__*/ jsx_runtime_.jsx("label", {
                                                                                style: {
                                                                                    display: "block",
                                                                                    marginBottom: "0.25rem",
                                                                                    fontSize: "12px",
                                                                                    fontWeight: "bold"
                                                                                },
                                                                                children: "Observatii"
                                                                            }),
                                                                            /*#__PURE__*/ jsx_runtime_.jsx("input", {
                                                                                type: "text",
                                                                                value: editData.observatii || "",
                                                                                onChange: (e)=>setEditData((prev)=>({
                                                                                            ...prev,
                                                                                            observatii: e.target.value
                                                                                        })),
                                                                                placeholder: "Observatii suplimentare...",
                                                                                style: {
                                                                                    width: "100%",
                                                                                    padding: "0.5rem",
                                                                                    border: "1px solid #dee2e6",
                                                                                    borderRadius: "4px",
                                                                                    fontSize: "12px"
                                                                                }
                                                                            })
                                                                        ]
                                                                    })
                                                                ]
                                                            }),
                                                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                style: {
                                                                    display: "flex",
                                                                    justifyContent: "flex-end",
                                                                    gap: "0.5rem"
                                                                },
                                                                children: [
                                                                    /*#__PURE__*/ jsx_runtime_.jsx("button", {
                                                                        onClick: cancelEdit,
                                                                        disabled: savingEdit,
                                                                        style: {
                                                                            padding: "0.5rem 1rem",
                                                                            background: "#6c757d",
                                                                            color: "white",
                                                                            border: "none",
                                                                            borderRadius: "4px",
                                                                            cursor: "pointer",
                                                                            fontSize: "12px"
                                                                        },
                                                                        children: "Anuleaza"
                                                                    }),
                                                                    /*#__PURE__*/ jsx_runtime_.jsx("button", {
                                                                        onClick: ()=>saveEdit(sarcina.id),
                                                                        disabled: savingEdit || !editData.titlu?.trim(),
                                                                        style: {
                                                                            padding: "0.5rem 1rem",
                                                                            background: savingEdit || !editData.titlu?.trim() ? "#bdc3c7" : "#27ae60",
                                                                            color: "white",
                                                                            border: "none",
                                                                            borderRadius: "4px",
                                                                            cursor: savingEdit || !editData.titlu?.trim() ? "not-allowed" : "pointer",
                                                                            fontSize: "12px"
                                                                        },
                                                                        children: savingEdit ? "Se salveaza..." : "Salveaza"
                                                                    })
                                                                ]
                                                            })
                                                        ]
                                                    }) : // Afisare normala cu progres vizual - PASTRAT identic
                                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                        children: [
                                                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                style: {
                                                                    display: "flex",
                                                                    justifyContent: "space-between",
                                                                    alignItems: "flex-start",
                                                                    marginBottom: "0.5rem"
                                                                },
                                                                children: [
                                                                    /*#__PURE__*/ jsx_runtime_.jsx("h4", {
                                                                        style: {
                                                                            margin: 0,
                                                                            color: "#2c3e50"
                                                                        },
                                                                        children: sarcina.titlu
                                                                    }),
                                                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                        style: {
                                                                            display: "flex",
                                                                            gap: "0.5rem"
                                                                        },
                                                                        children: [
                                                                            /*#__PURE__*/ jsx_runtime_.jsx("span", {
                                                                                style: {
                                                                                    padding: "0.25rem 0.5rem",
                                                                                    background: getPriorityColor(sarcina.prioritate),
                                                                                    color: "white",
                                                                                    borderRadius: "12px",
                                                                                    fontSize: "12px",
                                                                                    fontWeight: "bold"
                                                                                },
                                                                                children: sarcina.prioritate
                                                                            }),
                                                                            /*#__PURE__*/ jsx_runtime_.jsx("span", {
                                                                                style: {
                                                                                    padding: "0.25rem 0.5rem",
                                                                                    background: getStatusColor(sarcina.status),
                                                                                    color: "white",
                                                                                    borderRadius: "12px",
                                                                                    fontSize: "12px",
                                                                                    fontWeight: "bold"
                                                                                },
                                                                                children: sarcina.status
                                                                            })
                                                                        ]
                                                                    })
                                                                ]
                                                            }),
                                                            sarcina.descriere && /*#__PURE__*/ jsx_runtime_.jsx("p", {
                                                                style: {
                                                                    margin: "0.5rem 0",
                                                                    color: "#7f8c8d",
                                                                    fontSize: "14px"
                                                                },
                                                                children: sarcina.descriere
                                                            }),
                                                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                style: {
                                                                    background: "rgba(52, 152, 219, 0.1)",
                                                                    border: "1px solid rgba(52, 152, 219, 0.3)",
                                                                    borderRadius: "6px",
                                                                    padding: "0.75rem",
                                                                    margin: "0.5rem 0",
                                                                    display: "grid",
                                                                    gridTemplateColumns: "auto 1fr auto",
                                                                    gap: "1rem",
                                                                    alignItems: "center"
                                                                },
                                                                children: [
                                                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                                        style: {
                                                                            fontSize: "13px",
                                                                            fontWeight: "bold",
                                                                            color: "#3498db"
                                                                        },
                                                                        children: "Progres:"
                                                                    }),
                                                                    /*#__PURE__*/ jsx_runtime_.jsx(ProgressBar, {
                                                                        procent: sarcina.progres_procent || 0
                                                                    }),
                                                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                        style: {
                                                                            fontSize: "14px",
                                                                            fontWeight: "bold",
                                                                            color: getProgressColor(sarcina.progres_procent || 0)
                                                                        },
                                                                        children: [
                                                                            sarcina.progres_procent || 0,
                                                                            "%"
                                                                        ]
                                                                    })
                                                                ]
                                                            }),
                                                            sarcina.progres_descriere && /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                style: {
                                                                    fontSize: "13px",
                                                                    color: "#7f8c8d",
                                                                    fontStyle: "italic",
                                                                    marginBottom: "0.5rem",
                                                                    background: "#f8f9fa",
                                                                    padding: "0.5rem",
                                                                    borderRadius: "4px"
                                                                },
                                                                children: [
                                                                    '"',
                                                                    sarcina.progres_descriere,
                                                                    '"'
                                                                ]
                                                            }),
                                                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                style: {
                                                                    background: "rgba(243, 156, 18, 0.1)",
                                                                    border: "1px solid rgba(243, 156, 18, 0.3)",
                                                                    borderRadius: "6px",
                                                                    padding: "0.5rem",
                                                                    margin: "0.5rem 0",
                                                                    fontSize: "13px"
                                                                },
                                                                children: [
                                                                    /*#__PURE__*/ jsx_runtime_.jsx("strong", {
                                                                        style: {
                                                                            color: "#f39c12"
                                                                        },
                                                                        children: "Timp estimat:"
                                                                    }),
                                                                    " ",
                                                                    formatTimpEstimat(sarcina.timp_estimat_zile || 0, sarcina.timp_estimat_ore || 0, sarcina.timp_estimat_total_ore || 0)
                                                                ]
                                                            }),
                                                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                style: {
                                                                    display: "flex",
                                                                    justifyContent: "space-between",
                                                                    alignItems: "center",
                                                                    marginTop: "1rem"
                                                                },
                                                                children: [
                                                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                        style: {
                                                                            fontSize: "12px",
                                                                            color: "#7f8c8d"
                                                                        },
                                                                        children: [
                                                                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("span", {
                                                                                children: [
                                                                                    "Responsabili: ",
                                                                                    sarcina.responsabili.map((r)=>r.responsabil_nume).join(", ") || "Neatribuit"
                                                                                ]
                                                                            }),
                                                                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("span", {
                                                                                style: {
                                                                                    marginLeft: "1rem"
                                                                                },
                                                                                children: [
                                                                                    "Timp lucrat: ",
                                                                                    sarcina.total_ore_lucrate,
                                                                                    "h"
                                                                                ]
                                                                            }),
                                                                            sarcina.data_scadenta && /*#__PURE__*/ (0,jsx_runtime_.jsxs)("span", {
                                                                                style: {
                                                                                    marginLeft: "1rem"
                                                                                },
                                                                                children: [
                                                                                    "Scadenta: ",
                                                                                    formatDate(sarcina.data_scadenta)
                                                                                ]
                                                                            })
                                                                        ]
                                                                    }),
                                                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                        style: {
                                                                            display: "flex",
                                                                            gap: "0.5rem"
                                                                        },
                                                                        children: [
                                                                            /*#__PURE__*/ jsx_runtime_.jsx("button", {
                                                                                onClick: ()=>startEdit(sarcina),
                                                                                disabled: editingSarcina !== null,
                                                                                style: {
                                                                                    padding: "0.5rem 1rem",
                                                                                    background: editingSarcina !== null ? "#bdc3c7" : "#3498db",
                                                                                    color: "white",
                                                                                    border: "none",
                                                                                    borderRadius: "6px",
                                                                                    cursor: editingSarcina !== null ? "not-allowed" : "pointer",
                                                                                    fontSize: "12px"
                                                                                },
                                                                                children: "Editeaza"
                                                                            }),
                                                                            /*#__PURE__*/ jsx_runtime_.jsx("button", {
                                                                                onClick: ()=>setShowTimeModal(true),
                                                                                style: {
                                                                                    padding: "0.5rem 1rem",
                                                                                    background: "#f39c12",
                                                                                    color: "white",
                                                                                    border: "none",
                                                                                    borderRadius: "6px",
                                                                                    cursor: "pointer",
                                                                                    fontSize: "12px"
                                                                                },
                                                                                children: "Adauga Timp"
                                                                            })
                                                                        ]
                                                                    })
                                                                ]
                                                            })
                                                        ]
                                                    })
                                                }, sarcina.id))
                                        })
                                    ]
                                }),
                                activeTab === "comentarii" && !loading && /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                    children: [
                                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                            style: {
                                                marginBottom: "1.5rem"
                                            },
                                            children: [
                                                /*#__PURE__*/ jsx_runtime_.jsx("h3", {
                                                    style: {
                                                        margin: "0 0 1rem 0",
                                                        color: "#2c3e50"
                                                    },
                                                    children: "Adauga Comentariu"
                                                }),
                                                /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                    style: {
                                                        display: "flex",
                                                        gap: "1rem",
                                                        marginBottom: "1rem"
                                                    },
                                                    children: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("select", {
                                                        value: tipComentariu,
                                                        onChange: (e)=>setTipComentariu(e.target.value),
                                                        style: {
                                                            padding: "0.75rem",
                                                            border: "1px solid #dee2e6",
                                                            borderRadius: "6px",
                                                            fontSize: "14px",
                                                            minWidth: "150px"
                                                        },
                                                        children: [
                                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                                value: "General",
                                                                children: "General"
                                                            }),
                                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                                value: "Status",
                                                                children: "Status"
                                                            }),
                                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                                value: "Problema",
                                                                children: "Problema"
                                                            }),
                                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                                value: "Progres",
                                                                children: "Progres"
                                                            })
                                                        ]
                                                    })
                                                }),
                                                /*#__PURE__*/ jsx_runtime_.jsx("textarea", {
                                                    value: newComentariu,
                                                    onChange: (e)=>setNewComentariu(e.target.value),
                                                    placeholder: "Scrie comentariul aici...",
                                                    rows: 4,
                                                    style: {
                                                        width: "100%",
                                                        padding: "0.75rem",
                                                        border: "1px solid #dee2e6",
                                                        borderRadius: "6px",
                                                        fontSize: "14px",
                                                        resize: "vertical",
                                                        marginBottom: "1rem"
                                                    }
                                                }),
                                                /*#__PURE__*/ jsx_runtime_.jsx("button", {
                                                    onClick: handleAddComentariu,
                                                    disabled: loading || !newComentariu.trim() || !utilizatorCurent,
                                                    style: {
                                                        padding: "0.75rem 1.5rem",
                                                        background: loading || !newComentariu.trim() || !utilizatorCurent ? "#bdc3c7" : "#27ae60",
                                                        color: "white",
                                                        border: "none",
                                                        borderRadius: "6px",
                                                        cursor: loading || !newComentariu.trim() || !utilizatorCurent ? "not-allowed" : "pointer",
                                                        fontSize: "14px",
                                                        fontWeight: "bold"
                                                    },
                                                    children: loading ? "Se adauga..." : "Adauga Comentariu"
                                                })
                                            ]
                                        }),
                                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                            style: {
                                                borderTop: "1px solid #dee2e6",
                                                paddingTop: "1.5rem"
                                            },
                                            children: [
                                                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("h3", {
                                                    style: {
                                                        margin: "0 0 1rem 0",
                                                        color: "#2c3e50"
                                                    },
                                                    children: [
                                                        "Istoric Comentarii (",
                                                        comentarii.length,
                                                        ")"
                                                    ]
                                                }),
                                                comentarii.length === 0 ? /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                    style: {
                                                        textAlign: "center",
                                                        padding: "3rem",
                                                        color: "#7f8c8d",
                                                        background: "#f8f9fa",
                                                        borderRadius: "8px",
                                                        border: "2px dashed #dee2e6"
                                                    },
                                                    children: [
                                                        /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                            style: {
                                                                fontSize: "48px",
                                                                marginBottom: "1rem"
                                                            },
                                                            children: "\uD83D\uDCAC"
                                                        }),
                                                        /*#__PURE__*/ jsx_runtime_.jsx("h4", {
                                                            style: {
                                                                margin: "0 0 0.5rem 0"
                                                            },
                                                            children: "Nu exista comentarii"
                                                        }),
                                                        /*#__PURE__*/ jsx_runtime_.jsx("p", {
                                                            style: {
                                                                margin: 0
                                                            },
                                                            children: "Adauga primul comentariu pentru acest proiect"
                                                        })
                                                    ]
                                                }) : /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                    style: {
                                                        display: "grid",
                                                        gap: "1rem"
                                                    },
                                                    children: comentarii.map((comentariu)=>/*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                            style: {
                                                                border: "1px solid #dee2e6",
                                                                borderRadius: "8px",
                                                                padding: "1rem",
                                                                background: "white",
                                                                borderLeft: `4px solid ${comentariu.tip_comentariu === "Problema" ? "#e74c3c" : comentariu.tip_comentariu === "Progres" ? "#27ae60" : comentariu.tip_comentariu === "Status" ? "#f39c12" : "#3498db"}`
                                                            },
                                                            children: [
                                                                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                    style: {
                                                                        display: "flex",
                                                                        justifyContent: "space-between",
                                                                        alignItems: "flex-start",
                                                                        marginBottom: "0.5rem"
                                                                    },
                                                                    children: [
                                                                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                            children: [
                                                                                /*#__PURE__*/ jsx_runtime_.jsx("strong", {
                                                                                    style: {
                                                                                        color: "#2c3e50"
                                                                                    },
                                                                                    children: comentariu.autor_nume
                                                                                }),
                                                                                /*#__PURE__*/ jsx_runtime_.jsx("span", {
                                                                                    style: {
                                                                                        marginLeft: "0.5rem",
                                                                                        padding: "0.25rem 0.5rem",
                                                                                        background: "#f8f9fa",
                                                                                        color: "#7f8c8d",
                                                                                        borderRadius: "12px",
                                                                                        fontSize: "12px"
                                                                                    },
                                                                                    children: comentariu.tip_comentariu
                                                                                })
                                                                            ]
                                                                        }),
                                                                        /*#__PURE__*/ jsx_runtime_.jsx("span", {
                                                                            style: {
                                                                                fontSize: "12px",
                                                                                color: "#7f8c8d"
                                                                            },
                                                                            children: formatDate(comentariu.data_comentariu)
                                                                        })
                                                                    ]
                                                                }),
                                                                /*#__PURE__*/ jsx_runtime_.jsx("p", {
                                                                    style: {
                                                                        margin: 0,
                                                                        color: "#2c3e50",
                                                                        fontSize: "14px",
                                                                        lineHeight: "1.5",
                                                                        whiteSpace: "pre-wrap"
                                                                    },
                                                                    children: comentariu.comentariu
                                                                })
                                                            ]
                                                        }, comentariu.id))
                                                })
                                            ]
                                        })
                                    ]
                                }),
                                activeTab === "timetracking" && !loading && /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                    children: [
                                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                            style: {
                                                display: "flex",
                                                justifyContent: "space-between",
                                                alignItems: "center",
                                                marginBottom: "1.5rem"
                                            },
                                            children: [
                                                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("h3", {
                                                    style: {
                                                        margin: 0,
                                                        color: "#2c3e50"
                                                    },
                                                    children: [
                                                        "Time Tracking (",
                                                        timeTracking.length,
                                                        " inregistrari)"
                                                    ]
                                                }),
                                                /*#__PURE__*/ jsx_runtime_.jsx("button", {
                                                    onClick: ()=>setShowTimeModal(true),
                                                    disabled: !utilizatorCurent,
                                                    style: {
                                                        padding: "0.75rem 1.5rem",
                                                        background: !utilizatorCurent ? "#bdc3c7" : "linear-gradient(135deg, #f39c12 0%, #f1c40f 100%)",
                                                        color: "white",
                                                        border: "none",
                                                        borderRadius: "8px",
                                                        cursor: !utilizatorCurent ? "not-allowed" : "pointer",
                                                        fontSize: "14px",
                                                        fontWeight: "bold"
                                                    },
                                                    children: "+ Inregistreaza Timp"
                                                })
                                            ]
                                        }),
                                        timeTracking.length === 0 ? /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                            style: {
                                                textAlign: "center",
                                                padding: "3rem",
                                                color: "#7f8c8d",
                                                background: "#f8f9fa",
                                                borderRadius: "8px",
                                                border: "2px dashed #dee2e6"
                                            },
                                            children: [
                                                /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                    style: {
                                                        fontSize: "48px",
                                                        marginBottom: "1rem"
                                                    },
                                                    children: "⏱️"
                                                }),
                                                /*#__PURE__*/ jsx_runtime_.jsx("h4", {
                                                    style: {
                                                        margin: "0 0 0.5rem 0"
                                                    },
                                                    children: "Nu exista timp inregistrat"
                                                }),
                                                /*#__PURE__*/ jsx_runtime_.jsx("p", {
                                                    style: {
                                                        margin: 0
                                                    },
                                                    children: "Inregistreaza primul timp lucrat pe acest proiect"
                                                })
                                            ]
                                        }) : /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                            children: [
                                                /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                    style: {
                                                        background: "linear-gradient(135deg, #667eea 0%, #764ba2 100%)",
                                                        color: "white",
                                                        padding: "1rem",
                                                        borderRadius: "8px",
                                                        marginBottom: "1.5rem"
                                                    },
                                                    children: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                        style: {
                                                            display: "grid",
                                                            gridTemplateColumns: "repeat(auto-fit, minmax(200px, 1fr))",
                                                            gap: "1rem"
                                                        },
                                                        children: [
                                                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                children: [
                                                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                        style: {
                                                                            fontSize: "24px",
                                                                            fontWeight: "bold"
                                                                        },
                                                                        children: [
                                                                            Number(timeTracking.reduce((sum, t)=>sum + (Number(t.ore_lucrate) || 0), 0)).toFixed(1),
                                                                            "h"
                                                                        ]
                                                                    }),
                                                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                                        style: {
                                                                            fontSize: "14px",
                                                                            opacity: 0.9
                                                                        },
                                                                        children: "Total ore lucrate"
                                                                    })
                                                                ]
                                                            }),
                                                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                children: [
                                                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                                        style: {
                                                                            fontSize: "24px",
                                                                            fontWeight: "bold"
                                                                        },
                                                                        children: new Set(timeTracking.map((t)=>t.utilizator_uid)).size
                                                                    }),
                                                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                                        style: {
                                                                            fontSize: "14px",
                                                                            opacity: 0.9
                                                                        },
                                                                        children: "Persoane implicate"
                                                                    })
                                                                ]
                                                            }),
                                                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                children: [
                                                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                                        style: {
                                                                            fontSize: "24px",
                                                                            fontWeight: "bold"
                                                                        },
                                                                        children: new Set(timeTracking.map((t)=>{
                                                                            const dataLucru = typeof t.data_lucru === "string" ? t.data_lucru : typeof t.data_lucru === "object" && t.data_lucru?.value ? t.data_lucru.value : t.data_lucru?.toString() || "";
                                                                            return dataLucru;
                                                                        })).size
                                                                    }),
                                                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                                        style: {
                                                                            fontSize: "14px",
                                                                            opacity: 0.9
                                                                        },
                                                                        children: "Zile de lucru"
                                                                    })
                                                                ]
                                                            })
                                                        ]
                                                    })
                                                }),
                                                /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                    style: {
                                                        display: "grid",
                                                        gap: "1rem"
                                                    },
                                                    children: timeTracking.map((entry)=>/*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                            style: {
                                                                border: "1px solid #dee2e6",
                                                                borderRadius: "8px",
                                                                padding: "1rem",
                                                                background: "white",
                                                                display: "grid",
                                                                gridTemplateColumns: "1fr auto",
                                                                gap: "1rem",
                                                                alignItems: "center"
                                                            },
                                                            children: [
                                                                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                    children: [
                                                                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                            style: {
                                                                                display: "flex",
                                                                                alignItems: "center",
                                                                                gap: "1rem",
                                                                                marginBottom: "0.5rem"
                                                                            },
                                                                            children: [
                                                                                /*#__PURE__*/ jsx_runtime_.jsx("strong", {
                                                                                    style: {
                                                                                        color: "#2c3e50"
                                                                                    },
                                                                                    children: entry.utilizator_nume
                                                                                }),
                                                                                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("span", {
                                                                                    style: {
                                                                                        padding: "0.25rem 0.5rem",
                                                                                        background: "#f39c12",
                                                                                        color: "white",
                                                                                        borderRadius: "12px",
                                                                                        fontSize: "12px",
                                                                                        fontWeight: "bold"
                                                                                    },
                                                                                    children: [
                                                                                        Number(entry.ore_lucrate) || 0,
                                                                                        "h"
                                                                                    ]
                                                                                }),
                                                                                /*#__PURE__*/ jsx_runtime_.jsx("span", {
                                                                                    style: {
                                                                                        fontSize: "14px",
                                                                                        color: "#7f8c8d"
                                                                                    },
                                                                                    children: formatDate(entry.data_lucru)
                                                                                })
                                                                            ]
                                                                        }),
                                                                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                            style: {
                                                                                fontSize: "14px",
                                                                                color: "#3498db",
                                                                                marginBottom: "0.5rem"
                                                                            },
                                                                            children: [
                                                                                "Sarcina: ",
                                                                                entry.sarcina_titlu
                                                                            ]
                                                                        }),
                                                                        entry.descriere_lucru && /*#__PURE__*/ jsx_runtime_.jsx("p", {
                                                                            style: {
                                                                                margin: 0,
                                                                                fontSize: "14px",
                                                                                color: "#7f8c8d",
                                                                                fontStyle: "italic"
                                                                            },
                                                                            children: entry.descriere_lucru
                                                                        })
                                                                    ]
                                                                }),
                                                                /*#__PURE__*/ jsx_runtime_.jsx("button", {
                                                                    style: {
                                                                        padding: "0.5rem",
                                                                        background: "#e74c3c",
                                                                        color: "white",
                                                                        border: "none",
                                                                        borderRadius: "6px",
                                                                        cursor: "pointer",
                                                                        fontSize: "12px"
                                                                    },
                                                                    title: "Sterge inregistrare",
                                                                    children: "\uD83D\uDDD1️"
                                                                })
                                                            ]
                                                        }, entry.id))
                                                })
                                            ]
                                        })
                                    ]
                                })
                            ]
                        }),
                        /*#__PURE__*/ jsx_runtime_.jsx("div", {
                            style: {
                                padding: "1rem 1.5rem",
                                borderTop: "1px solid #dee2e6",
                                background: "#f8f9fa",
                                borderRadius: "0 0 16px 16px",
                                display: "flex",
                                justifyContent: "flex-end"
                            },
                            children: /*#__PURE__*/ jsx_runtime_.jsx("button", {
                                onClick: onClose,
                                style: {
                                    padding: "0.75rem 1.5rem",
                                    background: "#6c757d",
                                    color: "white",
                                    border: "none",
                                    borderRadius: "6px",
                                    cursor: "pointer",
                                    fontSize: "14px",
                                    fontWeight: "bold"
                                },
                                children: "Inchide"
                            })
                        })
                    ]
                })
            }), document.body),
            showSarcinaNouaModal && utilizatorCurent && /*#__PURE__*/ jsx_runtime_.jsx(SarcinaNouaModal, {
                isOpen: showSarcinaNouaModal,
                onClose: ()=>setShowSarcinaNouaModal(false),
                onSarcinaAdded: handleSarcinaAdded,
                proiect: proiect,
                utilizatorCurent: utilizatorCurent
            }),
            showTimeModal && utilizatorCurent && /*#__PURE__*/ jsx_runtime_.jsx(TimeTrackingNouModal, {
                isOpen: showTimeModal,
                onClose: ()=>setShowTimeModal(false),
                onTimeAdded: handleTimeAdded,
                proiect: proiect,
                sarcini: sarcini,
                utilizatorCurent: utilizatorCurent
            })
        ]
    });
}

;// CONCATENATED MODULE: ./app/admin/rapoarte/proiecte/components/ProiectActions.tsx
// ==================================================================
// CALEA: app/admin/rapoarte/proiecte/components/ProiectActions.tsx
// DATA: 07.09.2025 21:00 (ora României)
// MODIFICAT: Adăugat buton Proces Verbal în dropdown pentru proiecte principale
// PĂSTRATE: Toate funcționalitățile existente + logica Contract
// ==================================================================
/* __next_internal_client_entry_do_not_use__ default auto */ 



// System global pentru management dropdown-uri multiple
let currentOpenDropdown = null;
const openDropdowns = new Map();
// Toast system cu Z-index compatibil cu modalele externe
const ProiectActions_showToast = (message, type = "info")=>{
    const toastEl = document.createElement("div");
    toastEl.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(12px);
    color: ${type === "success" ? "#27ae60" : type === "error" ? "#e74c3c" : "#3498db"};
    padding: 16px 20px;
    border-radius: 16px;
    z-index: 70000;
    font-family: 'Inter', Arial, sans-serif;
    font-size: 14px;
    font-weight: 500;
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    border: 1px solid rgba(255, 255, 255, 0.2);
    max-width: 400px;
    word-wrap: break-word;
    white-space: pre-line;
    transform: translateY(-10px);
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  `;
    toastEl.textContent = message;
    document.body.appendChild(toastEl);
    setTimeout(()=>{
        toastEl.style.transform = "translateY(0)";
        toastEl.style.opacity = "1";
    }, 10);
    setTimeout(()=>{
        toastEl.style.transform = "translateY(-10px)";
        toastEl.style.opacity = "0";
        setTimeout(()=>{
            if (document.body.contains(toastEl)) {
                document.body.removeChild(toastEl);
            }
        }, 300);
    }, type === "success" ? 4000 : type === "error" ? 5000 : type === "info" && message.length > 200 ? 10000 : 6000);
};
function ProiectActions({ proiect, onRefresh, onShowFacturaModal, onShowSubproiectModal, onShowEditModal, onShowContractModal, onShowPVModal// ✅ NOU: Callback PV
 }) {
    // State pentru modalul de sarcini
    const [showSarciniModal, setShowSarciniModal] = (0,react_experimental_.useState)(false);
    // ACTUALIZAT: Logica pentru tipul de proiect și status
    const isProiectPrincipal = proiect.tip !== "subproiect";
    const isSubproiect = proiect.tip === "subproiect";
    const isActiv = proiect.Status === "Activ";
    // Helper pentru formatarea datelor
    const formatDate = (date)=>{
        if (!date) return "N/A";
        const dateValue = typeof date === "string" ? date : date.value;
        try {
            return new Date(dateValue).toLocaleDateString("ro-RO");
        } catch  {
            return "N/A";
        }
    };
    // ACTUALIZAT: Construire acțiuni în funcție de tip și status
    const actions = (()=>{
        // Pentru subproiecte active: DOAR Sarcini
        if (isSubproiect && isActiv) {
            return [
                {
                    key: "sarcini",
                    label: "Sarcini Subproiect",
                    icon: "\uD83D\uDCCB",
                    color: "primary"
                }
            ];
        }
        // Pentru subproiecte inactive: NICIO acțiune
        if (isSubproiect && !isActiv) {
            return [];
        }
        // Pentru proiecte principale: toate acțiunile
        return [
            {
                key: "view",
                label: "Vezi Detalii",
                icon: "\uD83D\uDC41️",
                color: "primary"
            },
            {
                key: "edit",
                label: "Editează",
                icon: "✏️",
                color: "secondary"
            },
            // Sarcini doar pentru proiecte active
            ...isActiv ? [
                {
                    key: "sarcini",
                    label: "Sarcini Proiect",
                    icon: "\uD83D\uDCCB",
                    color: "primary"
                }
            ] : [],
            // Adaugă subproiect doar pentru proiecte principale
            {
                key: "add_subproiect",
                label: "Adaugă Subproiect",
                icon: "\uD83D\uDCC4",
                color: "primary",
                disabled: proiect.Status === "Anulat" || proiect.Status === "Finalizat"
            },
            {
                key: "divider1",
                label: "",
                icon: "",
                color: "primary",
                divider: true
            },
            {
                key: "generate_invoice",
                label: "Generează Factură PDF",
                icon: "\uD83D\uDCB0",
                color: "warning",
                disabled: proiect.Status === "Anulat"
            },
            // BUTON CONTRACT - doar pentru proiecte principale
            {
                key: "generate_contract",
                label: "Generează Contract",
                icon: "\uD83D\uDCC4",
                color: "primary",
                disabled: proiect.Status === "Anulat"
            },
            // ✅ NOU: BUTON PROCES VERBAL - doar pentru proiecte principale
            {
                key: "generate_pv",
                label: "Generează Proces Verbal",
                icon: "\uD83D\uDCCB",
                color: "success",
                disabled: proiect.Status === "Anulat"
            },
            {
                key: "divider2",
                label: "",
                icon: "",
                color: "primary",
                divider: true
            },
            {
                key: "mark_completed",
                label: "Marchează Finalizat",
                icon: "✅",
                color: "success",
                disabled: proiect.Status === "Finalizat" || proiect.Status === "Anulat"
            },
            {
                key: "suspend",
                label: "Suspendă Proiect",
                icon: "⏸️",
                color: "warning",
                disabled: proiect.Status === "Suspendat" || proiect.Status === "Finalizat"
            },
            {
                key: "divider3",
                label: "",
                icon: "",
                color: "primary",
                divider: true
            },
            {
                key: "delete",
                label: "Șterge Proiect",
                icon: "\uD83D\uDDD1️",
                color: "danger"
            }
        ];
    })();
    const handleAction = async (actionKey)=>{
        try {
            switch(actionKey){
                case "view":
                    await handleViewDetails();
                    break;
                case "edit":
                    await handleEdit();
                    break;
                case "sarcini":
                    handleSarcini();
                    break;
                case "add_subproiect":
                    handleAddSubproiect();
                    break;
                case "generate_invoice":
                    handleCreateInvoiceHibrid();
                    break;
                case "generate_contract":
                    handleGenerateContract();
                    break;
                case "generate_pv":
                    handleGeneratePV();
                    break;
                case "mark_completed":
                    await handleUpdateStatus("Finalizat");
                    break;
                case "suspend":
                    await handleUpdateStatus("Suspendat");
                    break;
                case "delete":
                    await handleDelete();
                    break;
                default:
                    ProiectActions_showToast("Funcție \xeen dezvoltare", "info");
            }
        } catch (error) {
            console.error(`Eroare la ${actionKey}:`, error);
            ProiectActions_showToast(`Eroare la executarea acțiunii: ${actionKey}`, "error");
        }
    };
    // Handler pentru Sarcini
    const handleSarcini = ()=>{
        setShowSarciniModal(true);
        console.log("Deschidere modal sarcini pentru:", proiect.ID_Proiect);
    };
    // Handler pentru Adăugare Subproiect (doar pentru proiecte principale)
    const handleAddSubproiect = ()=>{
        if (onShowSubproiectModal) {
            onShowSubproiectModal(proiect);
        } else {
            console.warn("onShowSubproiectModal callback not provided");
            ProiectActions_showToast("Funcția de adăugare subproiect nu este disponibilă", "error");
        }
    };
    const handleCreateInvoiceHibrid = ()=>{
        if (onShowFacturaModal) {
            onShowFacturaModal(proiect);
        } else {
            console.warn("onShowFacturaModal callback not provided");
            ProiectActions_showToast("Funcția de generare factură nu este disponibilă", "error");
        }
    };
    // Handler pentru Contract
    const handleGenerateContract = ()=>{
        if (onShowContractModal) {
            onShowContractModal(proiect);
        } else {
            console.warn("onShowContractModal callback not provided");
            ProiectActions_showToast("Funcția de generare contract nu este disponibilă", "error");
        }
    };
    // ✅ NOU: Handler pentru Proces Verbal
    const handleGeneratePV = ()=>{
        if (onShowPVModal) {
            onShowPVModal(proiect);
        } else {
            console.warn("onShowPVModal callback not provided");
            ProiectActions_showToast("Funcția de generare proces verbal nu este disponibilă", "error");
        }
    };
    const handleViewDetails = async ()=>{
        const tipText = proiect.tip === "subproiect" ? "SUBPROIECT" : "PROIECT";
        const monedaInfo = proiect.moneda && proiect.moneda !== "RON" ? `\n💱 Monedă: ${proiect.moneda}\n💰 Valoare RON: ${proiect.valoare_ron ? `${proiect.valoare_ron.toLocaleString("ro-RO")} RON` : "N/A"}` : "";
        const statusuriInfo = proiect.status_predare || proiect.status_contract || proiect.status_facturare || proiect.status_achitare ? `\n📊 Status Predare: ${proiect.status_predare || "N/A"}\n📄 Status Contract: ${proiect.status_contract || "N/A"}\n🧾 Status Facturare: ${proiect.status_facturare || "N/A"}\n💳 Status Achitare: ${proiect.status_achitare || "N/A"}` : "";
        const detalii = `📋 ${tipText}: ${proiect.ID_Proiect}

🏷️ Denumire: ${proiect.Denumire}
👤 Client: ${proiect.Client}
📊 Status: ${proiect.Status}${isActiv ? " ✅" : ""}
💰 Valoare: ${proiect.Valoare_Estimata ? `${proiect.Valoare_Estimata.toLocaleString("ro-RO")} ${proiect.moneda || "RON"}` : "N/A"}${monedaInfo}
📅 Începe: ${formatDate(proiect.Data_Start)}
📅 Finalizare: ${formatDate(proiect.Data_Final)}
👤 Responsabil: ${proiect.Responsabil || "Neatribuit"}
📍 Adresă: ${proiect.Adresa || "Nespecificată"}${statusuriInfo}
📝 Observații: ${proiect.Observatii || "Fără observații"}`;
        ProiectActions_showToast(detalii, "info");
        console.log(`Detalii ${tipText.toLowerCase()}:`, proiect);
    };
    const handleEdit = async ()=>{
        if (onShowEditModal) {
            onShowEditModal(proiect);
        } else {
            console.warn("onShowEditModal callback not provided");
            ProiectActions_showToast("Funcția de editare nu este disponibilă", "error");
        }
    };
    const handleUpdateStatus = async (newStatus)=>{
        const tipText = proiect.tip === "subproiect" ? "subproiectului" : "proiectului";
        const confirmare = confirm(`Sigur vrei să schimbi statusul ${tipText} la "${newStatus}"?`);
        if (!confirmare) return;
        try {
            const apiEndpoint = proiect.tip === "subproiect" ? "/api/rapoarte/subproiecte" : "/api/rapoarte/proiecte";
            const response = await fetch(apiEndpoint, {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    id: proiect.ID_Proiect,
                    Status: newStatus
                })
            });
            const result = await response.json();
            if (result.success) {
                ProiectActions_showToast(`Status actualizat la: ${newStatus}`, "success");
                onRefresh?.();
            } else {
                ProiectActions_showToast(result.error || "Eroare la actualizarea statusului", "error");
            }
        } catch (error) {
            ProiectActions_showToast("Eroare la actualizarea statusului", "error");
        }
    };
    const handleDelete = async ()=>{
        const tipText = proiect.tip === "subproiect" ? "subproiectul" : "proiectul";
        const confirmed = confirm(`Sigur vrei să ștergi ${tipText} ${proiect.ID_Proiect}?\n\nAceastă acțiune nu poate fi anulată!`);
        if (!confirmed) return;
        try {
            const apiEndpoint = proiect.tip === "subproiect" ? "/api/rapoarte/subproiecte" : "/api/rapoarte/proiecte";
            const response = await fetch(`${apiEndpoint}?id=${encodeURIComponent(proiect.ID_Proiect)}`, {
                method: "DELETE"
            });
            const result = await response.json();
            if (result.success) {
                ProiectActions_showToast(`${tipText.charAt(0).toUpperCase() + tipText.slice(1)} șters cu succes!`, "success");
                onRefresh?.();
            } else {
                ProiectActions_showToast(result.error || `Eroare la ștergerea ${tipText}`, "error");
            }
        } catch (error) {
            ProiectActions_showToast(`Eroare la ștergerea ${tipText}`, "error");
        }
    };
    // ACTUALIZAT: Nu afișa nimic pentru subproiecte inactive
    if (isSubproiect && !isActiv) {
        return null;
    }
    return /*#__PURE__*/ (0,jsx_runtime_.jsxs)(jsx_runtime_.Fragment, {
        children: [
            /*#__PURE__*/ jsx_runtime_.jsx(EnhancedActionDropdown, {
                actions: actions,
                onAction: handleAction,
                proiect: proiect
            }),
            showSarciniModal && /*#__PURE__*/ jsx_runtime_.jsx(SarciniProiectModal, {
                isOpen: showSarciniModal,
                onClose: ()=>setShowSarciniModal(false),
                proiect: proiect
            })
        ]
    });
}
function EnhancedActionDropdown({ actions, onAction, proiect }) {
    const [isOpen, setIsOpen] = react_experimental_default().useState(false);
    const [loading, setLoading] = react_experimental_default().useState(null);
    const [dropdownPosition, setDropdownPosition] = react_experimental_default().useState("bottom");
    const [dropdownCoords, setDropdownCoords] = react_experimental_default().useState({
        top: 0,
        left: 0,
        width: 0
    });
    const buttonRef = react_experimental_default().useRef(null);
    const dropdownId = react_experimental_default().useMemo(()=>`dropdown-${proiect.ID_Proiect}-${Math.random().toString(36).substr(2, 9)}`, [
        proiect.ID_Proiect
    ]);
    // ACTUALIZAT: Nu afișa buton dacă nu sunt acțiuni
    if (actions.length === 0) {
        return null;
    }
    react_experimental_default().useEffect(()=>{
        openDropdowns.set(dropdownId, ()=>setIsOpen(false));
        return ()=>{
            openDropdowns.delete(dropdownId);
        };
    }, [
        dropdownId
    ]);
    react_experimental_default().useEffect(()=>{
        if (isOpen) {
            if (currentOpenDropdown && currentOpenDropdown !== dropdownId) {
                const closeFunction = openDropdowns.get(currentOpenDropdown);
                if (closeFunction) {
                    closeFunction();
                }
            }
            currentOpenDropdown = dropdownId;
            calculateDropdownPosition();
            window.addEventListener("resize", calculateDropdownPosition);
            return ()=>window.removeEventListener("resize", calculateDropdownPosition);
        } else {
            if (currentOpenDropdown === dropdownId) {
                currentOpenDropdown = null;
            }
        }
    }, [
        isOpen,
        dropdownId
    ]);
    const calculateDropdownPosition = ()=>{
        if (!buttonRef.current) return;
        const buttonRect = buttonRef.current.getBoundingClientRect();
        const viewportHeight = window.innerHeight;
        const dropdownHeight = 350;
        const tableRow = buttonRef.current.closest("tr");
        const rowHeight = tableRow ? tableRow.getBoundingClientRect().height : 50;
        const spaceBelow = viewportHeight - buttonRect.bottom;
        const spaceAbove = buttonRect.top - rowHeight;
        let finalTop = 0;
        let finalLeft = buttonRect.right - 260;
        if (spaceBelow < dropdownHeight && spaceAbove > dropdownHeight) {
            finalTop = buttonRect.top - dropdownHeight - 8;
            setDropdownPosition("top");
        } else {
            finalTop = buttonRect.bottom + 8;
            setDropdownPosition("bottom");
        }
        if (finalLeft < 10) finalLeft = 10;
        if (finalLeft + 260 > window.innerWidth - 10) {
            finalLeft = window.innerWidth - 270;
        }
        setDropdownCoords({
            top: finalTop,
            left: finalLeft,
            width: 260
        });
    };
    const handleActionClick = async (actionKey)=>{
        if (loading) return;
        setLoading(actionKey);
        setIsOpen(false);
        try {
            await onAction(actionKey);
        } finally{
            setLoading(null);
        }
    };
    const getStatusColor = (status)=>{
        switch(status){
            case "Activ":
                return "#27ae60";
            case "Finalizat":
                return "#3498db";
            case "Suspendat":
                return "#f39c12";
            case "Arhivat":
                return "#95a5a6";
            default:
                return "#7f8c8d";
        }
    };
    const getActionColor = (color)=>{
        switch(color){
            case "primary":
                return "#3498db";
            case "secondary":
                return "#95a5a6";
            case "success":
                return "#27ae60";
            case "warning":
                return "#f39c12";
            case "danger":
                return "#e74c3c";
            default:
                return "#7f8c8d";
        }
    };
    const isActiv = proiect.Status === "Activ";
    const isSubproiect = proiect.tip === "subproiect";
    return /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
        style: {
            position: "relative",
            display: "inline-block"
        },
        children: [
            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("button", {
                ref: buttonRef,
                onClick: ()=>setIsOpen(!isOpen),
                disabled: loading !== null,
                style: {
                    background: loading ? "#f8f9fa" : isActiv ? isSubproiect ? "linear-gradient(135deg, #3498db 0%, #5dade2 100%)" : "linear-gradient(135deg, #27ae60 0%, #2ecc71 100%)" : "linear-gradient(135deg, #667eea 0%, #764ba2 100%)",
                    color: loading ? "#6c757d" : "white",
                    border: "none",
                    borderRadius: "12px",
                    padding: "0.5rem 1rem",
                    cursor: loading ? "not-allowed" : "pointer",
                    fontSize: "14px",
                    fontWeight: "600",
                    boxShadow: loading ? "none" : isActiv ? isSubproiect ? "0 4px 12px rgba(52, 152, 219, 0.4)" : "0 4px 12px rgba(39, 174, 96, 0.4)" : "0 4px 12px rgba(102, 126, 234, 0.4)",
                    transition: "all 0.3s ease",
                    display: "flex",
                    alignItems: "center",
                    gap: "0.5rem"
                },
                onMouseOver: (e)=>{
                    if (!loading) {
                        e.currentTarget.style.transform = "translateY(-2px)";
                        e.currentTarget.style.boxShadow = isActiv ? isSubproiect ? "0 6px 16px rgba(52, 152, 219, 0.5)" : "0 6px 16px rgba(39, 174, 96, 0.5)" : "0 6px 16px rgba(102, 126, 234, 0.5)";
                    }
                },
                onMouseOut: (e)=>{
                    if (!loading) {
                        e.currentTarget.style.transform = "translateY(0)";
                        e.currentTarget.style.boxShadow = isActiv ? isSubproiect ? "0 4px 12px rgba(52, 152, 219, 0.4)" : "0 4px 12px rgba(39, 174, 96, 0.4)" : "0 4px 12px rgba(102, 126, 234, 0.4)";
                    }
                },
                children: [
                    loading ? "⏳" : isSubproiect ? "\uD83D\uDCCB" : "⚙️",
                    isSubproiect ? "Sarcini" : "Acțiuni",
                    isActiv && !loading && /*#__PURE__*/ jsx_runtime_.jsx("span", {
                        style: {
                            fontSize: "10px",
                            background: "rgba(255,255,255,0.2)",
                            padding: "2px 6px",
                            borderRadius: "8px",
                            fontWeight: "bold"
                        },
                        children: isSubproiect ? "SUB" : "ACTIV"
                    })
                ]
            }),
            isOpen && /*#__PURE__*/ (0,jsx_runtime_.jsxs)(jsx_runtime_.Fragment, {
                children: [
                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                        style: {
                            position: "fixed",
                            top: 0,
                            left: 0,
                            right: 0,
                            bottom: 0,
                            background: "rgba(0, 0, 0, 0.3)",
                            backdropFilter: "blur(6px)",
                            zIndex: 40000
                        },
                        onClick: ()=>setIsOpen(false)
                    }),
                     false && /*#__PURE__*/ 0
                ]
            })
        ]
    });
}

// EXTERNAL MODULE: ./node_modules/react-toastify/dist/index.mjs + 1 modules
var dist = __webpack_require__(7365);
// EXTERNAL MODULE: ./app/admin/rapoarte/clienti/components/ClientNouModal.tsx + 1 modules
var ClientNouModal = __webpack_require__(19518);
;// CONCATENATED MODULE: ./app/admin/rapoarte/proiecte/components/SubcontractantSearch.tsx
// ==================================================================
// CALEA: app/admin/rapoarte/proiecte/components/SubcontractantSearch.tsx
// DATA: 24.08.2025 19:15 (ora României)
// MODIFICAT: Adăugată salvare automată din ANAF similar cu ANAFClientSearch.tsx
// PĂSTRATE: Toate funcționalitățile existente de căutare locală și ANAF
// ==================================================================
/* __next_internal_client_entry_do_not_use__ default auto */ 

// Toast system cu Z-index compatibil
const SubcontractantSearch_showToast = (message, type = "info")=>{
    const toastEl = document.createElement("div");
    toastEl.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(12px);
    color: ${type === "success" ? "#27ae60" : type === "error" ? "#e74c3c" : "#3498db"};
    padding: 16px 20px;
    border-radius: 16px;
    z-index: 70000;
    font-family: 'Inter', Arial, sans-serif;
    font-size: 14px;
    font-weight: 500;
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    border: 1px solid rgba(255, 255, 255, 0.2);
    max-width: 400px;
    word-wrap: break-word;
    transform: translateY(-10px);
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  `;
    toastEl.textContent = message;
    document.body.appendChild(toastEl);
    setTimeout(()=>{
        toastEl.style.transform = "translateY(0)";
        toastEl.style.opacity = "1";
    }, 10);
    setTimeout(()=>{
        toastEl.style.transform = "translateY(-10px)";
        toastEl.style.opacity = "0";
        setTimeout(()=>{
            if (document.body.contains(toastEl)) {
                document.body.removeChild(toastEl);
            }
        }, 300);
    }, type === "success" || type === "error" ? 4000 : 6000);
};
function SubcontractantSearch({ onSubcontractantSelected, onShowAddModal, selectedSubcontractant: initialSelectedSubcontractant = "", className = "", showInModal = false, disabled = false, placeholder = "Caută subcontractant sau CUI..." }) {
    const [searchTerm, setSearchTerm] = useState(initialSelectedSubcontractant);
    const [subcontractanti, setSubcontractanti] = useState([]);
    const [anafResults, setAnafResults] = useState([]);
    const [loading, setLoading] = useState(false);
    const [showSuggestions, setShowSuggestions] = useState(false);
    const [selectedItem, setSelectedItem] = useState(null);
    const [searchMode, setSearchMode] = useState("local");
    const [loadingAnaf, setLoadingAnaf] = useState(false);
    // NOU: State pentru dialog import automat
    const [showImportDialog, setShowImportDialog] = useState(false);
    const [anafDataForImport, setAnafDataForImport] = useState(null);
    // Încarcă subcontractanți inițiali
    useEffect(()=>{
        loadSubcontractanti();
    }, []);
    // Setează valoarea inițială
    useEffect(()=>{
        if (initialSelectedSubcontractant && initialSelectedSubcontractant !== searchTerm) {
            setSearchTerm(initialSelectedSubcontractant);
            const foundSubcontractant = subcontractanti.find((s)=>s.nume === initialSelectedSubcontractant || s.cui === initialSelectedSubcontractant || s.id === initialSelectedSubcontractant);
            if (foundSubcontractant) {
                setSelectedItem(foundSubcontractant);
            }
        }
    }, [
        initialSelectedSubcontractant,
        subcontractanti
    ]);
    const loadSubcontractanti = async (search)=>{
        setLoading(true);
        try {
            const queryParams = new URLSearchParams();
            if (search && search.trim().length > 0) {
                queryParams.append("search", search.trim());
            }
            queryParams.append("limit", "20");
            const response = await fetch(`/api/rapoarte/subcontractanti?${queryParams.toString()}`);
            const data = await response.json();
            if (data.success) {
                setSubcontractanti(data.data || []);
            } else {
                SubcontractantSearch_showToast("Eroare la \xeencărcarea subcontractanților", "error");
                setSubcontractanti([]);
            }
        } catch (error) {
            console.error("Eroare la \xeencărcarea subcontractanților:", error);
            SubcontractantSearch_showToast("Eroare de conectare", "error");
            setSubcontractanti([]);
        } finally{
            setLoading(false);
        }
    };
    // MODIFICAT: Căutare în ANAF cu verificare existență în BD
    const searchInANAF = async (cui)=>{
        if (!cui || cui.trim().length < 6) return;
        setLoadingAnaf(true);
        try {
            // Primul pas: caută în ANAF
            const response = await fetch(`/api/anaf/company-info?cui=${encodeURIComponent(cui.trim())}`);
            const result = await response.json();
            if (result.success) {
                const anafData = {
                    denumire: result.data.denumire,
                    cui: result.data.cui,
                    nrRegCom: result.data.nrRegCom,
                    adresa: result.data.adresa,
                    status: result.data.status,
                    platitorTva: result.data.platitorTva,
                    judet: result.data.judet,
                    oras: result.data.oras,
                    codPostal: result.data.codPostal,
                    telefon: result.data.telefon
                };
                // Al doilea pas: verifică dacă există în BD
                const existingSubcontractant = await checkExistingSubcontractant(anafData.cui);
                if (existingSubcontractant) {
                    // Există în BD - returnează direct
                    setAnafResults([]);
                    setSubcontractanti([
                        existingSubcontractant
                    ]);
                    SubcontractantSearch_showToast("Subcontractant găsit \xeen baza de date!", "success");
                } else {
                    // Nu există în BD - afișează pentru import
                    setAnafResults([
                        anafData
                    ]);
                    setAnafDataForImport(anafData);
                    setShowImportDialog(true);
                    SubcontractantSearch_showToast("Găsit \xeen ANAF! Poți să \xeel imporți automat.", "info");
                }
            } else {
                setAnafResults([]);
                SubcontractantSearch_showToast("Nu a fost găsit \xeen ANAF", "info");
            }
        } catch (error) {
            console.error("Eroare căutare ANAF:", error);
            SubcontractantSearch_showToast("Eroare la căutarea \xeen ANAF", "error");
            setAnafResults([]);
        } finally{
            setLoadingAnaf(false);
        }
    };
    // NOU: Verifică dacă subcontractantul există în BD
    const checkExistingSubcontractant = async (cui)=>{
        try {
            const response = await fetch(`/api/rapoarte/subcontractanti?cui=${encodeURIComponent(cui)}&limit=1`);
            const data = await response.json();
            if (data.success && data.data && data.data.length > 0) {
                return data.data[0];
            }
            return null;
        } catch (error) {
            console.error("Eroare verificare subcontractant existent:", error);
            return null;
        }
    };
    // NOU: Import automat din ANAF în BD
    const importFromANAF = async (anafData)=>{
        try {
            setLoadingAnaf(true);
            const subcontractantData = {
                id: `SUB_${Date.now()}_${Math.random().toString(36).substr(2, 6)}`,
                nume: anafData.denumire,
                tip_client: anafData.platitorTva === "Da" ? "Juridic_TVA" : "Juridic",
                cui: anafData.cui,
                nr_reg_com: anafData.nrRegCom,
                adresa: anafData.adresa,
                judet: anafData.judet || "",
                oras: anafData.oras || "",
                cod_postal: anafData.codPostal || "",
                tara: "Romania",
                telefon: anafData.telefon || "",
                email: "",
                banca: "",
                iban: "",
                cnp: null,
                ci_serie: null,
                ci_numar: null,
                ci_eliberata_de: null,
                ci_eliberata_la: null,
                data_creare: new Date().toISOString(),
                data_actualizare: new Date().toISOString(),
                activ: anafData.status === "Activ",
                observatii: `Importat automat din ANAF la ${new Date().toLocaleString("ro-RO")}`,
                id_factureaza: null,
                data_ultima_sincronizare: null
            };
            const response = await fetch("/api/rapoarte/subcontractanti", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(subcontractantData)
            });
            const result = await response.json();
            if (result.success || response.ok) {
                SubcontractantSearch_showToast("Subcontractant importat cu succes din ANAF!", "success");
                // Selectează automat subcontractantul importat
                const newSubcontractant = {
                    id: subcontractantData.id,
                    nume: subcontractantData.nume,
                    tip_client: subcontractantData.tip_client,
                    cui: subcontractantData.cui,
                    telefon: subcontractantData.telefon,
                    email: subcontractantData.email,
                    activ: true
                };
                setSelectedItem(newSubcontractant);
                setSearchTerm(newSubcontractant.nume);
                setShowImportDialog(false);
                setAnafResults([]);
                if (onSubcontractantSelected) {
                    onSubcontractantSelected({
                        id: newSubcontractant.id,
                        nume: newSubcontractant.nume,
                        cui: newSubcontractant.cui,
                        tip_client: newSubcontractant.tip_client,
                        telefon: newSubcontractant.telefon,
                        email: newSubcontractant.email
                    });
                }
            } else {
                console.error("Eroare API:", result);
                SubcontractantSearch_showToast(`Eroare la import: ${result.error || "Eroare necunoscută"}`, "error");
            }
        } catch (error) {
            console.error("Eroare la importul din ANAF:", error);
            SubcontractantSearch_showToast("Eroare la importul din ANAF", "error");
        } finally{
            setLoadingAnaf(false);
        }
    };
    const handleSearchChange = (value)=>{
        setSearchTerm(value);
        setSelectedItem(null);
        setAnafResults([]);
        setShowImportDialog(false);
        setAnafDataForImport(null);
        // Detectează dacă este CUI (doar cifre)
        const isCUI = /^\d+$/.test(value.trim()) && value.trim().length >= 6;
        if (isCUI) {
            setSearchMode("anaf");
            setShowSuggestions(true);
            // Căutare ANAF pentru CUI
            if (value.trim().length >= 6) {
                searchInANAF(value);
            }
        } else {
            setSearchMode("local");
            if (value.trim().length >= 2) {
                setShowSuggestions(true);
                loadSubcontractanti(value);
            } else if (value.trim().length === 0) {
                setShowSuggestions(true);
                loadSubcontractanti();
            } else {
                setShowSuggestions(false);
            }
        }
        // Notifică părintele că selecția a fost resetată
        if (onSubcontractantSelected) {
            onSubcontractantSelected(null);
        }
    };
    const handleSelectSubcontractant = (subcontractant)=>{
        setSearchTerm(subcontractant.nume);
        setSelectedItem(subcontractant);
        setShowSuggestions(false);
        if (onSubcontractantSelected) {
            onSubcontractantSelected({
                id: subcontractant.id,
                nume: subcontractant.nume,
                cui: subcontractant.cui,
                tip_client: subcontractant.tip_client,
                telefon: subcontractant.telefon,
                email: subcontractant.email
            });
        }
    };
    // MODIFICAT: Selectare rezultat ANAF cu opțiune de import automat
    const handleSelectAnafResult = (anafResult)=>{
        setSearchTerm(anafResult.denumire);
        setShowSuggestions(false);
        setAnafDataForImport(anafResult);
        setShowImportDialog(true);
    };
    const handleFocus = ()=>{
        if (!disabled && (subcontractanti.length > 0 || anafResults.length > 0)) {
            setShowSuggestions(true);
        }
    };
    const handleBlur = ()=>{
        setTimeout(()=>{
            if (!showImportDialog) {
                setShowSuggestions(false);
            }
        }, 200);
    };
    const getTipClientIcon = (tip)=>{
        if (tip === "Juridic" || tip === "Juridic_TVA") return "\uD83C\uDFE2";
        return "\uD83D\uDC64";
    };
    const getTipClientLabel = (tip)=>{
        switch(tip){
            case "Juridic":
                return "Juridic";
            case "Juridic_TVA":
                return "Juridic (TVA)";
            case "Fizic":
                return "Fizic";
            default:
                return tip;
        }
    };
    const containerStyle = showInModal ? {
        background: "transparent",
        margin: 0
    } : {
        background: "rgba(255, 255, 255, 0.95)",
        backdropFilter: "blur(12px)",
        padding: "1rem",
        borderRadius: "12px",
        border: "1px solid rgba(255, 255, 255, 0.3)",
        boxShadow: "0 4px 16px rgba(0, 0, 0, 0.1)",
        margin: "0.5rem 0"
    };
    return /*#__PURE__*/ _jsxs("div", {
        className: className,
        style: containerStyle,
        children: [
            !showInModal && /*#__PURE__*/ _jsxs("div", {
                style: {
                    marginBottom: "0.75rem"
                },
                children: [
                    /*#__PURE__*/ _jsx("label", {
                        style: {
                            display: "block",
                            fontSize: "14px",
                            fontWeight: "600",
                            color: "#2c3e50",
                            marginBottom: "0.5rem"
                        },
                        children: "\uD83D\uDDC3️ Subcontractant"
                    }),
                    /*#__PURE__*/ _jsx("p", {
                        style: {
                            margin: 0,
                            fontSize: "12px",
                            color: "#7f8c8d"
                        },
                        children: "Caută \xeen baza de date sau introduce CUI pentru căutare ANAF"
                    })
                ]
            }),
            /*#__PURE__*/ _jsxs("div", {
                style: {
                    position: "relative"
                },
                children: [
                    /*#__PURE__*/ _jsx("input", {
                        type: "text",
                        value: searchTerm,
                        onChange: (e)=>handleSearchChange(e.target.value),
                        onFocus: handleFocus,
                        onBlur: handleBlur,
                        disabled: disabled || loading,
                        placeholder: loading ? "Se \xeencarcă..." : placeholder,
                        style: {
                            width: "100%",
                            padding: "0.75rem",
                            paddingRight: "3.5rem",
                            border: `1px solid ${selectedItem ? "#27ae60" : "#dee2e6"}`,
                            borderRadius: "8px",
                            fontSize: "14px",
                            backgroundColor: disabled ? "#f8f9fa" : "white",
                            color: disabled ? "#6c757d" : "#2c3e50"
                        }
                    }),
                    /*#__PURE__*/ _jsxs("div", {
                        style: {
                            position: "absolute",
                            right: "0.75rem",
                            top: "50%",
                            transform: "translateY(-50%)",
                            display: "flex",
                            alignItems: "center",
                            gap: "0.25rem"
                        },
                        children: [
                            loadingAnaf && /*#__PURE__*/ _jsx("span", {
                                style: {
                                    color: "#3498db",
                                    fontSize: "10px"
                                },
                                title: "Căutare ANAF",
                                children: "\uD83D\uDD0D"
                            }),
                            loading && /*#__PURE__*/ _jsx("span", {
                                style: {
                                    color: "#3498db",
                                    fontSize: "12px"
                                },
                                children: "⏳"
                            }),
                            selectedItem && /*#__PURE__*/ _jsx("span", {
                                style: {
                                    color: "#27ae60",
                                    fontSize: "12px"
                                },
                                children: "✅"
                            }),
                            !loading && !selectedItem && searchTerm && /*#__PURE__*/ _jsx("span", {
                                style: {
                                    color: "#f39c12",
                                    fontSize: "12px"
                                },
                                children: "⚠️"
                            }),
                            searchMode === "anaf" && /*#__PURE__*/ _jsx("span", {
                                style: {
                                    color: "#3498db",
                                    fontSize: "10px"
                                },
                                title: "Mod căutare ANAF",
                                children: "\uD83C\uDFE2"
                            })
                        ]
                    }),
                    showSuggestions && (searchMode === "local" ? subcontractanti.length > 0 : anafResults.length > 0) && /*#__PURE__*/ _jsxs("div", {
                        style: {
                            position: "absolute",
                            top: "100%",
                            left: 0,
                            right: 0,
                            background: "white",
                            border: "1px solid #dee2e6",
                            borderTop: "none",
                            borderRadius: "0 0 8px 8px",
                            boxShadow: "0 4px 12px rgba(0,0,0,0.15)",
                            zIndex: 1000,
                            maxHeight: "250px",
                            overflowY: "auto"
                        },
                        children: [
                            searchMode === "local" && subcontractanti.map((subcontractant)=>/*#__PURE__*/ _jsx("div", {
                                    onClick: ()=>handleSelectSubcontractant(subcontractant),
                                    style: {
                                        padding: "0.75rem",
                                        cursor: "pointer",
                                        borderBottom: "1px solid #f1f2f6",
                                        transition: "all 0.2s ease"
                                    },
                                    onMouseOver: (e)=>{
                                        e.currentTarget.style.background = "#f8f9fa";
                                    },
                                    onMouseOut: (e)=>{
                                        e.currentTarget.style.background = "white";
                                    },
                                    children: /*#__PURE__*/ _jsxs("div", {
                                        style: {
                                            display: "flex",
                                            justifyContent: "space-between",
                                            alignItems: "flex-start",
                                            gap: "0.5rem"
                                        },
                                        children: [
                                            /*#__PURE__*/ _jsxs("div", {
                                                style: {
                                                    flex: 1
                                                },
                                                children: [
                                                    /*#__PURE__*/ _jsx("div", {
                                                        style: {
                                                            fontWeight: "600",
                                                            color: "#2c3e50",
                                                            fontSize: "14px"
                                                        },
                                                        children: subcontractant.nume
                                                    }),
                                                    /*#__PURE__*/ _jsxs("div", {
                                                        style: {
                                                            fontSize: "12px",
                                                            color: "#7f8c8d",
                                                            marginTop: "0.25rem"
                                                        },
                                                        children: [
                                                            subcontractant.cui && `CUI: ${subcontractant.cui}`,
                                                            subcontractant.cnp && `CNP: ${subcontractant.cnp}`
                                                        ]
                                                    }),
                                                    (subcontractant.email || subcontractant.telefon) && /*#__PURE__*/ _jsxs("div", {
                                                        style: {
                                                            fontSize: "11px",
                                                            color: "#95a5a6",
                                                            marginTop: "0.25rem"
                                                        },
                                                        children: [
                                                            subcontractant.email && `📧 ${subcontractant.email}`,
                                                            subcontractant.telefon && ` 📞 ${subcontractant.telefon}`
                                                        ]
                                                    })
                                                ]
                                            }),
                                            /*#__PURE__*/ _jsxs("div", {
                                                style: {
                                                    display: "flex",
                                                    flexDirection: "column",
                                                    alignItems: "flex-end",
                                                    gap: "0.25rem"
                                                },
                                                children: [
                                                    /*#__PURE__*/ _jsx("span", {
                                                        style: {
                                                            fontSize: "16px"
                                                        },
                                                        children: getTipClientIcon(subcontractant.tip_client)
                                                    }),
                                                    /*#__PURE__*/ _jsx("span", {
                                                        style: {
                                                            fontSize: "10px",
                                                            color: "#7f8c8d",
                                                            textAlign: "center"
                                                        },
                                                        children: getTipClientLabel(subcontractant.tip_client)
                                                    })
                                                ]
                                            })
                                        ]
                                    })
                                }, subcontractant.id)),
                            searchMode === "anaf" && anafResults.map((result, index)=>/*#__PURE__*/ _jsx("div", {
                                    onClick: ()=>handleSelectAnafResult(result),
                                    style: {
                                        padding: "0.75rem",
                                        cursor: "pointer",
                                        borderBottom: "1px solid #f1f2f6",
                                        background: "linear-gradient(135deg, rgba(52, 152, 219, 0.05) 0%, rgba(46, 204, 113, 0.05) 100%)",
                                        transition: "all 0.2s ease"
                                    },
                                    onMouseOver: (e)=>{
                                        e.currentTarget.style.background = "linear-gradient(135deg, rgba(52, 152, 219, 0.1) 0%, rgba(46, 204, 113, 0.1) 100%)";
                                    },
                                    onMouseOut: (e)=>{
                                        e.currentTarget.style.background = "linear-gradient(135deg, rgba(52, 152, 219, 0.05) 0%, rgba(46, 204, 113, 0.05) 100%)";
                                    },
                                    children: /*#__PURE__*/ _jsxs("div", {
                                        style: {
                                            display: "flex",
                                            justifyContent: "space-between",
                                            alignItems: "flex-start",
                                            gap: "0.5rem"
                                        },
                                        children: [
                                            /*#__PURE__*/ _jsxs("div", {
                                                style: {
                                                    flex: 1
                                                },
                                                children: [
                                                    /*#__PURE__*/ _jsxs("div", {
                                                        style: {
                                                            display: "flex",
                                                            alignItems: "center",
                                                            gap: "0.5rem",
                                                            marginBottom: "0.25rem"
                                                        },
                                                        children: [
                                                            /*#__PURE__*/ _jsx("span", {
                                                                style: {
                                                                    fontSize: "14px"
                                                                },
                                                                children: "\uD83C\uDFE2"
                                                            }),
                                                            /*#__PURE__*/ _jsx("span", {
                                                                style: {
                                                                    fontWeight: "600",
                                                                    color: "#2c3e50",
                                                                    fontSize: "14px"
                                                                },
                                                                children: result.denumire
                                                            }),
                                                            /*#__PURE__*/ _jsx("span", {
                                                                style: {
                                                                    fontSize: "10px",
                                                                    padding: "2px 6px",
                                                                    background: "#3498db",
                                                                    color: "white",
                                                                    borderRadius: "8px",
                                                                    fontWeight: "bold"
                                                                },
                                                                children: "ANAF"
                                                            })
                                                        ]
                                                    }),
                                                    /*#__PURE__*/ _jsxs("div", {
                                                        style: {
                                                            fontSize: "12px",
                                                            color: "#7f8c8d",
                                                            marginBottom: "0.25rem"
                                                        },
                                                        children: [
                                                            "CUI: ",
                                                            result.cui,
                                                            " | Reg. Com: ",
                                                            result.nrRegCom || "N/A"
                                                        ]
                                                    }),
                                                    /*#__PURE__*/ _jsx("div", {
                                                        style: {
                                                            fontSize: "11px",
                                                            color: "#95a5a6"
                                                        },
                                                        children: result.adresa
                                                    })
                                                ]
                                            }),
                                            /*#__PURE__*/ _jsxs("div", {
                                                style: {
                                                    display: "flex",
                                                    flexDirection: "column",
                                                    alignItems: "flex-end",
                                                    gap: "0.25rem"
                                                },
                                                children: [
                                                    /*#__PURE__*/ _jsx("span", {
                                                        style: {
                                                            fontSize: "10px",
                                                            padding: "2px 6px",
                                                            background: result.status === "Activ" ? "#27ae60" : "#e74c3c",
                                                            color: "white",
                                                            borderRadius: "8px",
                                                            fontWeight: "bold"
                                                        },
                                                        children: result.status
                                                    }),
                                                    /*#__PURE__*/ _jsx("span", {
                                                        style: {
                                                            fontSize: "10px",
                                                            padding: "2px 6px",
                                                            background: result.platitorTva === "Da" ? "#f39c12" : "#95a5a6",
                                                            color: "white",
                                                            borderRadius: "8px",
                                                            fontWeight: "bold"
                                                        },
                                                        children: result.platitorTva === "Da" ? "TVA" : "FĂRĂ TVA"
                                                    })
                                                ]
                                            })
                                        ]
                                    })
                                }, index)),
                            (loading || loadingAnaf) && /*#__PURE__*/ _jsx("div", {
                                style: {
                                    padding: "1rem",
                                    textAlign: "center",
                                    color: "#7f8c8d",
                                    fontSize: "14px"
                                },
                                children: loadingAnaf ? "\uD83D\uDD0D Se caută \xeen ANAF..." : "⏳ Se \xeencarcă subcontractanți..."
                            })
                        ]
                    }),
                    showSuggestions && !loading && !loadingAnaf && /*#__PURE__*/ _jsxs(_Fragment, {
                        children: [
                            searchMode === "local" && subcontractanti.length === 0 && searchTerm.trim().length >= 2 && /*#__PURE__*/ _jsxs("div", {
                                style: {
                                    position: "absolute",
                                    top: "100%",
                                    left: 0,
                                    right: 0,
                                    background: "white",
                                    border: "1px solid #dee2e6",
                                    borderTop: "none",
                                    borderRadius: "0 0 8px 8px",
                                    boxShadow: "0 4px 12px rgba(0,0,0,0.15)",
                                    padding: "1rem",
                                    textAlign: "center",
                                    color: "#7f8c8d",
                                    fontSize: "14px"
                                },
                                children: [
                                    /*#__PURE__*/ _jsxs("div", {
                                        children: [
                                            'Nu au fost găsiți subcontractanți pentru "',
                                            searchTerm,
                                            '"'
                                        ]
                                    }),
                                    onShowAddModal && /*#__PURE__*/ _jsx("button", {
                                        onClick: onShowAddModal,
                                        style: {
                                            marginTop: "0.5rem",
                                            padding: "0.5rem 1rem",
                                            background: "#27ae60",
                                            color: "white",
                                            border: "none",
                                            borderRadius: "6px",
                                            cursor: "pointer",
                                            fontSize: "12px",
                                            fontWeight: "bold"
                                        },
                                        children: "+ Adaugă subcontractant nou"
                                    })
                                ]
                            }),
                            searchMode === "anaf" && anafResults.length === 0 && searchTerm.trim().length >= 6 && !loadingAnaf && /*#__PURE__*/ _jsxs("div", {
                                style: {
                                    position: "absolute",
                                    top: "100%",
                                    left: 0,
                                    right: 0,
                                    background: "white",
                                    border: "1px solid #dee2e6",
                                    borderTop: "none",
                                    borderRadius: "0 0 8px 8px",
                                    boxShadow: "0 4px 12px rgba(0,0,0,0.15)",
                                    padding: "1rem",
                                    textAlign: "center",
                                    color: "#7f8c8d",
                                    fontSize: "14px"
                                },
                                children: [
                                    /*#__PURE__*/ _jsxs("div", {
                                        children: [
                                            'CUI-ul "',
                                            searchTerm,
                                            '" nu a fost găsit \xeen ANAF'
                                        ]
                                    }),
                                    onShowAddModal && /*#__PURE__*/ _jsx("button", {
                                        onClick: onShowAddModal,
                                        style: {
                                            marginTop: "0.5rem",
                                            padding: "0.5rem 1rem",
                                            background: "#3498db",
                                            color: "white",
                                            border: "none",
                                            borderRadius: "6px",
                                            cursor: "pointer",
                                            fontSize: "12px",
                                            fontWeight: "bold"
                                        },
                                        children: "+ Adaugă manual"
                                    })
                                ]
                            })
                        ]
                    })
                ]
            }),
            showImportDialog && anafDataForImport && /*#__PURE__*/ _jsxs("div", {
                style: {
                    marginTop: "0.5rem",
                    background: "linear-gradient(135deg, rgba(52, 152, 219, 0.1) 0%, rgba(46, 204, 113, 0.1) 100%)",
                    border: "1px solid rgba(52, 152, 219, 0.3)",
                    borderRadius: "8px",
                    padding: "1rem"
                },
                children: [
                    /*#__PURE__*/ _jsx("div", {
                        style: {
                            display: "flex",
                            justifyContent: "space-between",
                            alignItems: "flex-start",
                            marginBottom: "0.75rem"
                        },
                        children: /*#__PURE__*/ _jsxs("div", {
                            style: {
                                flex: 1
                            },
                            children: [
                                /*#__PURE__*/ _jsxs("div", {
                                    style: {
                                        fontSize: "14px",
                                        fontWeight: "600",
                                        color: "#2c3e50",
                                        marginBottom: "0.25rem"
                                    },
                                    children: [
                                        "\uD83C\uDFE2 ",
                                        anafDataForImport.denumire
                                    ]
                                }),
                                /*#__PURE__*/ _jsxs("div", {
                                    style: {
                                        fontSize: "12px",
                                        color: "#7f8c8d"
                                    },
                                    children: [
                                        "CUI: ",
                                        anafDataForImport.cui,
                                        " • ",
                                        anafDataForImport.status,
                                        " • ",
                                        anafDataForImport.platitorTva === "Da" ? "Plătitor TVA" : "Fără TVA"
                                    ]
                                })
                            ]
                        })
                    }),
                    /*#__PURE__*/ _jsx("p", {
                        style: {
                            margin: "0 0 1rem 0",
                            fontSize: "13px",
                            color: "#2c3e50"
                        },
                        children: "\uD83D\uDCA1 Subcontractant găsit \xeen ANAF! Vrei să \xeel imporți automat \xeen baza de date?"
                    }),
                    /*#__PURE__*/ _jsxs("div", {
                        style: {
                            display: "flex",
                            gap: "0.75rem"
                        },
                        children: [
                            /*#__PURE__*/ _jsx("button", {
                                onClick: ()=>importFromANAF(anafDataForImport),
                                disabled: loadingAnaf,
                                style: {
                                    padding: "0.5rem 1rem",
                                    background: loadingAnaf ? "#bdc3c7" : "linear-gradient(135deg, #27ae60 0%, #2ecc71 100%)",
                                    color: "white",
                                    border: "none",
                                    borderRadius: "6px",
                                    cursor: loadingAnaf ? "not-allowed" : "pointer",
                                    fontSize: "12px",
                                    fontWeight: "600"
                                },
                                children: loadingAnaf ? "⏳ Se importă..." : "✅ Da, importă automat"
                            }),
                            /*#__PURE__*/ _jsx("button", {
                                onClick: ()=>{
                                    setShowImportDialog(false);
                                    setAnafDataForImport(null);
                                    if (onSubcontractantSelected) {
                                        onSubcontractantSelected({
                                            nume: anafDataForImport.denumire,
                                            cui: anafDataForImport.cui,
                                            tip_client: anafDataForImport.platitorTva === "Da" ? "Juridic_TVA" : "Juridic",
                                            din_anaf: true
                                        });
                                    }
                                },
                                style: {
                                    padding: "0.5rem 1rem",
                                    background: "#f8f9fa",
                                    color: "#6c757d",
                                    border: "1px solid #dee2e6",
                                    borderRadius: "6px",
                                    cursor: "pointer",
                                    fontSize: "12px",
                                    fontWeight: "600"
                                },
                                children: "Folosește fără salvare"
                            }),
                            /*#__PURE__*/ _jsx("button", {
                                onClick: ()=>{
                                    setShowImportDialog(false);
                                    setAnafDataForImport(null);
                                    setAnafResults([]);
                                },
                                style: {
                                    padding: "0.5rem 1rem",
                                    background: "#f8f9fa",
                                    color: "#6c757d",
                                    border: "1px solid #dee2e6",
                                    borderRadius: "6px",
                                    cursor: "pointer",
                                    fontSize: "12px",
                                    fontWeight: "600"
                                },
                                children: "Anulează"
                            })
                        ]
                    })
                ]
            }),
            selectedItem && /*#__PURE__*/ _jsx("div", {
                style: {
                    marginTop: "0.5rem",
                    padding: "0.75rem",
                    background: "linear-gradient(135deg, rgba(39, 174, 96, 0.1) 0%, rgba(46, 204, 113, 0.1) 100%)",
                    border: "1px solid rgba(39, 174, 96, 0.2)",
                    borderRadius: "8px"
                },
                children: /*#__PURE__*/ _jsxs("div", {
                    style: {
                        display: "flex",
                        justifyContent: "space-between",
                        alignItems: "center"
                    },
                    children: [
                        /*#__PURE__*/ _jsxs("div", {
                            children: [
                                /*#__PURE__*/ _jsx("div", {
                                    style: {
                                        fontSize: "12px",
                                        fontWeight: "600",
                                        color: "#27ae60"
                                    },
                                    children: "✅ Subcontractant selectat"
                                }),
                                /*#__PURE__*/ _jsxs("div", {
                                    style: {
                                        fontSize: "11px",
                                        color: "#7f8c8d",
                                        marginTop: "0.25rem"
                                    },
                                    children: [
                                        selectedItem.cui && `CUI: ${selectedItem.cui}`,
                                        selectedItem.telefon && ` • ${selectedItem.telefon}`
                                    ]
                                })
                            ]
                        }),
                        /*#__PURE__*/ _jsx("button", {
                            onClick: ()=>{
                                setSearchTerm("");
                                setSelectedItem(null);
                                if (onSubcontractantSelected) {
                                    onSubcontractantSelected(null);
                                }
                            },
                            style: {
                                background: "transparent",
                                border: "none",
                                color: "#e74c3c",
                                cursor: "pointer",
                                fontSize: "14px",
                                padding: "0.25rem"
                            },
                            title: "Șterge selecția",
                            children: "✖"
                        })
                    ]
                })
            }),
            !showInModal && onShowAddModal && /*#__PURE__*/ _jsx("div", {
                style: {
                    marginTop: "0.75rem"
                },
                children: /*#__PURE__*/ _jsx("button", {
                    onClick: onShowAddModal,
                    style: {
                        width: "100%",
                        padding: "0.75rem",
                        background: "linear-gradient(135deg, #3498db 0%, #5dade2 100%)",
                        color: "white",
                        border: "none",
                        borderRadius: "8px",
                        cursor: "pointer",
                        fontSize: "14px",
                        fontWeight: "600",
                        boxShadow: "0 4px 12px rgba(52, 152, 219, 0.4)",
                        transition: "all 0.3s ease"
                    },
                    children: "+ Adaugă subcontractant nou"
                })
            })
        ]
    });
}

;// CONCATENATED MODULE: ./app/admin/rapoarte/proiecte/components/SubcontractantNouModal.tsx
// ==================================================================
// CALEA: app/admin/rapoarte/proiecte/components/SubcontractantNouModal.tsx
// DATA: 19.08.2025 21:50 (ora României)
// DESCRIERE: Modal pentru adăugare subcontractanți noi cu integrare ANAF
// ==================================================================
/* __next_internal_client_entry_do_not_use__ default auto */ 

// Toast system cu Z-index compatibil cu modalele
const SubcontractantNouModal_showToast = (message, type = "info")=>{
    const toastEl = document.createElement("div");
    toastEl.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(12px);
    color: ${type === "success" ? "#27ae60" : type === "error" ? "#e74c3c" : "#3498db"};
    padding: 16px 20px;
    border-radius: 16px;
    z-index: 70000;
    font-family: 'Inter', Arial, sans-serif;
    font-size: 14px;
    font-weight: 500;
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    border: 1px solid rgba(255, 255, 255, 0.2);
    max-width: 400px;
    word-wrap: break-word;
    transform: translateY(-10px);
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  `;
    toastEl.textContent = message;
    document.body.appendChild(toastEl);
    setTimeout(()=>{
        toastEl.style.transform = "translateY(0)";
        toastEl.style.opacity = "1";
    }, 10);
    setTimeout(()=>{
        toastEl.style.transform = "translateY(-10px)";
        toastEl.style.opacity = "0";
        setTimeout(()=>{
            if (document.body.contains(toastEl)) {
                document.body.removeChild(toastEl);
            }
        }, 300);
    }, type === "success" || type === "error" ? 4000 : 6000);
};
function SubcontractantNouModal({ isOpen, onClose, onSubcontractantAdded, initialData }) {
    const [loading, setLoading] = useState(false);
    const [showAnafSearch, setShowAnafSearch] = useState(!initialData);
    const [anafData, setAnafData] = useState(initialData || null);
    const [formData, setFormData] = useState({
        nume: initialData?.nume || "",
        tip_client: initialData?.tip_client || "Juridic",
        cui: initialData?.cui || "",
        nr_reg_com: initialData?.nr_reg_com || "",
        adresa: initialData?.adresa || "",
        judet: initialData?.judet || "",
        oras: initialData?.oras || "",
        cod_postal: initialData?.cod_postal || "",
        telefon: initialData?.telefon || "",
        email: initialData?.email || "",
        banca: "",
        iban: "",
        // Pentru persoane fizice
        cnp: "",
        ci_serie: "",
        ci_numar: "",
        ci_eliberata_de: "",
        ci_eliberata_la: "",
        observatii: initialData?.din_anaf ? `Date preluate din ANAF la ${new Date().toLocaleString("ro-RO")}` : ""
    });
    const handleAnafDataFound = (data)=>{
        setAnafData(data);
        setFormData((prev)=>({
                ...prev,
                nume: data.denumire || "",
                cui: data.cui || "",
                nr_reg_com: data.nrRegCom || "",
                adresa: data.adresa || "",
                judet: data.judet || "",
                oras: data.oras || "",
                cod_postal: data.codPostal || "",
                telefon: data.telefon || "",
                tip_client: data.platitorTva === "Da" ? "Juridic_TVA" : "Juridic",
                observatii: `Date preluate din ANAF la ${new Date().toLocaleString("ro-RO")}`
            }));
        setShowAnafSearch(false);
        SubcontractantNouModal_showToast("Date ANAF \xeencărcate \xeen formular. Completați restul informațiilor.", "info");
    };
    const handleAnafDataImported = (subcontractantId, data)=>{
        SubcontractantNouModal_showToast("Subcontractant importat automat din ANAF!", "success");
        setTimeout(()=>{
            onSubcontractantAdded();
            onClose();
            resetForm();
        }, 1500);
    };
    const handleSubmit = async (e)=>{
        e.preventDefault();
        setLoading(true);
        try {
            // Validări
            if (!formData.nume.trim()) {
                SubcontractantNouModal_showToast("Numele subcontractantului este obligatoriu", "error");
                setLoading(false);
                return;
            }
            if (formData.tip_client.includes("Juridic") && !formData.cui.trim()) {
                SubcontractantNouModal_showToast("CUI-ul este obligatoriu pentru persoane juridice", "error");
                setLoading(false);
                return;
            }
            if (formData.tip_client === "Fizic" && !formData.cnp.trim()) {
                SubcontractantNouModal_showToast("CNP-ul este obligatoriu pentru persoane fizice", "error");
                setLoading(false);
                return;
            }
            SubcontractantNouModal_showToast("Se adaugă subcontractantul...", "info");
            // Construiește datele pentru BigQuery
            const subcontractantData = {
                ...formData,
                id: `SUB_${Date.now()}_${Math.random().toString(36).substr(2, 6)}`,
                tara: "Romania",
                data_creare: new Date().toISOString(),
                data_actualizare: new Date().toISOString(),
                activ: true
            };
            const response = await fetch("/api/rapoarte/subcontractanti", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(subcontractantData)
            });
            const result = await response.json();
            if (result.success || response.ok) {
                SubcontractantNouModal_showToast("Subcontractant adăugat cu succes!", "success");
                onSubcontractantAdded();
                onClose();
                resetForm();
            } else {
                console.error("Eroare API:", result);
                SubcontractantNouModal_showToast(`Eroare: ${result.error || "Eroare necunoscută"}`, "error");
            }
        } catch (error) {
            console.error("Eroare la adăugarea subcontractantului:", error);
            SubcontractantNouModal_showToast("Eroare la adăugarea subcontractantului", "error");
        } finally{
            setLoading(false);
        }
    };
    const handleInputChange = (field, value)=>{
        setFormData((prev)=>({
                ...prev,
                [field]: value
            }));
    };
    const resetForm = ()=>{
        setFormData({
            nume: "",
            tip_client: "Juridic",
            cui: "",
            nr_reg_com: "",
            adresa: "",
            judet: "",
            oras: "",
            cod_postal: "",
            telefon: "",
            email: "",
            banca: "",
            iban: "",
            cnp: "",
            ci_serie: "",
            ci_numar: "",
            ci_eliberata_de: "",
            ci_eliberata_la: "",
            observatii: ""
        });
        setAnafData(null);
        setShowAnafSearch(true);
    };
    if (!isOpen) return null;
    return /*#__PURE__*/ _jsx("div", {
        style: {
            position: "fixed",
            top: 0,
            left: 0,
            right: 0,
            bottom: 0,
            background: "rgba(0,0,0,0.7)",
            zIndex: 50000,
            display: "flex",
            alignItems: "center",
            justifyContent: "center",
            padding: "1rem"
        },
        children: /*#__PURE__*/ _jsxs("div", {
            style: {
                background: "white",
                borderRadius: "16px",
                boxShadow: "0 20px 40px rgba(0,0,0,0.3)",
                maxWidth: "900px",
                width: "100%",
                maxHeight: "90vh",
                overflowY: "auto"
            },
            children: [
                /*#__PURE__*/ _jsxs("div", {
                    style: {
                        padding: "1.5rem",
                        borderBottom: "1px solid #dee2e6",
                        background: "linear-gradient(135deg, #3498db 0%, #5dade2 100%)",
                        borderRadius: "16px 16px 0 0"
                    },
                    children: [
                        /*#__PURE__*/ _jsxs("div", {
                            style: {
                                display: "flex",
                                justifyContent: "space-between",
                                alignItems: "center"
                            },
                            children: [
                                /*#__PURE__*/ _jsx("h2", {
                                    style: {
                                        margin: 0,
                                        color: "white",
                                        fontSize: "1.5rem",
                                        fontWeight: "700"
                                    },
                                    children: "\uD83C\uDFD7️ Adaugă Subcontractant Nou"
                                }),
                                /*#__PURE__*/ _jsx("button", {
                                    onClick: ()=>{
                                        onClose();
                                        resetForm();
                                    },
                                    disabled: loading,
                                    style: {
                                        background: "rgba(255, 255, 255, 0.2)",
                                        border: "none",
                                        borderRadius: "12px",
                                        width: "40px",
                                        height: "40px",
                                        fontSize: "20px",
                                        cursor: "pointer",
                                        color: "white",
                                        display: "flex",
                                        alignItems: "center",
                                        justifyContent: "center"
                                    },
                                    children: "\xd7"
                                })
                            ]
                        }),
                        /*#__PURE__*/ _jsx("p", {
                            style: {
                                margin: "0.5rem 0 0 0",
                                color: "rgba(255, 255, 255, 0.9)",
                                fontSize: "14px"
                            },
                            children: "Caută \xeen ANAF pentru import automat sau adaugă manual"
                        })
                    ]
                }),
                /*#__PURE__*/ _jsxs("div", {
                    style: {
                        padding: "1.5rem"
                    },
                    children: [
                        showAnafSearch && /*#__PURE__*/ _jsxs(_Fragment, {
                            children: [
                                /*#__PURE__*/ _jsxs("div", {
                                    style: {
                                        background: "#f8f9fa",
                                        padding: "1.5rem",
                                        borderRadius: "12px",
                                        border: "1px solid #e0e0e0",
                                        marginBottom: "1rem"
                                    },
                                    children: [
                                        /*#__PURE__*/ _jsx("h4", {
                                            style: {
                                                margin: "0 0 1rem 0",
                                                color: "#2c3e50",
                                                fontSize: "1.1rem",
                                                fontWeight: "600"
                                            },
                                            children: "\uD83D\uDD0D Căutare \xeen ANAF"
                                        }),
                                        /*#__PURE__*/ _jsxs("div", {
                                            style: {
                                                display: "flex",
                                                gap: "0.75rem",
                                                marginBottom: "1rem",
                                                flexWrap: "wrap"
                                            },
                                            children: [
                                                /*#__PURE__*/ _jsx("div", {
                                                    style: {
                                                        flex: 1,
                                                        minWidth: "200px"
                                                    },
                                                    children: /*#__PURE__*/ _jsx("input", {
                                                        type: "text",
                                                        placeholder: "Introduceți CUI (ex: RO12345678 sau 12345678)",
                                                        style: {
                                                            width: "100%",
                                                            padding: "0.75rem",
                                                            border: "1px solid #dee2e6",
                                                            borderRadius: "8px",
                                                            fontSize: "14px",
                                                            fontFamily: "monospace",
                                                            fontWeight: "500"
                                                        },
                                                        onKeyDown: (e)=>{
                                                            if (e.key === "Enter") {
                                                                const cui = e.target.value;
                                                                if (cui.trim()) {
                                                                    // Trigger ANAF search
                                                                    SubcontractantNouModal_showToast("Funcție ANAF \xeen dezvoltare - folosiți formularul manual", "info");
                                                                }
                                                            }
                                                        }
                                                    })
                                                }),
                                                /*#__PURE__*/ _jsx("button", {
                                                    onClick: ()=>SubcontractantNouModal_showToast("Funcție ANAF \xeen dezvoltare - folosiți formularul manual", "info"),
                                                    style: {
                                                        padding: "0.75rem 1.5rem",
                                                        background: "linear-gradient(135deg, #3498db 0%, #5dade2 100%)",
                                                        color: "white",
                                                        border: "none",
                                                        borderRadius: "8px",
                                                        cursor: "pointer",
                                                        fontSize: "14px",
                                                        fontWeight: "600",
                                                        whiteSpace: "nowrap",
                                                        boxShadow: "0 4px 12px rgba(52, 152, 219, 0.4)"
                                                    },
                                                    children: "\uD83D\uDD0D Caută \xeen ANAF"
                                                })
                                            ]
                                        })
                                    ]
                                }),
                                /*#__PURE__*/ _jsxs("div", {
                                    style: {
                                        display: "flex",
                                        alignItems: "center",
                                        margin: "2rem 0",
                                        gap: "1rem"
                                    },
                                    children: [
                                        /*#__PURE__*/ _jsx("div", {
                                            style: {
                                                flex: 1,
                                                height: "1px",
                                                background: "#e0e0e0"
                                            }
                                        }),
                                        /*#__PURE__*/ _jsx("span", {
                                            style: {
                                                padding: "0.5rem 1rem",
                                                background: "#f8f9fa",
                                                borderRadius: "20px",
                                                fontSize: "14px",
                                                color: "#6c757d",
                                                fontWeight: "600"
                                            },
                                            children: "SAU"
                                        }),
                                        /*#__PURE__*/ _jsx("div", {
                                            style: {
                                                flex: 1,
                                                height: "1px",
                                                background: "#e0e0e0"
                                            }
                                        })
                                    ]
                                }),
                                /*#__PURE__*/ _jsx("div", {
                                    style: {
                                        textAlign: "center",
                                        margin: "2rem 0"
                                    },
                                    children: /*#__PURE__*/ _jsx("button", {
                                        onClick: ()=>setShowAnafSearch(false),
                                        style: {
                                            padding: "1rem 2rem",
                                            background: "linear-gradient(135deg, #27ae60 0%, #2ecc71 100%)",
                                            color: "white",
                                            border: "none",
                                            borderRadius: "12px",
                                            cursor: "pointer",
                                            fontSize: "16px",
                                            fontWeight: "600",
                                            boxShadow: "0 8px 24px rgba(39, 174, 96, 0.4)",
                                            transition: "all 0.3s ease"
                                        },
                                        onMouseOver: (e)=>{
                                            e.currentTarget.style.transform = "translateY(-2px)";
                                            e.currentTarget.style.boxShadow = "0 12px 32px rgba(39, 174, 96, 0.5)";
                                        },
                                        onMouseOut: (e)=>{
                                            e.currentTarget.style.transform = "translateY(0)";
                                            e.currentTarget.style.boxShadow = "0 8px 24px rgba(39, 174, 96, 0.4)";
                                        },
                                        children: "✏️ Adaugă Manual (fără ANAF)"
                                    })
                                })
                            ]
                        }),
                        !showAnafSearch && /*#__PURE__*/ _jsx("form", {
                            onSubmit: handleSubmit,
                            children: /*#__PURE__*/ _jsxs("div", {
                                style: {
                                    background: "#f8f9fa",
                                    padding: "1.5rem",
                                    borderRadius: "12px",
                                    border: "1px solid #e0e0e0",
                                    marginBottom: "1rem"
                                },
                                children: [
                                    /*#__PURE__*/ _jsxs("h4", {
                                        style: {
                                            margin: "0 0 1rem 0",
                                            color: "#2c3e50",
                                            fontSize: "1.1rem",
                                            fontWeight: "600"
                                        },
                                        children: [
                                            "\uD83D\uDCDD Completează Informațiile Subcontractant",
                                            anafData && /*#__PURE__*/ _jsx("span", {
                                                style: {
                                                    marginLeft: "0.5rem",
                                                    fontSize: "12px",
                                                    padding: "0.25rem 0.5rem",
                                                    background: "#3498db",
                                                    color: "white",
                                                    borderRadius: "8px"
                                                },
                                                children: "Date din ANAF"
                                            })
                                        ]
                                    }),
                                    /*#__PURE__*/ _jsxs("div", {
                                        style: {
                                            marginBottom: "1rem"
                                        },
                                        children: [
                                            /*#__PURE__*/ _jsx("label", {
                                                style: {
                                                    display: "block",
                                                    marginBottom: "0.5rem",
                                                    fontWeight: "bold",
                                                    color: "#2c3e50"
                                                },
                                                children: "Tip subcontractant *"
                                            }),
                                            /*#__PURE__*/ _jsxs("select", {
                                                value: formData.tip_client,
                                                onChange: (e)=>handleInputChange("tip_client", e.target.value),
                                                disabled: loading,
                                                style: {
                                                    width: "100%",
                                                    padding: "0.75rem",
                                                    border: "1px solid #dee2e6",
                                                    borderRadius: "8px",
                                                    fontSize: "14px"
                                                },
                                                children: [
                                                    /*#__PURE__*/ _jsx("option", {
                                                        value: "Juridic",
                                                        children: "Persoană Juridică"
                                                    }),
                                                    /*#__PURE__*/ _jsx("option", {
                                                        value: "Juridic_TVA",
                                                        children: "Persoană Juridică (Plătitor TVA)"
                                                    }),
                                                    /*#__PURE__*/ _jsx("option", {
                                                        value: "Fizic",
                                                        children: "Persoană Fizică"
                                                    })
                                                ]
                                            })
                                        ]
                                    }),
                                    /*#__PURE__*/ _jsxs("div", {
                                        style: {
                                            display: "grid",
                                            gridTemplateColumns: "repeat(auto-fit, minmax(250px, 1fr))",
                                            gap: "1rem",
                                            marginBottom: "1rem"
                                        },
                                        children: [
                                            /*#__PURE__*/ _jsxs("div", {
                                                children: [
                                                    /*#__PURE__*/ _jsx("label", {
                                                        style: {
                                                            display: "block",
                                                            marginBottom: "0.5rem",
                                                            fontWeight: "bold",
                                                            color: "#2c3e50"
                                                        },
                                                        children: "Nume/Denumire *"
                                                    }),
                                                    /*#__PURE__*/ _jsx("input", {
                                                        type: "text",
                                                        value: formData.nume,
                                                        onChange: (e)=>handleInputChange("nume", e.target.value),
                                                        disabled: loading,
                                                        placeholder: "Numele subcontractantului",
                                                        style: {
                                                            width: "100%",
                                                            padding: "0.75rem",
                                                            border: "1px solid #dee2e6",
                                                            borderRadius: "8px",
                                                            fontSize: "14px"
                                                        }
                                                    })
                                                ]
                                            }),
                                            formData.tip_client.includes("Juridic") ? /*#__PURE__*/ _jsxs("div", {
                                                children: [
                                                    /*#__PURE__*/ _jsx("label", {
                                                        style: {
                                                            display: "block",
                                                            marginBottom: "0.5rem",
                                                            fontWeight: "bold",
                                                            color: "#2c3e50"
                                                        },
                                                        children: "CUI *"
                                                    }),
                                                    /*#__PURE__*/ _jsx("input", {
                                                        type: "text",
                                                        value: formData.cui,
                                                        onChange: (e)=>handleInputChange("cui", e.target.value),
                                                        disabled: loading,
                                                        placeholder: "RO12345678",
                                                        style: {
                                                            width: "100%",
                                                            padding: "0.75rem",
                                                            border: "1px solid #dee2e6",
                                                            borderRadius: "8px",
                                                            fontSize: "14px",
                                                            fontFamily: "monospace"
                                                        }
                                                    })
                                                ]
                                            }) : /*#__PURE__*/ _jsxs("div", {
                                                children: [
                                                    /*#__PURE__*/ _jsx("label", {
                                                        style: {
                                                            display: "block",
                                                            marginBottom: "0.5rem",
                                                            fontWeight: "bold",
                                                            color: "#2c3e50"
                                                        },
                                                        children: "CNP *"
                                                    }),
                                                    /*#__PURE__*/ _jsx("input", {
                                                        type: "text",
                                                        value: formData.cnp,
                                                        onChange: (e)=>handleInputChange("cnp", e.target.value),
                                                        disabled: loading,
                                                        placeholder: "1234567890123",
                                                        style: {
                                                            width: "100%",
                                                            padding: "0.75rem",
                                                            border: "1px solid #dee2e6",
                                                            borderRadius: "8px",
                                                            fontSize: "14px",
                                                            fontFamily: "monospace"
                                                        }
                                                    })
                                                ]
                                            })
                                        ]
                                    }),
                                    formData.tip_client.includes("Juridic") && /*#__PURE__*/ _jsxs("div", {
                                        style: {
                                            marginBottom: "1rem"
                                        },
                                        children: [
                                            /*#__PURE__*/ _jsx("label", {
                                                style: {
                                                    display: "block",
                                                    marginBottom: "0.5rem",
                                                    fontWeight: "bold",
                                                    color: "#2c3e50"
                                                },
                                                children: "Nr. Reg. Com."
                                            }),
                                            /*#__PURE__*/ _jsx("input", {
                                                type: "text",
                                                value: formData.nr_reg_com,
                                                onChange: (e)=>handleInputChange("nr_reg_com", e.target.value),
                                                disabled: loading,
                                                placeholder: "J40/1234/2020",
                                                style: {
                                                    width: "100%",
                                                    padding: "0.75rem",
                                                    border: "1px solid #dee2e6",
                                                    borderRadius: "8px",
                                                    fontSize: "14px",
                                                    fontFamily: "monospace"
                                                }
                                            })
                                        ]
                                    }),
                                    /*#__PURE__*/ _jsxs("div", {
                                        style: {
                                            marginBottom: "1rem"
                                        },
                                        children: [
                                            /*#__PURE__*/ _jsx("label", {
                                                style: {
                                                    display: "block",
                                                    marginBottom: "0.5rem",
                                                    fontWeight: "bold",
                                                    color: "#2c3e50"
                                                },
                                                children: "Adresă"
                                            }),
                                            /*#__PURE__*/ _jsx("input", {
                                                type: "text",
                                                value: formData.adresa,
                                                onChange: (e)=>handleInputChange("adresa", e.target.value),
                                                disabled: loading,
                                                placeholder: "Strada, numărul, sectorul/comuna",
                                                style: {
                                                    width: "100%",
                                                    padding: "0.75rem",
                                                    border: "1px solid #dee2e6",
                                                    borderRadius: "8px",
                                                    fontSize: "14px"
                                                }
                                            })
                                        ]
                                    }),
                                    /*#__PURE__*/ _jsxs("div", {
                                        style: {
                                            display: "grid",
                                            gridTemplateColumns: "repeat(auto-fit, minmax(200px, 1fr))",
                                            gap: "1rem",
                                            marginBottom: "1rem"
                                        },
                                        children: [
                                            /*#__PURE__*/ _jsxs("div", {
                                                children: [
                                                    /*#__PURE__*/ _jsx("label", {
                                                        style: {
                                                            display: "block",
                                                            marginBottom: "0.5rem",
                                                            fontWeight: "bold",
                                                            color: "#2c3e50"
                                                        },
                                                        children: "Județ"
                                                    }),
                                                    /*#__PURE__*/ _jsx("input", {
                                                        type: "text",
                                                        value: formData.judet,
                                                        onChange: (e)=>handleInputChange("judet", e.target.value),
                                                        disabled: loading,
                                                        placeholder: "București",
                                                        style: {
                                                            width: "100%",
                                                            padding: "0.75rem",
                                                            border: "1px solid #dee2e6",
                                                            borderRadius: "8px",
                                                            fontSize: "14px"
                                                        }
                                                    })
                                                ]
                                            }),
                                            /*#__PURE__*/ _jsxs("div", {
                                                children: [
                                                    /*#__PURE__*/ _jsx("label", {
                                                        style: {
                                                            display: "block",
                                                            marginBottom: "0.5rem",
                                                            fontWeight: "bold",
                                                            color: "#2c3e50"
                                                        },
                                                        children: "Oraș"
                                                    }),
                                                    /*#__PURE__*/ _jsx("input", {
                                                        type: "text",
                                                        value: formData.oras,
                                                        onChange: (e)=>handleInputChange("oras", e.target.value),
                                                        disabled: loading,
                                                        placeholder: "București",
                                                        style: {
                                                            width: "100%",
                                                            padding: "0.75rem",
                                                            border: "1px solid #dee2e6",
                                                            borderRadius: "8px",
                                                            fontSize: "14px"
                                                        }
                                                    })
                                                ]
                                            }),
                                            /*#__PURE__*/ _jsxs("div", {
                                                children: [
                                                    /*#__PURE__*/ _jsx("label", {
                                                        style: {
                                                            display: "block",
                                                            marginBottom: "0.5rem",
                                                            fontWeight: "bold",
                                                            color: "#2c3e50"
                                                        },
                                                        children: "Cod Poștal"
                                                    }),
                                                    /*#__PURE__*/ _jsx("input", {
                                                        type: "text",
                                                        value: formData.cod_postal,
                                                        onChange: (e)=>handleInputChange("cod_postal", e.target.value),
                                                        disabled: loading,
                                                        placeholder: "010123",
                                                        style: {
                                                            width: "100%",
                                                            padding: "0.75rem",
                                                            border: "1px solid #dee2e6",
                                                            borderRadius: "8px",
                                                            fontSize: "14px"
                                                        }
                                                    })
                                                ]
                                            })
                                        ]
                                    }),
                                    /*#__PURE__*/ _jsxs("div", {
                                        style: {
                                            display: "grid",
                                            gridTemplateColumns: "repeat(auto-fit, minmax(250px, 1fr))",
                                            gap: "1rem",
                                            marginBottom: "1rem"
                                        },
                                        children: [
                                            /*#__PURE__*/ _jsxs("div", {
                                                children: [
                                                    /*#__PURE__*/ _jsx("label", {
                                                        style: {
                                                            display: "block",
                                                            marginBottom: "0.5rem",
                                                            fontWeight: "bold",
                                                            color: "#2c3e50"
                                                        },
                                                        children: "Telefon"
                                                    }),
                                                    /*#__PURE__*/ _jsx("input", {
                                                        type: "tel",
                                                        value: formData.telefon,
                                                        onChange: (e)=>handleInputChange("telefon", e.target.value),
                                                        disabled: loading,
                                                        placeholder: "0123456789",
                                                        style: {
                                                            width: "100%",
                                                            padding: "0.75rem",
                                                            border: "1px solid #dee2e6",
                                                            borderRadius: "8px",
                                                            fontSize: "14px"
                                                        }
                                                    })
                                                ]
                                            }),
                                            /*#__PURE__*/ _jsxs("div", {
                                                children: [
                                                    /*#__PURE__*/ _jsx("label", {
                                                        style: {
                                                            display: "block",
                                                            marginBottom: "0.5rem",
                                                            fontWeight: "bold",
                                                            color: "#2c3e50"
                                                        },
                                                        children: "Email"
                                                    }),
                                                    /*#__PURE__*/ _jsx("input", {
                                                        type: "email",
                                                        value: formData.email,
                                                        onChange: (e)=>handleInputChange("email", e.target.value),
                                                        disabled: loading,
                                                        placeholder: "contact@subcontractant.ro",
                                                        style: {
                                                            width: "100%",
                                                            padding: "0.75rem",
                                                            border: "1px solid #dee2e6",
                                                            borderRadius: "8px",
                                                            fontSize: "14px"
                                                        }
                                                    })
                                                ]
                                            })
                                        ]
                                    }),
                                    /*#__PURE__*/ _jsxs("div", {
                                        style: {
                                            display: "grid",
                                            gridTemplateColumns: "repeat(auto-fit, minmax(250px, 1fr))",
                                            gap: "1rem",
                                            marginBottom: "1rem"
                                        },
                                        children: [
                                            /*#__PURE__*/ _jsxs("div", {
                                                children: [
                                                    /*#__PURE__*/ _jsx("label", {
                                                        style: {
                                                            display: "block",
                                                            marginBottom: "0.5rem",
                                                            fontWeight: "bold",
                                                            color: "#2c3e50"
                                                        },
                                                        children: "Bancă"
                                                    }),
                                                    /*#__PURE__*/ _jsx("input", {
                                                        type: "text",
                                                        value: formData.banca,
                                                        onChange: (e)=>handleInputChange("banca", e.target.value),
                                                        disabled: loading,
                                                        placeholder: "Banca Transilvania",
                                                        style: {
                                                            width: "100%",
                                                            padding: "0.75rem",
                                                            border: "1px solid #dee2e6",
                                                            borderRadius: "8px",
                                                            fontSize: "14px"
                                                        }
                                                    })
                                                ]
                                            }),
                                            /*#__PURE__*/ _jsxs("div", {
                                                children: [
                                                    /*#__PURE__*/ _jsx("label", {
                                                        style: {
                                                            display: "block",
                                                            marginBottom: "0.5rem",
                                                            fontWeight: "bold",
                                                            color: "#2c3e50"
                                                        },
                                                        children: "IBAN"
                                                    }),
                                                    /*#__PURE__*/ _jsx("input", {
                                                        type: "text",
                                                        value: formData.iban,
                                                        onChange: (e)=>handleInputChange("iban", e.target.value),
                                                        disabled: loading,
                                                        placeholder: "RO49AAAA1B31007593840000",
                                                        style: {
                                                            width: "100%",
                                                            padding: "0.75rem",
                                                            border: "1px solid #dee2e6",
                                                            borderRadius: "8px",
                                                            fontSize: "14px",
                                                            fontFamily: "monospace"
                                                        }
                                                    })
                                                ]
                                            })
                                        ]
                                    }),
                                    /*#__PURE__*/ _jsxs("div", {
                                        style: {
                                            marginBottom: "1rem"
                                        },
                                        children: [
                                            /*#__PURE__*/ _jsx("label", {
                                                style: {
                                                    display: "block",
                                                    marginBottom: "0.5rem",
                                                    fontWeight: "bold",
                                                    color: "#2c3e50"
                                                },
                                                children: "Observații"
                                            }),
                                            /*#__PURE__*/ _jsx("textarea", {
                                                value: formData.observatii,
                                                onChange: (e)=>handleInputChange("observatii", e.target.value),
                                                disabled: loading,
                                                placeholder: "Observații despre subcontractant...",
                                                rows: 3,
                                                style: {
                                                    width: "100%",
                                                    padding: "0.75rem",
                                                    border: "1px solid #dee2e6",
                                                    borderRadius: "8px",
                                                    fontSize: "14px",
                                                    resize: "vertical"
                                                }
                                            })
                                        ]
                                    }),
                                    /*#__PURE__*/ _jsxs("div", {
                                        style: {
                                            display: "flex",
                                            justifyContent: "space-between",
                                            gap: "1rem",
                                            paddingTop: "1rem",
                                            borderTop: "1px solid #dee2e6"
                                        },
                                        children: [
                                            /*#__PURE__*/ _jsx("button", {
                                                type: "button",
                                                onClick: ()=>setShowAnafSearch(true),
                                                disabled: loading,
                                                style: {
                                                    padding: "0.75rem 1.5rem",
                                                    background: "#f8f9fa",
                                                    color: "#6c757d",
                                                    border: "1px solid #dee2e6",
                                                    borderRadius: "8px",
                                                    cursor: loading ? "not-allowed" : "pointer",
                                                    fontSize: "14px",
                                                    fontWeight: "600"
                                                },
                                                children: "← \xcenapoi la ANAF"
                                            }),
                                            /*#__PURE__*/ _jsxs("div", {
                                                style: {
                                                    display: "flex",
                                                    gap: "1rem"
                                                },
                                                children: [
                                                    /*#__PURE__*/ _jsx("button", {
                                                        type: "button",
                                                        onClick: ()=>{
                                                            onClose();
                                                            resetForm();
                                                        },
                                                        disabled: loading,
                                                        style: {
                                                            padding: "0.75rem 1.5rem",
                                                            background: "#6c757d",
                                                            color: "white",
                                                            border: "none",
                                                            borderRadius: "8px",
                                                            cursor: loading ? "not-allowed" : "pointer",
                                                            fontSize: "14px",
                                                            fontWeight: "600"
                                                        },
                                                        children: "Anulează"
                                                    }),
                                                    /*#__PURE__*/ _jsx("button", {
                                                        type: "submit",
                                                        disabled: loading,
                                                        style: {
                                                            padding: "0.75rem 1.5rem",
                                                            background: loading ? "#bdc3c7" : "linear-gradient(135deg, #3498db 0%, #5dade2 100%)",
                                                            color: "white",
                                                            border: "none",
                                                            borderRadius: "8px",
                                                            cursor: loading ? "not-allowed" : "pointer",
                                                            fontSize: "14px",
                                                            fontWeight: "600",
                                                            boxShadow: loading ? "none" : "0 4px 12px rgba(52, 152, 219, 0.4)"
                                                        },
                                                        children: loading ? "⏳ Se adaugă..." : "\uD83D\uDCBE Adaugă Subcontractant"
                                                    })
                                                ]
                                            })
                                        ]
                                    })
                                ]
                            })
                        })
                    ]
                })
            ]
        })
    });
}

;// CONCATENATED MODULE: ./app/admin/rapoarte/proiecte/components/ProiectNouModal.tsx
// ==================================================================
// CALEA: app/admin/rapoarte/proiecte/components/ProiectNouModal.tsx
// DATA: 24.08.2025 18:45 (ora României)
// MODIFICAT: Centrare cu createPortal + Responsabili multipli + Subcontractant în cheltuieli + Opțiuni monedă
// PĂSTRATE: Toate funcționalitățile existente cu conversii valutare și cursuri BNR
// ==================================================================
/* __next_internal_client_entry_do_not_use__ default auto */ 







// Toast system compatibil cu modalul centrat
const ProiectNouModal_showToast = (message, type = "info")=>{
    const toastEl = document.createElement("div");
    toastEl.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(12px);
    color: ${type === "success" ? "#27ae60" : type === "error" ? "#e74c3c" : "#3498db"};
    padding: 16px 20px;
    border-radius: 16px;
    z-index: 70000;
    font-family: 'Inter', Arial, sans-serif;
    font-size: 14px;
    font-weight: 500;
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    border: 1px solid rgba(255, 255, 255, 0.2);
    max-width: 400px;
    word-wrap: break-word;
    transform: translateY(-10px);
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  `;
    toastEl.textContent = message;
    document.body.appendChild(toastEl);
    setTimeout(()=>{
        toastEl.style.transform = "translateY(0)";
        toastEl.style.opacity = "1";
    }, 10);
    setTimeout(()=>{
        toastEl.style.transform = "translateY(-10px)";
        toastEl.style.opacity = "0";
        setTimeout(()=>{
            if (document.body.contains(toastEl)) {
                document.body.removeChild(toastEl);
            }
        }, 300);
    }, type === "success" || type === "error" ? 4000 : 6000);
};
// Funcție helper pentru validări sigure (PĂSTRATĂ identică)
const ensureNumber = (value, defaultValue = 0)=>{
    if (typeof value === "number" && !isNaN(value) && isFinite(value)) {
        return value;
    }
    if (typeof value === "string") {
        const parsed = parseFloat(value);
        return !isNaN(parsed) && isFinite(parsed) ? parsed : defaultValue;
    }
    return defaultValue;
};
// PĂSTRAT: Funcție pentru formatare cu precizie originală (fără rotunjire forțată)
const formatWithOriginalPrecision = (value, originalPrecision)=>{
    if (originalPrecision && originalPrecision !== "undefined" && originalPrecision !== "null") {
        return originalPrecision;
    }
    const num = ensureNumber(value);
    return num.toString();
};
// PĂSTRAT: Validare și formatare corectă pentru DATE fields BigQuery
const formatDateForBigQuery = (dateString)=>{
    if (!dateString || dateString.trim() === "") {
        return null;
    }
    try {
        // Verifică dacă este deja în format ISO (YYYY-MM-DD)
        const isoDateRegex = /^\d{4}-\d{2}-\d{2}$/;
        if (isoDateRegex.test(dateString)) {
            // Validează că data este reală
            const date = new Date(dateString + "T00:00:00");
            if (!isNaN(date.getTime())) {
                return dateString;
            }
        }
        // Încearcă să parseze data în alte formate
        const date = new Date(dateString);
        if (!isNaN(date.getTime())) {
            return date.toISOString().split("T")[0];
        }
        console.warn("Data nu poate fi parsată:", dateString);
        return null;
    } catch (error) {
        console.error("Eroare la formatarea datei pentru BigQuery:", dateString, error);
        return null;
    }
};
// PĂSTRAT: Funcție pentru preluarea cursurilor BNR LIVE - fără rotunjire
const getCursBNRLive = async (moneda, data)=>{
    if (moneda === "RON") return {
        curs: 1,
        precizie: "1"
    };
    try {
        const url = `/api/curs-valutar?moneda=${encodeURIComponent(moneda)}${data ? `&data=${data}` : ""}`;
        const response = await fetch(url);
        const result = await response.json();
        if (result.success && result.curs) {
            const cursNumeric = ensureNumber(result.curs, 1);
            const precizie = result.precizie_originala || cursNumeric.toString();
            console.log(`Curs BNR live pentru ${moneda}: ${precizie} (nu rotunjit)`);
            return {
                curs: cursNumeric,
                precizie
            };
        }
        console.warn(`Nu s-a putut prelua cursul live pentru ${moneda}, folosesc fallback`);
        const fallbackCursuri = {
            "EUR": {
                curs: 5.0683,
                precizie: "5.0683"
            },
            "USD": {
                curs: 4.3688,
                precizie: "4.3688"
            },
            "GBP": {
                curs: 5.8777,
                precizie: "5.8777"
            }
        };
        return fallbackCursuri[moneda] || {
            curs: 1,
            precizie: "1"
        };
    } catch (error) {
        console.error(`Eroare la preluarea cursului pentru ${moneda}:`, error);
        const fallbackCursuri = {
            "EUR": {
                curs: 5.0683,
                precizie: "5.0683"
            },
            "USD": {
                curs: 4.3688,
                precizie: "4.3688"
            },
            "GBP": {
                curs: 5.8777,
                precizie: "5.8777"
            }
        };
        return fallbackCursuri[moneda] || {
            curs: 1,
            precizie: "1"
        };
    }
};
// NOU: Funcție pentru ora României (UTC+3)
const getRomanianDateTime = ()=>{
    const now = new Date();
    const romanianTime = new Date(now.getTime() + 3 * 60 * 60 * 1000); // UTC+3
    return romanianTime.toISOString();
};
function ProiectNouModal({ isOpen, onClose, onProiectAdded }) {
    const [loading, setLoading] = (0,react_experimental_.useState)(false);
    const [clienti, setClienti] = (0,react_experimental_.useState)([]);
    const [showClientModal, setShowClientModal] = (0,react_experimental_.useState)(false);
    const [showSubcontractantModal, setShowSubcontractantModal] = (0,react_experimental_.useState)(false);
    const [clientSearch, setClientSearch] = (0,react_experimental_.useState)("");
    const [showClientSuggestions, setShowClientSuggestions] = (0,react_experimental_.useState)(false);
    // NOU: State pentru responsabili multipli
    const [responsabiliSelectati, setResponsabiliSelectati] = (0,react_experimental_.useState)([]);
    // NOU: State pentru responsabili per subproiect
    const [responsabiliSubproiecte, setResponsabiliSubproiecte] = (0,react_experimental_.useState)({});
    // State pentru conversii valutare (PĂSTRAT identic)
    const [cursValutar, setCursValutar] = (0,react_experimental_.useState)(null);
    const [loadingCurs, setLoadingCurs] = (0,react_experimental_.useState)(false);
    const [precizieOriginala, setPrecizieOriginala] = (0,react_experimental_.useState)("");
    const [formData, setFormData] = (0,react_experimental_.useState)({
        ID_Proiect: "",
        Denumire: "",
        Client: "",
        selectedClientId: "",
        Adresa: "",
        Descriere: "",
        // Date în format ISO pentru BigQuery
        Data_Start: "",
        Data_Final: "",
        Status: "Activ",
        // Valoare și monedă
        Valoare_Estimata: "",
        moneda: "RON",
        curs_valutar: "",
        data_curs_valutar: "",
        valoare_ron: "",
        // Status-uri multiple
        status_predare: "Nepredat",
        status_contract: "Nu e cazul",
        status_facturare: "Nefacturat",
        status_achitare: "Neachitat",
        // MODIFICAT: Eliminat Responsabil și Subcontractant - sunt gestionate separat
        Observatii: "",
        // Pentru subproiecte
        subproiecte: [],
        // MODIFICAT: Pentru cheltuieli proiect cu subcontractanti
        cheltuieli: []
    });
    (0,react_experimental_.useEffect)(()=>{
        if (isOpen) {
            loadClienti();
            const today = new Date().toISOString().split("T")[0];
            setFormData((prev)=>({
                    ...prev,
                    ID_Proiect: `P${new Date().getFullYear()}${String(Date.now()).slice(-3)}`,
                    data_curs_valutar: today,
                    Data_Start: today
                }));
        }
    }, [
        isOpen
    ]);
    // PĂSTRAT: Effect pentru calcularea cursului valutar
    (0,react_experimental_.useEffect)(()=>{
        if (formData.moneda !== "RON" && formData.Valoare_Estimata) {
            loadCursValutar();
        } else if (formData.moneda === "RON") {
            setFormData((prev)=>({
                    ...prev,
                    valoare_ron: prev.Valoare_Estimata,
                    curs_valutar: "1"
                }));
            setCursValutar(1);
            setPrecizieOriginala("1");
        }
    }, [
        formData.moneda,
        formData.Valoare_Estimata,
        formData.data_curs_valutar
    ]);
    const loadClienti = async ()=>{
        try {
            const response = await fetch("/api/rapoarte/clienti");
            const data = await response.json();
            if (data.success) {
                setClienti(data.data || []);
            }
        } catch (error) {
            console.error("Eroare la \xeencărcarea clienților:", error);
        }
    };
    // PĂSTRAT: Funcție pentru încărcarea cursului valutar fără rotunjire forțată
    const loadCursValutar = async ()=>{
        if (formData.moneda === "RON") return;
        setLoadingCurs(true);
        try {
            const response = await fetch(`/api/curs-valutar?moneda=${formData.moneda}&data=${formData.data_curs_valutar}`);
            const data = await response.json();
            if (data.success) {
                const cursSigur = ensureNumber(data.curs, 1);
                const valoareSigura = ensureNumber(formData.Valoare_Estimata, 0);
                setCursValutar(cursSigur);
                setPrecizieOriginala(data.precizie_originala || cursSigur.toString());
                const valoareRON = valoareSigura * cursSigur;
                setFormData((prev)=>({
                        ...prev,
                        curs_valutar: cursSigur.toString(),
                        valoare_ron: ensureNumber(valoareRON, 0).toFixed(2)
                    }));
                if (data.source === "fallback") {
                    dist.toast.warning(data.warning || "Folosind curs aproximativ");
                }
            } else {
                dist.toast.error("Nu s-a putut obține cursul valutar");
            }
        } catch (error) {
            console.error("Eroare la obținerea cursului:", error);
            dist.toast.error("Eroare la obținerea cursului valutar");
        } finally{
            setLoadingCurs(false);
        }
    };
    // NOU: Handler pentru selectarea responsabilului
    const handleResponsabilSelect = (responsabil)=>{
        if (responsabil) {
            const existaResponsabil = responsabiliSelectati.find((r)=>r.uid === responsabil.uid);
            if (existaResponsabil) {
                ProiectNouModal_showToast("Responsabilul este deja adăugat", "error");
                return;
            }
            const nouResponsabil = {
                uid: responsabil.uid,
                nume_complet: responsabil.nume_complet,
                email: responsabil.email,
                rol_in_proiect: responsabiliSelectati.length === 0 ? "Principal" : "Normal"
            };
            setResponsabiliSelectati((prev)=>[
                    ...prev,
                    nouResponsabil
                ]);
            ProiectNouModal_showToast(`Responsabil ${responsabil.nume_complet} adăugat`, "success");
        }
    };
    // NOU: Funcții pentru managementul responsabililor
    const removeResponsabil = (uid)=>{
        setResponsabiliSelectati((prev)=>prev.filter((r)=>r.uid !== uid));
    };
    const updateRolResponsabil = (uid, nouRol)=>{
        setResponsabiliSelectati((prev)=>prev.map((r)=>r.uid === uid ? {
                    ...r,
                    rol_in_proiect: nouRol
                } : r));
    };
    // NOU: Funcții pentru managementul responsabililor la subproiecte
    const handleResponsabilSubproiectSelected = (subproiectId, responsabil)=>{
        if (!responsabil) return;
        const responsabiliActuali = responsabiliSubproiecte[subproiectId] || [];
        const existaResponsabil = responsabiliActuali.find((r)=>r.uid === responsabil.uid);
        if (existaResponsabil) {
            ProiectNouModal_showToast("Responsabilul este deja adăugat la acest subproiect", "error");
            return;
        }
        const nouResponsabil = {
            uid: responsabil.uid,
            nume_complet: responsabil.nume_complet,
            email: responsabil.email,
            rol_in_proiect: responsabiliActuali.length === 0 ? "Principal" : "Normal"
        };
        setResponsabiliSubproiecte((prev)=>({
                ...prev,
                [subproiectId]: [
                    ...prev[subproiectId] || [],
                    nouResponsabil
                ]
            }));
        ProiectNouModal_showToast(`Responsabil ${responsabil.nume_complet} adăugat la subproiect`, "success");
    };
    const removeResponsabilSubproiect = (subproiectId, uid)=>{
        setResponsabiliSubproiecte((prev)=>({
                ...prev,
                [subproiectId]: (prev[subproiectId] || []).filter((r)=>r.uid !== uid)
            }));
    };
    const updateRolResponsabilSubproiect = (subproiectId, uid, nouRol)=>{
        setResponsabiliSubproiecte((prev)=>({
                ...prev,
                [subproiectId]: (prev[subproiectId] || []).map((r)=>r.uid === uid ? {
                        ...r,
                        rol_in_proiect: nouRol
                    } : r)
            }));
    };
    // NOU: Handler pentru selectarea subcontractantului în cheltuieli
    const handleSubcontractantSelectForCheltuiala = (cheltuialaId, subcontractant)=>{
        if (subcontractant) {
            setFormData((prev)=>({
                    ...prev,
                    cheltuieli: prev.cheltuieli.map((ch)=>ch.id === cheltuialaId ? {
                            ...ch,
                            subcontractant_id: subcontractant.id || "",
                            subcontractant_nume: subcontractant.nume,
                            subcontractant_cui: subcontractant.cui || ""
                        } : ch)
                }));
        } else {
            setFormData((prev)=>({
                    ...prev,
                    cheltuieli: prev.cheltuieli.map((ch)=>ch.id === cheltuialaId ? {
                            ...ch,
                            subcontractant_id: "",
                            subcontractant_nume: "",
                            subcontractant_cui: ""
                        } : ch)
                }));
        }
    };
    // PĂSTRAT: Handler pentru afișarea modalului de subcontractant nou
    const handleShowSubcontractantModal = ()=>{
        setShowSubcontractantModal(true);
    };
    // PĂSTRAT: Handler pentru când subcontractantul a fost adăugat
    const handleSubcontractantAdded = ()=>{
        setShowSubcontractantModal(false);
        ProiectNouModal_showToast("Subcontractant adăugat cu succes!", "success");
    };
    const resetForm = ()=>{
        const today = new Date().toISOString().split("T")[0];
        setFormData({
            ID_Proiect: "",
            Denumire: "",
            Client: "",
            selectedClientId: "",
            Adresa: "",
            Descriere: "",
            Data_Start: "",
            Data_Final: "",
            Status: "Activ",
            Valoare_Estimata: "",
            moneda: "RON",
            curs_valutar: "",
            data_curs_valutar: today,
            valoare_ron: "",
            status_predare: "Nepredat",
            status_contract: "Nu e cazul",
            status_facturare: "Nefacturat",
            status_achitare: "Neachitat",
            Observatii: "",
            subproiecte: [],
            cheltuieli: []
        });
        setClientSearch("");
        setResponsabiliSelectati([]); // NOU: Reset responsabili
        setResponsabiliSubproiecte({}); // NOU: Reset responsabili subproiecte
        setCursValutar(null);
        setPrecizieOriginala("");
    };
    const handleInputChange = (field, value)=>{
        setFormData((prev)=>({
                ...prev,
                [field]: value
            }));
    };
    const handleClientSearch = (value)=>{
        setClientSearch(value);
        setFormData((prev)=>({
                ...prev,
                Client: value
            }));
        setShowClientSuggestions(value.length > 0);
    };
    const selectClient = (client)=>{
        setClientSearch(client.nume);
        setFormData((prev)=>({
                ...prev,
                Client: client.nume,
                selectedClientId: client.id
            }));
        setShowClientSuggestions(false);
    };
    const filteredClients = clienti.filter((client)=>client.nume.toLowerCase().includes(clientSearch.toLowerCase())).slice(0, 5);
    // PĂSTRAT: Funcții pentru managementul subproiectelor
    const addSubproiect = ()=>{
        const newSubproiect = {
            id: Date.now().toString(),
            denumire: "",
            valoare: "",
            moneda: "RON",
            status: "Planificat",
            data_start: formData.Data_Start || "",
            data_final: formData.Data_Final || ""
        };
        setFormData((prev)=>({
                ...prev,
                subproiecte: [
                    ...prev.subproiecte,
                    newSubproiect
                ]
            }));
    };
    const removeSubproiect = (id)=>{
        setFormData((prev)=>({
                ...prev,
                subproiecte: prev.subproiecte.filter((sub)=>sub.id !== id)
            }));
    };
    const updateSubproiect = (id, field, value)=>{
        setFormData((prev)=>({
                ...prev,
                subproiecte: prev.subproiecte.map((sub)=>sub.id === id ? {
                        ...sub,
                        [field]: value
                    } : sub)
            }));
    };
    // MODIFICAT: Funcții pentru managementul cheltuielilor cu subcontractant
    const addCheltuiala = ()=>{
        const newCheltuiala = {
            id: Date.now().toString(),
            tip_cheltuiala: "subcontractant",
            subcontractant_id: "",
            subcontractant_nume: "",
            subcontractant_cui: "",
            descriere: "",
            valoare: "",
            moneda: "RON",
            status_predare: "Nepredat",
            status_contract: "Nu e cazul",
            status_facturare: "Nefacturat",
            status_achitare: "Neachitat"
        };
        setFormData((prev)=>({
                ...prev,
                cheltuieli: [
                    ...prev.cheltuieli,
                    newCheltuiala
                ]
            }));
    };
    const removeCheltuiala = (id)=>{
        setFormData((prev)=>({
                ...prev,
                cheltuieli: prev.cheltuieli.filter((ch)=>ch.id !== id)
            }));
    };
    const updateCheltuiala = (id, field, value)=>{
        setFormData((prev)=>({
                ...prev,
                cheltuieli: prev.cheltuieli.map((ch)=>ch.id === id ? {
                        ...ch,
                        [field]: value
                    } : ch)
            }));
    };
    // PĂSTRAT: Funcțiile pentru adăugarea subproiectelor și cheltuielilor cu cursuri BNR
    const addSubproiecte = async (proiectId, dataStart, dataFinal)=>{
        console.log(`Începe adăugarea subproiectelor pentru ${proiectId}`);
        for (const subproiect of formData.subproiecte){
            try {
                let valoareRonSubproiect = null;
                let cursSubproiect = null;
                if (subproiect.moneda && subproiect.moneda !== "RON" && subproiect.valoare) {
                    if (subproiect.moneda === formData.moneda && formData.curs_valutar) {
                        cursSubproiect = ensureNumber(formData.curs_valutar, 1);
                        valoareRonSubproiect = ensureNumber(subproiect.valoare, 0) * cursSubproiect;
                    } else {
                        console.log(`Preiau curs BNR live pentru subproiect ${subproiect.denumire} (${subproiect.moneda})`);
                        const cursData = await getCursBNRLive(subproiect.moneda, formData.data_curs_valutar);
                        cursSubproiect = cursData.curs;
                        valoareRonSubproiect = ensureNumber(subproiect.valoare, 0) * cursSubproiect;
                    }
                } else if (subproiect.moneda === "RON" && subproiect.valoare) {
                    valoareRonSubproiect = ensureNumber(subproiect.valoare, 0);
                    cursSubproiect = 1;
                }
                // CORECTAT: Responsabil principal din lista de responsabili multipli
                const responsabiliSubproiect = responsabiliSubproiecte[subproiect.id] || [];
                const responsabilPrincipal = responsabiliSubproiect.find((r)=>r.rol_in_proiect === "Principal");
                const subproiectData = {
                    ID_Subproiect: `${proiectId}_SUB_${subproiect.id}`,
                    ID_Proiect: proiectId,
                    Denumire: subproiect.denumire,
                    Responsabil: responsabilPrincipal ? responsabilPrincipal.nume_complet : null,
                    Status: subproiect.status || "Planificat",
                    Valoare_Estimata: subproiect.valoare ? ensureNumber(subproiect.valoare) : null,
                    Data_Start: dataStart,
                    Data_Final: dataFinal,
                    moneda: subproiect.moneda || "RON",
                    curs_valutar: cursSubproiect,
                    data_curs_valutar: formatDateForBigQuery(formData.data_curs_valutar || new Date().toISOString().split("T")[0]),
                    valoare_ron: valoareRonSubproiect,
                    status_predare: "Nepredat",
                    status_contract: "Nu e cazul",
                    status_facturare: "Nefacturat",
                    status_achitare: "Neachitat"
                };
                const response = await fetch("/api/rapoarte/subproiecte", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(subproiectData)
                });
                const result = await response.json();
                if (result.success) {
                    console.log(`Subproiect "${subproiect.denumire}" adăugat cu succes`);
                } else {
                    console.error(`Eroare la subproiect ${subproiect.denumire}:`, result);
                    dist.toast.error(`Eroare la adăugarea subproiectului "${subproiect.denumire}": ${result.error}`);
                }
            } catch (error) {
                console.error(`Eroare la adăugarea subproiectului ${subproiect.denumire}:`, error);
                dist.toast.error(`Eroare la adăugarea subproiectului "${subproiect.denumire}"`);
            }
        }
    };
    // CORECTAT: Functia pentru adaugarea cheltuielilor cu mapping corect către API
    const addCheltuieli = async (proiectId)=>{
        for (const cheltuiala of formData.cheltuieli){
            try {
                // CORECTAT: Calcul conversie valutară pentru cheltuieli
                let cursValutar = 1;
                let valoareRON = ensureNumber(cheltuiala.valoare);
                // Dacă moneda nu este RON, calculează conversia
                if (cheltuiala.moneda !== "RON") {
                    // Folosește cursul din formData dacă monedele coincid, altfel preiau curs nou
                    if (cheltuiala.moneda === formData.moneda && cursValutar && cursValutar > 1) {
                        cursValutar = ensureNumber(formData.curs_valutar);
                    } else {
                        // Preluare curs BNR pentru această cheltuială
                        try {
                            const response = await fetch(`/api/curs-valutar?moneda=${cheltuiala.moneda}`);
                            const cursData = await response.json();
                            if (cursData.success) {
                                cursValutar = ensureNumber(cursData.curs, 1);
                            }
                        } catch (error) {
                            console.error(`Eroare preluare curs ${cheltuiala.moneda}:`, error);
                            // Fallback cursuri aproximative
                            const cursuriFallback = {
                                "EUR": 5.0683,
                                "USD": 4.3688,
                                "GBP": 5.8777
                            };
                            cursValutar = cursuriFallback[cheltuiala.moneda] || 1;
                        }
                    }
                    valoareRON = ensureNumber(cheltuiala.valoare) * cursValutar;
                }
                const cheltuialaData = {
                    id: `${proiectId}_CHE_${cheltuiala.id}`,
                    proiect_id: proiectId,
                    tip_cheltuiala: cheltuiala.tip_cheltuiala,
                    // CORECTAT: Mapare subcontractant -> furnizor pentru API
                    furnizor_nume: cheltuiala.subcontractant_nume,
                    furnizor_cui: cheltuiala.subcontractant_cui,
                    furnizor_contact: null,
                    descriere: cheltuiala.descriere,
                    valoare: ensureNumber(cheltuiala.valoare),
                    moneda: cheltuiala.moneda,
                    // ADĂUGAT: Conversie valutară completă
                    curs_valutar: cursValutar,
                    data_curs_valutar: formatDateForBigQuery(formData.data_curs_valutar || new Date().toISOString().split("T")[0]),
                    valoare_ron: valoareRON,
                    status_predare: cheltuiala.status_predare,
                    status_contract: cheltuiala.status_contract,
                    status_facturare: cheltuiala.status_facturare,
                    status_achitare: cheltuiala.status_achitare
                };
                const response = await fetch("/api/rapoarte/cheltuieli", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(cheltuialaData)
                });
                const result = await response.json();
                if (!result.success) {
                    console.error(`Eroare la adaugarea cheltuielii ${cheltuiala.descriere}:`, result.error);
                } else {
                    console.log(`Cheltuială salvată în ProiecteCheltuieli: ${cheltuiala.descriere}`);
                }
            } catch (error) {
                console.error(`Eroare la adaugarea cheltuielii ${cheltuiala.descriere}:`, error);
            }
        }
    };
    // NOU: Funcție pentru salvarea responsabililor în tabela ProiecteResponsabili
    const addResponsabiliProiect = async (proiectId)=>{
        if (responsabiliSelectati.length === 0) return;
        try {
            for (const responsabil of responsabiliSelectati){
                const responsabilData = {
                    id: `RESP_${proiectId}_${responsabil.uid}_${Date.now()}`,
                    proiect_id: proiectId,
                    responsabil_uid: responsabil.uid,
                    responsabil_nume: responsabil.nume_complet,
                    rol_in_proiect: responsabil.rol_in_proiect,
                    data_atribuire: getRomanianDateTime(),
                    atribuit_de: responsabil.uid // Se poate modifica cu utilizatorul curent
                };
                const response = await fetch("/api/rapoarte/proiecte-responsabili", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(responsabilData)
                });
                const result = await response.json();
                if (!result.success) {
                    console.error(`Eroare la salvarea responsabilului ${responsabil.nume_complet}:`, result.error);
                }
            }
            console.log(`Salvați ${responsabiliSelectati.length} responsabili pentru proiectul ${proiectId}`);
        } catch (error) {
            console.error("Eroare la salvarea responsabililor:", error);
        }
    };
    const handleSubmit = async (e)=>{
        e.preventDefault();
        setLoading(true);
        try {
            // Validări de bază
            if (!formData.ID_Proiect.trim()) {
                dist.toast.error("ID proiect este obligatoriu");
                setLoading(false);
                return;
            }
            if (!formData.Denumire.trim()) {
                dist.toast.error("Denumirea proiectului este obligatorie");
                setLoading(false);
                return;
            }
            if (!formData.Client.trim()) {
                dist.toast.error("Clientul este obligatoriu");
                setLoading(false);
                return;
            }
            // Validare pentru cel puțin un responsabil principal
            if (responsabiliSelectati.length === 0) {
                dist.toast.error("Cel puțin un responsabil este obligatoriu");
                setLoading(false);
                return;
            }
            const responsabilPrincipal = responsabiliSelectati.find((r)=>r.rol_in_proiect === "Principal");
            if (!responsabilPrincipal) {
                dist.toast.error('Cel puțin un responsabil trebuie să aibă rolul "Principal"');
                setLoading(false);
                return;
            }
            const dataStartFormatted = formatDateForBigQuery(formData.Data_Start);
            const dataFinalFormatted = formatDateForBigQuery(formData.Data_Final);
            if (dataStartFormatted && dataFinalFormatted) {
                const dataStart = new Date(dataStartFormatted);
                const dataFinal = new Date(dataFinalFormatted);
                if (dataFinal <= dataStart) {
                    dist.toast.error("Data de finalizare trebuie să fie după data de \xeenceput");
                    setLoading(false);
                    return;
                }
            }
            // MODIFICAT: Construire payload cu responsabili multipli
            const proiectData = {
                ID_Proiect: formData.ID_Proiect.trim(),
                Denumire: formData.Denumire.trim(),
                Client: formData.Client.trim(),
                Adresa: formData.Adresa.trim() || null,
                Descriere: formData.Descriere.trim() || null,
                Data_Start: dataStartFormatted,
                Data_Final: dataFinalFormatted,
                Status: formData.Status,
                Valoare_Estimata: formData.Valoare_Estimata ? ensureNumber(formData.Valoare_Estimata) : null,
                moneda: formData.moneda,
                curs_valutar: formData.curs_valutar ? ensureNumber(formData.curs_valutar) : null,
                data_curs_valutar: formatDateForBigQuery(formData.data_curs_valutar),
                valoare_ron: formData.valoare_ron ? ensureNumber(formData.valoare_ron) : null,
                status_predare: formData.status_predare,
                status_contract: formData.status_contract,
                status_facturare: formData.status_facturare,
                status_achitare: formData.status_achitare,
                // CORECTAT: Doar responsabil principal în tabela Proiecte (pentru compatibilitate)
                Responsabil: responsabilPrincipal.nume_complet,
                // ELIMINAT: Array-ul va fi salvat separat în ProiecteResponsabili
                Observatii: formData.Observatii.trim() || null
            };
            console.log("Date trimise către API cu responsabili multipli:", proiectData);
            dist.toast.info("Se adaugă proiectul...");
            const response = await fetch("/api/rapoarte/proiecte", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(proiectData)
            });
            const result = await response.json();
            if (result.success || response.ok) {
                // CORECTAT: Adăugare responsabili în tabela separată
                if (responsabiliSelectati.length > 0) {
                    await addResponsabiliProiect(formData.ID_Proiect);
                }
                if (formData.subproiecte.length > 0) {
                    await addSubproiecte(formData.ID_Proiect, dataStartFormatted, dataFinalFormatted);
                }
                if (formData.cheltuieli.length > 0) {
                    await addCheltuieli(formData.ID_Proiect);
                }
                dist.toast.success(`Proiect adăugat cu succes cu ${responsabiliSelectati.length} responsabili salvați în BD!`);
                onProiectAdded();
                onClose();
                resetForm();
            } else {
                console.error("Eroare API proiect:", result);
                dist.toast.error(`Eroare: ${result.error || "Eroare necunoscută"}`);
            }
        } catch (error) {
            console.error("Eroare la adăugarea proiectului:", error);
            dist.toast.error("Eroare la adăugarea proiectului");
        } finally{
            setLoading(false);
        }
    };
    if (!isOpen) return null;
    // MODIFICAT: Render cu createPortal pentru centrare
    return  false ? /*#__PURE__*/ 0 : null;
}

// EXTERNAL MODULE: ./app/admin/rapoarte/proiecte/components/FacturaHibridModal.tsx
var FacturaHibridModal = __webpack_require__(11727);
;// CONCATENATED MODULE: ./app/admin/rapoarte/proiecte/components/SubproiectModal.tsx
// ==================================================================
// CALEA: app/admin/rapoarte/proiecte/components/SubproiectModal.tsx
// DATA: 24.08.2025 21:25 (ora României)
// MODIFICAT: Responsabili multipli + Opțiuni monedă corectate + Păstrate toate funcționalitățile
// ==================================================================
/* __next_internal_client_entry_do_not_use__ default auto */ 


// Toast system
const SubproiectModal_showToast = (message, type = "info")=>{
    const toastEl = document.createElement("div");
    toastEl.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(12px);
    color: ${type === "success" ? "#27ae60" : type === "error" ? "#e74c3c" : "#3498db"};
    padding: 16px 20px;
    border-radius: 16px;
    z-index: 70000;
    font-family: 'Inter', Arial, sans-serif;
    font-size: 14px;
    font-weight: 500;
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    border: 1px solid rgba(255, 255, 255, 0.2);
    max-width: 400px;
    word-wrap: break-word;
    white-space: pre-line;
    transform: translateY(-10px);
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  `;
    toastEl.textContent = message;
    document.body.appendChild(toastEl);
    setTimeout(()=>{
        toastEl.style.transform = "translateY(0)";
        toastEl.style.opacity = "1";
    }, 10);
    setTimeout(()=>{
        toastEl.style.transform = "translateY(-10px)";
        toastEl.style.opacity = "0";
        setTimeout(()=>{
            if (document.body.contains(toastEl)) {
                document.body.removeChild(toastEl);
            }
        }, 300);
    }, type === "success" ? 4000 : type === "error" ? 5000 : 6000);
};
function SubproiectModal({ proiectParinte, isOpen, onClose, onSuccess }) {
    // State pentru responsabili multipli
    const [responsabiliSelectati, setResponsabiliSelectati] = react_experimental_default().useState([]);
    const [formData, setFormData] = react_experimental_default().useState({
        denumire: "",
        dataStart: new Date().toISOString().split("T")[0],
        dataFinal: "",
        valoareEstimata: "0",
        status: "Activ",
        // Câmpuri pentru valută - CORECTAT: Opțiuni fără explicații
        moneda: "RON",
        curs_valutar: 1,
        valoare_ron: 0
    });
    const [isSubmitting, setIsSubmitting] = react_experimental_default().useState(false);
    const [isLoadingCurs, setIsLoadingCurs] = react_experimental_default().useState(false);
    const handleInputChange = (field, value)=>{
        setFormData((prev)=>({
                ...prev,
                [field]: value
            }));
    };
    // Funcție pentru preluare curs BNR cu precizie maximă (PĂSTRATĂ identică)
    const getCursBNR = async (moneda)=>{
        if (moneda === "RON") return 1;
        setIsLoadingCurs(true);
        try {
            const response = await fetch(`/api/curs-valutar?moneda=${moneda}`);
            const data = await response.json();
            if (data.success) {
                const cursComplet = typeof data.curs === "number" ? data.curs : parseFloat(data.curs);
                console.log(`Curs BNR pentru ${moneda} cu precizie maximă:`, {
                    curs_original: data.curs,
                    curs_procesat: cursComplet,
                    curs_4_zecimale: cursComplet.toFixed(4),
                    sursa: data.source
                });
                SubproiectModal_showToast(`Curs BNR ${moneda}: ${cursComplet.toFixed(4)} RON (${data.source})`, "info");
                return cursComplet;
            }
        } catch (error) {
            console.error("Eroare preluare curs BNR:", error);
            SubproiectModal_showToast("Nu s-a putut prelua cursul BNR. Folosesc curs aproximativ.", "error");
        } finally{
            setIsLoadingCurs(false);
        }
        // Fallback la cursuri aproximative cu precizie maximă
        const cursuriFallback = {
            "EUR": 4.9755,
            "USD": 4.3561,
            "GBP": 5.8585
        };
        return cursuriFallback[moneda] || 1;
    };
    // Handler pentru schimbare monedă cu precizie maximă (PĂSTRAT identic)
    const handleMonedaChange = async (moneda)=>{
        setFormData((prev)=>({
                ...prev,
                moneda
            }));
        if (moneda !== "RON" && formData.valoareEstimata) {
            const cursReal = await getCursBNR(moneda);
            const valoareRON = parseFloat(formData.valoareEstimata) * cursReal;
            setFormData((prev)=>({
                    ...prev,
                    curs_valutar: cursReal,
                    valoare_ron: valoareRON
                }));
            console.log(`Conversie valută ${moneda}:`, {
                valoare_originala: formData.valoareEstimata,
                curs_bnr: cursReal,
                curs_formatat: cursReal.toFixed(4),
                valoare_ron: valoareRON.toFixed(2)
            });
        } else if (moneda === "RON") {
            setFormData((prev)=>({
                    ...prev,
                    curs_valutar: 1,
                    valoare_ron: parseFloat(formData.valoareEstimata) || 0
                }));
        }
    };
    // Handler pentru schimbare valoare cu recalculare precisă (PĂSTRAT identic)
    const handleValoareChange = async (valoare)=>{
        setFormData((prev)=>({
                ...prev,
                valoareEstimata: valoare
            }));
        if (formData.moneda !== "RON" && valoare) {
            const valoareRON = parseFloat(valoare) * formData.curs_valutar;
            setFormData((prev)=>({
                    ...prev,
                    valoare_ron: valoareRON
                }));
        } else {
            setFormData((prev)=>({
                    ...prev,
                    valoare_ron: parseFloat(valoare) || 0
                }));
        }
    };
    // NOU: Handler pentru selectarea responsabilului
    const handleResponsabilSelected = (responsabil)=>{
        if (!responsabil) return;
        const existaResponsabil = responsabiliSelectati.find((r)=>r.uid === responsabil.uid);
        if (existaResponsabil) {
            SubproiectModal_showToast("Responsabilul este deja adăugat", "error");
            return;
        }
        const nouResponsabil = {
            uid: responsabil.uid,
            nume_complet: responsabil.nume_complet,
            email: responsabil.email,
            rol_in_subproiect: responsabiliSelectati.length === 0 ? "Principal" : "Normal"
        };
        setResponsabiliSelectati((prev)=>[
                ...prev,
                nouResponsabil
            ]);
        SubproiectModal_showToast(`Responsabil ${responsabil.nume_complet} adăugat`, "success");
    };
    // NOU: Funcții pentru managementul responsabililor
    const removeResponsabil = (uid)=>{
        setResponsabiliSelectati((prev)=>prev.filter((r)=>r.uid !== uid));
    };
    const updateRolResponsabil = (uid, nouRol)=>{
        setResponsabiliSelectati((prev)=>prev.map((r)=>r.uid === uid ? {
                    ...r,
                    rol_in_subproiect: nouRol
                } : r));
    };
    // NOU: Funcție pentru salvarea responsabililor în SubproiecteResponsabili
    const addResponsabiliSubproiect = async (subproiectId)=>{
        if (responsabiliSelectati.length === 0) return;
        try {
            for (const responsabil of responsabiliSelectati){
                const responsabilData = {
                    id: `RESP_SUB_${subproiectId}_${responsabil.uid}_${Date.now()}`,
                    subproiect_id: subproiectId,
                    responsabil_uid: responsabil.uid,
                    responsabil_nume: responsabil.nume_complet,
                    rol_in_subproiect: responsabil.rol_in_subproiect,
                    data_atribuire: new Date().toISOString(),
                    atribuit_de: responsabil.uid // Se poate modifica cu utilizatorul curent
                };
                const response = await fetch("/api/rapoarte/subproiecte-responsabili", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(responsabilData)
                });
                const result = await response.json();
                if (!result.success) {
                    console.error(`Eroare la salvarea responsabilului ${responsabil.nume_complet}:`, result.error);
                }
            }
            console.log(`Salvați ${responsabiliSelectati.length} responsabili pentru subproiectul ${subproiectId}`);
        } catch (error) {
            console.error("Eroare la salvarea responsabililor subproiect:", error);
        }
    };
    const resetForm = ()=>{
        setFormData({
            denumire: "",
            dataStart: new Date().toISOString().split("T")[0],
            dataFinal: "",
            valoareEstimata: "0",
            status: "Activ",
            moneda: "RON",
            curs_valutar: 1,
            valoare_ron: 0
        });
        setResponsabiliSelectati([]); // NOU: Reset responsabili
        SubproiectModal_showToast("Formular resetat pentru noul subproiect!", "info");
    };
    const handleSubmit = async (e)=>{
        e.preventDefault();
        if (!formData.denumire.trim()) {
            SubproiectModal_showToast("Denumirea subproiectului este obligatorie", "error");
            return;
        }
        // VALIDARE: Cel puțin un responsabil obligatoriu
        if (responsabiliSelectati.length === 0) {
            SubproiectModal_showToast("Cel puțin un responsabil este obligatoriu", "error");
            return;
        }
        const responsabilPrincipal = responsabiliSelectati.find((r)=>r.rol_in_subproiect === "Principal");
        if (!responsabilPrincipal) {
            SubproiectModal_showToast('Cel puțin un responsabil trebuie să aibă rolul "Principal"', "error");
            return;
        }
        setIsSubmitting(true);
        try {
            const subproiectId = `${proiectParinte.ID_Proiect}_SUB_${Date.now()}`;
            // Pregătește datele complete cu valută și precizie maximă
            const requestData = {
                ID_Subproiect: subproiectId,
                ID_Proiect: proiectParinte.ID_Proiect,
                Denumire: formData.denumire.trim(),
                // NOU: Responsabil principal pentru compatibilitate
                Responsabil: responsabilPrincipal.nume_complet,
                Data_Start: formData.dataStart || null,
                Data_Final: formData.dataFinal || null,
                Valoare_Estimata: formData.valoareEstimata ? parseFloat(formData.valoareEstimata) : null,
                Status: formData.status,
                // Câmpuri multi-valută cu curs real BNR și precizie maximă
                moneda: formData.moneda,
                curs_valutar: formData.curs_valutar,
                data_curs_valutar: new Date().toISOString().split("T")[0],
                valoare_ron: formData.valoare_ron,
                // Status-uri multiple cu TVA 21% implicit
                status_predare: "Nepredat",
                status_contract: "Nu e cazul",
                status_facturare: "Nefacturat",
                status_achitare: "Neachitat",
                // TVA implicit 21% pentru subproiecte
                tva_implicit: 21
            };
            console.log("Trimitere subproiect cu responsabili multipli:", {
                ...requestData,
                responsabili_count: responsabiliSelectati.length,
                responsabil_principal: responsabilPrincipal.nume_complet
            });
            const response = await fetch("/api/rapoarte/subproiecte", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(requestData)
            });
            const result = await response.json();
            if (result.success) {
                // SALVARE responsabili în tabela separată
                if (responsabiliSelectati.length > 0) {
                    await addResponsabiliSubproiect(subproiectId);
                }
                onSuccess();
                resetForm();
                const statusText = formData.moneda !== "RON" ? ` (Curs BNR ${formData.moneda}: ${formData.curs_valutar.toFixed(4)})` : "";
                SubproiectModal_showToast(`Subproiect adăugat cu succes cu ${responsabiliSelectati.length} responsabili!${statusText}\nTVA implicit: 21%`, "success");
            } else {
                console.error("Eroare API:", result);
                SubproiectModal_showToast(result.error || "Eroare la adăugarea subproiectului", "error");
            }
        } catch (error) {
            console.error("Eroare la adăugarea subproiectului:", error);
            SubproiectModal_showToast("Eroare la adăugarea subproiectului", "error");
        } finally{
            setIsSubmitting(false);
        }
    };
    if (!isOpen) return null;
    return /*#__PURE__*/ jsx_runtime_.jsx("div", {
        style: {
            position: "fixed",
            inset: "0",
            background: "rgba(0, 0, 0, 0.6)",
            backdropFilter: "blur(8px)",
            display: "flex",
            alignItems: "center",
            justifyContent: "center",
            zIndex: 50000,
            padding: "1rem"
        },
        children: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
            style: {
                background: "#ffffff",
                borderRadius: "16px",
                maxWidth: "900px",
                width: "100%",
                maxHeight: "90vh",
                overflowY: "auto",
                boxShadow: "0 20px 40px rgba(0, 0, 0, 0.3)",
                border: "1px solid #e0e0e0"
            },
            children: [
                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                    style: {
                        display: "flex",
                        alignItems: "center",
                        justifyContent: "space-between",
                        padding: "1.5rem",
                        borderBottom: "1px solid #e0e0e0",
                        background: "#e8f5e8",
                        borderRadius: "16px 16px 0 0"
                    },
                    children: [
                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                            children: [
                                /*#__PURE__*/ jsx_runtime_.jsx("h2", {
                                    style: {
                                        fontSize: "1.5rem",
                                        fontWeight: "700",
                                        color: "#2c3e50",
                                        margin: 0,
                                        display: "flex",
                                        alignItems: "center",
                                        gap: "0.5rem"
                                    },
                                    children: "Adaugă Subproiect Nou"
                                }),
                                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("p", {
                                    style: {
                                        fontSize: "14px",
                                        color: "#7f8c8d",
                                        margin: "0.5rem 0 0 0",
                                        fontWeight: "500"
                                    },
                                    children: [
                                        "Proiect părinte: ",
                                        /*#__PURE__*/ jsx_runtime_.jsx("span", {
                                            style: {
                                                fontFamily: "monospace",
                                                fontWeight: "600",
                                                color: "#3498db"
                                            },
                                            children: proiectParinte.ID_Proiect
                                        })
                                    ]
                                }),
                                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("p", {
                                    style: {
                                        fontSize: "12px",
                                        color: "#95a5a6",
                                        margin: "0.25rem 0 0 0"
                                    },
                                    children: [
                                        proiectParinte.Denumire,
                                        " • TVA implicit: 21% • Responsabili multipli"
                                    ]
                                })
                            ]
                        }),
                        /*#__PURE__*/ jsx_runtime_.jsx("button", {
                            onClick: onClose,
                            disabled: isSubmitting,
                            style: {
                                background: "rgba(231, 76, 60, 0.1)",
                                color: "#e74c3c",
                                border: "none",
                                borderRadius: "12px",
                                width: "48px",
                                height: "48px",
                                cursor: isSubmitting ? "not-allowed" : "pointer",
                                fontSize: "20px",
                                fontWeight: "600",
                                display: "flex",
                                alignItems: "center",
                                justifyContent: "center"
                            },
                            children: "✕"
                        })
                    ]
                }),
                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("form", {
                    onSubmit: handleSubmit,
                    style: {
                        padding: "1.5rem",
                        display: "flex",
                        flexDirection: "column",
                        gap: "1.25rem"
                    },
                    children: [
                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                            style: {
                                background: "#f0f8ff",
                                padding: "1.25rem",
                                borderRadius: "12px",
                                border: "1px solid #cce7ff"
                            },
                            children: [
                                /*#__PURE__*/ jsx_runtime_.jsx("label", {
                                    style: {
                                        display: "block",
                                        fontSize: "14px",
                                        fontWeight: "600",
                                        color: "#2c3e50",
                                        marginBottom: "0.75rem"
                                    },
                                    children: "Denumire Subproiect *"
                                }),
                                /*#__PURE__*/ jsx_runtime_.jsx("input", {
                                    type: "text",
                                    value: formData.denumire,
                                    onChange: (e)=>handleInputChange("denumire", e.target.value),
                                    style: {
                                        width: "100%",
                                        padding: "1rem",
                                        border: "1px solid #e0e0e0",
                                        borderRadius: "12px",
                                        fontSize: "16px",
                                        background: "#ffffff",
                                        boxSizing: "border-box"
                                    },
                                    placeholder: "Introduceți denumirea subproiectului...",
                                    required: true,
                                    disabled: isSubmitting
                                })
                            ]
                        }),
                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                            style: {
                                display: "grid",
                                gridTemplateColumns: "repeat(auto-fit, minmax(250px, 1fr))",
                                gap: "1rem"
                            },
                            children: [
                                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                    style: {
                                        background: "#ffffff",
                                        padding: "1rem",
                                        borderRadius: "12px",
                                        border: "1px solid #e0e0e0"
                                    },
                                    children: [
                                        /*#__PURE__*/ jsx_runtime_.jsx("label", {
                                            style: {
                                                display: "block",
                                                fontSize: "14px",
                                                fontWeight: "600",
                                                color: "#2c3e50",
                                                marginBottom: "0.75rem"
                                            },
                                            children: "Status"
                                        }),
                                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("select", {
                                            value: formData.status,
                                            onChange: (e)=>handleInputChange("status", e.target.value),
                                            style: {
                                                width: "100%",
                                                padding: "0.75rem",
                                                border: "1px solid #e0e0e0",
                                                borderRadius: "12px",
                                                fontSize: "14px",
                                                background: "#ffffff",
                                                boxSizing: "border-box"
                                            },
                                            disabled: isSubmitting,
                                            children: [
                                                /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                    value: "Activ",
                                                    children: "Activ"
                                                }),
                                                /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                    value: "Planificat",
                                                    children: "Planificat"
                                                }),
                                                /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                    value: "Suspendat",
                                                    children: "Suspendat"
                                                }),
                                                /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                    value: "Finalizat",
                                                    children: "Finalizat"
                                                })
                                            ]
                                        })
                                    ]
                                }),
                                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                    style: {
                                        background: "#ffffff",
                                        padding: "1rem",
                                        borderRadius: "12px",
                                        border: "1px solid #e0e0e0"
                                    },
                                    children: [
                                        /*#__PURE__*/ jsx_runtime_.jsx("label", {
                                            style: {
                                                display: "block",
                                                fontSize: "14px",
                                                fontWeight: "600",
                                                color: "#2c3e50",
                                                marginBottom: "0.75rem"
                                            },
                                            children: "Data \xcenceput"
                                        }),
                                        /*#__PURE__*/ jsx_runtime_.jsx("input", {
                                            type: "date",
                                            value: formData.dataStart,
                                            onChange: (e)=>handleInputChange("dataStart", e.target.value),
                                            style: {
                                                width: "100%",
                                                padding: "0.75rem",
                                                border: "1px solid #e0e0e0",
                                                borderRadius: "12px",
                                                fontSize: "14px",
                                                background: "#ffffff",
                                                boxSizing: "border-box"
                                            },
                                            disabled: isSubmitting
                                        })
                                    ]
                                }),
                                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                    style: {
                                        background: "#ffffff",
                                        padding: "1rem",
                                        borderRadius: "12px",
                                        border: "1px solid #e0e0e0"
                                    },
                                    children: [
                                        /*#__PURE__*/ jsx_runtime_.jsx("label", {
                                            style: {
                                                display: "block",
                                                fontSize: "14px",
                                                fontWeight: "600",
                                                color: "#2c3e50",
                                                marginBottom: "0.75rem"
                                            },
                                            children: "Data Finalizare"
                                        }),
                                        /*#__PURE__*/ jsx_runtime_.jsx("input", {
                                            type: "date",
                                            value: formData.dataFinal,
                                            onChange: (e)=>handleInputChange("dataFinal", e.target.value),
                                            style: {
                                                width: "100%",
                                                padding: "0.75rem",
                                                border: "1px solid #e0e0e0",
                                                borderRadius: "12px",
                                                fontSize: "14px",
                                                background: "#ffffff",
                                                boxSizing: "border-box"
                                            },
                                            disabled: isSubmitting
                                        })
                                    ]
                                })
                            ]
                        }),
                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                            style: {
                                background: "#e8f8e8",
                                padding: "1.5rem",
                                borderRadius: "16px",
                                border: "1px solid #c3e6cb"
                            },
                            children: [
                                /*#__PURE__*/ jsx_runtime_.jsx("h4", {
                                    style: {
                                        fontSize: "16px",
                                        fontWeight: "600",
                                        color: "#2c3e50",
                                        marginBottom: "1rem"
                                    },
                                    children: "Valoare Estimată și Valută • TVA implicit: 21%"
                                }),
                                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                    style: {
                                        display: "grid",
                                        gridTemplateColumns: "2fr 1fr 2fr",
                                        gap: "1rem",
                                        alignItems: "end"
                                    },
                                    children: [
                                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                            children: [
                                                /*#__PURE__*/ jsx_runtime_.jsx("label", {
                                                    style: {
                                                        display: "block",
                                                        fontSize: "14px",
                                                        fontWeight: "600",
                                                        color: "#2c3e50",
                                                        marginBottom: "0.5rem"
                                                    },
                                                    children: "Valoare"
                                                }),
                                                /*#__PURE__*/ jsx_runtime_.jsx("input", {
                                                    type: "number",
                                                    value: formData.valoareEstimata,
                                                    onChange: (e)=>handleValoareChange(e.target.value),
                                                    style: {
                                                        width: "100%",
                                                        padding: "1rem",
                                                        border: "1px solid #e0e0e0",
                                                        borderRadius: "12px",
                                                        fontSize: "16px",
                                                        background: "#ffffff",
                                                        boxSizing: "border-box"
                                                    },
                                                    placeholder: "0.00",
                                                    min: "0",
                                                    step: "0.01",
                                                    disabled: isSubmitting
                                                })
                                            ]
                                        }),
                                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                            children: [
                                                /*#__PURE__*/ jsx_runtime_.jsx("label", {
                                                    style: {
                                                        display: "block",
                                                        fontSize: "14px",
                                                        fontWeight: "600",
                                                        color: "#2c3e50",
                                                        marginBottom: "0.5rem"
                                                    },
                                                    children: "Moneda"
                                                }),
                                                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("select", {
                                                    value: formData.moneda,
                                                    onChange: (e)=>handleMonedaChange(e.target.value),
                                                    style: {
                                                        width: "100%",
                                                        padding: "1rem",
                                                        border: "1px solid #e0e0e0",
                                                        borderRadius: "12px",
                                                        fontSize: "16px",
                                                        background: "#ffffff",
                                                        boxSizing: "border-box"
                                                    },
                                                    disabled: isSubmitting || isLoadingCurs,
                                                    children: [
                                                        /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                            value: "RON",
                                                            children: "RON"
                                                        }),
                                                        /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                            value: "EUR",
                                                            children: "EUR"
                                                        }),
                                                        /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                            value: "USD",
                                                            children: "USD"
                                                        }),
                                                        /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                            value: "GBP",
                                                            children: "GBP"
                                                        })
                                                    ]
                                                })
                                            ]
                                        }),
                                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                            children: [
                                                /*#__PURE__*/ jsx_runtime_.jsx("label", {
                                                    style: {
                                                        display: "block",
                                                        fontSize: "14px",
                                                        fontWeight: "600",
                                                        color: "#2c3e50",
                                                        marginBottom: "0.5rem"
                                                    },
                                                    children: "Echivalent RON"
                                                }),
                                                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                    style: {
                                                        padding: "1rem",
                                                        background: "#f0f8ff",
                                                        border: "1px solid #cce7ff",
                                                        borderRadius: "12px",
                                                        fontSize: "16px",
                                                        fontWeight: "bold",
                                                        color: "#27ae60"
                                                    },
                                                    children: [
                                                        formData.valoare_ron.toLocaleString("ro-RO", {
                                                            minimumFractionDigits: 2,
                                                            maximumFractionDigits: 2
                                                        }),
                                                        " RON"
                                                    ]
                                                })
                                            ]
                                        })
                                    ]
                                }),
                                formData.moneda !== "RON" && formData.curs_valutar > 1 && /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                    style: {
                                        marginTop: "1rem",
                                        padding: "0.75rem",
                                        background: "#d1ecf1",
                                        border: "1px solid #bee5eb",
                                        borderRadius: "8px",
                                        fontSize: "13px",
                                        color: "#0c5460"
                                    },
                                    children: [
                                        "Curs BNR (precizie maximă): 1 ",
                                        formData.moneda,
                                        " = ",
                                        formData.curs_valutar.toFixed(4),
                                        " RON"
                                    ]
                                }),
                                isLoadingCurs && /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                    style: {
                                        marginTop: "1rem",
                                        padding: "0.75rem",
                                        background: "#fff3cd",
                                        border: "1px solid #ffeaa7",
                                        borderRadius: "8px",
                                        fontSize: "13px",
                                        color: "#856404"
                                    },
                                    children: "Se preia cursul BNR cu precizie maximă..."
                                }),
                                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                    style: {
                                        marginTop: "1rem",
                                        padding: "0.75rem",
                                        background: "#e8f5e8",
                                        border: "1px solid #c3e6cb",
                                        borderRadius: "8px",
                                        fontSize: "13px",
                                        color: "#2d5016"
                                    },
                                    children: [
                                        /*#__PURE__*/ jsx_runtime_.jsx("strong", {
                                            children: "TVA implicit:"
                                        }),
                                        " 21% (conform reglementărilor din august 2025)"
                                    ]
                                })
                            ]
                        }),
                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                            style: {
                                marginBottom: "1.5rem"
                            },
                            children: [
                                /*#__PURE__*/ jsx_runtime_.jsx("h3", {
                                    style: {
                                        margin: "0 0 1rem 0",
                                        color: "#2c3e50",
                                        fontSize: "1.1rem"
                                    },
                                    children: "Responsabili Subproiect *"
                                }),
                                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                    style: {
                                        background: "#f8f9fa",
                                        padding: "1rem",
                                        borderRadius: "8px",
                                        border: "1px solid #dee2e6",
                                        marginBottom: "1rem"
                                    },
                                    children: [
                                        /*#__PURE__*/ jsx_runtime_.jsx("label", {
                                            style: {
                                                display: "block",
                                                marginBottom: "0.5rem",
                                                fontWeight: "bold",
                                                color: "#2c3e50"
                                            },
                                            children: "Adaugă Responsabil"
                                        }),
                                        /*#__PURE__*/ jsx_runtime_.jsx(ResponsabilSearch, {
                                            onResponsabilSelected: handleResponsabilSelected,
                                            showInModal: true,
                                            disabled: isSubmitting,
                                            placeholder: "Caută și selectează responsabili..."
                                        })
                                    ]
                                }),
                                responsabiliSelectati.length > 0 && /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                    children: [
                                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("h4", {
                                            style: {
                                                margin: "0 0 0.5rem 0",
                                                color: "#2c3e50"
                                            },
                                            children: [
                                                "Responsabili Selectați (",
                                                responsabiliSelectati.length,
                                                ")"
                                            ]
                                        }),
                                        /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                            style: {
                                                display: "grid",
                                                gap: "0.5rem"
                                            },
                                            children: responsabiliSelectati.map((responsabil)=>/*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                    style: {
                                                        border: "1px solid #27ae60",
                                                        borderRadius: "6px",
                                                        padding: "0.75rem",
                                                        background: "rgba(39, 174, 96, 0.05)",
                                                        display: "flex",
                                                        justifyContent: "space-between",
                                                        alignItems: "center"
                                                    },
                                                    children: [
                                                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                            style: {
                                                                flex: 1
                                                            },
                                                            children: [
                                                                /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                                    style: {
                                                                        fontWeight: "bold",
                                                                        color: "#2c3e50"
                                                                    },
                                                                    children: responsabil.nume_complet
                                                                }),
                                                                /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                                    style: {
                                                                        fontSize: "12px",
                                                                        color: "#7f8c8d"
                                                                    },
                                                                    children: responsabil.email
                                                                })
                                                            ]
                                                        }),
                                                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                            style: {
                                                                display: "flex",
                                                                alignItems: "center",
                                                                gap: "1rem"
                                                            },
                                                            children: [
                                                                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("select", {
                                                                    value: responsabil.rol_in_subproiect,
                                                                    onChange: (e)=>updateRolResponsabil(responsabil.uid, e.target.value),
                                                                    disabled: isSubmitting,
                                                                    style: {
                                                                        padding: "0.5rem",
                                                                        border: "1px solid #dee2e6",
                                                                        borderRadius: "4px",
                                                                        fontSize: "12px",
                                                                        minWidth: "120px"
                                                                    },
                                                                    children: [
                                                                        /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                                            value: "Principal",
                                                                            children: "Principal"
                                                                        }),
                                                                        /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                                            value: "Normal",
                                                                            children: "Normal"
                                                                        }),
                                                                        /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                                            value: "Observator",
                                                                            children: "Observator"
                                                                        })
                                                                    ]
                                                                }),
                                                                /*#__PURE__*/ jsx_runtime_.jsx("button", {
                                                                    type: "button",
                                                                    onClick: ()=>removeResponsabil(responsabil.uid),
                                                                    disabled: isSubmitting,
                                                                    style: {
                                                                        background: "#e74c3c",
                                                                        color: "white",
                                                                        border: "none",
                                                                        borderRadius: "4px",
                                                                        padding: "0.5rem",
                                                                        cursor: "pointer",
                                                                        fontSize: "12px"
                                                                    },
                                                                    children: "\xd7"
                                                                })
                                                            ]
                                                        })
                                                    ]
                                                }, responsabil.uid))
                                        })
                                    ]
                                }),
                                responsabiliSelectati.length === 0 && /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                    style: {
                                        textAlign: "center",
                                        padding: "2rem",
                                        color: "#7f8c8d",
                                        background: "#f8f9fa",
                                        borderRadius: "8px",
                                        border: "2px dashed #dee2e6"
                                    },
                                    children: [
                                        /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                            style: {
                                                fontSize: "32px",
                                                marginBottom: "0.5rem"
                                            },
                                            children: "\uD83D\uDC65"
                                        }),
                                        /*#__PURE__*/ jsx_runtime_.jsx("p", {
                                            style: {
                                                margin: 0,
                                                fontSize: "14px"
                                            },
                                            children: "Nu sunt selectați responsabili. Caută și adaugă cel puțin un responsabil."
                                        })
                                    ]
                                })
                            ]
                        }),
                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                            style: {
                                background: "#f8f9fa",
                                padding: "1.5rem",
                                borderRadius: "16px",
                                border: "1px solid #e0e0e0"
                            },
                            children: [
                                /*#__PURE__*/ jsx_runtime_.jsx("h4", {
                                    style: {
                                        fontSize: "16px",
                                        fontWeight: "600",
                                        color: "#2c3e50",
                                        marginBottom: "1rem"
                                    },
                                    children: "Informații Proiect Părinte"
                                }),
                                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                    style: {
                                        display: "grid",
                                        gridTemplateColumns: "repeat(auto-fit, minmax(200px, 1fr))",
                                        gap: "1rem"
                                    },
                                    children: [
                                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                            style: {
                                                background: "#ffffff",
                                                padding: "1rem",
                                                borderRadius: "12px",
                                                border: "1px solid #e0e0e0"
                                            },
                                            children: [
                                                /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                    style: {
                                                        fontSize: "11px",
                                                        color: "#7f8c8d",
                                                        fontWeight: "600",
                                                        textTransform: "uppercase"
                                                    },
                                                    children: "CLIENT"
                                                }),
                                                /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                    style: {
                                                        fontSize: "14px",
                                                        fontWeight: "600",
                                                        color: "#2c3e50",
                                                        marginTop: "0.25rem"
                                                    },
                                                    children: proiectParinte.Client
                                                })
                                            ]
                                        }),
                                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                            style: {
                                                background: "#ffffff",
                                                padding: "1rem",
                                                borderRadius: "12px",
                                                border: "1px solid #e0e0e0"
                                            },
                                            children: [
                                                /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                    style: {
                                                        fontSize: "11px",
                                                        color: "#7f8c8d",
                                                        fontWeight: "600",
                                                        textTransform: "uppercase"
                                                    },
                                                    children: "STATUS"
                                                }),
                                                /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                    style: {
                                                        fontSize: "14px",
                                                        fontWeight: "600",
                                                        color: "#2c3e50",
                                                        marginTop: "0.25rem"
                                                    },
                                                    children: proiectParinte.Status
                                                })
                                            ]
                                        }),
                                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                            style: {
                                                background: "#ffffff",
                                                padding: "1rem",
                                                borderRadius: "12px",
                                                border: "1px solid #e0e0e0"
                                            },
                                            children: [
                                                /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                    style: {
                                                        fontSize: "11px",
                                                        color: "#7f8c8d",
                                                        fontWeight: "600",
                                                        textTransform: "uppercase"
                                                    },
                                                    children: "VALOARE"
                                                }),
                                                /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                    style: {
                                                        fontSize: "14px",
                                                        fontWeight: "600",
                                                        color: "#27ae60",
                                                        marginTop: "0.25rem"
                                                    },
                                                    children: proiectParinte.Valoare_Estimata ? `${proiectParinte.Valoare_Estimata.toLocaleString("ro-RO")} RON` : "N/A"
                                                })
                                            ]
                                        })
                                    ]
                                })
                            ]
                        }),
                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                            style: {
                                display: "flex",
                                justifyContent: "space-between",
                                alignItems: "center",
                                gap: "1rem",
                                paddingTop: "1rem",
                                borderTop: "1px solid #e0e0e0"
                            },
                            children: [
                                /*#__PURE__*/ jsx_runtime_.jsx("button", {
                                    type: "button",
                                    onClick: onClose,
                                    disabled: isSubmitting,
                                    style: {
                                        background: "#f8f9fa",
                                        color: "#6c757d",
                                        border: "1px solid #e0e0e0",
                                        borderRadius: "12px",
                                        padding: "0.75rem 1.5rem",
                                        fontSize: "14px",
                                        fontWeight: "600",
                                        cursor: isSubmitting ? "not-allowed" : "pointer"
                                    },
                                    children: "✕ \xcenchide"
                                }),
                                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                    style: {
                                        display: "flex",
                                        gap: "0.75rem"
                                    },
                                    children: [
                                        /*#__PURE__*/ jsx_runtime_.jsx("button", {
                                            type: "submit",
                                            disabled: isSubmitting || !formData.denumire.trim() || isLoadingCurs || responsabiliSelectati.length === 0,
                                            style: {
                                                background: isSubmitting || !formData.denumire.trim() || isLoadingCurs || responsabiliSelectati.length === 0 ? "#f8f9fa" : "linear-gradient(135deg, #3498db 0%, #5dade2 100%)",
                                                color: isSubmitting || !formData.denumire.trim() || isLoadingCurs || responsabiliSelectati.length === 0 ? "#6c757d" : "white",
                                                border: "none",
                                                borderRadius: "12px",
                                                padding: "0.75rem 1.5rem",
                                                fontSize: "14px",
                                                fontWeight: "600",
                                                cursor: isSubmitting || !formData.denumire.trim() || isLoadingCurs || responsabiliSelectati.length === 0 ? "not-allowed" : "pointer",
                                                display: "flex",
                                                alignItems: "center",
                                                gap: "0.5rem"
                                            },
                                            children: isSubmitting ? /*#__PURE__*/ jsx_runtime_.jsx(jsx_runtime_.Fragment, {
                                                children: "⏳ Se adaugă..."
                                            }) : isLoadingCurs ? /*#__PURE__*/ jsx_runtime_.jsx(jsx_runtime_.Fragment, {
                                                children: "⏳ Se preia cursul..."
                                            }) : /*#__PURE__*/ jsx_runtime_.jsx(jsx_runtime_.Fragment, {
                                                children: "\uD83D\uDCC2 Adaugă Subproiect cu Responsabili"
                                            })
                                        }),
                                        /*#__PURE__*/ jsx_runtime_.jsx("button", {
                                            type: "button",
                                            onClick: resetForm,
                                            disabled: isSubmitting || isLoadingCurs,
                                            style: {
                                                background: "linear-gradient(135deg, #27ae60 0%, #2ecc71 100%)",
                                                color: "white",
                                                border: "none",
                                                borderRadius: "12px",
                                                padding: "0.75rem 1rem",
                                                fontSize: "14px",
                                                fontWeight: "600",
                                                cursor: isSubmitting || isLoadingCurs ? "not-allowed" : "pointer",
                                                display: "flex",
                                                alignItems: "center",
                                                gap: "0.5rem"
                                            },
                                            title: "Resetează formularul pentru a adăuga alt subproiect",
                                            children: "\uD83D\uDD04 Resetează"
                                        })
                                    ]
                                })
                            ]
                        })
                    ]
                })
            ]
        })
    });
}

;// CONCATENATED MODULE: ./app/admin/rapoarte/proiecte/components/ProiectEditModal.tsx
// ==================================================================
// CALEA: app/admin/rapoarte/proiecte/components/ProiectEditModal.tsx
// DATA: 25.08.2025 08:15 (ora României)
// CORECTAT: Eroare sintaxă JSX + Uniformizare cu ProiectNouModal + createPortal
// IMPLEMENTARE COMPLETĂ: Toate funcționalitățile din ProiectNouModal + încărcare date existente
// FUNCȚIONALITĂȚi CORECTATE: Responsabili multipli + SubcontractantSearch + Data cursului din BigQuery
// ==================================================================
/* __next_internal_client_entry_do_not_use__ default auto */ 


 // CORECTAT: Folosește toast din react-toastify ca în ProiectNouModal




// ELIMINAT: showToast custom - folosim toast din react-toastify pentru consistență
// Funcție helper pentru validări sigure (PĂSTRATĂ identică)
const ProiectEditModal_ensureNumber = (value, defaultValue = 0)=>{
    if (typeof value === "number" && !isNaN(value) && isFinite(value)) {
        return value;
    }
    if (typeof value === "string") {
        const parsed = parseFloat(value);
        return !isNaN(parsed) && isFinite(parsed) ? parsed : defaultValue;
    }
    return defaultValue;
};
// PĂSTRAT: Funcție pentru formatare cu precizie originală (fără rotunjire forțată)
const ProiectEditModal_formatWithOriginalPrecision = (value, originalPrecision)=>{
    if (originalPrecision && originalPrecision !== "undefined" && originalPrecision !== "null") {
        return originalPrecision;
    }
    const num = ProiectEditModal_ensureNumber(value);
    return num.toString();
};
// PĂSTRAT: Validare și formatare corectă pentru DATE fields BigQuery
const ProiectEditModal_formatDateForBigQuery = (dateString)=>{
    if (!dateString || dateString.trim() === "") {
        return null;
    }
    try {
        const isoDateRegex = /^\d{4}-\d{2}-\d{2}$/;
        if (isoDateRegex.test(dateString)) {
            const date = new Date(dateString + "T00:00:00");
            if (!isNaN(date.getTime())) {
                return dateString;
            }
        }
        const date = new Date(dateString);
        if (!isNaN(date.getTime())) {
            return date.toISOString().split("T")[0];
        }
        console.warn("Data nu poate fi parsată:", dateString);
        return null;
    } catch (error) {
        console.error("Eroare la formatarea datei pentru BigQuery:", dateString, error);
        return null;
    }
};
// Helper simplificat pentru formatarea datei pentru input
const formatDateForInput = (dateValue)=>{
    if (!dateValue) return "";
    try {
        const dateString = typeof dateValue === "string" ? dateValue : String(dateValue);
        if (!dateString || dateString === "null" || dateString === "undefined" || dateString.trim() === "") {
            return "";
        }
        const date = new Date(dateString);
        if (isNaN(date.getTime())) {
            return "";
        }
        return date.toISOString().split("T")[0];
    } catch (error) {
        console.warn("Eroare la formatarea datei pentru input:", error);
        return "";
    }
};
// PĂSTRAT: Funcție pentru preluarea cursurilor BNR LIVE - fără rotunjire
const ProiectEditModal_getCursBNRLive = async (moneda, data)=>{
    if (moneda === "RON") return {
        curs: 1,
        precizie: "1"
    };
    try {
        const url = `/api/curs-valutar?moneda=${encodeURIComponent(moneda)}${data ? `&data=${data}` : ""}`;
        const response = await fetch(url);
        const result = await response.json();
        if (result.success && result.curs) {
            const cursNumeric = ProiectEditModal_ensureNumber(result.curs, 1);
            const precizie = result.precizie_originala || cursNumeric.toString();
            console.log(`Curs BNR live pentru ${moneda}: ${precizie} (nu rotunjit)`);
            return {
                curs: cursNumeric,
                precizie
            };
        }
        console.warn(`Nu s-a putut prelua cursul live pentru ${moneda}, folosesc fallback`);
        const fallbackCursuri = {
            "EUR": {
                curs: 5.0683,
                precizie: "5.0683"
            },
            "USD": {
                curs: 4.3688,
                precizie: "4.3688"
            },
            "GBP": {
                curs: 5.8777,
                precizie: "5.8777"
            }
        };
        return fallbackCursuri[moneda] || {
            curs: 1,
            precizie: "1"
        };
    } catch (error) {
        console.error(`Eroare la preluarea cursului pentru ${moneda}:`, error);
        const fallbackCursuri = {
            "EUR": {
                curs: 5.0683,
                precizie: "5.0683"
            },
            "USD": {
                curs: 4.3688,
                precizie: "4.3688"
            },
            "GBP": {
                curs: 5.8777,
                precizie: "5.8777"
            }
        };
        return fallbackCursuri[moneda] || {
            curs: 1,
            precizie: "1"
        };
    }
};
// NOU: Funcție pentru ora României (UTC+3)
const ProiectEditModal_getRomanianDateTime = ()=>{
    const now = new Date();
    const romanianTime = new Date(now.getTime() + 3 * 60 * 60 * 1000); // UTC+3
    return romanianTime.toISOString();
};
function ProiectEditModal({ proiect, isOpen, onClose, onProiectUpdated, onProiectDeleted }) {
    const [loading, setLoading] = (0,react_experimental_.useState)(false);
    const [clienti, setClienti] = (0,react_experimental_.useState)([]);
    const [showClientModal, setShowClientModal] = (0,react_experimental_.useState)(false);
    const [showSubcontractantModal, setShowSubcontractantModal] = (0,react_experimental_.useState)(false);
    const [clientSearch, setClientSearch] = (0,react_experimental_.useState)("");
    const [showClientSuggestions, setShowClientSuggestions] = (0,react_experimental_.useState)(false);
    // State pentru responsabili multipli
    const [responsabiliSelectati, setResponsabiliSelectati] = (0,react_experimental_.useState)([]);
    const [responsabiliSubproiecte, setResponsabiliSubproiecte] = (0,react_experimental_.useState)({});
    // State pentru conversii valutare (PĂSTRAT identic)
    const [cursValutar, setCursValutar] = (0,react_experimental_.useState)(null);
    const [loadingCurs, setLoadingCurs] = (0,react_experimental_.useState)(false);
    const [precizieOriginala, setPrecizieOriginala] = (0,react_experimental_.useState)("");
    const [formData, setFormData] = (0,react_experimental_.useState)({
        ID_Proiect: "",
        Denumire: "",
        Client: "",
        selectedClientId: "",
        Adresa: "",
        Descriere: "",
        Data_Start: "",
        Data_Final: "",
        Status: "Activ",
        // Valoare și monedă
        Valoare_Estimata: "",
        moneda: "RON",
        curs_valutar: "",
        data_curs_valutar: "",
        valoare_ron: "",
        // Status-uri multiple
        status_predare: "Nepredat",
        status_contract: "Nu e cazul",
        status_facturare: "Nefacturat",
        status_achitare: "Neachitat",
        Observatii: "",
        // Pentru subproiecte
        subproiecte: [],
        // Pentru cheltuieli proiect cu subcontractanti
        cheltuieli: []
    });
    (0,react_experimental_.useEffect)(()=>{
        if (isOpen && proiect) {
            loadClienti();
            loadProiectData();
            loadResponsabiliProiect();
            loadSubproiecte();
            loadCheltuieli();
        }
    }, [
        isOpen,
        proiect
    ]);
    // PĂSTRAT: Effect pentru calcularea cursului valutar
    (0,react_experimental_.useEffect)(()=>{
        if (formData.moneda !== "RON" && formData.Valoare_Estimata) {
            loadCursValutar();
        } else if (formData.moneda === "RON") {
            setFormData((prev)=>({
                    ...prev,
                    valoare_ron: prev.Valoare_Estimata,
                    curs_valutar: "1"
                }));
            setCursValutar(1);
            setPrecizieOriginala("1");
        }
    }, [
        formData.moneda,
        formData.Valoare_Estimata,
        formData.data_curs_valutar
    ]);
    const loadProiectData = ()=>{
        setFormData((prev)=>({
                ...prev,
                ID_Proiect: proiect.ID_Proiect || "",
                Denumire: proiect.Denumire || "",
                Client: proiect.Client || "",
                selectedClientId: "",
                Adresa: proiect.Adresa || "",
                Descriere: proiect.Descriere || "",
                // Data cursului din BigQuery, nu data curentă
                Data_Start: formatDateForInput(proiect.Data_Start),
                Data_Final: formatDateForInput(proiect.Data_Final),
                Status: proiect.Status || "Activ",
                Valoare_Estimata: proiect.Valoare_Estimata?.toString() || "",
                moneda: proiect.moneda || "RON",
                curs_valutar: proiect.curs_valutar?.toString() || "",
                // Data cursului din BigQuery, nu data curentă
                data_curs_valutar: formatDateForInput(proiect.data_curs_valutar),
                valoare_ron: proiect.valoare_ron?.toString() || "",
                status_predare: proiect.status_predare || "Nepredat",
                status_contract: proiect.status_contract || "Nu e cazul",
                status_facturare: proiect.status_facturare || "Nefacturat",
                status_achitare: proiect.status_achitare || "Neachitat",
                Observatii: proiect.Observatii || ""
            }));
        setClientSearch(proiect.Client || "");
    };
    // Încarcă responsabilii existenți ai proiectului
    const loadResponsabiliProiect = async ()=>{
        if (!proiect.ID_Proiect) return;
        try {
            const response = await fetch(`/api/rapoarte/proiecte-responsabili?proiect_id=${proiect.ID_Proiect}`);
            const data = await response.json();
            if (data.success && data.data) {
                const responsabiliFormatati = data.data.map((resp)=>({
                        uid: resp.responsabil_uid,
                        nume_complet: resp.responsabil_nume,
                        email: resp.email || "",
                        rol_in_proiect: resp.rol_in_proiect || "Normal"
                    }));
                setResponsabiliSelectati(responsabiliFormatati);
                console.log(`Încărcați ${responsabiliFormatati.length} responsabili existenți pentru proiect`);
            }
        } catch (error) {
            console.error("Eroare la \xeencărcarea responsabililor proiect:", error);
        }
    };
    // Încarcă responsabilii pentru subproiecte existente
    const loadResponsabiliSubproiecte = async (subproiecteIds)=>{
        if (subproiecteIds.length === 0) return;
        const responsabiliMap = {};
        for (const subproiectId of subproiecteIds){
            try {
                const response = await fetch(`/api/rapoarte/subproiecte-responsabili?subproiect_id=${subproiectId}`);
                const data = await response.json();
                if (data.success && data.data) {
                    responsabiliMap[subproiectId] = data.data.map((resp)=>({
                            uid: resp.responsabil_uid,
                            nume_complet: resp.responsabil_nume,
                            email: resp.email || "",
                            rol_in_proiect: resp.rol_in_subproiect || "Normal" // CORECTAT: Mapare corectă
                        }));
                }
            } catch (error) {
                console.error(`Eroare la încărcarea responsabililor pentru subproiectul ${subproiectId}:`, error);
            }
        }
        setResponsabiliSubproiecte(responsabiliMap);
        console.log(`Încărcați responsabili pentru ${Object.keys(responsabiliMap).length} subproiecte`);
    };
    // Încarcă subproiectele existente
    const loadSubproiecte = async ()=>{
        if (!proiect.ID_Proiect) return;
        try {
            const response = await fetch(`/api/rapoarte/subproiecte?proiect_id=${proiect.ID_Proiect}`);
            const data = await response.json();
            if (data.success && data.data) {
                const subproiecteFormatate = data.data.map((sub)=>({
                        id: sub.ID_Subproiect,
                        ID_Subproiect: sub.ID_Subproiect,
                        denumire: sub.Denumire || "",
                        valoare: sub.Valoare_Estimata?.toString() || "",
                        moneda: sub.moneda || "RON",
                        status: sub.Status || "Planificat",
                        data_start: formatDateForInput(sub.Data_Start),
                        data_final: formatDateForInput(sub.Data_Final),
                        curs_valutar: sub.curs_valutar?.toString() || "",
                        // Data cursului din BigQuery, nu fallback
                        data_curs_valutar: formatDateForInput(sub.data_curs_valutar),
                        valoare_ron: sub.valoare_ron?.toString() || "",
                        isExisting: true,
                        isDeleted: false
                    }));
                setFormData((prev)=>({
                        ...prev,
                        subproiecte: subproiecteFormatate
                    }));
                // Încarcă responsabilii pentru subproiectele existente
                const subproiecteIds = subproiecteFormatate.map((s)=>s.ID_Subproiect);
                await loadResponsabiliSubproiecte(subproiecteIds);
                console.log(`Încărcate ${subproiecteFormatate.length} subproiecte existente`);
            }
        } catch (error) {
            console.error("Eroare la \xeencărcarea subproiectelor:", error);
            dist.toast.error("Eroare la \xeencărcarea subproiectelor");
        }
    };
    // Încarcă cheltuielile existente
    const loadCheltuieli = async ()=>{
        if (!proiect.ID_Proiect) return;
        try {
            const response = await fetch(`/api/rapoarte/cheltuieli?proiectId=${proiect.ID_Proiect}`);
            const data = await response.json();
            if (data.success && data.data) {
                const cheltuieliFormatate = data.data.map((ch)=>({
                        id: ch.id,
                        tip_cheltuiala: ch.tip_cheltuiala || "subcontractant",
                        subcontractant_id: "",
                        subcontractant_nume: ch.furnizor_nume || "",
                        subcontractant_cui: ch.furnizor_cui || "",
                        descriere: ch.descriere || "",
                        valoare: ch.valoare?.toString() || "",
                        moneda: ch.moneda || "RON",
                        // Data cursului din BigQuery, nu fallback
                        data_curs_valutar: formatDateForInput(ch.data_curs_valutar),
                        status_predare: ch.status_predare || "Nepredat",
                        status_contract: ch.status_contract || "Nu e cazul",
                        status_facturare: ch.status_facturare || "Nefacturat",
                        status_achitare: ch.status_achitare || "Neachitat",
                        isExisting: true,
                        isDeleted: false
                    }));
                setFormData((prev)=>({
                        ...prev,
                        cheltuieli: cheltuieliFormatate
                    }));
                console.log(`Încărcate ${cheltuieliFormatate.length} cheltuieli existente`);
            }
        } catch (error) {
            console.error("Eroare la \xeencărcarea cheltuielilor:", error);
            dist.toast.error("Eroare la \xeencărcarea cheltuielilor");
        }
    };
    const loadClienti = async ()=>{
        try {
            const response = await fetch("/api/rapoarte/clienti");
            const data = await response.json();
            if (data.success) {
                setClienti(data.data || []);
            }
        } catch (error) {
            console.error("Eroare la \xeencărcarea clienților:", error);
        }
    };
    // PĂSTRAT: Funcție pentru încărcarea cursului valutar fără rotunjire forțată
    const loadCursValutar = async ()=>{
        if (formData.moneda === "RON") return;
        setLoadingCurs(true);
        try {
            const response = await fetch(`/api/curs-valutar?moneda=${formData.moneda}&data=${formData.data_curs_valutar}`);
            const data = await response.json();
            if (data.success) {
                const cursSigur = ProiectEditModal_ensureNumber(data.curs, 1);
                const valoareSigura = ProiectEditModal_ensureNumber(formData.Valoare_Estimata, 0);
                setCursValutar(cursSigur);
                setPrecizieOriginala(data.precizie_originala || cursSigur.toString());
                const valoareRON = valoareSigura * cursSigur;
                setFormData((prev)=>({
                        ...prev,
                        curs_valutar: cursSigur.toString(),
                        valoare_ron: ProiectEditModal_ensureNumber(valoareRON, 0).toFixed(2)
                    }));
                if (data.source === "fallback") {
                    dist.toast.warning(data.warning || "Folosind curs aproximativ");
                }
            } else {
                dist.toast.error("Nu s-a putut obține cursul valutar");
            }
        } catch (error) {
            console.error("Eroare la obținerea cursului:", error);
            dist.toast.error("Eroare la obținerea cursului valutar");
        } finally{
            setLoadingCurs(false);
        }
    };
    // Handler pentru selectarea responsabilului
    const handleResponsabilSelect = (responsabil)=>{
        if (responsabil) {
            const existaResponsabil = responsabiliSelectati.find((r)=>r.uid === responsabil.uid);
            if (existaResponsabil) {
                dist.toast.error("Responsabilul este deja adăugat");
                return;
            }
            const nouResponsabil = {
                uid: responsabil.uid,
                nume_complet: responsabil.nume_complet,
                email: responsabil.email,
                rol_in_proiect: responsabiliSelectati.length === 0 ? "Principal" : "Normal"
            };
            setResponsabiliSelectati((prev)=>[
                    ...prev,
                    nouResponsabil
                ]);
            dist.toast.success(`Responsabil ${responsabil.nume_complet} adăugat`);
        }
    };
    // Funcții pentru managementul responsabililor
    const removeResponsabil = (uid)=>{
        setResponsabiliSelectati((prev)=>prev.filter((r)=>r.uid !== uid));
    };
    const updateRolResponsabil = (uid, nouRol)=>{
        setResponsabiliSelectati((prev)=>prev.map((r)=>r.uid === uid ? {
                    ...r,
                    rol_in_proiect: nouRol
                } : r));
    };
    // Funcții pentru managementul responsabililor la subproiecte
    const handleResponsabilSubproiectSelected = (subproiectId, responsabil)=>{
        if (!responsabil) return;
        const responsabiliActuali = responsabiliSubproiecte[subproiectId] || [];
        const existaResponsabil = responsabiliActuali.find((r)=>r.uid === responsabil.uid);
        if (existaResponsabil) {
            dist.toast.error("Responsabilul este deja adăugat la acest subproiect");
            return;
        }
        const nouResponsabil = {
            uid: responsabil.uid,
            nume_complet: responsabil.nume_complet,
            email: responsabil.email,
            rol_in_proiect: responsabiliActuali.length === 0 ? "Principal" : "Normal" // CORECTAT: Folosește rol_in_proiect
        };
        setResponsabiliSubproiecte((prev)=>({
                ...prev,
                [subproiectId]: [
                    ...prev[subproiectId] || [],
                    nouResponsabil
                ]
            }));
        dist.toast.success(`Responsabil ${responsabil.nume_complet} adăugat la subproiect`);
    };
    const removeResponsabilSubproiect = (subproiectId, uid)=>{
        setResponsabiliSubproiecte((prev)=>({
                ...prev,
                [subproiectId]: (prev[subproiectId] || []).filter((r)=>r.uid !== uid)
            }));
    };
    const updateRolResponsabilSubproiect = (subproiectId, uid, nouRol)=>{
        setResponsabiliSubproiecte((prev)=>({
                ...prev,
                [subproiectId]: (prev[subproiectId] || []).map((r)=>r.uid === uid ? {
                        ...r,
                        rol_in_proiect: nouRol
                    } : r // CORECTAT: Folosește rol_in_proiect
                )
            }));
    };
    // Handler pentru selectarea subcontractantului în cheltuieli
    const handleSubcontractantSelectForCheltuiala = (cheltuialaId, subcontractant)=>{
        if (subcontractant) {
            setFormData((prev)=>({
                    ...prev,
                    cheltuieli: prev.cheltuieli.map((ch)=>ch.id === cheltuialaId ? {
                            ...ch,
                            subcontractant_id: subcontractant.id || "",
                            subcontractant_nume: subcontractant.nume,
                            subcontractant_cui: subcontractant.cui || ""
                        } : ch)
                }));
        } else {
            setFormData((prev)=>({
                    ...prev,
                    cheltuieli: prev.cheltuieli.map((ch)=>ch.id === cheltuialaId ? {
                            ...ch,
                            subcontractant_id: "",
                            subcontractant_nume: "",
                            subcontractant_cui: ""
                        } : ch)
                }));
        }
    };
    // Handler pentru afișarea modalului de subcontractant nou
    const handleShowSubcontractantModal = ()=>{
        setShowSubcontractantModal(true);
    };
    // Handler pentru când subcontractantul a fost adăugat
    const handleSubcontractantAdded = ()=>{
        setShowSubcontractantModal(false);
        dist.toast.success("Subcontractant adăugat cu succes!");
    };
    const resetForm = ()=>{
        setFormData({
            ID_Proiect: "",
            Denumire: "",
            Client: "",
            selectedClientId: "",
            Adresa: "",
            Descriere: "",
            Data_Start: "",
            Data_Final: "",
            Status: "Activ",
            Valoare_Estimata: "",
            moneda: "RON",
            curs_valutar: "",
            data_curs_valutar: "",
            valoare_ron: "",
            status_predare: "Nepredat",
            status_contract: "Nu e cazul",
            status_facturare: "Nefacturat",
            status_achitare: "Neachitat",
            Observatii: "",
            subproiecte: [],
            cheltuieli: []
        });
        setClientSearch("");
        setResponsabiliSelectati([]);
        setResponsabiliSubproiecte({});
        setCursValutar(null);
        setPrecizieOriginala("");
    };
    const handleInputChange = (field, value)=>{
        setFormData((prev)=>({
                ...prev,
                [field]: value
            }));
    };
    const handleClientSearch = (value)=>{
        setClientSearch(value);
        setFormData((prev)=>({
                ...prev,
                Client: value
            }));
        setShowClientSuggestions(value.length > 0);
    };
    const selectClient = (client)=>{
        setClientSearch(client.nume);
        setFormData((prev)=>({
                ...prev,
                Client: client.nume,
                selectedClientId: client.id
            }));
        setShowClientSuggestions(false);
    };
    const filteredClients = clienti.filter((client)=>client.nume.toLowerCase().includes(clientSearch.toLowerCase())).slice(0, 5);
    // Funcții pentru managementul subproiectelor
    const addSubproiect = ()=>{
        const newSubproiect = {
            id: Date.now().toString(),
            denumire: "",
            valoare: "",
            moneda: "RON",
            status: "Planificat",
            data_start: formData.Data_Start || "",
            data_final: formData.Data_Final || "",
            isExisting: false,
            isDeleted: false
        };
        setFormData((prev)=>({
                ...prev,
                subproiecte: [
                    ...prev.subproiecte,
                    newSubproiect
                ]
            }));
    };
    const removeSubproiect = (id)=>{
        setFormData((prev)=>({
                ...prev,
                subproiecte: prev.subproiecte.map((sub)=>sub.id === id || sub.ID_Subproiect === id ? {
                        ...sub,
                        isDeleted: true
                    } : sub).filter((sub)=>!sub.isDeleted || sub.isExisting)
            }));
    };
    const updateSubproiect = (id, field, value)=>{
        setFormData((prev)=>({
                ...prev,
                subproiecte: prev.subproiecte.map((sub)=>sub.id === id || sub.ID_Subproiect === id ? {
                        ...sub,
                        [field]: value
                    } : sub)
            }));
    };
    // Funcții pentru managementul cheltuielilor cu subcontractant
    const addCheltuiala = ()=>{
        const newCheltuiala = {
            id: Date.now().toString(),
            tip_cheltuiala: "subcontractant",
            subcontractant_id: "",
            subcontractant_nume: "",
            subcontractant_cui: "",
            descriere: "",
            valoare: "",
            moneda: "RON",
            status_predare: "Nepredat",
            status_contract: "Nu e cazul",
            status_facturare: "Nefacturat",
            status_achitare: "Neachitat",
            isExisting: false,
            isDeleted: false
        };
        setFormData((prev)=>({
                ...prev,
                cheltuieli: [
                    ...prev.cheltuieli,
                    newCheltuiala
                ]
            }));
    };
    const removeCheltuiala = (id)=>{
        setFormData((prev)=>({
                ...prev,
                cheltuieli: prev.cheltuieli.map((ch)=>ch.id === id ? {
                        ...ch,
                        isDeleted: true
                    } : ch).filter((ch)=>!ch.isDeleted || ch.isExisting)
            }));
    };
    const updateCheltuiala = (id, field, value)=>{
        setFormData((prev)=>({
                ...prev,
                cheltuieli: prev.cheltuieli.map((ch)=>ch.id === id ? {
                        ...ch,
                        [field]: value
                    } : ch)
            }));
    };
    // Funcții pentru adăugarea/actualizarea subproiectelor cu cursuri BNR LIVE
    const addSubproiecte = async (proiectId, dataStart, dataFinal)=>{
        console.log(`Începe adăugarea subproiectelor pentru ${proiectId}`);
        for (const subproiect of formData.subproiecte.filter((s)=>!s.isExisting && !s.isDeleted)){
            try {
                let valoareRonSubproiect = null;
                let cursSubproiect = null;
                if (subproiect.moneda && subproiect.moneda !== "RON" && subproiect.valoare) {
                    if (subproiect.moneda === formData.moneda && formData.curs_valutar) {
                        cursSubproiect = ProiectEditModal_ensureNumber(formData.curs_valutar, 1);
                        valoareRonSubproiect = ProiectEditModal_ensureNumber(subproiect.valoare, 0) * cursSubproiect;
                    } else {
                        console.log(`Preiau curs BNR live pentru subproiect ${subproiect.denumire} (${subproiect.moneda})`);
                        const cursData = await ProiectEditModal_getCursBNRLive(subproiect.moneda, formData.data_curs_valutar);
                        cursSubproiect = cursData.curs;
                        valoareRonSubproiect = ProiectEditModal_ensureNumber(subproiect.valoare, 0) * cursSubproiect;
                    }
                } else if (subproiect.moneda === "RON" && subproiect.valoare) {
                    valoareRonSubproiect = ProiectEditModal_ensureNumber(subproiect.valoare, 0);
                    cursSubproiect = 1;
                }
                // Responsabil principal din lista de responsabili multipli pentru subproiect
                const responsabiliSubproiect = responsabiliSubproiecte[subproiect.id] || [];
                const responsabilPrincipal = responsabiliSubproiect.find((r)=>r.rol_in_proiect === "Principal");
                const subproiectData = {
                    ID_Subproiect: `${proiectId}_SUB_${subproiect.id}`,
                    ID_Proiect: proiectId,
                    Denumire: subproiect.denumire,
                    Responsabil: responsabilPrincipal ? responsabilPrincipal.nume_complet : null,
                    Status: subproiect.status || "Planificat",
                    Valoare_Estimata: subproiect.valoare ? ProiectEditModal_ensureNumber(subproiect.valoare) : null,
                    Data_Start: dataStart,
                    Data_Final: dataFinal,
                    moneda: subproiect.moneda || "RON",
                    curs_valutar: cursSubproiect,
                    data_curs_valutar: ProiectEditModal_formatDateForBigQuery(formData.data_curs_valutar || new Date().toISOString().split("T")[0]),
                    valoare_ron: valoareRonSubproiect,
                    status_predare: "Nepredat",
                    status_contract: "Nu e cazul",
                    status_facturare: "Nefacturat",
                    status_achitare: "Neachitat"
                };
                const response = await fetch("/api/rapoarte/subproiecte", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(subproiectData)
                });
                const result = await response.json();
                if (result.success) {
                    // Adaugă responsabilii pentru subproiectul nou creat
                    if (responsabiliSubproiect.length > 0) {
                        await addResponsabiliSubproiect(subproiectData.ID_Subproiect, responsabiliSubproiect);
                    }
                    console.log(`Subproiect "${subproiect.denumire}" adăugat cu succes`);
                } else {
                    console.error(`Eroare la subproiect ${subproiect.denumire}:`, result);
                    dist.toast.error(`Eroare la adăugarea subproiectului "${subproiect.denumire}": ${result.error}`);
                }
            } catch (error) {
                console.error(`Eroare la adăugarea subproiectului ${subproiect.denumire}:`, error);
                dist.toast.error(`Eroare la adăugarea subproiectului "${subproiect.denumire}"`);
            }
        }
    };
    // NOU: Funcție pentru salvarea responsabililor în tabela ProiecteResponsabili
    const addResponsabiliProiect = async (proiectId)=>{
        if (responsabiliSelectati.length === 0) return;
        try {
            for (const responsabil of responsabiliSelectati){
                // Verifică dacă responsabilul nu există deja
                const checkResponse = await fetch(`/api/rapoarte/proiecte-responsabili?proiect_id=${proiectId}`);
                const existingData = await checkResponse.json();
                const existaResponsabil = existingData.success && existingData.data.find((r)=>r.responsabil_uid === responsabil.uid);
                if (existaResponsabil) continue; // Skip dacă există deja
                const responsabilData = {
                    id: `RESP_${proiectId}_${responsabil.uid}_${Date.now()}`,
                    proiect_id: proiectId,
                    responsabil_uid: responsabil.uid,
                    responsabil_nume: responsabil.nume_complet,
                    rol_in_proiect: responsabil.rol_in_proiect,
                    data_atribuire: ProiectEditModal_getRomanianDateTime(),
                    atribuit_de: responsabil.uid
                };
                const response = await fetch("/api/rapoarte/proiecte-responsabili", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(responsabilData)
                });
                const result = await response.json();
                if (!result.success) {
                    console.error(`Eroare la salvarea responsabilului ${responsabil.nume_complet}:`, result.error);
                }
            }
            console.log(`Salvați ${responsabiliSelectati.length} responsabili pentru proiectul ${proiectId}`);
        } catch (error) {
            console.error("Eroare la salvarea responsabililor:", error);
        }
    };
    // NOU: Funcție pentru salvarea responsabililor subproiecte
    const addResponsabiliSubproiect = async (subproiectId, responsabili)=>{
        if (responsabili.length === 0) return;
        try {
            for (const responsabil of responsabili){
                const responsabilData = {
                    id: `RESP_SUB_${subproiectId}_${responsabil.uid}_${Date.now()}`,
                    subproiect_id: subproiectId,
                    responsabil_uid: responsabil.uid,
                    responsabil_nume: responsabil.nume_complet,
                    rol_in_subproiect: responsabil.rol_in_proiect,
                    data_atribuire: ProiectEditModal_getRomanianDateTime(),
                    atribuit_de: responsabil.uid
                };
                const response = await fetch("/api/rapoarte/subproiecte-responsabili", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(responsabilData)
                });
                const result = await response.json();
                if (!result.success) {
                    console.error(`Eroare la salvarea responsabilului ${responsabil.nume_complet}:`, result.error);
                }
            }
            console.log(`Salvați ${responsabili.length} responsabili pentru subproiectul ${subproiectId}`);
        } catch (error) {
            console.error("Eroare la salvarea responsabililor subproiect:", error);
        }
    };
    // Funcția pentru adăugarea cheltuielilor
    const addCheltuieli = async (proiectId)=>{
        for (const cheltuiala of formData.cheltuieli.filter((c)=>!c.isExisting && !c.isDeleted)){
            try {
                let cursValutar = 1;
                let valoareRON = ProiectEditModal_ensureNumber(cheltuiala.valoare);
                if (cheltuiala.moneda !== "RON") {
                    if (cheltuiala.moneda === formData.moneda && cursValutar && cursValutar > 1) {
                        cursValutar = ProiectEditModal_ensureNumber(formData.curs_valutar);
                    } else {
                        try {
                            const response = await fetch(`/api/curs-valutar?moneda=${cheltuiala.moneda}`);
                            const cursData = await response.json();
                            if (cursData.success) {
                                cursValutar = ProiectEditModal_ensureNumber(cursData.curs, 1);
                            }
                        } catch (error) {
                            console.error(`Eroare preluare curs ${cheltuiala.moneda}:`, error);
                            const cursuriFallback = {
                                "EUR": 5.0683,
                                "USD": 4.3688,
                                "GBP": 5.8777
                            };
                            cursValutar = cursuriFallback[cheltuiala.moneda] || 1;
                        }
                    }
                    valoareRON = ProiectEditModal_ensureNumber(cheltuiala.valoare) * cursValutar;
                }
                const cheltuialaData = {
                    id: `${proiectId}_CHE_${cheltuiala.id}`,
                    proiect_id: proiectId,
                    tip_cheltuiala: cheltuiala.tip_cheltuiala,
                    furnizor_nume: cheltuiala.subcontractant_nume,
                    furnizor_cui: cheltuiala.subcontractant_cui,
                    furnizor_contact: null,
                    descriere: cheltuiala.descriere,
                    valoare: ProiectEditModal_ensureNumber(cheltuiala.valoare),
                    moneda: cheltuiala.moneda,
                    curs_valutar: cursValutar,
                    data_curs_valutar: ProiectEditModal_formatDateForBigQuery(formData.data_curs_valutar || new Date().toISOString().split("T")[0]),
                    valoare_ron: valoareRON,
                    status_predare: cheltuiala.status_predare,
                    status_contract: cheltuiala.status_contract,
                    status_facturare: cheltuiala.status_facturare,
                    status_achitare: cheltuiala.status_achitare
                };
                const response = await fetch("/api/rapoarte/cheltuieli", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(cheltuialaData)
                });
                const result = await response.json();
                if (!result.success) {
                    console.error(`Eroare la adaugarea cheltuielii ${cheltuiala.descriere}:`, result.error);
                } else {
                    console.log(`Cheltuială salvată în ProiecteCheltuieli: ${cheltuiala.descriere}`);
                }
            } catch (error) {
                console.error(`Eroare la adaugarea cheltuielii ${cheltuiala.descriere}:`, error);
            }
        }
    };
    // NOU: Actualizare subproiecte existente
    const updateSubproiecteExistente = async ()=>{
        for (const subproiect of formData.subproiecte.filter((s)=>s.isExisting && !s.isDeleted)){
            try {
                // ADĂUGAT: Calculează cursul dacă moneda nu e RON
                let cursSubproiect = 1;
                let valoareRonSubproiect = parseFloat(subproiect.valoare) || 0;
                if (subproiect.moneda !== "RON" && subproiect.valoare) {
                    try {
                        const cursData = await ProiectEditModal_getCursBNRLive(subproiect.moneda, formData.data_curs_valutar);
                        cursSubproiect = cursData.curs;
                        valoareRonSubproiect = parseFloat(subproiect.valoare) * cursSubproiect;
                    } catch (error) {
                        console.error(`Eroare curs pentru ${subproiect.moneda}:`, error);
                    }
                }
                const updateData = {
                    id: subproiect.ID_Subproiect,
                    Denumire: subproiect.denumire,
                    Status: subproiect.status,
                    Valoare_Estimata: subproiect.valoare ? parseFloat(subproiect.valoare) : null,
                    moneda: subproiect.moneda || "RON",
                    Data_Start: ProiectEditModal_formatDateForBigQuery(subproiect.data_start || formData.Data_Start),
                    Data_Final: ProiectEditModal_formatDateForBigQuery(subproiect.data_final || formData.Data_Final),
                    curs_valutar: cursSubproiect,
                    data_curs_valutar: ProiectEditModal_formatDateForBigQuery(formData.data_curs_valutar),
                    valoare_ron: valoareRonSubproiect,
                    data_actualizare: ProiectEditModal_getRomanianDateTime()
                };
                await fetch("/api/rapoarte/subproiecte", {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(updateData)
                });
                console.log(`Subproiect ${subproiect.ID_Subproiect} actualizat`);
            } catch (error) {
                console.error(`Eroare la actualizarea subproiectului ${subproiect.denumire}:`, error);
            }
        }
    };
    // NOU: Ștergere subproiecte marcate pentru ștergere
    const deleteSubproiecte = async ()=>{
        for (const subproiect of formData.subproiecte.filter((s)=>s.isExisting && s.isDeleted)){
            try {
                await fetch(`/api/rapoarte/subproiecte?id=${subproiect.ID_Subproiect}`, {
                    method: "DELETE"
                });
                console.log(`Subproiect ${subproiect.ID_Subproiect} șters`);
            } catch (error) {
                console.error(`Eroare la ștergerea subproiectului ${subproiect.denumire}:`, error);
            }
        }
    };
    // NOU: Actualizare cheltuieli existente
    const updateCheltuieliExistente = async ()=>{
        for (const cheltuiala of formData.cheltuieli.filter((c)=>c.isExisting && !c.isDeleted)){
            try {
                // ADĂUGAT: Calculează cursul
                let cursValutar = 1;
                let valoareRON = parseFloat(cheltuiala.valoare);
                if (cheltuiala.moneda !== "RON") {
                    try {
                        const response = await fetch(`/api/curs-valutar?moneda=${cheltuiala.moneda}&data=${formData.data_curs_valutar}`);
                        const cursData = await response.json();
                        if (cursData.success) {
                            cursValutar = cursData.curs;
                            valoareRON = parseFloat(cheltuiala.valoare) * cursValutar;
                        }
                    } catch (error) {
                        console.error(`Eroare curs ${cheltuiala.moneda}:`, error);
                    }
                }
                const updateData = {
                    id: cheltuiala.id,
                    tip_cheltuiala: cheltuiala.tip_cheltuiala,
                    furnizor_nume: cheltuiala.subcontractant_nume,
                    furnizor_cui: cheltuiala.subcontractant_cui || null,
                    descriere: cheltuiala.descriere,
                    valoare: parseFloat(cheltuiala.valoare),
                    moneda: cheltuiala.moneda,
                    curs_valutar: cursValutar,
                    data_curs_valutar: ProiectEditModal_formatDateForBigQuery(formData.data_curs_valutar),
                    valoare_ron: valoareRON,
                    status_predare: cheltuiala.status_predare,
                    status_contract: cheltuiala.status_contract,
                    status_facturare: cheltuiala.status_facturare,
                    status_achitare: cheltuiala.status_achitare,
                    data_actualizare: ProiectEditModal_getRomanianDateTime()
                };
                await fetch("/api/rapoarte/cheltuieli", {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(updateData)
                });
                console.log(`Cheltuială ${cheltuiala.id} actualizată`);
            } catch (error) {
                console.error(`Eroare la actualizarea cheltuielii ${cheltuiala.descriere}:`, error);
            }
        }
    };
    // NOU: Ștergere cheltuieli marcate pentru ștergere
    const deleteCheltuieli = async ()=>{
        for (const cheltuiala of formData.cheltuieli.filter((c)=>c.isExisting && c.isDeleted)){
            try {
                await fetch(`/api/rapoarte/cheltuieli?id=${cheltuiala.id}`, {
                    method: "DELETE"
                });
                console.log(`Cheltuială ${cheltuiala.id} ștearsă`);
            } catch (error) {
                console.error(`Eroare la ștergerea cheltuielii ${cheltuiala.descriere}:`, error);
            }
        }
    };
    const handleSubmit = async (e)=>{
        e.preventDefault();
        setLoading(true);
        try {
            // Validări
            if (!formData.Denumire.trim()) {
                dist.toast.error("Denumirea proiectului este obligatorie");
                setLoading(false);
                return;
            }
            if (!formData.Client.trim()) {
                dist.toast.error("Clientul este obligatoriu");
                setLoading(false);
                return;
            }
            // Validare pentru cel puțin un responsabil principal
            if (responsabiliSelectati.length === 0) {
                dist.toast.error("Cel puțin un responsabil este obligatoriu");
                setLoading(false);
                return;
            }
            const responsabilPrincipal = responsabiliSelectati.find((r)=>r.rol_in_proiect === "Principal");
            if (!responsabilPrincipal) {
                dist.toast.error('Cel puțin un responsabil trebuie să aibă rolul "Principal"');
                setLoading(false);
                return;
            }
            // Validări date
            if (formData.Data_Start && formData.Data_Final) {
                const dataStart = new Date(formData.Data_Start);
                const dataFinal = new Date(formData.Data_Final);
                if (dataFinal <= dataStart) {
                    dist.toast.error("Data de finalizare trebuie să fie după data de \xeenceput");
                    setLoading(false);
                    return;
                }
            }
            dist.toast.info("Se actualizează proiectul...");
            // Pregătește datele pentru actualizare
            const updateData = {
                id: formData.ID_Proiect,
                Denumire: formData.Denumire.trim(),
                Client: formData.Client.trim(),
                Adresa: formData.Adresa.trim() || null,
                Descriere: formData.Descriere.trim() || null,
                Data_Start: formData.Data_Start || null,
                Data_Final: formData.Data_Final || null,
                Status: formData.Status,
                Valoare_Estimata: formData.Valoare_Estimata ? parseFloat(formData.Valoare_Estimata) : null,
                moneda: formData.moneda,
                curs_valutar: formData.curs_valutar ? parseFloat(formData.curs_valutar) : null,
                data_curs_valutar: formData.data_curs_valutar || null,
                valoare_ron: formData.valoare_ron ? parseFloat(formData.valoare_ron) : null,
                status_predare: formData.status_predare,
                status_contract: formData.status_contract,
                status_facturare: formData.status_facturare,
                status_achitare: formData.status_achitare,
                Responsabil: responsabilPrincipal.nume_complet,
                Observatii: formData.Observatii.trim() || null
            };
            const response = await fetch("/api/rapoarte/proiecte", {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(updateData)
            });
            const result = await response.json();
            if (result.success || response.ok) {
                // Actualizează responsabilii
                await addResponsabiliProiect(formData.ID_Proiect);
                // Actualizează subproiectele
                await updateSubproiecteExistente();
                await deleteSubproiecte();
                await addSubproiecte(formData.ID_Proiect, updateData.Data_Start, updateData.Data_Final);
                // Actualizează cheltuielile
                await updateCheltuieliExistente();
                await deleteCheltuieli();
                await addCheltuieli(formData.ID_Proiect);
                dist.toast.success("Proiect actualizat cu succes cu toate componentele!");
                onProiectUpdated();
                onClose();
            } else {
                console.error("Eroare API:", result);
                dist.toast.error(`Eroare: ${result.error || "Eroare necunoscută"}`);
            }
        } catch (error) {
            console.error("Eroare la actualizarea proiectului:", error);
            dist.toast.error("Eroare la actualizarea proiectului");
        } finally{
            setLoading(false);
        }
    };
    // Funcție pentru ștergerea proiectului
    const handleDelete = async ()=>{
        const confirmed = confirm(`ATENȚIE: Ești sigur că vrei să ștergi proiectul "${formData.Denumire}"?\n\n` + `ID: ${formData.ID_Proiect}\n` + `Client: ${formData.Client}\n\n` + `Această acțiune va șterge și:\n` + `- ${formData.subproiecte.filter((s)=>!s.isDeleted).length} subproiecte\n` + `- ${formData.cheltuieli.filter((c)=>!c.isDeleted).length} cheltuieli\n` + `- ${responsabiliSelectati.length} responsabili\n\n` + `Această acțiune nu poate fi anulată!`);
        if (!confirmed) return;
        setLoading(true);
        try {
            const response = await fetch(`/api/rapoarte/proiecte?id=${encodeURIComponent(formData.ID_Proiect)}`, {
                method: "DELETE"
            });
            const result = await response.json();
            if (result.success) {
                dist.toast.success("Proiect șters cu succes!");
                onProiectDeleted();
                onClose();
            } else {
                dist.toast.error(result.error || "Eroare la ștergerea proiectului");
            }
        } catch (error) {
            console.error("Eroare la ștergere:", error);
            dist.toast.error("Eroare la ștergerea proiectului");
        } finally{
            setLoading(false);
        }
    };
    if (!isOpen) return null;
    // CORECTAT: Render cu createPortal pentru centrare corectă (ca în ProiectNouModal)
    return  false ? /*#__PURE__*/ 0 : null;
}

// EXTERNAL MODULE: ./app/admin/rapoarte/proiecte/components/ContractModal.tsx
var ContractModal = __webpack_require__(17509);
// EXTERNAL MODULE: ./app/admin/rapoarte/proiecte/components/ProcesVerbalModal.tsx
var ProcesVerbalModal = __webpack_require__(35471);
;// CONCATENATED MODULE: ./app/admin/rapoarte/proiecte/components/ProiecteTable.tsx
// ==================================================================
// CALEA: app/admin/rapoarte/proiecte/components/ProiecteTable.tsx
// DATA: 07.09.2025 21:15 (ora României)
// MODIFICAT: Adăugat integrare ProcesVerbalModal pentru generarea PV-urilor
// PĂSTRATE: Toate funcționalitățile existente + pattern identic cu ContractModal
// ==================================================================
/* __next_internal_client_entry_do_not_use__ default auto */ 







 // ✅ NOU: Import ProcesVerbalModal
// FIX PRINCIPAL: Funcție helper pentru validări sigure
const ProiecteTable_ensureNumber = (value, defaultValue = 0)=>{
    if (typeof value === "number" && !isNaN(value) && isFinite(value)) {
        return value;
    }
    if (typeof value === "string") {
        const parsed = parseFloat(value);
        return !isNaN(parsed) && isFinite(parsed) ? parsed : defaultValue;
    }
    return defaultValue;
};
// FIX PRINCIPAL: Funcție pentru formatare sigură cu precizie originală
const ProiecteTable_formatWithOriginalPrecision = (value, originalPrecision)=>{
    // Dacă avem precizia originală, o folosim
    if (originalPrecision && originalPrecision !== "undefined" && originalPrecision !== "null") {
        return originalPrecision;
    }
    // Altfel, formatez cu precizia naturală
    const num = ProiecteTable_ensureNumber(value);
    return num.toString();
};
// Funcție pentru preluarea cursurilor BNR LIVE - ACTUALIZATĂ
const ProiecteTable_getCursBNRLive = async (moneda, data)=>{
    if (moneda === "RON") return 1;
    try {
        const url = `/api/curs-valutar?moneda=${encodeURIComponent(moneda)}${data ? `&data=${data}` : ""}`;
        const response = await fetch(url);
        const result = await response.json();
        if (result.success && result.curs) {
            const cursNumeric = ProiecteTable_ensureNumber(result.curs, 1);
            console.log(`Curs BNR live pentru ${moneda}: ${ProiecteTable_formatWithOriginalPrecision(cursNumeric, result.precizie_originala)}`);
            return cursNumeric;
        }
        console.warn(`Nu s-a putut prelua cursul live pentru ${moneda}, folosesc fallback`);
        switch(moneda){
            case "EUR":
                return 5.0683;
            case "USD":
                return 4.3688;
            case "GBP":
                return 5.8777;
            default:
                return 1;
        }
    } catch (error) {
        console.error(`Eroare la preluarea cursului pentru ${moneda}:`, error);
        switch(moneda){
            case "EUR":
                return 5.0683;
            case "USD":
                return 4.3688;
            case "GBP":
                return 5.8777;
            default:
                return 1;
        }
    }
};
// Toast system - PĂSTRAT identic
const ProiecteTable_showToast = (message, type = "info")=>{
    const toastEl = document.createElement("div");
    toastEl.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(12px);
    color: ${type === "success" ? "#27ae60" : type === "error" ? "#e74c3c" : "#3498db"};
    padding: 16px 20px;
    border-radius: 16px;
    z-index: 60000;
    font-family: 'Inter', Arial, sans-serif;
    font-size: 14px;
    font-weight: 500;
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    border: 1px solid rgba(255, 255, 255, 0.2);
    max-width: 400px;
    word-wrap: break-word;
    transform: translateY(-10px);
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  `;
    toastEl.textContent = message;
    document.body.appendChild(toastEl);
    setTimeout(()=>{
        toastEl.style.transform = "translateY(0)";
        toastEl.style.opacity = "1";
    }, 10);
    setTimeout(()=>{
        toastEl.style.transform = "translateY(-10px)";
        toastEl.style.opacity = "0";
        setTimeout(()=>{
            if (document.body.contains(toastEl)) {
                document.body.removeChild(toastEl);
            }
        }, 300);
    }, type === "success" || type === "error" ? 4000 : 6000);
};
function ProiecteTable({ searchParams }) {
    // State variables - PĂSTRATE identic + ADĂUGAT state pentru PV
    const [proiecte, setProiecte] = (0,react_experimental_.useState)([]);
    const [subproiecte, setSubproiecte] = (0,react_experimental_.useState)([]);
    const [loading, setLoading] = (0,react_experimental_.useState)(true);
    const [refreshTrigger, setRefreshTrigger] = (0,react_experimental_.useState)(0);
    const [cursuriLive, setCursuriLive] = (0,react_experimental_.useState)({});
    const [loadingCursuri, setLoadingCursuri] = (0,react_experimental_.useState)(false);
    const [showProiectModal, setShowProiectModal] = (0,react_experimental_.useState)(false);
    const [showFacturaModal, setShowFacturaModal] = (0,react_experimental_.useState)(false);
    const [showSubproiectModal, setShowSubproiectModal] = (0,react_experimental_.useState)(false);
    const [showEditModal, setShowEditModal] = (0,react_experimental_.useState)(false);
    const [selectedProiect, setSelectedProiect] = (0,react_experimental_.useState)(null);
    const [showContractModal, setShowContractModal] = (0,react_experimental_.useState)(false);
    const [showPVModal, setShowPVModal] = (0,react_experimental_.useState)(false); // ✅ NOU: State pentru PV Modal
    const [expandedProjects, setExpandedProjects] = (0,react_experimental_.useState)(new Set());
    // Toate useEffect-urile - PĂSTRATE identic
    (0,react_experimental_.useEffect)(()=>{
        loadData();
    }, [
        searchParams,
        refreshTrigger
    ]);
    (0,react_experimental_.useEffect)(()=>{
        if (proiecte.length > 0 && subproiecte.length > 0) {
            const proiecteCuSubproiecte = proiecte.map((p)=>p.ID_Proiect).filter((id)=>subproiecte.some((sub)=>sub.ID_Proiect === id));
            if (proiecteCuSubproiecte.length > 0) {
                setExpandedProjects(new Set(proiecteCuSubproiecte));
            }
        }
        if (proiecte.length > 0 || subproiecte.length > 0) {
            identificaSiPreiaCursuriLive();
        }
    }, [
        proiecte,
        subproiecte
    ]);
    // FIX PRINCIPAL: Funcție pentru identificare și preluare cursuri ACTUALIZATĂ
    const identificaSiPreiaCursuriLive = async ()=>{
        const valuteNecesare = new Set();
        proiecte.forEach((p)=>{
            if (p.moneda && p.moneda !== "RON") {
                valuteNecesare.add(p.moneda);
            }
        });
        subproiecte.forEach((s)=>{
            if (s.moneda && s.moneda !== "RON") {
                valuteNecesare.add(s.moneda);
            }
        });
        if (valuteNecesare.size === 0) {
            return;
        }
        const monede = Array.from(valuteNecesare);
        setLoadingCursuri(true);
        try {
            const promisesCursuri = monede.map(async (moneda)=>{
                try {
                    const cursLive = await ProiecteTable_getCursBNRLive(moneda);
                    // FIX: Nu forțez 4 zecimale, păstrez precizia originală
                    return {
                        moneda,
                        curs: cursLive,
                        data: new Date().toISOString().split("T")[0],
                        precizie_originala: cursLive.toString(),
                        loading: false
                    };
                } catch (error) {
                    return {
                        moneda,
                        error: "Eroare de conectare",
                        loading: false
                    };
                }
            });
            const rezultateCursuri = await Promise.all(promisesCursuri);
            const cursuriNoi = {};
            let cursuriObtinute = 0;
            rezultateCursuri.forEach((rezultat)=>{
                if (rezultat) {
                    cursuriNoi[rezultat.moneda] = {
                        curs: rezultat.curs || 1,
                        data: rezultat.data || new Date().toISOString().split("T")[0],
                        precizie_originala: rezultat.precizie_originala,
                        loading: false,
                        error: rezultat.error
                    };
                    if (!rezultat.error) {
                        cursuriObtinute++;
                    }
                }
            });
            setCursuriLive(cursuriNoi);
            if (cursuriObtinute > 0) {
                ProiecteTable_showToast(`Cursuri BNR live actualizate (${cursuriObtinute}/${monede.length})`, "success");
            }
        } catch (error) {
            console.error("Eroare generală la preluarea cursurilor live:", error);
        } finally{
            setLoadingCursuri(false);
        }
    };
    (0,react_experimental_.useEffect)(()=>{
        if (searchParams?.invoice_status && searchParams?.project_id) {
            const status = searchParams.invoice_status;
            const projectId = searchParams.project_id;
            switch(status){
                case "success":
                    ProiecteTable_showToast(`Factură creată cu succes pentru proiectul ${projectId}!`, "success");
                    break;
                case "cancelled":
                    ProiecteTable_showToast(`Crearea facturii pentru proiectul ${projectId} a fost anulată.`, "info");
                    break;
                default:
                    ProiecteTable_showToast(`Status factură pentru proiectul ${projectId}: ${status}`, "info");
            }
        }
    }, [
        searchParams
    ]);
    // Toate funcțiile de încărcare date - PĂSTRATE identic
    const loadData = async ()=>{
        try {
            setLoading(true);
            await Promise.all([
                loadProiecte(),
                loadSubproiecte()
            ]);
        } catch (error) {
            console.error("Eroare la \xeencărcarea datelor:", error);
            ProiecteTable_showToast("Eroare de conectare la baza de date", "error");
        } finally{
            setLoading(false);
        }
    };
    const loadProiecte = async ()=>{
        try {
            const queryParams = new URLSearchParams();
            if (searchParams) {
                Object.entries(searchParams).forEach(([key, value])=>{
                    if (value && key !== "invoice_status" && key !== "project_id") {
                        queryParams.append(key, value);
                    }
                });
            }
            const response = await fetch(`/api/rapoarte/proiecte?${queryParams.toString()}`);
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
            }
            const data = await response.json();
            console.log("=== DEBUG: Date RAW din BigQuery ===");
            console.log("Sample proiect din API:", data.data[0]);
            console.log("Data_Start raw:", data.data[0]?.Data_Start);
            console.log("Data_Final raw:", data.data[0]?.Data_Final);
            console.log("Tipul Data_Start:", typeof data.data[0]?.Data_Start);
            if (data.success) {
                // FIX: Procesează obiectele DATE de la BigQuery
                const proiecteFormatate = (data.data || []).map((p)=>({
                        ...p,
                        Data_Start: p.Data_Start?.value || p.Data_Start,
                        Data_Final: p.Data_Final?.value || p.Data_Final,
                        data_curs_valutar: p.data_curs_valutar?.value || p.data_curs_valutar,
                        tip: "proiect"
                    }));
                setProiecte(proiecteFormatate);
            } else {
                throw new Error(data.error || "Eroare la \xeencărcarea proiectelor");
            }
        } catch (error) {
            console.error("Eroare la \xeencărcarea proiectelor:", error);
            setProiecte([]);
        }
    };
    const loadSubproiecte = async ()=>{
        try {
            const queryParams = new URLSearchParams();
            if (searchParams) {
                Object.entries(searchParams).forEach(([key, value])=>{
                    if (value && key !== "invoice_status" && key !== "project_id") {
                        queryParams.append(key, value);
                    }
                });
            }
            const response = await fetch(`/api/rapoarte/subproiecte?${queryParams.toString()}`);
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
            }
            const data = await response.json();
            if (data.success) {
                // FIX: Procesează obiectele DATE de la BigQuery pentru subproiecte
                const subproiecteFormatate = (data.data || []).map((s)=>({
                        ...s,
                        Data_Start: s.Data_Start?.value || s.Data_Start,
                        Data_Final: s.Data_Final?.value || s.Data_Final,
                        data_curs_valutar: s.data_curs_valutar?.value || s.data_curs_valutar
                    }));
                setSubproiecte(subproiecteFormatate);
            } else {
                setSubproiecte([]);
            }
        } catch (error) {
            console.error("Eroare la \xeencărcarea subproiectelor:", error);
            setSubproiecte([]);
        }
    };
    // Toate handler-ele - PĂSTRATE identic + ADĂUGAT handler pentru PV
    const handleRefresh = ()=>{
        setRefreshTrigger((prev)=>prev + 1);
        ProiecteTable_showToast("Date actualizate!", "success");
    };
    const handleShowFacturaModal = (proiect)=>{
        setSelectedProiect(proiect);
        setShowFacturaModal(true);
    };
    const handleShowSubproiectModal = (proiect)=>{
        setSelectedProiect(proiect);
        setShowSubproiectModal(true);
    };
    const handleShowEditModal = (proiect)=>{
        setSelectedProiect(proiect);
        setShowEditModal(true);
    };
    const handleShowContractModal = (proiect)=>{
        setSelectedProiect(proiect);
        setShowContractModal(true);
    };
    // ✅ NOU: Handler pentru PV Modal
    const handleShowPVModal = (proiect)=>{
        setSelectedProiect(proiect);
        setShowPVModal(true);
    };
    const handleFacturaSuccess = (invoiceId, downloadUrl)=>{
        setShowFacturaModal(false);
        setSelectedProiect(null);
        ProiecteTable_showToast(`Factura ${invoiceId} a fost generată cu succes!`, "success");
        handleRefresh();
    };
    const handleSubproiectSuccess = ()=>{
        setShowSubproiectModal(false);
        setSelectedProiect(null);
        ProiecteTable_showToast("Subproiect adăugat cu succes!", "success");
        handleRefresh();
    };
    const handleEditSuccess = ()=>{
        setShowEditModal(false);
        setSelectedProiect(null);
        ProiecteTable_showToast("Proiect actualizat cu succes!", "success");
        handleRefresh();
    };
    const handleEditDelete = ()=>{
        setShowEditModal(false);
        setSelectedProiect(null);
        ProiecteTable_showToast("Proiect șters cu succes!", "success");
        handleRefresh();
    };
    const handleContractSuccess = ()=>{
        setShowContractModal(false);
        setSelectedProiect(null);
        ProiecteTable_showToast("Contract generat cu succes!", "success");
        handleRefresh();
    };
    // ✅ NOU: Handler pentru PV Success
    const handlePVSuccess = ()=>{
        setShowPVModal(false);
        setSelectedProiect(null);
        ProiecteTable_showToast("Proces Verbal generat cu succes!", "success");
        handleRefresh();
    };
    const handleCloseFacturaModal = ()=>{
        setShowFacturaModal(false);
        setSelectedProiect(null);
    };
    const handleCloseSubproiectModal = ()=>{
        setShowSubproiectModal(false);
        setSelectedProiect(null);
    };
    const handleCloseEditModal = ()=>{
        setShowEditModal(false);
        setSelectedProiect(null);
    };
    const handleCloseContractModal = ()=>{
        setShowContractModal(false);
        setSelectedProiect(null);
    };
    // ✅ NOU: Handler pentru PV Close
    const handleClosePVModal = ()=>{
        setShowPVModal(false);
        setSelectedProiect(null);
    };
    const toggleProjectExpansion = (proiectId)=>{
        setExpandedProjects((prev)=>{
            const newSet = new Set(prev);
            if (newSet.has(proiectId)) {
                newSet.delete(proiectId);
            } else {
                newSet.add(proiectId);
            }
            return newSet;
        });
    };
    const getSubproiecteForProject = (proiectId)=>{
        return subproiecte.filter((sub)=>sub.ID_Proiect === proiectId);
    };
    const handleExportExcel = async ()=>{
        try {
            ProiecteTable_showToast("Se generează fișierul Excel...", "info");
            const queryParams = new URLSearchParams();
            if (searchParams) {
                Object.entries(searchParams).forEach(([key, value])=>{
                    if (value && key !== "invoice_status" && key !== "project_id") {
                        queryParams.append(key, value);
                    }
                });
            }
            const response = await fetch(`/api/rapoarte/proiecte/export?${queryParams.toString()}`);
            if (response.ok) {
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.href = url;
                const contentDisposition = response.headers.get("Content-Disposition");
                const fileName = contentDisposition ? contentDisposition.split("filename=")[1]?.replace(/"/g, "") : `Proiecte_${new Date().toISOString().split("T")[0]}.xlsx`;
                link.download = fileName;
                link.click();
                window.URL.revokeObjectURL(url);
                ProiecteTable_showToast("Fișier Excel descărcat cu succes!", "success");
            } else {
                const errorData = await response.json();
                ProiecteTable_showToast(`Eroare la export: ${errorData.error}`, "error");
            }
        } catch (error) {
            console.error("Eroare la exportul Excel:", error);
            ProiecteTable_showToast("Eroare la exportul Excel", "error");
        }
    };
    // FIX PRINCIPAL: Funcție formatDate SIMPLIFICATĂ
    const formatDate = (dateString)=>{
        console.log("formatDate primește:", dateString, "tip:", typeof dateString);
        if (!dateString || dateString === "null" || dateString === "undefined") {
            return /*#__PURE__*/ jsx_runtime_.jsx("span", {
                style: {
                    color: "#e74c3c",
                    fontSize: "12px",
                    fontStyle: "italic"
                },
                children: "Data lipsă"
            });
        }
        try {
            const isoDateRegex = /^\d{4}-\d{2}-\d{2}$/;
            if (isoDateRegex.test(dateString)) {
                const date = new Date(dateString + "T00:00:00");
                if (!isNaN(date.getTime())) {
                    return /*#__PURE__*/ jsx_runtime_.jsx("span", {
                        style: {
                            color: "#2c3e50",
                            fontWeight: "500"
                        },
                        children: date.toLocaleDateString()
                    });
                }
            }
            const date = new Date(dateString);
            if (!isNaN(date.getTime())) {
                return /*#__PURE__*/ jsx_runtime_.jsx("span", {
                    style: {
                        color: "#2c3e50",
                        fontWeight: "500"
                    },
                    children: date.toLocaleDateString()
                });
            }
            return /*#__PURE__*/ jsx_runtime_.jsx("span", {
                style: {
                    color: "#e74c3c",
                    fontSize: "12px",
                    fontStyle: "italic"
                },
                children: "Data invalidă"
            });
        } catch (error) {
            console.warn("Eroare formatare dată:", dateString, error);
            return /*#__PURE__*/ jsx_runtime_.jsx("span", {
                style: {
                    color: "#e74c3c",
                    fontSize: "12px",
                    fontStyle: "italic"
                },
                children: "Eroare formatare"
            });
        }
    };
    // FIX PRINCIPAL: Funcții pentru currency cu validări sigure și precizie originală
    const recalculeazaValoareaCuCursBNRLive = (valoareOriginala, monedaOriginala, valoareRonBD, cursVechiDinBD)=>{
        if (monedaOriginala === "RON" || !monedaOriginala) {
            return ProiecteTable_ensureNumber(valoareOriginala);
        }
        const cursLive = cursuriLive[monedaOriginala];
        if (cursLive && !cursLive.error && cursLive.curs) {
            const valoareSigura = ProiecteTable_ensureNumber(valoareOriginala);
            const cursSigur = ProiecteTable_ensureNumber(cursLive.curs, 1);
            return valoareSigura * cursSigur;
        }
        if (valoareRonBD && valoareRonBD > 0) {
            return ProiecteTable_ensureNumber(valoareRonBD);
        }
        if (cursVechiDinBD && cursVechiDinBD > 0) {
            const valoareSigura = ProiecteTable_ensureNumber(valoareOriginala);
            const cursSigur = ProiecteTable_ensureNumber(cursVechiDinBD, 1);
            return valoareSigura * cursSigur;
        }
        return ProiecteTable_ensureNumber(valoareOriginala);
    };
    const formatCurrencyWithOriginal = (amount, currency, ronValueBD, cursVechiDinBD, isSubproiect = false)=>{
        const amountSigur = ProiecteTable_ensureNumber(amount);
        if (amountSigur === 0 && !amount) return "";
        const originalCurrency = currency || "RON";
        const colorClass = isSubproiect ? "#3498db" : "#27ae60";
        if (originalCurrency === "RON" || !currency) {
            return /*#__PURE__*/ jsx_runtime_.jsx("div", {
                style: {
                    textAlign: "right",
                    fontWeight: "700",
                    color: colorClass,
                    fontSize: "14px"
                },
                children: new Intl.NumberFormat("ro-RO", {
                    style: "currency",
                    currency: "RON"
                }).format(amountSigur)
            });
        }
        const valoareRecalculataRON = recalculeazaValoareaCuCursBNRLive(amountSigur, originalCurrency, ronValueBD, cursVechiDinBD);
        const cursLive = cursuriLive[originalCurrency];
        const areaCursLive = cursLive && !cursLive.error;
        return /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
            style: {
                textAlign: "right",
                fontWeight: "700",
                color: colorClass,
                fontSize: "13px"
            },
            children: [
                /*#__PURE__*/ jsx_runtime_.jsx("div", {
                    style: {
                        fontSize: "14px",
                        marginBottom: "2px"
                    },
                    children: new Intl.NumberFormat("ro-RO", {
                        style: "currency",
                        currency: originalCurrency
                    }).format(amountSigur)
                }),
                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                    style: {
                        fontSize: "11px",
                        color: areaCursLive ? "#27ae60" : "#7f8c8d",
                        fontWeight: "500",
                        display: "flex",
                        alignItems: "center",
                        justifyContent: "flex-end",
                        gap: "4px"
                    },
                    children: [
                        "≈ ",
                        new Intl.NumberFormat("ro-RO", {
                            style: "currency",
                            currency: "RON"
                        }).format(valoareRecalculataRON),
                        areaCursLive && /*#__PURE__*/ jsx_runtime_.jsx("span", {
                            style: {
                                backgroundColor: "#d4edda",
                                color: "#155724",
                                padding: "1px 4px",
                                borderRadius: "3px",
                                fontSize: "9px",
                                fontWeight: "bold"
                            },
                            children: "LIVE"
                        }),
                        loadingCursuri && /*#__PURE__*/ jsx_runtime_.jsx("span", {
                            style: {
                                backgroundColor: "#fff3cd",
                                color: "#856404",
                                padding: "1px 4px",
                                borderRadius: "3px",
                                fontSize: "9px"
                            },
                            children: "⏼"
                        })
                    ]
                }),
                areaCursLive && cursLive.precizie_originala && /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                    style: {
                        fontSize: "10px",
                        color: "#6c757d",
                        marginTop: "1px",
                        fontFamily: "monospace"
                    },
                    children: [
                        "1 ",
                        originalCurrency,
                        " = ",
                        ProiecteTable_formatWithOriginalPrecision(cursLive.curs, cursLive.precizie_originala),
                        " RON"
                    ]
                })
            ]
        });
    };
    const formatCurrency = (amount)=>{
        const amountSigur = ProiecteTable_ensureNumber(amount);
        if (amountSigur === 0 && !amount) return "";
        return new Intl.NumberFormat("ro-RO", {
            style: "currency",
            currency: "RON"
        }).format(amountSigur);
    };
    const getStatusColor = (status)=>{
        switch(status){
            case "Activ":
                return "#27ae60";
            case "Finalizat":
                return "#3498db";
            case "Suspendat":
                return "#f39c12";
            case "Arhivat":
                return "#95a5a6";
            default:
                return "#7f8c8d";
        }
    };
    const getStatusIcon = (status)=>{
        switch(status){
            case "Activ":
                return "\uD83D\uDFE2";
            case "Finalizat":
                return "✅";
            case "Suspendat":
                return "⏸️";
            case "Arhivat":
                return "\uD83D\uDCE6";
            default:
                return "⚪";
        }
    };
    // FIX PRINCIPAL: Calculare total ÎMBUNĂTĂȚITĂ cu validări robuste
    const calculateTotalValue = ()=>{
        let totalProiecte = 0;
        let proiecteCalculate = 0;
        let proiecteIgnorate = 0;
        console.log("Calculare total portofoliu cu validări sigure...");
        proiecte.forEach((p, index)=>{
            try {
                // PRIORITATE 1: valoare_ron din BigQuery (cel mai precis)
                const valoareRonSigura = ProiecteTable_ensureNumber(p.valoare_ron);
                if (valoareRonSigura > 0) {
                    totalProiecte += valoareRonSigura;
                    proiecteCalculate++;
                    console.log(`Proiect ${p.ID_Proiect}: ${valoareRonSigura} RON (din valoare_ron BD)`);
                    return;
                }
                // PRIORITATE 2: Proiecte în RON cu Valoare_Estimata
                const valoareEstimataSigura = ProiecteTable_ensureNumber(p.Valoare_Estimata);
                if (valoareEstimataSigura > 0 && (!p.moneda || p.moneda === "RON")) {
                    totalProiecte += valoareEstimataSigura;
                    proiecteCalculate++;
                    console.log(`Proiect ${p.ID_Proiect}: ${valoareEstimataSigura} RON (direct)`);
                    return;
                }
                // PRIORITATE 3: Proiecte cu valută străină + curs live
                if (valoareEstimataSigura > 0 && p.moneda && p.moneda !== "RON") {
                    const cursLive = cursuriLive[p.moneda];
                    if (cursLive && !cursLive.error && cursLive.curs) {
                        const cursSigur = ProiecteTable_ensureNumber(cursLive.curs, 1);
                        const valoareCalculata = valoareEstimataSigura * cursSigur;
                        totalProiecte += valoareCalculata;
                        proiecteCalculate++;
                        console.log(`Proiect ${p.ID_Proiect}: ${valoareEstimataSigura} ${p.moneda} * ${ProiecteTable_formatWithOriginalPrecision(cursSigur, cursLive.precizie_originala)} = ${ProiecteTable_ensureNumber(valoareCalculata).toFixed(2)} RON (curs live)`);
                        return;
                    }
                    // PRIORITATE 4: Folosește cursul salvat în BD
                    const cursVechi = ProiecteTable_ensureNumber(p.curs_valutar);
                    if (cursVechi > 0) {
                        const valoareCalculata = valoareEstimataSigura * cursVechi;
                        totalProiecte += valoareCalculata;
                        proiecteCalculate++;
                        console.log(`Proiect ${p.ID_Proiect}: ${valoareEstimataSigura} ${p.moneda} * ${cursVechi} = ${ProiecteTable_ensureNumber(valoareCalculata).toFixed(2)} RON (curs BD)`);
                        return;
                    }
                    console.warn(`Proiect ${p.ID_Proiect}: Nu pot calcula valoarea (${valoareEstimataSigura} ${p.moneda}, fără curs valid)`);
                    proiecteIgnorate++;
                    return;
                }
                console.warn(`Proiect ${p.ID_Proiect}: Valoare lipsă sau invalidă`);
                proiecteIgnorate++;
            } catch (error) {
                console.error(`Eroare la calculul proiectului ${p.ID_Proiect}:`, error);
                proiecteIgnorate++;
            }
        });
        const totalSigur = ProiecteTable_ensureNumber(totalProiecte);
        console.log(`Total calculat: ${totalSigur.toFixed(2)} RON din ${proiecteCalculate} proiecte (${proiecteIgnorate} ignorate)`);
        return totalSigur;
    };
    // Loading state - PĂSTRAT identic
    if (loading) {
        return /*#__PURE__*/ jsx_runtime_.jsx("div", {
            style: {
                display: "flex",
                justifyContent: "center",
                alignItems: "center",
                height: "300px",
                fontSize: "16px",
                color: "#7f8c8d",
                background: "rgba(255, 255, 255, 0.8)",
                backdropFilter: "blur(8px)",
                borderRadius: "16px",
                border: "1px solid rgba(255, 255, 255, 0.3)",
                zIndex: 1
            },
            children: "⏼ Se \xeencarcă proiectele..."
        });
    }
    // RENDER principal - PĂSTRAT identic cu funcțiile actualizate
    return /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
        style: {
            zIndex: 1,
            position: "relative"
        },
        children: [
            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                style: {
                    display: "flex",
                    justifyContent: "space-between",
                    alignItems: "center",
                    marginBottom: "1.5rem",
                    padding: "1.5rem",
                    background: "rgba(255, 255, 255, 0.85)",
                    backdropFilter: "blur(8px)",
                    borderRadius: "16px",
                    border: "1px solid rgba(255, 255, 255, 0.3)",
                    boxShadow: "0 4px 16px rgba(0, 0, 0, 0.08)",
                    zIndex: 10
                },
                children: [
                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                        children: [
                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("h3", {
                                style: {
                                    margin: 0,
                                    color: "#2c3e50",
                                    fontSize: "1.4rem",
                                    fontWeight: "600"
                                },
                                children: [
                                    "\uD83D\uDCCB Proiecte găsite: ",
                                    proiecte.length,
                                    subproiecte.length > 0 && ` (+ ${subproiecte.length} subproiecte)`
                                ]
                            }),
                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("p", {
                                style: {
                                    margin: "0.5rem 0 0 0",
                                    fontSize: "14px",
                                    color: "#7f8c8d",
                                    opacity: 0.8
                                },
                                children: [
                                    searchParams && Object.keys(searchParams).length > 0 ? "Rezultate filtrate" : "Toate proiectele și subproiectele",
                                    Object.keys(cursuriLive).length > 0 && /*#__PURE__*/ jsx_runtime_.jsx("span", {
                                        style: {
                                            marginLeft: "10px",
                                            padding: "2px 8px",
                                            backgroundColor: loadingCursuri ? "#fff3cd" : "#d4edda",
                                            color: loadingCursuri ? "#856404" : "#155724",
                                            borderRadius: "12px",
                                            fontSize: "11px",
                                            fontWeight: "bold"
                                        },
                                        children: loadingCursuri ? "⏼ Se actualizează cursuri BNR..." : `💱 ${Object.keys(cursuriLive).length} cursuri BNR LIVE`
                                    }),
                                    /*#__PURE__*/ jsx_runtime_.jsx("br", {}),
                                    /*#__PURE__*/ jsx_runtime_.jsx("span", {
                                        style: {
                                            color: "#27ae60",
                                            fontWeight: "bold",
                                            fontSize: "12px"
                                        },
                                        children: "✅ FIX APLICAT: Eliminare forțare 4 zecimale + Validări sigure pentru .toFixed()"
                                    })
                                ]
                            })
                        ]
                    }),
                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                        style: {
                            display: "flex",
                            gap: "0.75rem"
                        },
                        children: [
                            /*#__PURE__*/ jsx_runtime_.jsx("button", {
                                onClick: ()=>setShowProiectModal(true),
                                style: {
                                    padding: "0.75rem 1.25rem",
                                    background: "linear-gradient(135deg, #27ae60 0%, #2ecc71 100%)",
                                    color: "white",
                                    border: "none",
                                    borderRadius: "12px",
                                    cursor: "pointer",
                                    fontSize: "14px",
                                    fontWeight: "600",
                                    boxShadow: "0 4px 12px rgba(39, 174, 96, 0.4)",
                                    transition: "all 0.3s ease",
                                    zIndex: 11
                                },
                                children: "+ Proiect Nou"
                            }),
                            /*#__PURE__*/ jsx_runtime_.jsx("button", {
                                onClick: handleRefresh,
                                style: {
                                    padding: "0.75rem 1.25rem",
                                    background: "linear-gradient(135deg, #3498db 0%, #5dade2 100%)",
                                    color: "white",
                                    border: "none",
                                    borderRadius: "12px",
                                    cursor: "pointer",
                                    fontSize: "14px",
                                    fontWeight: "600",
                                    boxShadow: "0 4px 12px rgba(52, 152, 219, 0.4)",
                                    transition: "all 0.3s ease",
                                    zIndex: 11
                                },
                                children: "\uD83D\uDD04 Re\xeemprospătează"
                            }),
                            /*#__PURE__*/ jsx_runtime_.jsx("button", {
                                onClick: handleExportExcel,
                                style: {
                                    padding: "0.75rem 1.25rem",
                                    background: "linear-gradient(135deg, #f39c12 0%, #f5b041 100%)",
                                    color: "white",
                                    border: "none",
                                    borderRadius: "12px",
                                    cursor: "pointer",
                                    fontSize: "14px",
                                    fontWeight: "600",
                                    boxShadow: "0 4px 12px rgba(243, 156, 18, 0.4)",
                                    transition: "all 0.3s ease",
                                    zIndex: 11
                                },
                                children: "\uD83D\uDCCA Export Excel"
                            })
                        ]
                    })
                ]
            }),
            proiecte.length === 0 ? /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                style: {
                    textAlign: "center",
                    padding: "3rem",
                    background: "rgba(255, 255, 255, 0.8)",
                    backdropFilter: "blur(8px)",
                    borderRadius: "16px",
                    border: "2px dashed rgba(255, 255, 255, 0.4)",
                    zIndex: 1
                },
                children: [
                    /*#__PURE__*/ jsx_runtime_.jsx("p", {
                        style: {
                            fontSize: "18px",
                            color: "#7f8c8d",
                            margin: 0
                        },
                        children: "\uD83D\uDCCB Nu au fost găsite proiecte"
                    }),
                    /*#__PURE__*/ jsx_runtime_.jsx("p", {
                        style: {
                            fontSize: "14px",
                            color: "#bdc3c7",
                            margin: "0.5rem 0 0 0"
                        },
                        children: "Verifică filtrele aplicate sau adaugă proiecte noi."
                    })
                ]
            }) : /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                style: {
                    background: "rgba(255, 255, 255, 0.85)",
                    backdropFilter: "blur(8px)",
                    borderRadius: "16px",
                    border: "1px solid rgba(255, 255, 255, 0.3)",
                    overflow: "visible",
                    boxShadow: "0 4px 16px rgba(0, 0, 0, 0.08)"
                },
                children: [
                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                        style: {
                            overflowX: "auto",
                            overflowY: "visible"
                        },
                        children: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("table", {
                            style: {
                                width: "100%",
                                borderCollapse: "collapse",
                                fontSize: "14px"
                            },
                            children: [
                                /*#__PURE__*/ jsx_runtime_.jsx("thead", {
                                    children: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("tr", {
                                        style: {
                                            background: "rgba(248, 249, 250, 0.8)",
                                            backdropFilter: "blur(6px)",
                                            borderBottom: "1px solid rgba(0, 0, 0, 0.08)"
                                        },
                                        children: [
                                            /*#__PURE__*/ jsx_runtime_.jsx("th", {
                                                style: {
                                                    padding: "1rem 0.75rem",
                                                    textAlign: "left",
                                                    fontWeight: "600",
                                                    color: "#2c3e50",
                                                    fontSize: "13px",
                                                    textTransform: "uppercase",
                                                    letterSpacing: "0.5px"
                                                },
                                                children: "Proiect / Subproiect"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("th", {
                                                style: {
                                                    padding: "1rem 0.75rem",
                                                    textAlign: "left",
                                                    fontWeight: "600",
                                                    color: "#2c3e50",
                                                    fontSize: "13px",
                                                    textTransform: "uppercase",
                                                    letterSpacing: "0.5px"
                                                },
                                                children: "Client"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("th", {
                                                style: {
                                                    padding: "1rem 0.75rem",
                                                    textAlign: "center",
                                                    fontWeight: "600",
                                                    color: "#2c3e50",
                                                    fontSize: "13px",
                                                    textTransform: "uppercase",
                                                    letterSpacing: "0.5px"
                                                },
                                                children: "Status"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("th", {
                                                style: {
                                                    padding: "1rem 0.75rem",
                                                    textAlign: "center",
                                                    fontWeight: "600",
                                                    color: "#2c3e50",
                                                    fontSize: "13px",
                                                    textTransform: "uppercase",
                                                    letterSpacing: "0.5px"
                                                },
                                                children: "Data \xcenceput"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("th", {
                                                style: {
                                                    padding: "1rem 0.75rem",
                                                    textAlign: "center",
                                                    fontWeight: "600",
                                                    color: "#2c3e50",
                                                    fontSize: "13px",
                                                    textTransform: "uppercase",
                                                    letterSpacing: "0.5px"
                                                },
                                                children: "Data Finalizare"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("th", {
                                                style: {
                                                    padding: "1rem 0.75rem",
                                                    textAlign: "right",
                                                    fontWeight: "600",
                                                    color: "#2c3e50",
                                                    fontSize: "13px",
                                                    textTransform: "uppercase",
                                                    letterSpacing: "0.5px"
                                                },
                                                children: "Valoare Estimată"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("th", {
                                                style: {
                                                    padding: "1rem 0.75rem",
                                                    textAlign: "center",
                                                    fontWeight: "600",
                                                    color: "#2c3e50",
                                                    fontSize: "13px",
                                                    textTransform: "uppercase",
                                                    letterSpacing: "0.5px"
                                                },
                                                children: "Acțiuni"
                                            })
                                        ]
                                    })
                                }),
                                /*#__PURE__*/ jsx_runtime_.jsx("tbody", {
                                    children: proiecte.map((proiect, index)=>{
                                        const subproiecteProiect = getSubproiecteForProject(proiect.ID_Proiect);
                                        const isExpanded = expandedProjects.has(proiect.ID_Proiect);
                                        const hasSubprojects = subproiecteProiect.length > 0;
                                        return /*#__PURE__*/ (0,jsx_runtime_.jsxs)(react_experimental_.Fragment, {
                                            children: [
                                                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("tr", {
                                                    style: {
                                                        borderBottom: "1px solid rgba(0, 0, 0, 0.05)",
                                                        background: index % 2 === 0 ? "rgba(255, 255, 255, 0.5)" : "rgba(248, 249, 250, 0.5)",
                                                        transition: "all 0.3s ease"
                                                    },
                                                    children: [
                                                        /*#__PURE__*/ jsx_runtime_.jsx("td", {
                                                            style: {
                                                                padding: "0.75rem",
                                                                color: "#2c3e50",
                                                                width: "300px",
                                                                minWidth: "250px"
                                                            },
                                                            children: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                style: {
                                                                    display: "flex",
                                                                    alignItems: "flex-start",
                                                                    gap: "0.5rem"
                                                                },
                                                                children: [
                                                                    hasSubprojects && /*#__PURE__*/ jsx_runtime_.jsx("button", {
                                                                        onClick: ()=>toggleProjectExpansion(proiect.ID_Proiect),
                                                                        style: {
                                                                            background: "none",
                                                                            border: "none",
                                                                            cursor: "pointer",
                                                                            padding: "0.25rem",
                                                                            fontSize: "12px",
                                                                            color: "#3498db",
                                                                            borderRadius: "4px"
                                                                        },
                                                                        children: isExpanded ? "\uD83D\uDCC2" : "\uD83D\uDCC1"
                                                                    }),
                                                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                        style: {
                                                                            flex: 1,
                                                                            minWidth: 0
                                                                        },
                                                                        children: [
                                                                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                                style: {
                                                                                    fontFamily: "monospace",
                                                                                    fontWeight: "bold",
                                                                                    fontSize: "12px",
                                                                                    color: "#2c3e50",
                                                                                    marginBottom: "0.25rem"
                                                                                },
                                                                                children: [
                                                                                    "\uD83D\uDDC3️ ",
                                                                                    proiect.ID_Proiect
                                                                                ]
                                                                            }),
                                                                            /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                                                style: {
                                                                                    color: "#2c3e50",
                                                                                    whiteSpace: "normal",
                                                                                    wordBreak: "break-word",
                                                                                    lineHeight: "1.4",
                                                                                    fontSize: "14px",
                                                                                    fontWeight: "500"
                                                                                },
                                                                                children: proiect.Denumire
                                                                            }),
                                                                            hasSubprojects && /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                                style: {
                                                                                    fontSize: "11px",
                                                                                    color: "#3498db",
                                                                                    marginTop: "0.5rem",
                                                                                    padding: "0.25rem 0.5rem",
                                                                                    background: "rgba(52, 152, 219, 0.1)",
                                                                                    borderRadius: "6px",
                                                                                    display: "inline-block"
                                                                                },
                                                                                children: [
                                                                                    "\uD83D\uDCCB ",
                                                                                    subproiecteProiect.length,
                                                                                    " subproiect",
                                                                                    subproiecteProiect.length !== 1 ? "e" : ""
                                                                                ]
                                                                            })
                                                                        ]
                                                                    })
                                                                ]
                                                            })
                                                        }),
                                                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("td", {
                                                            style: {
                                                                padding: "0.75rem",
                                                                color: "#2c3e50"
                                                            },
                                                            children: [
                                                                /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                                    style: {
                                                                        fontWeight: "600",
                                                                        fontSize: "14px"
                                                                    },
                                                                    children: proiect.Client
                                                                }),
                                                                proiect.Responsabil && /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                    style: {
                                                                        fontSize: "12px",
                                                                        color: "#7f8c8d",
                                                                        marginTop: "0.25rem"
                                                                    },
                                                                    children: [
                                                                        "\uD83D\uDC64 ",
                                                                        proiect.Responsabil
                                                                    ]
                                                                })
                                                            ]
                                                        }),
                                                        /*#__PURE__*/ jsx_runtime_.jsx("td", {
                                                            style: {
                                                                padding: "0.75rem",
                                                                textAlign: "center"
                                                            },
                                                            children: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("span", {
                                                                style: {
                                                                    display: "inline-flex",
                                                                    alignItems: "center",
                                                                    gap: "0.5rem",
                                                                    padding: "0.5rem 0.75rem",
                                                                    borderRadius: "16px",
                                                                    fontSize: "12px",
                                                                    fontWeight: "600",
                                                                    color: "white",
                                                                    background: `linear-gradient(135deg, ${getStatusColor(proiect.Status)} 0%, ${getStatusColor(proiect.Status)}dd 100%)`
                                                                },
                                                                children: [
                                                                    getStatusIcon(proiect.Status),
                                                                    " ",
                                                                    proiect.Status
                                                                ]
                                                            })
                                                        }),
                                                        /*#__PURE__*/ jsx_runtime_.jsx("td", {
                                                            style: {
                                                                padding: "0.75rem",
                                                                textAlign: "center",
                                                                fontFamily: "monospace",
                                                                fontSize: "13px",
                                                                fontWeight: "500"
                                                            },
                                                            children: formatDate(proiect.Data_Start)
                                                        }),
                                                        /*#__PURE__*/ jsx_runtime_.jsx("td", {
                                                            style: {
                                                                padding: "0.75rem",
                                                                textAlign: "center",
                                                                fontFamily: "monospace",
                                                                fontSize: "13px",
                                                                fontWeight: "500"
                                                            },
                                                            children: formatDate(proiect.Data_Final)
                                                        }),
                                                        /*#__PURE__*/ jsx_runtime_.jsx("td", {
                                                            style: {
                                                                padding: "0.75rem",
                                                                textAlign: "right"
                                                            },
                                                            children: formatCurrencyWithOriginal(proiect.Valoare_Estimata, proiect.moneda, proiect.valoare_ron, proiect.curs_valutar, false)
                                                        }),
                                                        /*#__PURE__*/ jsx_runtime_.jsx("td", {
                                                            style: {
                                                                padding: "0.75rem",
                                                                textAlign: "center"
                                                            },
                                                            children: /*#__PURE__*/ jsx_runtime_.jsx(ProiectActions, {
                                                                proiect: proiect,
                                                                onRefresh: handleRefresh,
                                                                onShowFacturaModal: handleShowFacturaModal,
                                                                onShowSubproiectModal: handleShowSubproiectModal,
                                                                onShowEditModal: handleShowEditModal,
                                                                onShowContractModal: handleShowContractModal,
                                                                onShowPVModal: handleShowPVModal
                                                            })
                                                        })
                                                    ]
                                                }),
                                                isExpanded && subproiecteProiect.map((subproiect, subIndex)=>/*#__PURE__*/ (0,jsx_runtime_.jsxs)("tr", {
                                                        style: {
                                                            background: "rgba(52, 152, 219, 0.05)",
                                                            borderLeft: "4px solid #3498db",
                                                            borderBottom: "1px solid rgba(52, 152, 219, 0.1)"
                                                        },
                                                        children: [
                                                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("td", {
                                                                style: {
                                                                    padding: "0.5rem 0.75rem",
                                                                    paddingLeft: "3rem",
                                                                    color: "#2c3e50"
                                                                },
                                                                children: [
                                                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                        style: {
                                                                            fontFamily: "monospace",
                                                                            fontWeight: "bold",
                                                                            fontSize: "11px",
                                                                            color: "#3498db",
                                                                            marginBottom: "0.25rem"
                                                                        },
                                                                        children: [
                                                                            "└─ \uD83D\uDCCB ",
                                                                            subproiect.ID_Subproiect
                                                                        ]
                                                                    }),
                                                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                                        style: {
                                                                            color: "#2c3e50",
                                                                            fontStyle: "italic",
                                                                            fontSize: "13px",
                                                                            fontWeight: "500"
                                                                        },
                                                                        children: subproiect.Denumire
                                                                    })
                                                                ]
                                                            }),
                                                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("td", {
                                                                style: {
                                                                    padding: "0.5rem 0.75rem",
                                                                    color: "#2c3e50"
                                                                },
                                                                children: [
                                                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                                        style: {
                                                                            fontSize: "13px",
                                                                            fontWeight: "500"
                                                                        },
                                                                        children: subproiect.Client || proiect.Client
                                                                    }),
                                                                    subproiect.Responsabil && /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                                        style: {
                                                                            fontSize: "11px",
                                                                            color: "#7f8c8d",
                                                                            marginTop: "0.25rem"
                                                                        },
                                                                        children: [
                                                                            "\uD83D\uDC64 ",
                                                                            subproiect.Responsabil
                                                                        ]
                                                                    })
                                                                ]
                                                            }),
                                                            /*#__PURE__*/ jsx_runtime_.jsx("td", {
                                                                style: {
                                                                    padding: "0.5rem 0.75rem",
                                                                    textAlign: "center"
                                                                },
                                                                children: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("span", {
                                                                    style: {
                                                                        display: "inline-flex",
                                                                        alignItems: "center",
                                                                        gap: "0.25rem",
                                                                        padding: "0.3rem 0.6rem",
                                                                        borderRadius: "12px",
                                                                        fontSize: "11px",
                                                                        fontWeight: "600",
                                                                        color: "white",
                                                                        background: `linear-gradient(135deg, ${getStatusColor(subproiect.Status)} 0%, ${getStatusColor(subproiect.Status)}dd 100%)`
                                                                    },
                                                                    children: [
                                                                        getStatusIcon(subproiect.Status),
                                                                        " ",
                                                                        subproiect.Status
                                                                    ]
                                                                })
                                                            }),
                                                            /*#__PURE__*/ jsx_runtime_.jsx("td", {
                                                                style: {
                                                                    padding: "0.5rem 0.75rem",
                                                                    textAlign: "center",
                                                                    fontFamily: "monospace",
                                                                    fontSize: "12px"
                                                                },
                                                                children: formatDate(subproiect.Data_Start)
                                                            }),
                                                            /*#__PURE__*/ jsx_runtime_.jsx("td", {
                                                                style: {
                                                                    padding: "0.5rem 0.75rem",
                                                                    textAlign: "center",
                                                                    fontFamily: "monospace",
                                                                    fontSize: "12px"
                                                                },
                                                                children: formatDate(subproiect.Data_Final)
                                                            }),
                                                            /*#__PURE__*/ jsx_runtime_.jsx("td", {
                                                                style: {
                                                                    padding: "0.5rem 0.75rem",
                                                                    textAlign: "right"
                                                                },
                                                                children: formatCurrencyWithOriginal(subproiect.Valoare_Estimata, subproiect.moneda, subproiect.valoare_ron, subproiect.curs_valutar, true)
                                                            }),
                                                            /*#__PURE__*/ jsx_runtime_.jsx("td", {
                                                                style: {
                                                                    padding: "0.5rem 0.75rem",
                                                                    textAlign: "center"
                                                                },
                                                                children: /*#__PURE__*/ jsx_runtime_.jsx(ProiectActions, {
                                                                    proiect: {
                                                                        ID_Proiect: subproiect.ID_Subproiect,
                                                                        Denumire: subproiect.Denumire,
                                                                        Client: subproiect.Client || proiect.Client,
                                                                        Status: subproiect.Status,
                                                                        Valoare_Estimata: subproiect.Valoare_Estimata,
                                                                        Data_Start: subproiect.Data_Start,
                                                                        Data_Final: subproiect.Data_Final,
                                                                        tip: "subproiect",
                                                                        Responsabil: subproiect.Responsabil,
                                                                        moneda: subproiect.moneda,
                                                                        valoare_ron: subproiect.valoare_ron,
                                                                        curs_valutar: subproiect.curs_valutar,
                                                                        data_curs_valutar: subproiect.data_curs_valutar,
                                                                        status_predare: subproiect.status_predare,
                                                                        status_contract: subproiect.status_contract,
                                                                        status_facturare: subproiect.status_facturare,
                                                                        status_achitare: subproiect.status_achitare,
                                                                        Adresa: undefined,
                                                                        Descriere: undefined,
                                                                        Observatii: undefined
                                                                    },
                                                                    onRefresh: handleRefresh,
                                                                    onShowFacturaModal: handleShowFacturaModal,
                                                                    onShowSubproiectModal: handleShowSubproiectModal,
                                                                    onShowEditModal: handleShowEditModal,
                                                                    onShowContractModal: handleShowContractModal,
                                                                    onShowPVModal: handleShowPVModal
                                                                })
                                                            })
                                                        ]
                                                    }, subproiect.ID_Subproiect))
                                            ]
                                        }, proiect.ID_Proiect);
                                    })
                                })
                            ]
                        })
                    }),
                    proiecte.length > 0 && /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                        style: {
                            padding: "1.5rem",
                            borderTop: "1px solid rgba(0, 0, 0, 0.08)",
                            background: "rgba(248, 249, 250, 0.8)",
                            backdropFilter: "blur(6px)",
                            display: "grid",
                            gridTemplateColumns: "repeat(auto-fit, minmax(200px, 1fr))",
                            gap: "1rem",
                            textAlign: "center",
                            zIndex: 1
                        },
                        children: [
                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                style: {
                                    background: "rgba(255, 255, 255, 0.7)",
                                    padding: "1rem",
                                    borderRadius: "12px",
                                    border: "1px solid rgba(255, 255, 255, 0.3)",
                                    boxShadow: "0 4px 12px rgba(0, 0, 0, 0.05)"
                                },
                                children: [
                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                        style: {
                                            fontSize: "12px",
                                            color: "#7f8c8d",
                                            fontWeight: "500",
                                            textTransform: "uppercase",
                                            letterSpacing: "0.5px"
                                        },
                                        children: "Total Proiecte"
                                    }),
                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                        style: {
                                            fontSize: "20px",
                                            fontWeight: "700",
                                            color: "#2c3e50",
                                            marginTop: "0.25rem"
                                        },
                                        children: proiecte.length
                                    })
                                ]
                            }),
                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                style: {
                                    background: "rgba(255, 255, 255, 0.7)",
                                    padding: "1rem",
                                    borderRadius: "12px",
                                    border: "1px solid rgba(255, 255, 255, 0.3)",
                                    boxShadow: "0 4px 12px rgba(0, 0, 0, 0.05)"
                                },
                                children: [
                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                        style: {
                                            fontSize: "12px",
                                            color: "#7f8c8d",
                                            fontWeight: "500",
                                            textTransform: "uppercase",
                                            letterSpacing: "0.5px"
                                        },
                                        children: "Total Subproiecte"
                                    }),
                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                        style: {
                                            fontSize: "20px",
                                            fontWeight: "700",
                                            color: "#3498db",
                                            marginTop: "0.25rem"
                                        },
                                        children: subproiecte.length
                                    })
                                ]
                            }),
                            Object.keys(cursuriLive).length > 0 && /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                style: {
                                    background: "linear-gradient(135deg, rgba(52, 152, 219, 0.1) 0%, rgba(93, 173, 226, 0.1) 100%)",
                                    padding: "1rem",
                                    borderRadius: "12px",
                                    border: "1px solid rgba(52, 152, 219, 0.2)",
                                    boxShadow: "0 4px 12px rgba(52, 152, 219, 0.1)"
                                },
                                children: [
                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                        style: {
                                            fontSize: "12px",
                                            color: "#3498db",
                                            fontWeight: "600",
                                            textTransform: "uppercase",
                                            letterSpacing: "0.5px"
                                        },
                                        children: "Cursuri BNR Live"
                                    }),
                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                        style: {
                                            fontSize: "20px",
                                            fontWeight: "700",
                                            color: "#3498db",
                                            marginTop: "0.25rem"
                                        },
                                        children: [
                                            Object.keys(cursuriLive).filter((m)=>!cursuriLive[m].error).length,
                                            "/",
                                            Object.keys(cursuriLive).length
                                        ]
                                    }),
                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                        style: {
                                            fontSize: "10px",
                                            color: "#7f8c8d",
                                            marginTop: "0.25rem",
                                            opacity: 0.8
                                        },
                                        children: "Precizie originală (fără forțare zecimale)"
                                    })
                                ]
                            }),
                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                style: {
                                    background: "linear-gradient(135deg, rgba(39, 174, 96, 0.1) 0%, rgba(46, 204, 113, 0.1) 100%)",
                                    padding: "1rem",
                                    borderRadius: "12px",
                                    border: "1px solid rgba(39, 174, 96, 0.2)",
                                    boxShadow: "0 4px 12px rgba(39, 174, 96, 0.1)",
                                    gridColumn: Object.keys(cursuriLive).length > 0 ? "span 1" : "span 2"
                                },
                                children: [
                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                        style: {
                                            fontSize: "12px",
                                            color: "#27ae60",
                                            fontWeight: "600",
                                            textTransform: "uppercase",
                                            letterSpacing: "0.5px"
                                        },
                                        children: "Valoare Totală Portofoliu"
                                    }),
                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                        style: {
                                            fontSize: "24px",
                                            fontWeight: "700",
                                            color: "#27ae60",
                                            marginTop: "0.25rem"
                                        },
                                        children: formatCurrency(calculateTotalValue())
                                    }),
                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                        style: {
                                            fontSize: "11px",
                                            color: "#7f8c8d",
                                            marginTop: "0.25rem",
                                            opacity: 0.8
                                        },
                                        children: [
                                            "✅ FIX APLICAT: Validări sigure + Precizie originală cursuri",
                                            /*#__PURE__*/ jsx_runtime_.jsx("br", {}),
                                            "(Console log pentru debugging - doar proiecte principale)"
                                        ]
                                    })
                                ]
                            })
                        ]
                    })
                ]
            }),
            showProiectModal && /*#__PURE__*/ jsx_runtime_.jsx("div", {
                style: {
                    zIndex: 50000
                },
                children: /*#__PURE__*/ jsx_runtime_.jsx(ProiectNouModal, {
                    isOpen: showProiectModal,
                    onClose: ()=>setShowProiectModal(false),
                    onProiectAdded: handleRefresh
                })
            }),
            showFacturaModal && selectedProiect && /*#__PURE__*/ jsx_runtime_.jsx("div", {
                style: {
                    zIndex: 50000
                },
                children: /*#__PURE__*/ jsx_runtime_.jsx(FacturaHibridModal/* default */.Z, {
                    proiect: selectedProiect,
                    onClose: handleCloseFacturaModal,
                    onSuccess: handleFacturaSuccess
                })
            }),
            showSubproiectModal && selectedProiect && /*#__PURE__*/ jsx_runtime_.jsx("div", {
                style: {
                    zIndex: 50000
                },
                children: /*#__PURE__*/ jsx_runtime_.jsx(SubproiectModal, {
                    proiectParinte: selectedProiect,
                    isOpen: showSubproiectModal,
                    onClose: handleCloseSubproiectModal,
                    onSuccess: handleSubproiectSuccess
                })
            }),
            showEditModal && selectedProiect && /*#__PURE__*/ jsx_runtime_.jsx("div", {
                style: {
                    zIndex: 50000
                },
                children: /*#__PURE__*/ jsx_runtime_.jsx(ProiectEditModal, {
                    proiect: selectedProiect,
                    isOpen: showEditModal,
                    onClose: handleCloseEditModal,
                    onProiectUpdated: handleEditSuccess,
                    onProiectDeleted: handleEditDelete
                })
            }),
            showContractModal && selectedProiect && /*#__PURE__*/ jsx_runtime_.jsx("div", {
                style: {
                    zIndex: 50000
                },
                children: /*#__PURE__*/ jsx_runtime_.jsx(ContractModal/* default */.Z, {
                    proiect: selectedProiect,
                    isOpen: showContractModal,
                    onClose: handleCloseContractModal,
                    onSuccess: handleContractSuccess
                })
            }),
            showPVModal && selectedProiect && /*#__PURE__*/ jsx_runtime_.jsx("div", {
                style: {
                    zIndex: 50000
                },
                children: /*#__PURE__*/ jsx_runtime_.jsx(ProcesVerbalModal/* default */.Z, {
                    proiect: selectedProiect,
                    isOpen: showPVModal,
                    onClose: handleClosePVModal,
                    onSuccess: handlePVSuccess
                })
            })
        ]
    });
}

;// CONCATENATED MODULE: ./app/admin/rapoarte/proiecte/page.tsx
// ==================================================================
// CALEA: app/admin/rapoarte/proiecte/page.tsx
// MODIFICAT: Z-index Management Universal + Backdrop Intensity Control
// ==================================================================
/* __next_internal_client_entry_do_not_use__ default auto */ 









function ProiectePage() {
    const router = (0,navigation.useRouter)();
    const searchParams = (0,navigation.useSearchParams)();
    const [user, loading] = (0,index_cjs/* useAuthState */.F_)(firebaseConfig/* auth */.I);
    const [showProiectModal, setShowProiectModal] = (0,react_experimental_.useState)(false);
    const [displayName, setDisplayName] = (0,react_experimental_.useState)("Utilizator");
    const [userRole, setUserRole] = (0,react_experimental_.useState)("user");
    // Inițializează filtrele din URL
    const [filters, setFilters] = (0,react_experimental_.useState)({
        search: searchParams?.get("search") || "",
        status: searchParams?.get("status") || "",
        client: searchParams?.get("client") || "",
        data_start_start: searchParams?.get("data_start_start") || "",
        data_start_end: searchParams?.get("data_start_end") || "",
        valoare_min: searchParams?.get("valoare_min") || "",
        valoare_max: searchParams?.get("valoare_max") || ""
    });
    // Convertește filtrele în searchParams pentru ProiecteTable
    const tableSearchParams = Object.fromEntries(Object.entries(filters).filter(([_, value])=>value !== ""));
    const handleFilterChange = (newFilters)=>{
        setFilters(newFilters);
        // Actualizează URL-ul cu noile filtre
        const params = new URLSearchParams();
        Object.entries(newFilters).forEach(([key, value])=>{
            if (value) {
                params.set(key, value);
            }
        });
        const newUrl = params.toString() ? `/admin/rapoarte/proiecte?${params.toString()}` : "/admin/rapoarte/proiecte";
        router.push(newUrl);
    };
    const handleFilterReset = ()=>{
        const emptyFilters = {
            search: "",
            status: "",
            client: "",
            data_start_start: "",
            data_start_end: "",
            valoare_min: "",
            valoare_max: ""
        };
        setFilters(emptyFilters);
        router.push("/admin/rapoarte/proiecte");
    };
    const handleProiectAdded = ()=>{
        // Trigger refresh în ProiecteTable prin schimbarea unui parametru
        window.location.reload();
    };
    // Auth check
    (0,react_experimental_.useEffect)(()=>{
        if (loading) return;
        if (!user) {
            router.push("/login");
            return;
        }
        setDisplayName(localStorage.getItem("displayName") || "Utilizator");
        setUserRole("admin"); // Pentru pagini admin
    }, [
        user,
        loading,
        router
    ]);
    if (loading || !user) {
        return /*#__PURE__*/ jsx_runtime_.jsx("div", {
            children: "Se \xeencarcă..."
        });
    }
    return /*#__PURE__*/ jsx_runtime_.jsx(ModernLayout/* default */.Z, {
        user: user,
        displayName: displayName,
        userRole: userRole,
        children: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
            style: {
                padding: "2rem",
                position: "relative",
                zIndex: 1
            },
            className: "jsx-b9d82393daaeb258",
            children: [
                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                    style: {
                        display: "flex",
                        justifyContent: "space-between",
                        alignItems: "center",
                        marginBottom: "2rem",
                        padding: "2rem",
                        background: "rgba(255, 255, 255, 0.9)",
                        // ✅ Backdrop-filter redus dramatic pentru a elimina shadow effects
                        backdropFilter: "blur(4px)",
                        borderRadius: "20px",
                        border: "1px solid rgba(255, 255, 255, 0.3)",
                        boxShadow: "0 4px 16px rgba(0, 0, 0, 0.08)",
                        // ✅ Z-index specific pentru header
                        position: "relative",
                        zIndex: 10
                    },
                    className: "jsx-b9d82393daaeb258",
                    children: [
                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                            className: "jsx-b9d82393daaeb258",
                            children: [
                                /*#__PURE__*/ jsx_runtime_.jsx("h1", {
                                    style: {
                                        margin: 0,
                                        color: "#2c3e50",
                                        fontSize: "2.5rem",
                                        fontWeight: "700",
                                        background: "linear-gradient(135deg, #2c3e50 0%, #4a6741 100%)",
                                        backgroundClip: "text",
                                        WebkitBackgroundClip: "text",
                                        WebkitTextFillColor: "transparent"
                                    },
                                    className: "jsx-b9d82393daaeb258",
                                    children: "\uD83D\uDCCB Management Proiecte"
                                }),
                                /*#__PURE__*/ jsx_runtime_.jsx("p", {
                                    style: {
                                        margin: "0.75rem 0 0 0",
                                        color: "#7f8c8d",
                                        fontSize: "1.1rem",
                                        fontWeight: "500"
                                    },
                                    className: "jsx-b9d82393daaeb258",
                                    children: "Gestionează și monitorizează toate proiectele din portofoliu"
                                })
                            ]
                        }),
                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("button", {
                            onClick: ()=>setShowProiectModal(true),
                            style: {
                                padding: "1rem 2rem",
                                background: "linear-gradient(135deg, #27ae60 0%, #2ecc71 100%)",
                                color: "white",
                                border: "none",
                                borderRadius: "16px",
                                cursor: "pointer",
                                fontSize: "16px",
                                fontWeight: "700",
                                boxShadow: "0 4px 12px rgba(39, 174, 96, 0.3)",
                                transition: "all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",
                                position: "relative",
                                overflow: "hidden",
                                // ✅ Z-index pentru buton
                                zIndex: 11
                            },
                            onMouseOver: (e)=>{
                                e.currentTarget.style.transform = "translateY(-2px) scale(1.02)";
                                e.currentTarget.style.boxShadow = "0 6px 20px rgba(39, 174, 96, 0.4)";
                            },
                            onMouseOut: (e)=>{
                                e.currentTarget.style.transform = "translateY(0) scale(1)";
                                e.currentTarget.style.boxShadow = "0 4px 12px rgba(39, 174, 96, 0.3)";
                            },
                            className: "jsx-b9d82393daaeb258",
                            children: [
                                /*#__PURE__*/ jsx_runtime_.jsx("span", {
                                    style: {
                                        position: "relative",
                                        zIndex: 1
                                    },
                                    className: "jsx-b9d82393daaeb258",
                                    children: "+ Proiect Nou"
                                }),
                                /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                    style: {
                                        position: "absolute",
                                        top: 0,
                                        left: "-100%",
                                        width: "100%",
                                        height: "100%",
                                        background: "linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent)",
                                        transition: "left 0.5s ease"
                                    },
                                    className: "jsx-b9d82393daaeb258"
                                })
                            ]
                        })
                    ]
                }),
                /*#__PURE__*/ jsx_runtime_.jsx("div", {
                    style: {
                        marginBottom: "2rem",
                        background: "rgba(255, 255, 255, 0.9)",
                        // ✅ Backdrop-filter redus dramatic
                        backdropFilter: "blur(4px)",
                        border: "1px solid rgba(255, 255, 255, 0.3)",
                        borderRadius: "20px",
                        padding: "2rem",
                        boxShadow: "0 4px 16px rgba(0, 0, 0, 0.08)",
                        // ✅ Z-index pentru filtre
                        position: "relative",
                        zIndex: 10
                    },
                    className: "jsx-b9d82393daaeb258",
                    children: /*#__PURE__*/ jsx_runtime_.jsx(react_experimental_.Suspense, {
                        fallback: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                            style: {
                                padding: "3rem",
                                textAlign: "center",
                                color: "#7f8c8d",
                                display: "flex",
                                alignItems: "center",
                                justifyContent: "center",
                                gap: "1rem"
                            },
                            className: "jsx-b9d82393daaeb258",
                            children: [
                                /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                    style: {
                                        width: "24px",
                                        height: "24px",
                                        borderRadius: "50%",
                                        border: "3px solid #3498db",
                                        borderTop: "3px solid transparent",
                                        animation: "spin 1s linear infinite"
                                    },
                                    className: "jsx-b9d82393daaeb258"
                                }),
                                /*#__PURE__*/ jsx_runtime_.jsx("span", {
                                    style: {
                                        fontSize: "16px",
                                        fontWeight: "500"
                                    },
                                    className: "jsx-b9d82393daaeb258",
                                    children: "⏳ Se \xeencarcă filtrele..."
                                }),
                                /*#__PURE__*/ jsx_runtime_.jsx("style", {
                                    children: `
                  @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                  }
                `
                                })
                            ]
                        }),
                        children: /*#__PURE__*/ jsx_runtime_.jsx(ProiectFilters, {
                            values: filters,
                            onChange: handleFilterChange,
                            onReset: handleFilterReset
                        })
                    })
                }),
                /*#__PURE__*/ jsx_runtime_.jsx("div", {
                    style: {
                        background: "rgba(255, 255, 255, 0.9)",
                        // ✅ Backdrop-filter redus dramatic
                        backdropFilter: "blur(4px)",
                        border: "1px solid rgba(255, 255, 255, 0.3)",
                        borderRadius: "20px",
                        overflow: "hidden",
                        boxShadow: "0 4px 16px rgba(0, 0, 0, 0.08)",
                        marginBottom: "2rem",
                        // ✅ Z-index pentru tabel
                        position: "relative",
                        zIndex: 10
                    },
                    className: "jsx-b9d82393daaeb258",
                    children: /*#__PURE__*/ jsx_runtime_.jsx(react_experimental_.Suspense, {
                        fallback: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                            style: {
                                padding: "4rem",
                                textAlign: "center",
                                color: "#7f8c8d",
                                display: "flex",
                                alignItems: "center",
                                justifyContent: "center",
                                gap: "1rem"
                            },
                            className: "jsx-b9d82393daaeb258",
                            children: [
                                /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                    style: {
                                        width: "32px",
                                        height: "32px",
                                        borderRadius: "50%",
                                        border: "4px solid #3498db",
                                        borderTop: "4px solid transparent",
                                        animation: "spin 1s linear infinite"
                                    },
                                    className: "jsx-b9d82393daaeb258"
                                }),
                                /*#__PURE__*/ jsx_runtime_.jsx("span", {
                                    style: {
                                        fontSize: "18px",
                                        fontWeight: "500"
                                    },
                                    className: "jsx-b9d82393daaeb258",
                                    children: "⏳ Se \xeencarcă proiectele..."
                                })
                            ]
                        }),
                        children: /*#__PURE__*/ jsx_runtime_.jsx(ProiecteTable, {
                            searchParams: tableSearchParams
                        })
                    })
                }),
                /*#__PURE__*/ jsx_runtime_.jsx("div", {
                    style: {
                        padding: "1.5rem",
                        background: "rgba(255, 255, 255, 0.85)",
                        // ✅ Backdrop-filter redus dramatic
                        backdropFilter: "blur(3px)",
                        borderRadius: "16px",
                        border: "1px solid rgba(255, 255, 255, 0.4)",
                        boxShadow: "0 2px 8px rgba(0, 0, 0, 0.06)",
                        textAlign: "center",
                        // ✅ Z-index pentru footer
                        position: "relative",
                        zIndex: 10
                    },
                    className: "jsx-b9d82393daaeb258",
                    children: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("p", {
                        style: {
                            margin: 0,
                            fontSize: "14px",
                            color: "#6c757d",
                            fontWeight: "500",
                            display: "flex",
                            alignItems: "center",
                            justifyContent: "center",
                            gap: "0.5rem"
                        },
                        className: "jsx-b9d82393daaeb258",
                        children: [
                            "\uD83D\uDCA1 ",
                            /*#__PURE__*/ jsx_runtime_.jsx("strong", {
                                className: "jsx-b9d82393daaeb258",
                                children: "Tip:"
                            }),
                            ' Folosește filtrele pentru a găsi rapid proiectele dorite. Click pe "Acțiuni" pentru a gestiona fiecare proiect individual.'
                        ]
                    })
                }),
                showProiectModal && /*#__PURE__*/ jsx_runtime_.jsx("div", {
                    style: {
                        // ✅ Z-index foarte înalt pentru toate modalele
                        zIndex: 50000,
                        position: "relative"
                    },
                    className: "jsx-b9d82393daaeb258",
                    children: /*#__PURE__*/ jsx_runtime_.jsx(ProiectNouModal, {
                        isOpen: showProiectModal,
                        onClose: ()=>setShowProiectModal(false),
                        onProiectAdded: handleProiectAdded
                    })
                }),
                jsx_runtime_.jsx((style_default()), {
                    id: "b9d82393daaeb258",
                    children: '[data-modal="true"],.modal-overlay,.modal-container,div[style*="position: fixed"]:not([data-background]){z-index:50000!important}[data-dropdown="true"],.dropdown-menu,.actions-dropdown,div[style*="position: absolute"][style*="background"]:not([data-background]){z-index:40000!important}.toast,.notification,[data-toast="true"]{z-index:60000!important}.loading-overlay,[data-loading="true"]{z-index:45000!important}.tooltip,[data-tooltip="true"]{z-index:35000!important}.modal-backdrop{z-index:49000!important;background:rgba(0,0,0,.5)!important;-webkit-backdrop-filter:blur(2px)!important;backdrop-filter:blur(2px)!important}.main-content,.page-container,.glassmorphism-container{z-index:1!important;position:relative}.modal-container select,.modal-container input,.modal-container textarea,.modal-container button{z-index:inherit!important}.react-select__menu{z-index:51000!important}.modal-container .dropdown-menu,.modal-container .actions-dropdown{z-index:51000!important}'
                })
            ]
        })
    });
}


/***/ }),

/***/ 84309:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   $$typeof: () => (/* binding */ $$typeof),
/* harmony export */   __esModule: () => (/* binding */ __esModule),
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var next_dist_build_webpack_loaders_next_flight_loader_module_proxy__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(61363);

const proxy = (0,next_dist_build_webpack_loaders_next_flight_loader_module_proxy__WEBPACK_IMPORTED_MODULE_0__.createProxy)(String.raw`/home/teodor/PM1-2025-07-17/unitar-admin/app/admin/rapoarte/proiecte/page.tsx`)

// Accessing the __esModule property and exporting $$typeof are required here.
// The __esModule getter forces the proxy target to create the default export
// and the $$typeof value is for rendering logic to determine if the module
// is a client boundary.
const { __esModule, $$typeof } = proxy;
const __default__ = proxy.default;


/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__default__);

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, [8478,8448,8222,9493,6369,1440,8045,8313,9850,6166,6128,6549,7509,1727,9518,2594], () => (__webpack_exec__(224)));
module.exports = __webpack_exports__;

})();