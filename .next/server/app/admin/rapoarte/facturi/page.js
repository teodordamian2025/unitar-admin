(() => {
var exports = {};
exports.id = 2993;
exports.ids = [2993];
exports.modules = {

/***/ 55752:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/react-dom-experimental/server-rendering-stub");

/***/ }),

/***/ 17640:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/react-experimental");

/***/ }),

/***/ 76931:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/react-experimental/jsx-runtime");

/***/ }),

/***/ 67597:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/react-server-dom-webpack-experimental/client");

/***/ }),

/***/ 5868:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/app-render");

/***/ }),

/***/ 41844:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/get-segment-param");

/***/ }),

/***/ 96624:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/future/helpers/interception-routes");

/***/ }),

/***/ 75281:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/future/route-modules/route-module");

/***/ }),

/***/ 57085:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/app-router-context");

/***/ }),

/***/ 20199:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/hash");

/***/ }),

/***/ 39569:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/hooks-client-context");

/***/ }),

/***/ 17160:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router-context");

/***/ }),

/***/ 30893:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/add-path-prefix");

/***/ }),

/***/ 12336:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/format-url");

/***/ }),

/***/ 17887:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/handle-smooth-scroll");

/***/ }),

/***/ 98735:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/is-bot");

/***/ }),

/***/ 60120:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/is-local-url");

/***/ }),

/***/ 68231:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/parse-path");

/***/ }),

/***/ 54614:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/path-has-prefix");

/***/ }),

/***/ 53750:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/remove-trailing-slash");

/***/ }),

/***/ 70982:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/resolve-href");

/***/ }),

/***/ 79618:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/server-inserted-html");

/***/ }),

/***/ 78423:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/utils");

/***/ }),

/***/ 6113:
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ 9523:
/***/ ((module) => {

"use strict";
module.exports = require("dns");

/***/ }),

/***/ 82361:
/***/ ((module) => {

"use strict";
module.exports = require("events");

/***/ }),

/***/ 57147:
/***/ ((module) => {

"use strict";
module.exports = require("fs");

/***/ }),

/***/ 13685:
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ 85158:
/***/ ((module) => {

"use strict";
module.exports = require("http2");

/***/ }),

/***/ 41808:
/***/ ((module) => {

"use strict";
module.exports = require("net");

/***/ }),

/***/ 22037:
/***/ ((module) => {

"use strict";
module.exports = require("os");

/***/ }),

/***/ 71017:
/***/ ((module) => {

"use strict";
module.exports = require("path");

/***/ }),

/***/ 77282:
/***/ ((module) => {

"use strict";
module.exports = require("process");

/***/ }),

/***/ 12781:
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ 24404:
/***/ ((module) => {

"use strict";
module.exports = require("tls");

/***/ }),

/***/ 57310:
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ 73837:
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ }),

/***/ 59796:
/***/ ((module) => {

"use strict";
module.exports = require("zlib");

/***/ }),

/***/ 42244:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   GlobalError: () => (/* reexport default from dynamic */ next_dist_client_components_error_boundary__WEBPACK_IMPORTED_MODULE_2___default.a),
/* harmony export */   __next_app__: () => (/* binding */ __next_app__),
/* harmony export */   originalPathname: () => (/* binding */ originalPathname),
/* harmony export */   pages: () => (/* binding */ pages),
/* harmony export */   routeModule: () => (/* binding */ routeModule),
/* harmony export */   tree: () => (/* binding */ tree)
/* harmony export */ });
/* harmony import */ var next_dist_server_future_route_modules_app_page_module__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(7262);
/* harmony import */ var next_dist_server_future_route_modules_app_page_module__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_page_module__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(19513);
/* harmony import */ var next_dist_client_components_error_boundary__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(31823);
/* harmony import */ var next_dist_client_components_error_boundary__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_client_components_error_boundary__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var next_dist_server_app_render_entry_base__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(12502);
/* harmony import */ var next_dist_server_app_render_entry_base__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_app_render_entry_base__WEBPACK_IMPORTED_MODULE_3__);
/* harmony reexport (unknown) */ var __WEBPACK_REEXPORT_OBJECT__ = {};
/* harmony reexport (unknown) */ for(const __WEBPACK_IMPORT_KEY__ in next_dist_server_app_render_entry_base__WEBPACK_IMPORTED_MODULE_3__) if(["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(__WEBPACK_IMPORT_KEY__) < 0) __WEBPACK_REEXPORT_OBJECT__[__WEBPACK_IMPORT_KEY__] = () => next_dist_server_app_render_entry_base__WEBPACK_IMPORTED_MODULE_3__[__WEBPACK_IMPORT_KEY__]
/* harmony reexport (unknown) */ __webpack_require__.d(__webpack_exports__, __WEBPACK_REEXPORT_OBJECT__);
// @ts-ignore this need to be imported from next/dist to be external


const AppPageRouteModule = next_dist_server_future_route_modules_app_page_module__WEBPACK_IMPORTED_MODULE_0__.AppPageRouteModule;
// We inject the tree and pages here so that we can use them in the route
// module.
const tree = {
        children: [
        '',
        {
        children: [
        'admin',
        {
        children: [
        'rapoarte',
        {
        children: [
        'facturi',
        {
        children: ['__PAGE__', {}, {
          page: [() => Promise.resolve(/* import() eager */).then(__webpack_require__.bind(__webpack_require__, 89601)), "/home/teodor/PM1-2025-07-17/unitar-admin/app/admin/rapoarte/facturi/page.tsx"],
          
        }]
      },
        {
        
        
      }
      ]
      },
        {
        'layout': [() => Promise.resolve(/* import() eager */).then(__webpack_require__.bind(__webpack_require__, 61705)), "/home/teodor/PM1-2025-07-17/unitar-admin/app/admin/rapoarte/layout.tsx"],
        
      }
      ]
      },
        {
        'layout': [() => Promise.resolve(/* import() eager */).then(__webpack_require__.bind(__webpack_require__, 85093)), "/home/teodor/PM1-2025-07-17/unitar-admin/app/admin/layout.tsx"],
        
      }
      ]
      },
        {
        'layout': [() => Promise.resolve(/* import() eager */).then(__webpack_require__.bind(__webpack_require__, 51921)), "/home/teodor/PM1-2025-07-17/unitar-admin/app/layout.tsx"],
'not-found': [() => Promise.resolve(/* import() eager */).then(__webpack_require__.t.bind(__webpack_require__, 95493, 23)), "next/dist/client/components/not-found-error"],
        
      }
      ]
      }.children;
const pages = ["/home/teodor/PM1-2025-07-17/unitar-admin/app/admin/rapoarte/facturi/page.tsx"];

// @ts-expect-error - replaced by webpack/turbopack loader

const __next_app_require__ = __webpack_require__
const __next_app_load_chunk__ = () => Promise.resolve()
const originalPathname = "/admin/rapoarte/facturi/page";
const __next_app__ = {
    require: __next_app_require__,
    loadChunk: __next_app_load_chunk__
};

// Create and export the route module that will be consumed.
const routeModule = new AppPageRouteModule({
    definition: {
        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_PAGE,
        page: "/admin/rapoarte/facturi/page",
        pathname: "/admin/rapoarte/facturi",
        // The following aren't used in production.
        bundlePath: "",
        filename: "",
        appPaths: []
    },
    userland: {
        loaderTree: tree
    }
});

//# sourceMappingURL=app-page.js.map

/***/ }),

/***/ 29861:
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

Promise.resolve(/* import() eager */).then(__webpack_require__.bind(__webpack_require__, 18470))

/***/ }),

/***/ 18470:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__);

// EXPORTS
__webpack_require__.d(__webpack_exports__, {
  "default": () => (/* binding */ FacturiPage)
});

// EXTERNAL MODULE: external "next/dist/compiled/react-experimental/jsx-runtime"
var jsx_runtime_ = __webpack_require__(76931);
// EXTERNAL MODULE: ./node_modules/styled-jsx/style.js
var style = __webpack_require__(86369);
var style_default = /*#__PURE__*/__webpack_require__.n(style);
// EXTERNAL MODULE: external "next/dist/compiled/react-experimental"
var react_experimental_ = __webpack_require__(17640);
var react_experimental_default = /*#__PURE__*/__webpack_require__.n(react_experimental_);
// EXTERNAL MODULE: ./node_modules/react-firebase-hooks/auth/dist/index.cjs.js
var index_cjs = __webpack_require__(75792);
// EXTERNAL MODULE: ./lib/firebaseConfig.ts
var firebaseConfig = __webpack_require__(79850);
// EXTERNAL MODULE: ./node_modules/next/navigation.js
var navigation = __webpack_require__(57114);
// EXTERNAL MODULE: ./app/components/ModernLayout.tsx
var ModernLayout = __webpack_require__(56128);
// EXTERNAL MODULE: external "next/dist/compiled/react-dom-experimental/server-rendering-stub"
var server_rendering_stub_ = __webpack_require__(55752);
// EXTERNAL MODULE: ./node_modules/lucide-react/dist/esm/icons/download.js
var download = __webpack_require__(85574);
// EXTERNAL MODULE: ./node_modules/lucide-react/dist/esm/icons/rotate-ccw.js
var rotate_ccw = __webpack_require__(71063);
// EXTERNAL MODULE: ./node_modules/lucide-react/dist/esm/icons/refresh-cw.js
var refresh_cw = __webpack_require__(20644);
// EXTERNAL MODULE: ./node_modules/lucide-react/dist/esm/icons/chevron-down.js
var chevron_down = __webpack_require__(19458);
// EXTERNAL MODULE: ./node_modules/lucide-react/dist/esm/icons/file-text.js
var file_text = __webpack_require__(39546);
// EXTERNAL MODULE: ./node_modules/lucide-react/dist/esm/icons/send.js
var send = __webpack_require__(28089);
// EXTERNAL MODULE: ./node_modules/lucide-react/dist/esm/icons/circle-alert.js
var circle_alert = __webpack_require__(43917);
// EXTERNAL MODULE: ./node_modules/lucide-react/dist/esm/icons/circle-check-big.js
var circle_check_big = __webpack_require__(96253);
// EXTERNAL MODULE: ./node_modules/lucide-react/dist/esm/icons/clock.js
var clock = __webpack_require__(15441);
// EXTERNAL MODULE: ./node_modules/lucide-react/dist/esm/icons/circle-x.js
var circle_x = __webpack_require__(34706);
// EXTERNAL MODULE: ./app/admin/rapoarte/proiecte/components/FacturaHibridModal.tsx
var FacturaHibridModal = __webpack_require__(11727);
;// CONCATENATED MODULE: ./app/admin/rapoarte/proiecte/components/EditFacturaModal.tsx
// ==================================================================
// CALEA: app/admin/rapoarte/proiecte/components/EditFacturaModal.tsx
// DATA: 11.09.2025 20:15 (ora României)
// MODIFICAT: Centrare cu createPortal + etape contracte în loc de subproiecte
// PĂSTRATE: TOATE funcționalitățile existente (Edit/Storno, cursuri BNR, ANAF)
// ==================================================================
/* __next_internal_client_entry_do_not_use__ default auto */ 








// Toast system cu Z-index compatibil cu modalele externe
const showToast = (message, type = "info")=>{
    const toastEl = document.createElement("div");
    toastEl.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(12px);
    color: ${type === "success" ? "#27ae60" : type === "error" ? "#e74c3c" : "#3498db"};
    padding: 16px 20px;
    border-radius: 16px;
    z-index: 100000;
    font-family: 'Inter', Arial, sans-serif;
    font-size: 14px;
    font-weight: 500;
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    border: 1px solid rgba(255, 255, 255, 0.2);
    max-width: 400px;
    word-wrap: break-word;
    white-space: pre-line;
    transform: translateY(-10px);
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  `;
    toastEl.textContent = message;
    document.body.appendChild(toastEl);
    setTimeout(()=>{
        toastEl.style.transform = "translateY(0)";
        toastEl.style.opacity = "1";
    }, 10);
    setTimeout(()=>{
        toastEl.style.transform = "translateY(-10px)";
        toastEl.style.opacity = "0";
        setTimeout(()=>{
            if (document.body.contains(toastEl)) {
                document.body.removeChild(toastEl);
            }
        }, 300);
    }, type === "success" ? 4000 : type === "error" ? 5000 : type === "info" && message.length > 200 ? 10000 : 6000);
};
function EditFacturaModal({ factura, isOpen, onClose, onSuccess, mode = "edit" }) {
    const [proiectData, setProiectData] = (0,react_experimental_.useState)(null);
    const [loading, setLoading] = (0,react_experimental_.useState)(true);
    const [debugInfo, setDebugInfo] = (0,react_experimental_.useState)([]);
    // Helper functions pentru BigQuery NUMERIC (adaptate din FacturaHibridModal)
    const convertBigQueryNumeric = (value)=>{
        if (value === null || value === undefined) return 0;
        if (typeof value === "object" && value.value !== undefined) {
            return parseFloat(value.value.toString()) || 0;
        }
        if (typeof value === "string") {
            return parseFloat(value) || 0;
        }
        if (typeof value === "number") {
            return value;
        }
        return 0;
    };
    const formatDate = (date)=>{
        if (!date) return "";
        const dateValue = typeof date === "string" ? date : date.value;
        try {
            return new Date(dateValue).toLocaleDateString("ro-RO");
        } catch  {
            return "";
        }
    };
    // Funcție helper pentru log cu encoding corect
    const addDebugLog = (message)=>{
        console.log(`DEBUG: ${message}`);
        setDebugInfo((prev)=>[
                ...prev,
                `${new Date().toISOString().substr(11, 8)}: ${message}`
            ]);
    };
    // NOUĂ: Funcție pentru căutarea contractelor și etapelor (adaptată din FacturaHibridModal)
    const findContractAndEtapeForProiect = async (proiectId)=>{
        try {
            addDebugLog(`Căutare contracte și etape pentru proiect: ${proiectId}`);
            // 1. CĂUTARE CONTRACT PRINCIPAL
            const contractResponse = await fetch(`/api/rapoarte/contracte?proiect_id=${encodeURIComponent(proiectId)}`);
            const contractResult = await contractResponse.json();
            let contractData = null;
            if (contractResult.success && contractResult.data && contractResult.data.length > 0) {
                // Prioritizează contractul cu status-ul cel mai avansat
                const contracteSortate = contractResult.data.sort((a, b)=>{
                    const statusOrder = {
                        "Semnat": 3,
                        "Generat": 2,
                        "Draft": 1,
                        "Anulat": 0
                    };
                    return (statusOrder[b.Status] || 0) - (statusOrder[a.Status] || 0);
                });
                contractData = contracteSortate[0];
                if (contractData) {
                    addDebugLog(`Contract găsit: ${contractData.numar_contract} (Status: ${contractData.Status})`);
                }
            }
            if (!contractData) {
                addDebugLog("Nu s-a găsit contract pentru proiect");
                return {
                    etapeContract: [],
                    etapeAnexe: [],
                    contract: null
                };
            }
            // 2. ÎNCĂRCARE ETAPE DIN CONTRACT PRINCIPAL
            const etapeContractResponse = await fetch(`/api/rapoarte/etape-contract?contract_id=${encodeURIComponent(contractData.ID_Contract)}`);
            const etapeContractResult = await etapeContractResponse.json();
            let etapeContract = [];
            if (etapeContractResult.success && etapeContractResult.data) {
                etapeContract = etapeContractResult.data.filter((etapa)=>etapa.status_facturare === "Nefacturat") // Doar etapele nefacturate
                .map((etapa)=>({
                        ID_Etapa: etapa.ID_Etapa,
                        tip: "contract",
                        contract_id: etapa.contract_id,
                        contract_numar: etapa.numar_contract || contractData.numar_contract,
                        contract_data: formatDate(contractData.Data_Semnare) || formatDate(contractData.data_creare),
                        etapa_index: etapa.etapa_index,
                        denumire: etapa.denumire,
                        valoare: convertBigQueryNumeric(etapa.valoare),
                        moneda: etapa.moneda,
                        valoare_ron: convertBigQueryNumeric(etapa.valoare_ron),
                        termen_zile: etapa.termen_zile,
                        subproiect_id: etapa.subproiect_id,
                        subproiect_denumire: etapa.subproiect_denumire,
                        status_facturare: etapa.status_facturare,
                        curs_valutar: convertBigQueryNumeric(etapa.curs_valutar),
                        data_curs_valutar: etapa.data_curs_valutar,
                        procent_din_total: convertBigQueryNumeric(etapa.procent_din_total),
                        observatii: etapa.observatii,
                        adaugat: false
                    }));
            }
            // 3. ÎNCĂRCARE ETAPE DIN ANEXE
            const anexeResponse = await fetch(`/api/rapoarte/anexe-contract?contract_id=${encodeURIComponent(contractData.ID_Contract)}`);
            const anexeResult = await anexeResponse.json();
            let etapeAnexe = [];
            if (anexeResult.success && anexeResult.data) {
                etapeAnexe = anexeResult.data.filter((anexa)=>anexa.status_facturare === "Nefacturat") // Doar etapele nefacturate
                .map((anexa)=>({
                        ID_Anexa: anexa.ID_Anexa,
                        tip: "anexa",
                        contract_id: anexa.contract_id,
                        contract_numar: anexa.numar_contract || contractData.numar_contract,
                        contract_data: formatDate(contractData.Data_Semnare) || formatDate(contractData.data_creare),
                        anexa_numar: anexa.anexa_numar,
                        anexa_data: formatDate(anexa.data_start) || formatDate(anexa.data_creare),
                        etapa_index: anexa.etapa_index,
                        denumire: anexa.denumire,
                        valoare: convertBigQueryNumeric(anexa.valoare),
                        moneda: anexa.moneda,
                        valoare_ron: convertBigQueryNumeric(anexa.valoare_ron),
                        termen_zile: anexa.termen_zile,
                        subproiect_id: anexa.subproiect_id,
                        subproiect_denumire: anexa.subproiect_denumire,
                        status_facturare: anexa.status_facturare,
                        curs_valutar: convertBigQueryNumeric(anexa.curs_valutar),
                        data_curs_valutar: anexa.data_curs_valutar,
                        procent_din_total: convertBigQueryNumeric(anexa.procent_din_total),
                        observatii: anexa.observatii,
                        adaugat: false
                    }));
            }
            addDebugLog(`Găsite: ${etapeContract.length} etape contract + ${etapeAnexe.length} etape anexe`);
            return {
                etapeContract,
                etapeAnexe,
                contract: contractData
            };
        } catch (error) {
            addDebugLog(`EROARE la căutarea etapelor: ${error}`);
            console.error("Eroare la căutarea etapelor:", error);
            return {
                etapeContract: [],
                etapeAnexe: [],
                contract: null
            };
        }
    };
    (0,react_experimental_.useEffect)(()=>{
        if (isOpen && factura) {
            addDebugLog(`Deschidere modal ${mode} pentru factura ${factura.numar}`);
            loadFacturaCompleteData();
        }
    }, [
        isOpen,
        factura,
        mode
    ]);
    const loadFacturaCompleteData = async ()=>{
        setLoading(true);
        setDebugInfo([]);
        try {
            addDebugLog(`Încep încărcarea datelor pentru factura ID: ${factura.id}`);
            const proiectIdPrioritar = factura.proiect_id || factura.proiect_id_bigquery || factura.proiectId;
            addDebugLog(`ID-uri proiect disponibile: BigQuery=${factura.proiect_id}, Backup=${factura.proiect_id_bigquery}, Transmis=${factura.proiectId}`);
            addDebugLog(`ID Proiect FINAL selectat: ${proiectIdPrioritar || "NULL"}`);
            let dateComplete = factura.dateComplete || {};
            if (!factura.dateComplete && factura.date_complete_json) {
                try {
                    dateComplete = typeof factura.date_complete_json === "string" ? JSON.parse(factura.date_complete_json) : factura.date_complete_json;
                    addDebugLog(`Date JSON parsate. Chei: ${Object.keys(dateComplete).join(", ")}`);
                } catch (e) {
                    addDebugLog(`EROARE parsare JSON: ${e}`);
                    console.error("Eroare parsare date_complete_json:", e);
                }
            }
            const proiectIdActual = proiectIdPrioritar || "UNKNOWN";
            addDebugLog(`Proiect ID pentru încărcarea datelor: ${proiectIdActual}`);
            console.log("Verificare completă ID proiect - NOUĂ ABORDARE:", {
                proiect_id_din_BigQuery: factura.proiect_id,
                proiect_id_backup: factura.proiect_id_bigquery,
                proiectId_transmis: factura.proiectId,
                din_dateComplete_proiectId: dateComplete.proiectId,
                din_proiectInfo: dateComplete.proiectInfo,
                ID_FINAL_UTILIZAT: proiectIdActual
            });
            if (!proiectIdActual || proiectIdActual === "UNKNOWN") {
                addDebugLog("ATENȚIE: Nu s-a găsit un ID de proiect valid!");
                console.error("ID proiect invalid sau lipsă chiar și din BigQuery");
            }
            // Încarcă date proiect din BD dacă avem ID valid
            let proiectInfo = dateComplete.proiectInfo || {};
            if (proiectIdActual && proiectIdActual !== "UNKNOWN") {
                try {
                    addDebugLog(`Încarcă proiectul ${proiectIdActual} din BD...`);
                    const proiectResponse = await fetch(`/api/rapoarte/proiecte?search=${encodeURIComponent(proiectIdActual)}`);
                    const proiectData = await proiectResponse.json();
                    if (proiectData.success && proiectData.data && proiectData.data.length > 0) {
                        const proiect = proiectData.data.find((p)=>p.ID_Proiect === proiectIdActual || p.ID_Proiect.includes(proiectIdActual)) || proiectData.data[0];
                        if (proiect) {
                            proiectInfo = {
                                ...proiectInfo,
                                id: proiect.ID_Proiect,
                                ID_Proiect: proiect.ID_Proiect,
                                denumire: proiect.Denumire,
                                client: proiect.Client,
                                valoare: proiect.Valoare_Estimata,
                                moneda: proiect.moneda || "RON",
                                curs_valutar: proiect.curs_valutar,
                                valoare_ron: proiect.valoare_ron,
                                status: proiect.Status,
                                adresa: proiect.Adresa
                            };
                            addDebugLog(`Proiect găsit: ${proiect.Denumire}`);
                        }
                    } else {
                        addDebugLog(`Proiectul ${proiectIdActual} nu a fost găsit în BD`);
                    }
                } catch (error) {
                    addDebugLog(`EROARE încărcare proiect: ${error}`);
                    console.error("Eroare la \xeencărcarea datelor proiectului:", error);
                }
            }
            // Pregătește liniile facturii cu TVA 21% implicit
            let liniiFacturaPregatite = dateComplete.liniiFactura || [
                {
                    denumire: proiectInfo.denumire || factura.proiect_denumire || "Servicii",
                    cantitate: 1,
                    pretUnitar: factura.subtotal,
                    cotaTva: factura.total_tva > 0 ? 21 : 0,
                    monedaOriginala: proiectInfo.moneda || "RON",
                    valoareOriginala: proiectInfo.valoare,
                    cursValutar: proiectInfo.curs_valutar || 1
                }
            ];
            // Pentru STORNO, inversează valorile
            if (mode === "storno") {
                addDebugLog("Inversez valorile pentru STORNO");
                liniiFacturaPregatite = liniiFacturaPregatite.map((linie)=>({
                        ...linie,
                        pretUnitar: -Math.abs(linie.pretUnitar || 0),
                        cantitate: Math.abs(linie.cantitate || 1),
                        denumire: linie.denumire.startsWith("STORNO:") ? linie.denumire : `STORNO: ${linie.denumire}`
                    }));
            }
            // MODIFICAT: Încarcă etapele în loc de subproiecte
            let etapeDisponibile = [];
            if (proiectIdActual && proiectIdActual !== "UNKNOWN") {
                try {
                    addDebugLog(`Încarcă etapele pentru proiectul ${proiectIdActual}...`);
                    const { etapeContract, etapeAnexe, contract } = await findContractAndEtapeForProiect(proiectIdActual);
                    // Combină toate etapele disponibile
                    etapeDisponibile = [
                        ...etapeContract,
                        ...etapeAnexe
                    ];
                    addDebugLog(`Găsite ${etapeDisponibile.length} etape disponibile pentru facturare`);
                    // Pentru edit, marchează etapele care sunt deja în factură
                    if (mode === "edit" && dateComplete.liniiFactura) {
                        const etapeInFactura = dateComplete.liniiFactura.filter((l)=>l.tip === "etapa_contract" || l.tip === "etapa_anexa").map((l)=>l.etapa_id || l.anexa_id);
                        if (etapeInFactura.length > 0) {
                            addDebugLog(`Marchează ${etapeInFactura.length} etape ca fiind în factură`);
                            etapeDisponibile = etapeDisponibile.map((etapa)=>{
                                const etapaId = etapa.ID_Etapa || etapa.ID_Anexa;
                                return {
                                    ...etapa,
                                    adaugat: etapeInFactura.includes(etapaId)
                                };
                            });
                        }
                    }
                } catch (error) {
                    addDebugLog(`EROARE încărcare etape: ${error}`);
                    console.error("Eroare la \xeencărcarea etapelor:", error);
                }
            }
            // Standardizare clientInfo cu suport dual denumire/nume
            const clientInfoPregatit = (()=>{
                if (dateComplete.clientInfo) {
                    return {
                        id: dateComplete.clientInfo.id || "",
                        denumire: dateComplete.clientInfo.denumire || dateComplete.clientInfo.nume || factura.client_nume,
                        cui: dateComplete.clientInfo.cui || factura.client_cui,
                        nrRegCom: dateComplete.clientInfo.nrRegCom || dateComplete.clientInfo.nr_reg_com || "",
                        adresa: dateComplete.clientInfo.adresa || "Adresa client",
                        telefon: dateComplete.clientInfo.telefon || "",
                        email: dateComplete.clientInfo.email || ""
                    };
                }
                return {
                    id: "",
                    denumire: factura.client_nume || "Client din factură",
                    cui: factura.client_cui || "",
                    nrRegCom: "",
                    adresa: "Adresa client",
                    telefon: "",
                    email: ""
                };
            })();
            addDebugLog(`Client info pregătit: ${clientInfoPregatit.denumire} (CUI: ${clientInfoPregatit.cui})`);
            // Date finale cu ID proiect corect și etape în loc de subproiecte
            const dateFinale = {
                ID_Proiect: proiectIdActual,
                Denumire: proiectInfo.denumire || factura.proiect_denumire || "Proiect necunoscut",
                Client: clientInfoPregatit.denumire,
                Status: proiectInfo.status || "Activ",
                Valoare_Estimata: proiectInfo.valoare || factura.subtotal,
                moneda: proiectInfo.moneda || "RON",
                curs_valutar: proiectInfo.curs_valutar || 1,
                valoare_ron: proiectInfo.valoare_ron || factura.subtotal,
                Adresa: proiectInfo.adresa,
                // Flags pentru edit/storno
                _isEdit: mode === "edit",
                _isStorno: mode === "storno",
                // Observațiile NU se precompletează, rămân goale
                _initialData: {
                    ...dateComplete,
                    liniiFactura: liniiFacturaPregatite,
                    clientInfo: clientInfoPregatit,
                    observatii: "",
                    numarFactura: mode === "edit" ? factura.numar : null,
                    facturaId: mode === "edit" ? factura.id : null,
                    proiectId: proiectIdActual,
                    proiectInfo: {
                        ...proiectInfo,
                        ID_Proiect: proiectIdActual,
                        id: proiectIdActual
                    },
                    // MODIFICAT: etapeDisponibile în loc de subproiecteDisponibile
                    etapeDisponibile: etapeDisponibile,
                    isEdit: mode === "edit",
                    isStorno: mode === "storno",
                    facturaOriginala: mode === "storno" ? factura.numar : null,
                    cursuriUtilizate: dateComplete.cursuriUtilizate || {},
                    setariFacturare: dateComplete.setariFacturare || null,
                    // NOUĂ: Pentru compatibilitate backwards cu subproiectele
                    subproiecteDisponibile: [],
                    backward_compatibility: {
                        avea_subproiecte: !!(dateComplete.subproiecteDisponibile && dateComplete.subproiecteDisponibile.length > 0),
                        migrat_la_etape: true,
                        numar_etape_disponibile: etapeDisponibile.length
                    }
                }
            };
            addDebugLog(`Date finale pregătite. ID Proiect final: ${dateFinale.ID_Proiect}, Client: ${clientInfoPregatit.denumire}, Etape: ${etapeDisponibile.length}`);
            console.log("Date finale pentru FacturaHibridModal cu etape \xeen loc de subproiecte:", {
                ...dateFinale,
                _initialData: {
                    ...dateFinale._initialData,
                    clientInfo_verify: {
                        denumire: clientInfoPregatit.denumire,
                        cui: clientInfoPregatit.cui,
                        has_id: !!clientInfoPregatit.id
                    },
                    etape_count: etapeDisponibile.length,
                    linii_factura_count: liniiFacturaPregatite.length,
                    sistem_nou_etape: true
                }
            });
            setProiectData(dateFinale);
            setLoading(false);
        } catch (error) {
            addDebugLog(`EROARE GENERALĂ: ${error}`);
            console.error("Eroare la \xeencărcarea datelor complete ale facturii:", error);
            showToast("Eroare la \xeencărcarea datelor facturii", "error");
            setLoading(false);
        }
    };
    // Handler pentru salvare cu API-ul nou de update complet
    const handleFacturaSuccess = async (invoiceId, downloadUrl)=>{
        try {
            console.log("DEBUG: Success handler:", {
                mode,
                invoiceId
            });
            if (mode === "edit") {
                // Pentru Edit, se salvează automat în FacturaHibridModal prin generate-hibrid + /update
                // Nu mai e nevoie de apel separat la /update aici - fix-ul e în FacturaHibridModal
                showToast("Factură actualizată cu succes (cu etape contracte și cursuri BNR precise)", "success");
                onSuccess("updated", factura.id);
            } else if (mode === "storno") {
                console.log("DEBUG: Marchează factura originală ca stornată...");
                // Marchează factura originală ca stornată
                try {
                    const response = await fetch("/api/actions/invoices/update", {
                        method: "PUT",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            facturaId: factura.id,
                            status: "stornata",
                            observatii: `Stornată prin factură ${invoiceId}`
                        })
                    });
                    if (response.ok) {
                        console.log("DEBUG: Factură marcată ca stornată");
                        showToast("Factură de stornare creată cu succes (cu sistem de etape)", "success");
                        onSuccess("reversed", invoiceId);
                    }
                } catch (err) {
                    console.error("Eroare la marcarea ca stornată:", err);
                }
            }
        } catch (error) {
            console.error("Eroare la procesarea facturii:", error);
            showToast(`Eroare: ${error instanceof Error ? error.message : "Eroare necunoscută"}`, "error");
        }
        onClose();
    };
    if (!isOpen) return null;
    if (loading) {
        return  false ? /*#__PURE__*/ 0 : null;
    }
    if (!proiectData) return null;
    return  false ? /*#__PURE__*/ 0 : null;
}

;// CONCATENATED MODULE: ./app/admin/rapoarte/proiecte/components/FacturiList.tsx
// ==================================================================
// CALEA: app/admin/rapoarte/proiecte/components/FacturiList.tsx
// DATA: 17.08.2025 15:30
// FIX COMPLET: Lucide-react icons + Dropdown logic IDENTIC cu ProiectActions
// PĂSTRATE: TOATE funcționalitățile existente
// ==================================================================
/* __next_internal_client_entry_do_not_use__ default auto */ 
















// System global pentru management dropdown-uri multiple - IDENTIC cu ProiectActions
let currentOpenDropdown = null;
const openDropdowns = new Map();
function FacturiList({ proiectId, clientId, showFilters = true, maxHeight = "500px" }) {
    const [facturi, setFacturi] = (0,react_experimental_.useState)([]);
    const [loading, setLoading] = (0,react_experimental_.useState)(true);
    const [error, setError] = (0,react_experimental_.useState)(null);
    const [filters, setFilters] = (0,react_experimental_.useState)({
        status: "",
        search: "",
        scadenta: "",
        perioada: "30"
    });
    const [showCustomPeriod, setShowCustomPeriod] = (0,react_experimental_.useState)(false);
    const [customPeriod, setCustomPeriod] = (0,react_experimental_.useState)({
        dataStart: "",
        dataEnd: ""
    });
    const [processingActions, setProcessingActions] = (0,react_experimental_.useState)({});
    const [eFacturaDetails, setEFacturaDetails] = (0,react_experimental_.useState)({});
    const [showEFacturaModal, setShowEFacturaModal] = (0,react_experimental_.useState)(null);
    const [showEditModal, setShowEditModal] = (0,react_experimental_.useState)(false);
    const [selectedFactura, setSelectedFactura] = (0,react_experimental_.useState)(null);
    const [editMode, setEditMode] = (0,react_experimental_.useState)("edit");
    (0,react_experimental_.useEffect)(()=>{
        loadFacturi();
    }, [
        proiectId,
        clientId,
        filters,
        customPeriod
    ]);
    const loadFacturi = async ()=>{
        setLoading(true);
        setError(null);
        try {
            const params = new URLSearchParams();
            if (proiectId) params.append("proiectId", proiectId);
            if (clientId) params.append("clientId", clientId);
            if (filters.status) params.append("status", filters.status);
            if (filters.perioada === "custom" && customPeriod.dataStart && customPeriod.dataEnd) {
                params.append("dataStart", customPeriod.dataStart);
                params.append("dataEnd", customPeriod.dataEnd);
            } else if (filters.perioada !== "toate") {
                params.append("perioada", filters.perioada);
            }
            const response = await fetch(`/api/actions/invoices/list?${params}`);
            const data = await response.json();
            if (data.success) {
                let result = data.facturi;
                result = result.map((f)=>({
                        ...f,
                        data_factura_formatted: formatDateSafe(f.data_factura),
                        data_scadenta_formatted: formatDateSafe(f.data_scadenta),
                        data_creare_formatted: formatDateSafe(f.data_creare)
                    }));
                if (filters.search) {
                    const searchLower = filters.search.toLowerCase();
                    result = result.filter((f)=>f.numar.toLowerCase().includes(searchLower) || f.client_nume.toLowerCase().includes(searchLower) || f.proiect_denumire.toLowerCase().includes(searchLower));
                }
                if (filters.scadenta) {
                    result = result.filter((f)=>f.status_scadenta === filters.scadenta);
                }
                setFacturi(result);
                await loadEFacturaDetails(result.filter((f)=>f.efactura_enabled));
            } else {
                throw new Error(data.error);
            }
        } catch (err) {
            setError(err instanceof Error ? err.message : "Eroare necunoscuta");
        } finally{
            setLoading(false);
        }
    };
    const loadEFacturaDetails = async (efacturaFacturi)=>{
        const details = {};
        for (const factura of efacturaFacturi){
            try {
                const response = await fetch(`/api/actions/invoices/efactura-details?facturaId=${factura.id}`);
                const data = await response.json();
                if (data.success) {
                    details[factura.id] = {
                        xmlId: data.xmlId,
                        anafStatus: data.status,
                        errorMessage: data.errorMessage,
                        dataUpload: data.dataUpload,
                        dataValidare: data.dataValidare,
                        retryCount: data.retryCount,
                        timeline: data.timeline || []
                    };
                }
            } catch (error) {
                console.warn(`Could not load e-factura details for ${factura.id}:`, error);
            }
        }
        setEFacturaDetails(details);
    };
    const formatDateSafe = (dateInput)=>{
        if (!dateInput) return "N/A";
        try {
            let dateValue;
            if (typeof dateInput === "object" && dateInput.value) {
                dateValue = dateInput.value;
            } else if (typeof dateInput === "string") {
                dateValue = dateInput;
            } else {
                return "Format invalid";
            }
            if (dateValue.includes("T")) {
                return new Date(dateValue).toLocaleDateString("ro-RO");
            } else if (dateValue.includes("-") && dateValue.length === 10) {
                return new Date(dateValue + "T00:00:00").toLocaleDateString("ro-RO");
            } else {
                return new Date(dateValue).toLocaleDateString("ro-RO");
            }
        } catch (error) {
            console.warn("Invalid date format:", dateInput);
            return "Data invalida";
        }
    };
    // Status badge cu Lucide icons
    const getStatusBadge = (factura)=>{
        let displayStatus = "";
        let bgClass = "";
        let textClass = "";
        let IconComponent = file_text/* default */.Z;
        if (factura.efactura_enabled) {
            const eDetails = eFacturaDetails[factura.id];
            const anafStatus = eDetails?.anafStatus || factura.efactura_status;
            switch(anafStatus){
                case "mock_pending":
                case "mock_generated":
                    displayStatus = "Mock Test";
                    bgClass = "bg-purple-100";
                    textClass = "text-purple-800";
                    IconComponent = circle_alert/* default */.Z;
                    break;
                case "draft":
                    displayStatus = "XML Generat";
                    bgClass = "bg-blue-100";
                    textClass = "text-blue-800";
                    IconComponent = file_text/* default */.Z;
                    break;
                case "pending":
                    displayStatus = "ANAF Pending";
                    bgClass = "bg-yellow-100";
                    textClass = "text-yellow-800";
                    IconComponent = clock/* default */.Z;
                    break;
                case "sent":
                    displayStatus = "Trimis la ANAF";
                    bgClass = "bg-indigo-100";
                    textClass = "text-indigo-800";
                    IconComponent = send/* default */.Z;
                    break;
                case "validated":
                    displayStatus = "ANAF Validat";
                    bgClass = "bg-green-100";
                    textClass = "text-green-800";
                    IconComponent = circle_check_big/* default */.Z;
                    break;
                case "error":
                    displayStatus = "Eroare ANAF";
                    bgClass = "bg-red-100";
                    textClass = "text-red-800";
                    IconComponent = circle_x/* default */.Z;
                    break;
                case "stornata":
                    displayStatus = "Stornata";
                    bgClass = "bg-gray-100";
                    textClass = "text-gray-800";
                    IconComponent = rotate_ccw/* default */.Z;
                    break;
                default:
                    displayStatus = "Gata pentru ANAF";
                    bgClass = "bg-orange-100";
                    textClass = "text-orange-800";
                    IconComponent = clock/* default */.Z;
            }
        } else {
            const statusConfig = {
                "pdf_generated": {
                    bg: "bg-gray-100",
                    text: "text-gray-800",
                    label: "PDF Generat",
                    icon: file_text/* default */.Z
                },
                "generata": {
                    bg: "bg-green-100",
                    text: "text-green-800",
                    label: "Generata",
                    icon: file_text/* default */.Z
                },
                "anaf_processing": {
                    bg: "bg-yellow-100",
                    text: "text-yellow-800",
                    label: "ANAF in curs",
                    icon: clock/* default */.Z
                },
                "anaf_success": {
                    bg: "bg-blue-100",
                    text: "text-blue-800",
                    label: "ANAF Succes",
                    icon: circle_check_big/* default */.Z
                },
                "anaf_error": {
                    bg: "bg-red-100",
                    text: "text-red-800",
                    label: "Eroare ANAF",
                    icon: circle_x/* default */.Z
                },
                "stornata": {
                    bg: "bg-gray-100",
                    text: "text-gray-800",
                    label: "Stornata",
                    icon: rotate_ccw/* default */.Z
                }
            };
            const config = statusConfig[factura.status] || {
                bg: "bg-gray-100",
                text: "text-gray-800",
                label: factura.status,
                icon: file_text/* default */.Z
            };
            displayStatus = config.label;
            bgClass = config.bg;
            textClass = config.text;
            IconComponent = config.icon;
        }
        return /*#__PURE__*/ (0,jsx_runtime_.jsxs)("span", {
            className: `px-2 py-1 rounded text-xs font-medium ${bgClass} ${textClass} flex items-center gap-1`,
            title: factura.efactura_enabled ? "Factura cu e-factura ANAF" : "Factura doar PDF",
            children: [
                /*#__PURE__*/ jsx_runtime_.jsx(IconComponent, {
                    size: 12
                }),
                displayStatus
            ]
        });
    };
    // Scadenta badge cu Lucide icons  
    const getScadentaBadge = (statusScadenta, zile)=>{
        const scadentaConfig = {
            "Expirata": {
                bg: "bg-red-100",
                text: "text-red-800",
                icon: circle_x/* default */.Z
            },
            "Expira curand": {
                bg: "bg-orange-100",
                text: "text-orange-800",
                icon: circle_alert/* default */.Z
            },
            "Platita": {
                bg: "bg-green-100",
                text: "text-green-800",
                icon: circle_check_big/* default */.Z
            },
            "In regula": {
                bg: "bg-gray-100",
                text: "text-gray-800",
                icon: clock/* default */.Z
            }
        };
        const config = scadentaConfig[statusScadenta] || {
            bg: "bg-gray-100",
            text: "text-gray-800",
            icon: circle_alert/* default */.Z
        };
        const IconComponent = config.icon;
        return /*#__PURE__*/ (0,jsx_runtime_.jsxs)("span", {
            className: `px-2 py-1 rounded text-xs font-medium ${config.bg} ${config.text} flex items-center gap-1`,
            title: `${zile} zile pana la scadenta`,
            children: [
                /*#__PURE__*/ jsx_runtime_.jsx(IconComponent, {
                    size: 12
                }),
                statusScadenta
            ]
        });
    };
    const getRowBackgroundColor = (index)=>{
        const colorIndex = index % 3;
        switch(colorIndex){
            case 0:
                return "#fefdf8";
            case 1:
                return "#fafafa";
            case 2:
                return "#f8fafc";
            default:
                return "#ffffff";
        }
    };
    const getRowHoverColor = (index)=>{
        const colorIndex = index % 3;
        switch(colorIndex){
            case 0:
                return "#fdf6e3";
            case 1:
                return "#f0f0f0";
            case 2:
                return "#e2e8f0";
            default:
                return "#f9f9f9";
        }
    };
    // PDF processing cu metoda optimizată identică cu FacturaHibridModal
    const handleDownload = async (factura)=>{
        try {
            showToast("Se regenereaza PDF-ul din datele facturii...", "info");
            const response = await fetch("/api/actions/invoices/regenerate-pdf", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    facturaId: factura.id,
                    numar: factura.numar
                })
            });
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            const contentType = response.headers.get("content-type");
            if (contentType && contentType.includes("application/pdf")) {
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.href = url;
                link.download = `Factura_${factura.numar}.pdf`;
                link.target = "_blank";
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                window.URL.revokeObjectURL(url);
                showToast(`Factura ${factura.numar} descarcata cu succes`, "success");
            } else {
                const data = await response.json();
                if (data.success && data.htmlContent) {
                    await processPDFOptimized(data.htmlContent, `Factura_${factura.numar}.pdf`);
                    showToast(`PDF regenerat si descarcat pentru factura ${factura.numar}`, "success");
                } else {
                    throw new Error(data.error || "Nu s-a putut regenera PDF-ul");
                }
            }
        } catch (error) {
            console.error("Error downloading PDF:", error);
            showToast(`Eroare la descarcarea PDF: ${error instanceof Error ? error.message : "Eroare necunoscuta"}`, "error");
        }
    };
    // processPDF OPTIMIZAT identic cu FacturaHibridModal.tsx
    const processPDFOptimized = async (htmlContent, fileName)=>{
        try {
            await loadPDFLibraries();
            const tempDiv = document.createElement("div");
            tempDiv.id = "pdf-content-optimized";
            tempDiv.style.position = "fixed";
            tempDiv.style.left = "0px";
            tempDiv.style.top = "0px";
            tempDiv.style.width = "794px";
            tempDiv.style.height = "1000px";
            tempDiv.style.backgroundColor = "white";
            tempDiv.style.fontFamily = "Arial, sans-serif";
            tempDiv.style.fontSize = "4px";
            tempDiv.style.color = "#333";
            tempDiv.style.lineHeight = "1.0";
            tempDiv.style.padding = "15px";
            tempDiv.style.zIndex = "-1000";
            tempDiv.style.opacity = "1";
            tempDiv.style.transform = "scale(1)";
            tempDiv.style.overflow = "hidden";
            tempDiv.style.boxSizing = "border-box";
            tempDiv.style.display = "flex";
            tempDiv.style.flexDirection = "column";
            tempDiv.style.justifyContent = "space-between";
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(htmlContent, "text/html");
            const styleElement = htmlDoc.querySelector("style");
            const cssRules = styleElement ? styleElement.textContent || "" : "";
            const bodyContent = htmlDoc.body;
            if (bodyContent) {
                tempDiv.innerHTML = bodyContent.innerHTML;
                const globalStyle = document.createElement("style");
                globalStyle.id = "pdf-styles-optimized";
                globalStyle.textContent = cssRules;
                if (!document.getElementById("pdf-styles-optimized")) {
                    document.head.appendChild(globalStyle);
                }
            } else {
                tempDiv.innerHTML = htmlContent;
            }
            document.body.appendChild(tempDiv);
            await new Promise((resolve)=>setTimeout(resolve, 1000));
            const pdf = new window.jsPDF("p", "pt", "a4");
            const pageWidth = pdf.internal.pageSize.getWidth();
            const targetElement = document.getElementById("pdf-content-optimized");
            await pdf.html(targetElement || tempDiv, {
                callback: function(pdf) {
                    document.body.removeChild(tempDiv);
                    const globalStyle = document.getElementById("pdf-styles-optimized");
                    if (globalStyle) {
                        document.head.removeChild(globalStyle);
                    }
                    pdf.save(fileName);
                },
                margin: [
                    10,
                    10,
                    10,
                    10
                ],
                width: pageWidth - 20,
                windowWidth: pageWidth - 20,
                autoPaging: "text",
                html2canvas: {
                    allowTaint: true,
                    dpi: 96,
                    letterRendering: true,
                    logging: false,
                    scale: 0.75,
                    useCORS: true,
                    backgroundColor: "#ffffff",
                    height: 1000,
                    width: pageWidth - 20,
                    scrollX: 0,
                    scrollY: 0,
                    windowWidth: pageWidth - 20,
                    windowHeight: 1000,
                    onclone: (clonedDoc)=>{
                        const clonedElement = clonedDoc.getElementById("pdf-content-optimized");
                        if (clonedElement) {
                            const allElements = clonedElement.querySelectorAll("*");
                            allElements.forEach((el)=>{
                                el.style.fontSize = "3px";
                                el.style.lineHeight = "0.8";
                                el.style.margin = "0.25px";
                                el.style.padding = "0.25px";
                                el.style.marginTop = "0.25px";
                                el.style.marginBottom = "0.25px";
                                el.style.paddingTop = "0.25px";
                                el.style.paddingBottom = "0.25px";
                            });
                            const headers = clonedElement.querySelectorAll("h1, h2, h3, h4, .header h1");
                            headers.forEach((header)=>{
                                header.style.fontSize = "4px";
                                header.style.margin = "0.5px 0";
                                header.style.padding = "0.5px 0";
                                header.style.fontWeight = "bold";
                            });
                            const largeTexts = clonedElement.querySelectorAll(".invoice-number");
                            largeTexts.forEach((text)=>{
                                text.style.fontSize = "6px";
                                text.style.margin = "1px 0";
                                text.style.fontWeight = "bold";
                            });
                            const tables = clonedElement.querySelectorAll("table, th, td");
                            tables.forEach((table)=>{
                                table.style.fontSize = "2.5px";
                                table.style.padding = "0.25px";
                                table.style.margin = "0";
                                table.style.borderSpacing = "0";
                                table.style.borderCollapse = "collapse";
                                table.style.lineHeight = "0.8";
                            });
                            clonedElement.style.fontSize = "3px !important";
                            clonedElement.style.lineHeight = "0.8 !important";
                            clonedElement.style.padding = "5px !important";
                            clonedElement.style.margin = "0 !important";
                        }
                    }
                }
            });
        } catch (error) {
            console.error("PDF processing error:", error);
            showToast(`Eroare la generarea PDF: ${error instanceof Error ? error.message : "Eroare necunoscuta"}`, "error");
        }
    };
    const loadPDFLibraries = ()=>{
        return new Promise((resolve, reject)=>{
            if (window.jsPDF && window.html2canvas) {
                resolve();
                return;
            }
            const jsPDFScript = document.createElement("script");
            jsPDFScript.src = "https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js";
            jsPDFScript.onload = ()=>{
                window.jsPDF = window.jspdf.jsPDF;
                const html2canvasScript = document.createElement("script");
                html2canvasScript.src = "https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js";
                html2canvasScript.onload = ()=>{
                    window.html2canvas = window.html2canvas;
                    resolve();
                };
                html2canvasScript.onerror = reject;
                document.head.appendChild(html2canvasScript);
            };
            jsPDFScript.onerror = reject;
            document.head.appendChild(jsPDFScript);
        });
    };
    // Funcții pentru acțiuni e-factura - păstrate identice
    const handleDownloadXML = async (factura)=>{
        try {
            const response = await fetch(`/api/actions/invoices/generate-xml?facturaId=${factura.id}`);
            const data = await response.json();
            if (data.success && data.xmlContent) {
                const blob = new Blob([
                    data.xmlContent
                ], {
                    type: "application/xml"
                });
                const url = window.URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.href = url;
                link.download = `EFactura_${factura.numar}.xml`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                window.URL.revokeObjectURL(url);
                showToast(`XML descarcat pentru factura ${factura.numar}`, "success");
            } else {
                throw new Error(data.error || "XML nu a fost gasit");
            }
        } catch (error) {
            showToast(`Eroare la descarcarea XML: ${error instanceof Error ? error.message : "Eroare necunoscuta"}`, "error");
        }
    };
    const handleSendToANAF = async (factura)=>{
        if (processingActions[factura.id]) return;
        setProcessingActions((prev)=>({
                ...prev,
                [factura.id]: true
            }));
        try {
            let xmlResponse = await fetch("/api/actions/invoices/generate-xml", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    facturaId: factura.id,
                    forceRegenerate: false
                })
            });
            let xmlData = await xmlResponse.json();
            if (!xmlData.success) {
                throw new Error(xmlData.error || "Failed to generate XML");
            }
            showToast(`XML generat. Se trimite la ANAF...`, "info");
            await new Promise((resolve)=>setTimeout(resolve, 2000));
            showToast(`Factura ${factura.numar} trimisa la ANAF cu succes!`, "success");
            await loadFacturi();
        } catch (error) {
            showToast(`Eroare la trimiterea la ANAF: ${error instanceof Error ? error.message : "Eroare necunoscuta"}`, "error");
        } finally{
            setProcessingActions((prev)=>({
                    ...prev,
                    [factura.id]: false
                }));
        }
    };
    const handleRetryANAF = async (factura)=>{
        if (processingActions[factura.id]) return;
        if (!confirm(`Sigur vrei sa reincerci trimiterea facturii ${factura.numar} la ANAF?`)) {
            return;
        }
        setProcessingActions((prev)=>({
                ...prev,
                [factura.id]: true
            }));
        try {
            showToast(`Se reincearca trimiterea la ANAF...`, "info");
            await new Promise((resolve)=>setTimeout(resolve, 3000));
            showToast(`Retry pentru factura ${factura.numar} a fost trimis la ANAF!`, "success");
            await loadFacturi();
        } catch (error) {
            showToast(`Eroare la retry ANAF: ${error instanceof Error ? error.message : "Eroare necunoscuta"}`, "error");
        } finally{
            setProcessingActions((prev)=>({
                    ...prev,
                    [factura.id]: false
                }));
        }
    };
    const handleEditFactura = (factura, mode = "edit")=>{
        try {
            const proiectIdDinBigQuery = factura.proiect_id;
            let dateComplete = {};
            try {
                if (factura.date_complete_json) {
                    dateComplete = typeof factura.date_complete_json === "string" ? JSON.parse(factura.date_complete_json) : factura.date_complete_json;
                }
            } catch (error) {
                console.warn("Nu s-au putut parsa datele complete JSON:", error);
            }
            const proiectIdFinal = proiectIdDinBigQuery || dateComplete?.proiectId || dateComplete?.proiectInfo?.ID_Proiect || dateComplete?.proiectInfo?.id || "UNKNOWN";
            const facturaCompleta = {
                ...factura,
                dateComplete: dateComplete,
                proiectId: proiectIdFinal,
                proiect_id_bigquery: proiectIdDinBigQuery
            };
            setSelectedFactura(facturaCompleta);
            setEditMode(mode);
            setShowEditModal(true);
        } catch (error) {
            console.error("Eroare la pregatirea datelor pentru editare:", error);
            showToast("Eroare la incarcarea datelor facturii", "error");
            const facturaFallback = {
                ...factura,
                proiectId: factura.proiect_id || "UNKNOWN",
                proiect_id_bigquery: factura.proiect_id
            };
            setSelectedFactura(facturaFallback);
            setEditMode(mode);
            setShowEditModal(true);
        }
    };
    const handleEditSuccess = (action, facturaId)=>{
        setShowEditModal(false);
        setSelectedFactura(null);
        loadFacturi();
        if (action === "updated") {
            showToast("Factura actualizata cu succes", "success");
        } else if (action === "cancelled") {
            showToast("Factura anulata cu succes", "success");
        } else if (action === "reversed") {
            showToast("Factura de stornare creata cu succes", "success");
        }
    };
    const handleDeleteFactura = async (factura)=>{
        if (factura.efactura_enabled && factura.efactura_status && ![
            "draft",
            "error",
            "mock_pending",
            "mock_generated"
        ].includes(factura.efactura_status)) {
            showToast("Factura a fost trimisa la ANAF si nu poate fi stearsa", "error");
            return;
        }
        if (!confirm(`Sigur vrei sa stergi factura ${factura.numar}?\n\nAceasta actiune nu poate fi anulata!`)) {
            return;
        }
        try {
            const response = await fetch(`/api/actions/invoices/delete?id=${factura.id}`, {
                method: "DELETE"
            });
            const result = await response.json();
            if (result.success) {
                showToast(`Factura ${factura.numar} a fost stearsa`, "success");
                loadFacturi();
            } else {
                showToast(`${result.error}`, "error");
            }
        } catch (error) {
            console.error("Eroare la stergerea facturii:", error);
            showToast("Eroare la stergerea facturii", "error");
        }
    };
    const showEFacturaDetailsModal = (factura)=>{
        setShowEFacturaModal(factura.id);
    };
    // Toast system cu Z-index compatibil cu modalele externe - IDENTIC cu ProiectActions
    const showToast = (message, type = "info")=>{
        const toastEl = document.createElement("div");
        toastEl.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(12px);
      color: ${type === "success" ? "#27ae60" : type === "error" ? "#e74c3c" : "#3498db"};
      padding: 16px 20px;
      border-radius: 16px;
      z-index: 70000;
      font-family: 'Inter', Arial, sans-serif;
      font-size: 14px;
      font-weight: 500;
      box-shadow: 0 20px 40px rgba(0,0,0,0.15);
      border: 1px solid rgba(255, 255, 255, 0.2);
      max-width: 400px;
      word-wrap: break-word;
      white-space: pre-line;
      transform: translateY(-10px);
      opacity: 0;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    `;
        toastEl.textContent = message;
        document.body.appendChild(toastEl);
        setTimeout(()=>{
            toastEl.style.transform = "translateY(0)";
            toastEl.style.opacity = "1";
        }, 10);
        setTimeout(()=>{
            toastEl.style.transform = "translateY(-10px)";
            toastEl.style.opacity = "0";
            setTimeout(()=>{
                if (document.body.contains(toastEl)) {
                    document.body.removeChild(toastEl);
                }
            }, 300);
        }, type === "success" ? 4000 : type === "error" ? 5000 : type === "info" && message.length > 200 ? 10000 : 6000);
    };
    const formatCurrency = (amount)=>{
        return new Intl.NumberFormat("ro-RO", {
            style: "currency",
            currency: "RON"
        }).format(amount);
    };
    if (loading) {
        return /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
            className: "flex justify-center items-center p-8",
            children: [
                /*#__PURE__*/ jsx_runtime_.jsx("div", {
                    className: "animate-spin rounded-full h-8 w-8 border-b-2 border-green-500"
                }),
                /*#__PURE__*/ jsx_runtime_.jsx("span", {
                    className: "ml-3",
                    children: "Se incarca facturile..."
                })
            ]
        });
    }
    if (error) {
        return /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
            className: "bg-red-50 border border-red-200 rounded-lg p-4",
            children: [
                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                    className: "text-red-800",
                    children: [
                        /*#__PURE__*/ jsx_runtime_.jsx("strong", {
                            children: "Eroare:"
                        }),
                        " ",
                        error
                    ]
                }),
                /*#__PURE__*/ jsx_runtime_.jsx("button", {
                    onClick: loadFacturi,
                    className: "mt-2 text-red-600 underline hover:text-red-800",
                    children: "Incearca din nou"
                })
            ]
        });
    }
    const currentModalDetails = showEFacturaModal ? eFacturaDetails[showEFacturaModal] : null;
    const currentModalFactura = showEFacturaModal ? facturi.find((f)=>f.id === showEFacturaModal) : null;
    return /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
        className: "bg-white rounded-lg shadow border border-gray-200",
        children: [
            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                className: "px-6 py-4 border-b border-gray-200",
                children: [
                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                        className: "flex items-center justify-between",
                        children: [
                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("h3", {
                                className: "text-lg font-semibold text-gray-800 flex items-center gap-2",
                                children: [
                                    "Facturi Generate",
                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("span", {
                                        className: "text-sm font-normal text-gray-500",
                                        children: [
                                            "(",
                                            facturi.length,
                                            " ",
                                            facturi.length === 1 ? "factura" : "facturi",
                                            ")"
                                        ]
                                    })
                                ]
                            }),
                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("button", {
                                onClick: loadFacturi,
                                className: "text-blue-600 hover:text-blue-800 text-sm flex items-center gap-1",
                                children: [
                                    /*#__PURE__*/ jsx_runtime_.jsx(refresh_cw/* default */.Z, {
                                        size: 14
                                    }),
                                    "Reincarcare"
                                ]
                            })
                        ]
                    }),
                    showFilters && /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                        className: "mt-4 space-y-3",
                        children: [
                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                className: "grid grid-cols-1 md:grid-cols-4 gap-3",
                                children: [
                                    /*#__PURE__*/ jsx_runtime_.jsx("input", {
                                        type: "text",
                                        placeholder: "Cauta dupa numar, client sau proiect...",
                                        value: filters.search,
                                        onChange: (e)=>setFilters({
                                                ...filters,
                                                search: e.target.value
                                            }),
                                        className: "px-3 py-2 border border-gray-300 rounded text-sm"
                                    }),
                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("select", {
                                        value: filters.status,
                                        onChange: (e)=>setFilters({
                                                ...filters,
                                                status: e.target.value
                                            }),
                                        className: "px-3 py-2 border border-gray-300 rounded text-sm",
                                        children: [
                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                value: "",
                                                children: "Toate statusurile"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                value: "generata",
                                                children: "PDF Generat"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                value: "draft",
                                                children: "XML Generat"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                value: "pending",
                                                children: "ANAF Pending"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                value: "sent",
                                                children: "Trimis la ANAF"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                value: "validated",
                                                children: "ANAF Validat"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                value: "error",
                                                children: "Eroare ANAF"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                value: "stornata",
                                                children: "Stornata"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                value: "mock_pending",
                                                children: "Mock Test"
                                            })
                                        ]
                                    }),
                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("select", {
                                        value: filters.scadenta,
                                        onChange: (e)=>setFilters({
                                                ...filters,
                                                scadenta: e.target.value
                                            }),
                                        className: "px-3 py-2 border border-gray-300 rounded text-sm",
                                        children: [
                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                value: "",
                                                children: "Toate scadentele"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                value: "Expirata",
                                                children: "Expirate"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                value: "Expira curand",
                                                children: "Expira curand"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                value: "In regula",
                                                children: "In regula"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                value: "Platita",
                                                children: "Platite"
                                            })
                                        ]
                                    }),
                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("select", {
                                        value: filters.perioada,
                                        onChange: (e)=>{
                                            const perioada = e.target.value;
                                            setFilters({
                                                ...filters,
                                                perioada
                                            });
                                            if (perioada === "custom") {
                                                setShowCustomPeriod(true);
                                            } else {
                                                setShowCustomPeriod(false);
                                                setCustomPeriod({
                                                    dataStart: "",
                                                    dataEnd: ""
                                                });
                                            }
                                        },
                                        className: "px-3 py-2 border border-gray-300 rounded text-sm",
                                        children: [
                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                value: "toate",
                                                children: "Toate perioadele"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                value: "7",
                                                children: "Ultimele 7 zile"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                value: "30",
                                                children: "Ultimele 30 zile"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                value: "90",
                                                children: "Ultimele 3 luni"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                value: "365",
                                                children: "Ultimul an"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                value: "custom",
                                                children: "Alta perioada"
                                            })
                                        ]
                                    })
                                ]
                            }),
                            showCustomPeriod && /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                className: "grid grid-cols-1 md:grid-cols-2 gap-3 p-4 bg-blue-50 border border-blue-200 rounded",
                                children: [
                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                        children: [
                                            /*#__PURE__*/ jsx_runtime_.jsx("label", {
                                                className: "block text-sm font-medium text-gray-700 mb-1",
                                                children: "Data inceput:"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("input", {
                                                type: "date",
                                                value: customPeriod.dataStart,
                                                onChange: (e)=>setCustomPeriod({
                                                        ...customPeriod,
                                                        dataStart: e.target.value
                                                    }),
                                                className: "w-full px-3 py-2 border border-gray-300 rounded text-sm"
                                            })
                                        ]
                                    }),
                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                        children: [
                                            /*#__PURE__*/ jsx_runtime_.jsx("label", {
                                                className: "block text-sm font-medium text-gray-700 mb-1",
                                                children: "Data sfarsit:"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("input", {
                                                type: "date",
                                                value: customPeriod.dataEnd,
                                                onChange: (e)=>setCustomPeriod({
                                                        ...customPeriod,
                                                        dataEnd: e.target.value
                                                    }),
                                                className: "w-full px-3 py-2 border border-gray-300 rounded text-sm"
                                            })
                                        ]
                                    })
                                ]
                            })
                        ]
                    })
                ]
            }),
            facturi.length === 0 ? /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                className: "p-8 text-center text-gray-500",
                children: [
                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                        className: "text-4xl mb-4",
                        children: /*#__PURE__*/ jsx_runtime_.jsx(file_text/* default */.Z, {
                            size: 48,
                            className: "mx-auto text-gray-300"
                        })
                    }),
                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                        children: filters.search || filters.status || filters.scadenta ? "Nu s-au gasit facturi cu criteriile specificate" : "Nu exista facturi generate"
                    }),
                    (filters.search || filters.status || filters.scadenta) && /*#__PURE__*/ jsx_runtime_.jsx("button", {
                        onClick: ()=>setFilters({
                                search: "",
                                status: "",
                                scadenta: "",
                                perioada: "30"
                            }),
                        className: "mt-2 text-blue-600 underline",
                        children: "Reseteaza filtrele"
                    })
                ]
            }) : /*#__PURE__*/ jsx_runtime_.jsx("div", {
                style: {
                    maxHeight,
                    overflowY: "auto"
                },
                children: /*#__PURE__*/ jsx_runtime_.jsx("div", {
                    className: "overflow-x-auto",
                    children: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("table", {
                        className: "w-full text-sm",
                        children: [
                            /*#__PURE__*/ jsx_runtime_.jsx("thead", {
                                className: "bg-gray-50 sticky top-0",
                                children: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("tr", {
                                    children: [
                                        /*#__PURE__*/ jsx_runtime_.jsx("th", {
                                            className: "px-4 py-3 text-left font-medium text-gray-500 uppercase tracking-wider",
                                            children: "Factura"
                                        }),
                                        /*#__PURE__*/ jsx_runtime_.jsx("th", {
                                            className: "px-4 py-3 text-left font-medium text-gray-500 uppercase tracking-wider",
                                            children: "Client"
                                        }),
                                        /*#__PURE__*/ jsx_runtime_.jsx("th", {
                                            className: "px-4 py-3 text-left font-medium text-gray-500 uppercase tracking-wider max-w-32",
                                            children: "Proiect"
                                        }),
                                        /*#__PURE__*/ jsx_runtime_.jsx("th", {
                                            className: "px-4 py-3 text-right font-medium text-gray-500 uppercase tracking-wider",
                                            children: "Valoare"
                                        }),
                                        /*#__PURE__*/ jsx_runtime_.jsx("th", {
                                            className: "px-4 py-3 text-center font-medium text-gray-500 uppercase tracking-wider",
                                            children: "Status"
                                        }),
                                        /*#__PURE__*/ jsx_runtime_.jsx("th", {
                                            className: "px-4 py-3 text-center font-medium text-gray-500 uppercase tracking-wider",
                                            children: "Scadenta"
                                        }),
                                        /*#__PURE__*/ jsx_runtime_.jsx("th", {
                                            className: "px-4 py-3 text-center font-medium text-gray-500 uppercase tracking-wider",
                                            children: "Actiuni"
                                        })
                                    ]
                                })
                            }),
                            /*#__PURE__*/ jsx_runtime_.jsx("tbody", {
                                className: "bg-white divide-y divide-gray-200",
                                children: facturi.map((factura, index)=>{
                                    const canEdit = (!factura.efactura_enabled || factura.efactura_status === "draft") && factura.status !== "stornata";
                                    const canDelete = (!factura.efactura_enabled || [
                                        "draft",
                                        "error",
                                        "mock_pending",
                                        "mock_generated"
                                    ].includes(factura.efactura_status || "")) && factura.status !== "stornata";
                                    const canStorno = factura.status !== "stornata";
                                    return /*#__PURE__*/ (0,jsx_runtime_.jsxs)("tr", {
                                        style: {
                                            backgroundColor: getRowBackgroundColor(index),
                                            transition: "background-color 0.2s ease"
                                        },
                                        onMouseEnter: (e)=>{
                                            e.currentTarget.style.backgroundColor = getRowHoverColor(index);
                                        },
                                        onMouseLeave: (e)=>{
                                            e.currentTarget.style.backgroundColor = getRowBackgroundColor(index);
                                        },
                                        children: [
                                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("td", {
                                                className: "px-4 py-3",
                                                children: [
                                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                        className: "font-medium text-gray-900 flex items-center gap-2",
                                                        children: [
                                                            factura.numar,
                                                            factura.efactura_enabled && /*#__PURE__*/ jsx_runtime_.jsx("span", {
                                                                className: "text-xs bg-blue-100 text-blue-800 px-1 py-0.5 rounded flex items-center gap-1",
                                                                title: "Factura cu e-factura ANAF",
                                                                children: /*#__PURE__*/ jsx_runtime_.jsx(send/* default */.Z, {
                                                                    size: 10
                                                                })
                                                            })
                                                        ]
                                                    }),
                                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                        className: "text-xs text-gray-500",
                                                        children: formatDateSafe(factura.data_factura)
                                                    })
                                                ]
                                            }),
                                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("td", {
                                                className: "px-4 py-3",
                                                children: [
                                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                        className: "font-medium text-gray-900",
                                                        children: factura.client_nume
                                                    }),
                                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                        className: "text-xs text-gray-500",
                                                        children: factura.client_cui
                                                    })
                                                ]
                                            }),
                                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("td", {
                                                className: "px-4 py-3 max-w-32",
                                                children: [
                                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                        className: "font-medium text-gray-900 break-words leading-tight",
                                                        children: factura.proiect_denumire
                                                    }),
                                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                        className: "text-xs text-gray-500 mt-1",
                                                        children: [
                                                            "Status: ",
                                                            factura.proiect_status
                                                        ]
                                                    }),
                                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                        className: "text-xs text-blue-600 mt-1 font-mono",
                                                        children: [
                                                            "ID: ",
                                                            factura.proiect_id || "LIPSESTE"
                                                        ]
                                                    })
                                                ]
                                            }),
                                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("td", {
                                                className: "px-4 py-3 text-right",
                                                children: [
                                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                        className: "font-semibold text-gray-900",
                                                        children: formatCurrency(factura.total)
                                                    }),
                                                    factura.valoare_platita > 0 && /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                        className: "text-xs text-green-600",
                                                        children: [
                                                            "Platit: ",
                                                            formatCurrency(factura.valoare_platita)
                                                        ]
                                                    }),
                                                    factura.rest_de_plata > 0 && /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                        className: "text-xs text-orange-600",
                                                        children: [
                                                            "Rest: ",
                                                            formatCurrency(factura.rest_de_plata)
                                                        ]
                                                    })
                                                ]
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("td", {
                                                className: "px-4 py-3 text-center",
                                                children: getStatusBadge(factura)
                                            }),
                                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("td", {
                                                className: "px-4 py-3 text-center",
                                                children: [
                                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                        children: getScadentaBadge(factura.status_scadenta, factura.zile_pana_scadenta)
                                                    }),
                                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                        className: "text-xs text-gray-500 mt-1",
                                                        children: formatDateSafe(factura.data_scadenta)
                                                    })
                                                ]
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("td", {
                                                className: "px-4 py-3 text-center",
                                                children: /*#__PURE__*/ jsx_runtime_.jsx(EnhancedActionDropdown, {
                                                    factura: factura,
                                                    canEdit: canEdit,
                                                    canDelete: canDelete,
                                                    canStorno: canStorno,
                                                    onDownload: ()=>handleDownload(factura),
                                                    onEdit: ()=>handleEditFactura(factura, "edit"),
                                                    onStorno: ()=>handleEditFactura(factura, "storno"),
                                                    onDownloadXML: ()=>handleDownloadXML(factura),
                                                    onSendToANAF: ()=>handleSendToANAF(factura),
                                                    onRetryANAF: ()=>handleRetryANAF(factura),
                                                    onShowDetails: ()=>showEFacturaDetailsModal(factura),
                                                    onDelete: ()=>handleDeleteFactura(factura),
                                                    isProcessing: processingActions[factura.id]
                                                })
                                            })
                                        ]
                                    }, factura.id);
                                })
                            })
                        ]
                    })
                })
            }),
            showEditModal && selectedFactura && /*#__PURE__*/ jsx_runtime_.jsx(EditFacturaModal, {
                factura: selectedFactura,
                isOpen: showEditModal,
                onClose: ()=>{
                    setShowEditModal(false);
                    setSelectedFactura(null);
                },
                onSuccess: handleEditSuccess,
                mode: editMode
            }),
            showEFacturaModal && currentModalFactura && /*#__PURE__*/ jsx_runtime_.jsx("div", {
                className: "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",
                children: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                    className: "bg-white rounded-lg max-w-2xl w-full max-h-90vh overflow-y-auto",
                    children: [
                        /*#__PURE__*/ jsx_runtime_.jsx("div", {
                            className: "px-6 py-4 border-b border-gray-200",
                            children: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                className: "flex items-center justify-between",
                                children: [
                                    /*#__PURE__*/ jsx_runtime_.jsx("h3", {
                                        className: "text-lg font-semibold text-gray-800",
                                        children: "Detalii e-Factura"
                                    }),
                                    /*#__PURE__*/ jsx_runtime_.jsx("button", {
                                        onClick: ()=>setShowEFacturaModal(null),
                                        className: "text-gray-400 hover:text-gray-600",
                                        children: /*#__PURE__*/ jsx_runtime_.jsx(circle_x/* default */.Z, {
                                            size: 20
                                        })
                                    })
                                ]
                            })
                        }),
                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                            className: "p-6",
                            children: [
                                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                    className: "mb-6",
                                    children: [
                                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("h4", {
                                            className: "font-medium text-gray-900 mb-2",
                                            children: [
                                                "Factura: ",
                                                currentModalFactura.numar
                                            ]
                                        }),
                                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                            className: "grid grid-cols-2 gap-4 text-sm",
                                            children: [
                                                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                    children: [
                                                        /*#__PURE__*/ jsx_runtime_.jsx("span", {
                                                            className: "text-gray-500",
                                                            children: "Client:"
                                                        }),
                                                        " ",
                                                        currentModalFactura.client_nume
                                                    ]
                                                }),
                                                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                    children: [
                                                        /*#__PURE__*/ jsx_runtime_.jsx("span", {
                                                            className: "text-gray-500",
                                                            children: "Total:"
                                                        }),
                                                        " ",
                                                        formatCurrency(currentModalFactura.total)
                                                    ]
                                                }),
                                                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                    children: [
                                                        /*#__PURE__*/ jsx_runtime_.jsx("span", {
                                                            className: "text-gray-500",
                                                            children: "Data factura:"
                                                        }),
                                                        " ",
                                                        formatDateSafe(currentModalFactura.data_factura)
                                                    ]
                                                }),
                                                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                    children: [
                                                        /*#__PURE__*/ jsx_runtime_.jsx("span", {
                                                            className: "text-gray-500",
                                                            children: "Status:"
                                                        }),
                                                        " ",
                                                        getStatusBadge(currentModalFactura)
                                                    ]
                                                })
                                            ]
                                        })
                                    ]
                                }),
                                currentModalDetails && /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                    children: [
                                        /*#__PURE__*/ jsx_runtime_.jsx("h4", {
                                            className: "font-medium text-gray-900 mb-4",
                                            children: "Timeline e-Factura:"
                                        }),
                                        /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                            className: "space-y-4",
                                            children: currentModalDetails.timeline && currentModalDetails.timeline.length > 0 ? currentModalDetails.timeline.map((event, index)=>/*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                    className: "flex items-start gap-3",
                                                    children: [
                                                        /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                            className: "w-3 h-3 bg-blue-500 rounded-full mt-1"
                                                        }),
                                                        /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                            className: "flex-1",
                                                            children: [
                                                                /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                                    className: "font-medium text-gray-900",
                                                                    children: event.eveniment
                                                                }),
                                                                /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                                    className: "text-sm text-gray-500",
                                                                    children: formatDateSafe(event.data)
                                                                }),
                                                                event.detalii && /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                                    className: "text-sm text-gray-600 mt-1",
                                                                    children: event.detalii
                                                                })
                                                            ]
                                                        }),
                                                        /*#__PURE__*/ jsx_runtime_.jsx("span", {
                                                            className: `px-2 py-1 rounded text-xs ${event.status === "success" ? "bg-green-100 text-green-800" : event.status === "error" ? "bg-red-100 text-red-800" : "bg-blue-100 text-blue-800"}`,
                                                            children: event.status
                                                        })
                                                    ]
                                                }, index)) : /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                className: "text-center py-8 text-gray-500",
                                                children: [
                                                    /*#__PURE__*/ jsx_runtime_.jsx(file_text/* default */.Z, {
                                                        size: 48,
                                                        className: "mx-auto text-gray-300 mb-2"
                                                    }),
                                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                                        children: "Se incarca istoricul e-facturii..."
                                                    })
                                                ]
                                            })
                                        })
                                    ]
                                })
                            ]
                        })
                    ]
                })
            })
        ]
    });
}
function EnhancedActionDropdown({ factura, canEdit, canDelete, canStorno, onDownload, onEdit, onStorno, onDownloadXML, onSendToANAF, onRetryANAF, onShowDetails, onDelete, isProcessing }) {
    const [isOpen, setIsOpen] = react_experimental_default().useState(false);
    const [loading, setLoading] = react_experimental_default().useState(null);
    const [dropdownPosition, setDropdownPosition] = react_experimental_default().useState("bottom");
    const [dropdownCoords, setDropdownCoords] = react_experimental_default().useState({
        top: 0,
        left: 0,
        width: 0
    });
    const buttonRef = react_experimental_default().useRef(null);
    const dropdownId = react_experimental_default().useMemo(()=>`dropdown-${factura.id}-${Math.random().toString(36).substr(2, 9)}`, [
        factura.id
    ]);
    react_experimental_default().useEffect(()=>{
        openDropdowns.set(dropdownId, ()=>setIsOpen(false));
        return ()=>{
            openDropdowns.delete(dropdownId);
        };
    }, [
        dropdownId
    ]);
    react_experimental_default().useEffect(()=>{
        if (isOpen) {
            if (currentOpenDropdown && currentOpenDropdown !== dropdownId) {
                const closeFunction = openDropdowns.get(currentOpenDropdown);
                if (closeFunction) {
                    closeFunction();
                }
            }
            currentOpenDropdown = dropdownId;
            calculateDropdownPosition();
            window.addEventListener("resize", calculateDropdownPosition);
            return ()=>window.removeEventListener("resize", calculateDropdownPosition);
        } else {
            if (currentOpenDropdown === dropdownId) {
                currentOpenDropdown = null;
            }
        }
    }, [
        isOpen,
        dropdownId
    ]);
    const calculateDropdownPosition = ()=>{
        if (!buttonRef.current) return;
        const buttonRect = buttonRef.current.getBoundingClientRect();
        const viewportHeight = window.innerHeight;
        // Calculează înălțimea reală bazată pe numărul de acțiuni disponibile
        const baseHeight = 120; // Header + padding
        const actionHeight = 45; // Înălțime per acțiune
        let actionsCount = 1; // PDF download mereu prezent
        if (canEdit) actionsCount++;
        if (canStorno) actionsCount++;
        if (factura.efactura_enabled) {
            actionsCount += 2; // Divider + detalii
            if (factura.efactura_status === "draft" || factura.efactura_status === "sent" || factura.efactura_status === "validated" || factura.efactura_status === "mock_pending") {
                actionsCount++; // Download XML
            }
            if (!factura.efactura_status || factura.efactura_status === "draft") {
                actionsCount++; // Send ANAF
            }
            if (factura.efactura_status === "error") {
                actionsCount++; // Retry ANAF
            }
        }
        if (canDelete) actionsCount += 2; // Divider + delete
        const dropdownHeight = baseHeight + actionsCount * actionHeight;
        const tableRow = buttonRef.current.closest("tr");
        const rowHeight = tableRow ? tableRow.getBoundingClientRect().height : 50;
        const spaceBelow = viewportHeight - buttonRect.bottom;
        const spaceAbove = buttonRect.top; // Elimină scăderea rowHeight
        let finalTop = 0;
        let finalLeft = buttonRect.right - 260;
        if (spaceBelow < dropdownHeight && spaceAbove > dropdownHeight + 50) {
            // Aliniază partea de jos a dropdown-ului cu partea de sus a butonului
            finalTop = buttonRect.top - dropdownHeight + buttonRect.height / 2;
            setDropdownPosition("top");
        } else {
            finalTop = buttonRect.bottom + 8;
            setDropdownPosition("bottom");
        }
        if (finalLeft < 10) finalLeft = 10;
        if (finalLeft + 260 > window.innerWidth - 10) {
            finalLeft = window.innerWidth - 270;
        }
        setDropdownCoords({
            top: finalTop,
            left: finalLeft,
            width: 260
        });
    };
    const handleActionClick = async (actionKey, actionFn)=>{
        if (loading) return;
        setLoading(actionKey);
        setIsOpen(false);
        try {
            await actionFn();
        } finally{
            setLoading(null);
        }
    };
    const getStatusColor = (status)=>{
        switch(status){
            case "generata":
                return "#27ae60";
            case "stornata":
                return "#95a5a6";
            case "error":
                return "#e74c3c";
            default:
                return "#3498db";
        }
    };
    return /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
        style: {
            position: "relative",
            display: "inline-block"
        },
        children: [
            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("button", {
                ref: buttonRef,
                onClick: ()=>setIsOpen(!isOpen),
                disabled: loading !== null,
                style: {
                    background: loading ? "#f8f9fa" : "linear-gradient(135deg, #667eea 0%, #764ba2 100%)",
                    color: loading ? "#6c757d" : "white",
                    border: "none",
                    borderRadius: "12px",
                    padding: "0.5rem 1rem",
                    cursor: loading ? "not-allowed" : "pointer",
                    fontSize: "14px",
                    fontWeight: "600",
                    boxShadow: loading ? "none" : "0 4px 12px rgba(102, 126, 234, 0.4)",
                    transition: "all 0.3s ease",
                    display: "flex",
                    alignItems: "center",
                    gap: "0.5rem"
                },
                children: [
                    loading ? /*#__PURE__*/ jsx_runtime_.jsx(clock/* default */.Z, {
                        size: 16
                    }) : /*#__PURE__*/ jsx_runtime_.jsx(download/* default */.Z, {
                        size: 16
                    }),
                    "Actiuni",
                    /*#__PURE__*/ jsx_runtime_.jsx(chevron_down/* default */.Z, {
                        size: 16,
                        className: isOpen ? "rotate-180" : ""
                    })
                ]
            }),
            isOpen && /*#__PURE__*/ (0,jsx_runtime_.jsxs)(jsx_runtime_.Fragment, {
                children: [
                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                        style: {
                            position: "fixed",
                            top: 0,
                            left: 0,
                            right: 0,
                            bottom: 0,
                            background: "rgba(0, 0, 0, 0.3)",
                            backdropFilter: "blur(6px)",
                            zIndex: 40000
                        },
                        onClick: ()=>setIsOpen(false)
                    }),
                     false && /*#__PURE__*/ 0
                ]
            })
        ]
    });
}

;// CONCATENATED MODULE: ./app/admin/rapoarte/facturi/page.tsx
// ==================================================================
// CALEA: app/admin/rapoarte/facturi/page.tsx
// DATA: 16.08.2025 10:35
// FIX PROBLEMA 1c: 3 culori alternative la rândurile din lista facturi
// ==================================================================
/* __next_internal_client_entry_do_not_use__ default auto */ 







function FacturiPage() {
    const [user, authLoading] = (0,index_cjs/* useAuthState */.F_)(firebaseConfig/* auth */.I);
    const router = (0,navigation.useRouter)();
    const [displayName, setDisplayName] = (0,react_experimental_.useState)("Utilizator");
    const [userRole, setUserRole] = (0,react_experimental_.useState)("admin");
    const [stats, setStats] = (0,react_experimental_.useState)(null);
    const [loading, setLoading] = (0,react_experimental_.useState)(true);
    const [perioada, setPerioada] = (0,react_experimental_.useState)(30);
    (0,react_experimental_.useEffect)(()=>{
        loadStats();
    }, [
        perioada
    ]);
    const loadStats = async ()=>{
        setLoading(true);
        try {
            const response = await fetch("/api/actions/invoices/stats", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    perioada: perioada.toString()
                })
            });
            const data = await response.json();
            if (data.success) {
                setStats(data.statistici);
            }
        } catch (error) {
            console.error("Eroare loading stats:", error);
        } finally{
            setLoading(false);
        }
    };
    const formatCurrency = (amount)=>{
        return new Intl.NumberFormat("ro-RO", {
            style: "currency",
            currency: "RON"
        }).format(amount);
    };
    // Auth check
    (0,react_experimental_.useEffect)(()=>{
        if (authLoading) return;
        if (!user) {
            router.push("/login");
            return;
        }
        setDisplayName(localStorage.getItem("displayName") || "Utilizator");
    }, [
        user,
        authLoading,
        router
    ]);
    if (authLoading || !user) {
        return /*#__PURE__*/ jsx_runtime_.jsx("div", {
            children: "Se \xeencarcă..."
        });
    }
    return /*#__PURE__*/ jsx_runtime_.jsx(ModernLayout/* default */.Z, {
        user: user,
        displayName: displayName,
        userRole: userRole,
        children: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
            className: "p-6 max-w-7xl mx-auto",
            children: [
                /*#__PURE__*/ jsx_runtime_.jsx("div", {
                    className: "mb-8",
                    children: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                        className: "flex items-center justify-between",
                        children: [
                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                children: [
                                    /*#__PURE__*/ jsx_runtime_.jsx("h1", {
                                        className: "text-3xl font-bold text-gray-900 flex items-center gap-3",
                                        children: "\uD83D\uDCB0 Gestionare Facturi"
                                    }),
                                    /*#__PURE__*/ jsx_runtime_.jsx("p", {
                                        className: "text-gray-600 mt-2",
                                        children: "Sistemul hibrid de facturare - PDF instant + integrare ANAF"
                                    })
                                ]
                            }),
                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                className: "flex items-center gap-3",
                                children: [
                                    /*#__PURE__*/ jsx_runtime_.jsx("button", {
                                        onClick: ()=>window.location.href = "/admin/anaf/monitoring",
                                        className: "bg-purple-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-purple-600 flex items-center gap-2",
                                        title: "Monitorizeaz\xc4ƒ sistemul ANAF",
                                        children: "\uD83D\uDCCA ANAF Monitoring"
                                    }),
                                    /*#__PURE__*/ jsx_runtime_.jsx("button", {
                                        onClick: ()=>window.location.href = "/admin/rapoarte/proiecte",
                                        className: "bg-green-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-600 flex items-center gap-2",
                                        children: "➕ Generează Factură Nouă"
                                    }),
                                    /*#__PURE__*/ jsx_runtime_.jsx("label", {
                                        className: "text-sm font-medium text-gray-700",
                                        children: "Perioada:"
                                    }),
                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("select", {
                                        value: perioada,
                                        onChange: (e)=>setPerioada(parseInt(e.target.value)),
                                        className: "border border-gray-300 rounded px-3 py-2 text-sm",
                                        children: [
                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                value: 7,
                                                children: "Ultima săptăm\xe2nă"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                value: 30,
                                                children: "Ultima lună"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                value: 90,
                                                children: "Ultimele 3 luni"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("option", {
                                                value: 365,
                                                children: "Ultimul an"
                                            })
                                        ]
                                    })
                                ]
                            })
                        ]
                    })
                }),
                loading ? /*#__PURE__*/ jsx_runtime_.jsx("div", {
                    className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",
                    children: [
                        ...Array(8)
                    ].map((_, i)=>/*#__PURE__*/ jsx_runtime_.jsx("div", {
                            className: "bg-white p-6 rounded-lg shadow border",
                            children: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                className: "animate-pulse",
                                children: [
                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                        className: "h-4 bg-gray-200 rounded mb-4"
                                    }),
                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                        className: "h-8 bg-gray-200 rounded"
                                    })
                                ]
                            })
                        }, i))
                }) : stats && /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                    className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",
                    children: [
                        /*#__PURE__*/ jsx_runtime_.jsx("div", {
                            className: "bg-white p-6 rounded-lg shadow border border-blue-200",
                            children: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                className: "flex items-center",
                                children: [
                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                        className: "flex-1",
                                        children: [
                                            /*#__PURE__*/ jsx_runtime_.jsx("p", {
                                                className: "text-sm font-medium text-gray-600",
                                                children: "Total Facturi"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("p", {
                                                className: "text-2xl font-bold text-blue-600",
                                                children: stats.total_facturi
                                            })
                                        ]
                                    }),
                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                        className: "text-3xl",
                                        children: "\uD83D\uDCCA"
                                    })
                                ]
                            })
                        }),
                        /*#__PURE__*/ jsx_runtime_.jsx("div", {
                            className: "bg-white p-6 rounded-lg shadow border border-green-200",
                            children: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                className: "flex items-center",
                                children: [
                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                        className: "flex-1",
                                        children: [
                                            /*#__PURE__*/ jsx_runtime_.jsx("p", {
                                                className: "text-sm font-medium text-gray-600",
                                                children: "Valoare Total\xc4ƒ"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("p", {
                                                className: "text-2xl font-bold text-green-600",
                                                children: formatCurrency(stats.valoare_totala)
                                            })
                                        ]
                                    }),
                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                        className: "text-3xl",
                                        children: "\uD83D\uDCB0"
                                    })
                                ]
                            })
                        }),
                        /*#__PURE__*/ jsx_runtime_.jsx("div", {
                            className: "bg-white p-6 rounded-lg shadow border border-purple-200",
                            children: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                className: "flex items-center",
                                children: [
                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                        className: "flex-1",
                                        children: [
                                            /*#__PURE__*/ jsx_runtime_.jsx("p", {
                                                className: "text-sm font-medium text-gray-600",
                                                children: "\xcencasate"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("p", {
                                                className: "text-2xl font-bold text-purple-600",
                                                children: formatCurrency(stats.valoare_platita)
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("p", {
                                                className: "text-xs text-gray-500",
                                                children: stats.valoare_totala > 0 ? `${(stats.valoare_platita / stats.valoare_totala * 100).toFixed(1)}%` : "0%"
                                            })
                                        ]
                                    }),
                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                        className: "text-3xl",
                                        children: "\uD83D\uDCB3"
                                    })
                                ]
                            })
                        }),
                        /*#__PURE__*/ jsx_runtime_.jsx("div", {
                            className: "bg-white p-6 rounded-lg shadow border border-orange-200",
                            children: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                className: "flex items-center",
                                children: [
                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                        className: "flex-1",
                                        children: [
                                            /*#__PURE__*/ jsx_runtime_.jsx("p", {
                                                className: "text-sm font-medium text-gray-600",
                                                children: "Rest de plată"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("p", {
                                                className: "text-2xl font-bold text-orange-600",
                                                children: formatCurrency(stats.rest_de_plata)
                                            })
                                        ]
                                    }),
                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                        className: "text-3xl",
                                        children: "⏳"
                                    })
                                ]
                            })
                        }),
                        /*#__PURE__*/ jsx_runtime_.jsx("div", {
                            className: "bg-white p-6 rounded-lg shadow border border-green-200",
                            children: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                className: "flex items-center",
                                children: [
                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                        className: "flex-1",
                                        children: [
                                            /*#__PURE__*/ jsx_runtime_.jsx("p", {
                                                className: "text-sm font-medium text-gray-600",
                                                children: "PDF Generate"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("p", {
                                                className: "text-2xl font-bold text-green-600",
                                                children: stats.facturi_pdf
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("p", {
                                                className: "text-xs text-gray-500",
                                                children: stats.total_facturi > 0 ? `${(stats.facturi_pdf / stats.total_facturi * 100).toFixed(1)}%` : "0%"
                                            })
                                        ]
                                    }),
                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                        className: "text-3xl",
                                        children: "\uD83D\uDCC4"
                                    })
                                ]
                            })
                        }),
                        /*#__PURE__*/ jsx_runtime_.jsx("div", {
                            className: "bg-white p-6 rounded-lg shadow border border-blue-200",
                            children: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                className: "flex items-center",
                                children: [
                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                        className: "flex-1",
                                        children: [
                                            /*#__PURE__*/ jsx_runtime_.jsx("p", {
                                                className: "text-sm font-medium text-gray-600",
                                                children: "ANAF Succes"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("p", {
                                                className: "text-2xl font-bold text-blue-600",
                                                children: stats.facturi_anaf
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("p", {
                                                className: "text-xs text-gray-500",
                                                children: stats.total_facturi > 0 ? `${(stats.facturi_anaf / stats.total_facturi * 100).toFixed(1)}%` : "0%"
                                            })
                                        ]
                                    }),
                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                        className: "text-3xl",
                                        children: "✅"
                                    })
                                ]
                            })
                        }),
                        /*#__PURE__*/ jsx_runtime_.jsx("div", {
                            className: "bg-white p-6 rounded-lg shadow border border-red-200 cursor-pointer hover:bg-red-50 transition-colors",
                            onClick: ()=>window.location.href = "/admin/anaf/monitoring",
                            title: "Click pentru a vedea detalii \xcen ANAF Monitoring",
                            children: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                className: "flex items-center",
                                children: [
                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                        className: "flex-1",
                                        children: [
                                            /*#__PURE__*/ jsx_runtime_.jsx("p", {
                                                className: "text-sm font-medium text-gray-600",
                                                children: "Erori ANAF"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("p", {
                                                className: "text-2xl font-bold text-red-600",
                                                children: stats.facturi_eroare
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("p", {
                                                className: "text-xs text-blue-600 underline",
                                                children: "\uD83D\uDD0D Vezi \xcen Monitoring"
                                            })
                                        ]
                                    }),
                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                        className: "text-3xl",
                                        children: "❌"
                                    })
                                ]
                            })
                        }),
                        /*#__PURE__*/ jsx_runtime_.jsx("div", {
                            className: "bg-white p-6 rounded-lg shadow border border-red-200",
                            children: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                className: "flex items-center",
                                children: [
                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                        className: "flex-1",
                                        children: [
                                            /*#__PURE__*/ jsx_runtime_.jsx("p", {
                                                className: "text-sm font-medium text-gray-600",
                                                children: "Expirate"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("p", {
                                                className: "text-2xl font-bold text-red-600",
                                                children: stats.facturi_expirate
                                            }),
                                            stats.facturi_expira_curand > 0 && /*#__PURE__*/ (0,jsx_runtime_.jsxs)("p", {
                                                className: "text-xs text-orange-600",
                                                children: [
                                                    "+",
                                                    stats.facturi_expira_curand,
                                                    " expiră cur\xe2nd"
                                                ]
                                            })
                                        ]
                                    }),
                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                        className: "text-3xl",
                                        children: "\uD83D\uDD34"
                                    })
                                ]
                            })
                        })
                    ]
                }),
                stats && (stats.facturi_expirate > 0 || stats.facturi_expira_curand > 0 || stats.facturi_eroare > 0) && /*#__PURE__*/ jsx_runtime_.jsx("div", {
                    className: "bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",
                    children: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                        className: "flex items-start justify-between",
                        children: [
                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                className: "flex items-start",
                                children: [
                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                        className: "flex-shrink-0 text-2xl",
                                        children: "⚠️"
                                    }),
                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                        className: "ml-3",
                                        children: [
                                            /*#__PURE__*/ jsx_runtime_.jsx("h3", {
                                                className: "text-sm font-medium text-yellow-800",
                                                children: "Atenție necesară"
                                            }),
                                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                className: "mt-2 text-sm text-yellow-700 space-y-1",
                                                children: [
                                                    stats.facturi_expirate > 0 && /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                        children: [
                                                            "• ",
                                                            stats.facturi_expirate,
                                                            " facturi expirate"
                                                        ]
                                                    }),
                                                    stats.facturi_expira_curand > 0 && /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                        children: [
                                                            "• ",
                                                            stats.facturi_expira_curand,
                                                            " facturi care expiră cur\xe2nd"
                                                        ]
                                                    }),
                                                    stats.facturi_eroare > 0 && /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                                        children: [
                                                            "• ",
                                                            stats.facturi_eroare,
                                                            " erori ANAF de rezolvat"
                                                        ]
                                                    })
                                                ]
                                            })
                                        ]
                                    })
                                ]
                            }),
                            stats.facturi_eroare > 0 && /*#__PURE__*/ jsx_runtime_.jsx("button", {
                                onClick: ()=>window.location.href = "/admin/anaf/monitoring",
                                className: "bg-yellow-600 text-white px-4 py-2 rounded text-sm hover:bg-yellow-700 flex items-center gap-2",
                                children: "\uD83D\uDCCA Vezi Monitoring"
                            })
                        ]
                    })
                }),
                /*#__PURE__*/ jsx_runtime_.jsx("div", {
                    className: "bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",
                    children: /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                        className: "flex items-center justify-between",
                        children: [
                            /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                className: "flex items-center",
                                children: [
                                    /*#__PURE__*/ jsx_runtime_.jsx("div", {
                                        className: "text-2xl mr-3",
                                        children: "\uD83D\uDCCA"
                                    }),
                                    /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                                        children: [
                                            /*#__PURE__*/ jsx_runtime_.jsx("h3", {
                                                className: "text-sm font-medium text-blue-800",
                                                children: "ANAF e-Factura Monitoring"
                                            }),
                                            /*#__PURE__*/ jsx_runtime_.jsx("p", {
                                                className: "text-sm text-blue-700",
                                                children: "Monitorizează \xeen timp real statusul sistem OAuth, performanțe și erori ANAF"
                                            })
                                        ]
                                    })
                                ]
                            }),
                            /*#__PURE__*/ jsx_runtime_.jsx("button", {
                                onClick: ()=>window.location.href = "/admin/anaf/monitoring",
                                className: "bg-blue-600 text-white px-4 py-2 rounded text-sm hover:bg-blue-700 flex items-center gap-2",
                                children: "\uD83D\uDD0D ANAF Monitoring"
                            })
                        ]
                    })
                }),
                /*#__PURE__*/ (0,jsx_runtime_.jsxs)("div", {
                    className: "jsx-89c3b376595e8478" + " " + "bg-white rounded-lg shadow",
                    children: [
                        jsx_runtime_.jsx((style_default()), {
                            id: "89c3b376595e8478",
                            children: ".facturi-row-1.jsx-89c3b376595e8478{background-color:#fefdf8!important}.facturi-row-2.jsx-89c3b376595e8478{background-color:#fafafa!important}.facturi-row-3.jsx-89c3b376595e8478{background-color:#f8fafc!important}.facturi-row-1.jsx-89c3b376595e8478:hover{background-color:#fdf6e3!important}.facturi-row-2.jsx-89c3b376595e8478:hover{background-color:#f0f0f0!important}.facturi-row-3.jsx-89c3b376595e8478:hover{background-color:#e2e8f0!important}"
                        }),
                        /*#__PURE__*/ jsx_runtime_.jsx(FacturiList, {
                            showFilters: true,
                            maxHeight: "600px"
                        })
                    ]
                })
            ]
        })
    });
}


/***/ }),

/***/ 89601:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   $$typeof: () => (/* binding */ $$typeof),
/* harmony export */   __esModule: () => (/* binding */ __esModule),
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var next_dist_build_webpack_loaders_next_flight_loader_module_proxy__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(61363);

const proxy = (0,next_dist_build_webpack_loaders_next_flight_loader_module_proxy__WEBPACK_IMPORTED_MODULE_0__.createProxy)(String.raw`/home/teodor/PM1-2025-07-17/unitar-admin/app/admin/rapoarte/facturi/page.tsx`)

// Accessing the __esModule property and exporting $$typeof are required here.
// The __esModule getter forces the proxy target to create the default export
// and the $$typeof value is for rendering logic to determine if the module
// is a client boundary.
const { __esModule, $$typeof } = proxy;
const __default__ = proxy.default;


/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__default__);

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, [8478,8448,8222,9493,6369,1440,8045,1504,8313,9850,6166,6128,6549,1727], () => (__webpack_exec__(42244)));
module.exports = __webpack_exports__;

})();