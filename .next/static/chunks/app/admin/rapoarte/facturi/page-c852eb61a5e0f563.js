(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[993],{8765:function(e,t,a){Promise.resolve().then(a.bind(a,5193))},5193:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return c}});var s=a(6705),r=a(955);function l(e){let{proiectId:t,clientId:a,showFilters:l=!0,maxHeight:c="500px"}=e,[i,n]=(0,r.useState)([]),[d,x]=(0,r.useState)(!0),[o,u]=(0,r.useState)(null),[m,h]=(0,r.useState)({status:"",search:"",scadenta:""});(0,r.useEffect)(()=>{p()},[t,a,m]);let p=async()=>{x(!0),u(null);try{let e=new URLSearchParams;t&&e.append("proiectId",t),a&&e.append("clientId",a),m.status&&e.append("status",m.status);let s=await fetch("/api/actions/invoices/list?".concat(e)),r=await s.json();if(r.success){let e=r.facturi;if(m.search){let t=m.search.toLowerCase();e=e.filter(e=>e.numar.toLowerCase().includes(t)||e.client_nume.toLowerCase().includes(t)||e.proiect_denumire.toLowerCase().includes(t))}m.scadenta&&(e=e.filter(e=>e.status_scadenta===m.scadenta)),n(e)}else throw Error(r.error)}catch(e){u(e instanceof Error?e.message:"Eroare necunoscută")}finally{x(!1)}},g=e=>{let t={pdf_generated:{bg:"bg-green-100",text:"text-green-800",label:"\uD83D\uDFE2 PDF Generat"},anaf_processing:{bg:"bg-yellow-100",text:"text-yellow-800",label:"\uD83D\uDFE1 ANAF \xeen curs"},anaf_success:{bg:"bg-blue-100",text:"text-blue-800",label:"✅ ANAF Succes"},anaf_error:{bg:"bg-red-100",text:"text-red-800",label:"\uD83D\uDD34 Eroare ANAF"}}[e]||{bg:"bg-gray-100",text:"text-gray-800",label:e};return(0,s.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat(t.bg," ").concat(t.text),children:t.label})},f=(e,t)=>{let a={Expirată:{bg:"bg-red-100",text:"text-red-800",icon:"\uD83D\uDD34"},"Expiră cur\xe2nd":{bg:"bg-orange-100",text:"text-orange-800",icon:"⚠️"},Plătită:{bg:"bg-green-100",text:"text-green-800",icon:"✅"},"\xcen regulă":{bg:"bg-gray-100",text:"text-gray-800",icon:"\uD83D\uDFE2"}}[e]||{bg:"bg-gray-100",text:"text-gray-800",icon:"❓"};return(0,s.jsxs)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat(a.bg," ").concat(a.text),title:"".concat(t," zile p\xe2nă la scadență"),children:[a.icon," ",e]})},j=e=>{let t=document.createElement("a");t.href="/api/actions/invoices/download/".concat(e),t.download="Factura_".concat(e,".pdf"),t.target="_blank",document.body.appendChild(t),t.click(),document.body.removeChild(t)},N=e=>new Intl.NumberFormat("ro-RO",{style:"currency",currency:"RON"}).format(e);return d?(0,s.jsxs)("div",{className:"flex justify-center items-center p-8",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500"}),(0,s.jsx)("span",{className:"ml-3",children:"Se \xeencarcă facturile..."})]}):o?(0,s.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,s.jsxs)("div",{className:"text-red-800",children:[(0,s.jsx)("strong",{children:"Eroare:"})," ",o]}),(0,s.jsx)("button",{onClick:p,className:"mt-2 text-red-600 underline hover:text-red-800",children:"\xcencearcă din nou"})]}):(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow border border-gray-200",children:[(0,s.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:["\uD83D\uDCC4 Facturi Generate",(0,s.jsxs)("span",{className:"text-sm font-normal text-gray-500",children:["(",i.length," ",1===i.length?"factură":"facturi",")"]})]}),(0,s.jsx)("button",{onClick:p,className:"text-blue-600 hover:text-blue-800 text-sm",children:"\uD83D\uDD04 Re\xeencarcă"})]}),l&&(0,s.jsxs)("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,s.jsx)("input",{type:"text",placeholder:"Caută după număr, client sau proiect...",value:m.search,onChange:e=>h({...m,search:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded text-sm"}),(0,s.jsxs)("select",{value:m.status,onChange:e=>h({...m,status:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded text-sm",children:[(0,s.jsx)("option",{value:"",children:"Toate statusurile"}),(0,s.jsx)("option",{value:"pdf_generated",children:"PDF Generat"}),(0,s.jsx)("option",{value:"anaf_processing",children:"ANAF \xeen curs"}),(0,s.jsx)("option",{value:"anaf_success",children:"ANAF Succes"}),(0,s.jsx)("option",{value:"anaf_error",children:"Eroare ANAF"})]}),(0,s.jsxs)("select",{value:m.scadenta,onChange:e=>h({...m,scadenta:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded text-sm",children:[(0,s.jsx)("option",{value:"",children:"Toate scadențele"}),(0,s.jsx)("option",{value:"Expirată",children:"Expirate"}),(0,s.jsx)("option",{value:"Expiră cur\xe2nd",children:"Expiră cur\xe2nd"}),(0,s.jsx)("option",{value:"\xcen regulă",children:"\xcen regulă"}),(0,s.jsx)("option",{value:"Plătită",children:"Plătite"})]})]})]}),0===i.length?(0,s.jsxs)("div",{className:"p-8 text-center text-gray-500",children:[(0,s.jsx)("div",{className:"text-4xl mb-4",children:"\uD83D\uDCC4"}),(0,s.jsx)("div",{children:m.search||m.status||m.scadenta?"Nu s-au găsit facturi cu criteriile specificate":"Nu există facturi generate"}),(m.search||m.status||m.scadenta)&&(0,s.jsx)("button",{onClick:()=>h({search:"",status:"",scadenta:""}),className:"mt-2 text-blue-600 underline",children:"Resetează filtrele"})]}):(0,s.jsx)("div",{style:{maxHeight:c,overflowY:"auto"},children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-gray-50 sticky top-0",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-3 text-left font-medium text-gray-500 uppercase tracking-wider",children:"Factură"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left font-medium text-gray-500 uppercase tracking-wider",children:"Client"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left font-medium text-gray-500 uppercase tracking-wider",children:"Proiect"}),(0,s.jsx)("th",{className:"px-4 py-3 text-right font-medium text-gray-500 uppercase tracking-wider",children:"Valoare"}),(0,s.jsx)("th",{className:"px-4 py-3 text-center font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,s.jsx)("th",{className:"px-4 py-3 text-center font-medium text-gray-500 uppercase tracking-wider",children:"Scadență"}),(0,s.jsx)("th",{className:"px-4 py-3 text-center font-medium text-gray-500 uppercase tracking-wider",children:"Acțiuni"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:i.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,s.jsxs)("td",{className:"px-4 py-3",children:[(0,s.jsx)("div",{className:"font-medium text-gray-900",children:e.numar}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:new Date(e.data_factura).toLocaleDateString("ro-RO")})]}),(0,s.jsxs)("td",{className:"px-4 py-3",children:[(0,s.jsx)("div",{className:"font-medium text-gray-900",children:e.client_nume}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:e.client_cui})]}),(0,s.jsxs)("td",{className:"px-4 py-3",children:[(0,s.jsx)("div",{className:"font-medium text-gray-900",children:e.proiect_denumire}),(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:["Status: ",e.proiect_status]})]}),(0,s.jsxs)("td",{className:"px-4 py-3 text-right",children:[(0,s.jsx)("div",{className:"font-semibold text-gray-900",children:N(e.total)}),e.valoare_platita>0&&(0,s.jsxs)("div",{className:"text-xs text-green-600",children:["Plătit: ",N(e.valoare_platita)]}),e.rest_de_plata>0&&(0,s.jsxs)("div",{className:"text-xs text-orange-600",children:["Rest: ",N(e.rest_de_plata)]})]}),(0,s.jsx)("td",{className:"px-4 py-3 text-center",children:g(e.status)}),(0,s.jsxs)("td",{className:"px-4 py-3 text-center",children:[(0,s.jsx)("div",{children:f(e.status_scadenta,e.zile_pana_scadenta)}),(0,s.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:new Date(e.data_scadenta).toLocaleDateString("ro-RO")})]}),(0,s.jsx)("td",{className:"px-4 py-3 text-center",children:(0,s.jsxs)("div",{className:"flex justify-center gap-2",children:[(0,s.jsx)("button",{onClick:()=>j(e.numar),className:"bg-blue-500 text-white px-3 py-1 rounded text-xs hover:bg-blue-600",title:"Descarcă PDF",children:"\uD83D\uDCC4 PDF"}),"anaf_error"===e.status&&(0,s.jsx)("button",{className:"bg-yellow-500 text-white px-3 py-1 rounded text-xs hover:bg-yellow-600",title:"Re\xeencearcă ANAF",onClick:()=>{alert("Funcția va fi disponibilă \xeen următoarea versiune")},children:"\uD83D\uDD04 Retry"})]})})]},e.id))})]})})})]})}function c(){let[e,t]=(0,r.useState)(null),[a,c]=(0,r.useState)(!0),[i,n]=(0,r.useState)(30);(0,r.useEffect)(()=>{d()},[i]);let d=async()=>{c(!0);try{let e=await fetch("/api/actions/invoices/stats",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({perioada:i.toString()})}),a=await e.json();a.success&&t(a.statistici)}catch(e){console.error("Eroare loading stats:",e)}finally{c(!1)}},x=e=>new Intl.NumberFormat("ro-RO",{style:"currency",currency:"RON"}).format(e);return(0,s.jsxs)("div",{className:"p-6 max-w-7xl mx-auto",children:[(0,s.jsx)("div",{className:"mb-8",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:"\uD83D\uDCB0 Gestionare Facturi"}),(0,s.jsx)("p",{className:"text-gray-600 mt-2",children:"Sistemul hibrid de facturare - PDF instant + integrare ANAF"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("button",{onClick:()=>window.location.href="/admin/rapoarte/proiecte",className:"bg-green-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-600 flex items-center gap-2",children:"➕ Generează Factură Nouă"}),(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Perioada:"}),(0,s.jsxs)("select",{value:i,onChange:e=>n(parseInt(e.target.value)),className:"border border-gray-300 rounded px-3 py-2 text-sm",children:[(0,s.jsx)("option",{value:7,children:"Ultima săptăm\xe2nă"}),(0,s.jsx)("option",{value:30,children:"Ultima lună"}),(0,s.jsx)("option",{value:90,children:"Ultimele 3 luni"}),(0,s.jsx)("option",{value:365,children:"Ultimul an"})]})]})]})}),a?(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[...Array(8)].map((e,t)=>(0,s.jsx)("div",{className:"bg-white p-6 rounded-lg shadow border",children:(0,s.jsxs)("div",{className:"animate-pulse",children:[(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded mb-4"}),(0,s.jsx)("div",{className:"h-8 bg-gray-200 rounded"})]})},t))}):e&&(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,s.jsx)("div",{className:"bg-white p-6 rounded-lg shadow border border-blue-200",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Facturi"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:e.total_facturi})]}),(0,s.jsx)("div",{className:"text-3xl",children:"\uD83D\uDCCA"})]})}),(0,s.jsx)("div",{className:"bg-white p-6 rounded-lg shadow border border-green-200",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Valoare Totală"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-green-600",children:x(e.valoare_totala)})]}),(0,s.jsx)("div",{className:"text-3xl",children:"\uD83D\uDCB0"})]})}),(0,s.jsx)("div",{className:"bg-white p-6 rounded-lg shadow border border-purple-200",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"\xcencasate"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-purple-600",children:x(e.valoare_platita)}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:e.valoare_totala>0?"".concat((e.valoare_platita/e.valoare_totala*100).toFixed(1),"%"):"0%"})]}),(0,s.jsx)("div",{className:"text-3xl",children:"\uD83D\uDCB3"})]})}),(0,s.jsx)("div",{className:"bg-white p-6 rounded-lg shadow border border-orange-200",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Rest de plată"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-orange-600",children:x(e.rest_de_plata)})]}),(0,s.jsx)("div",{className:"text-3xl",children:"⏳"})]})}),(0,s.jsx)("div",{className:"bg-white p-6 rounded-lg shadow border border-green-200",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"PDF Generate"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-green-600",children:e.facturi_pdf}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:e.total_facturi>0?"".concat((e.facturi_pdf/e.total_facturi*100).toFixed(1),"%"):"0%"})]}),(0,s.jsx)("div",{className:"text-3xl",children:"\uD83D\uDCC4"})]})}),(0,s.jsx)("div",{className:"bg-white p-6 rounded-lg shadow border border-blue-200",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"ANAF Succes"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:e.facturi_anaf}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:e.total_facturi>0?"".concat((e.facturi_anaf/e.total_facturi*100).toFixed(1),"%"):"0%"})]}),(0,s.jsx)("div",{className:"text-3xl",children:"✅"})]})}),(0,s.jsx)("div",{className:"bg-white p-6 rounded-lg shadow border border-red-200",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Erori ANAF"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-red-600",children:e.facturi_eroare})]}),(0,s.jsx)("div",{className:"text-3xl",children:"❌"})]})}),(0,s.jsx)("div",{className:"bg-white p-6 rounded-lg shadow border border-red-200",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Expirate"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-red-600",children:e.facturi_expirate}),e.facturi_expira_curand>0&&(0,s.jsxs)("p",{className:"text-xs text-orange-600",children:["+",e.facturi_expira_curand," expiră cur\xe2nd"]})]}),(0,s.jsx)("div",{className:"text-3xl",children:"\uD83D\uDD34"})]})})]}),e&&(e.facturi_expirate>0||e.facturi_expira_curand>0||e.facturi_eroare>0)&&(0,s.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:(0,s.jsxs)("div",{className:"flex items-start",children:[(0,s.jsx)("div",{className:"flex-shrink-0 text-2xl",children:"⚠️"}),(0,s.jsxs)("div",{className:"ml-3",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-yellow-800",children:"Atenție necesară"}),(0,s.jsxs)("div",{className:"mt-2 text-sm text-yellow-700 space-y-1",children:[e.facturi_expirate>0&&(0,s.jsxs)("div",{children:["• ",e.facturi_expirate," facturi expirate"]}),e.facturi_expira_curand>0&&(0,s.jsxs)("div",{children:["• ",e.facturi_expira_curand," facturi expiră \xeen cur\xe2nd"]}),e.facturi_eroare>0&&(0,s.jsxs)("div",{children:["• ",e.facturi_eroare," erori ANAF de rezolvat"]})]})]})]})}),(0,s.jsx)("div",{className:"bg-white rounded-lg shadow",children:(0,s.jsx)(l,{showFilters:!0,maxHeight:"600px"})})]})}},9991:function(e,t,a){"use strict";/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var s=a(955),r=Symbol.for("react.element"),l=Symbol.for("react.fragment"),c=Object.prototype.hasOwnProperty,i=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,n={key:!0,ref:!0,__self:!0,__source:!0};function d(e,t,a){var s,l={},d=null,x=null;for(s in void 0!==a&&(d=""+a),void 0!==t.key&&(d=""+t.key),void 0!==t.ref&&(x=t.ref),t)c.call(t,s)&&!n.hasOwnProperty(s)&&(l[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===l[s]&&(l[s]=t[s]);return{$$typeof:r,type:e,key:d,ref:x,props:l,_owner:i.current}}t.Fragment=l,t.jsx=d,t.jsxs=d},6705:function(e,t,a){"use strict";e.exports=a(9991)}},function(e){e.O(0,[121,114,744],function(){return e(e.s=8765)}),_N_E=e.O()}]);