(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[578],{9530:function(e,t,r){Promise.resolve().then(r.bind(r,285))},285:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return x}});var i=r(6705),a=r(955),o=r(4033);function l(e){let{filters:t,values:r,onChange:o,onReset:l,loading:n=!1}=e,[s,d]=(0,a.useState)(!1),c=(e,t)=>{o({...r,[e]:t})},p=Object.values(r).some(e=>""!==e&&null!=e);return(0,i.jsxs)("div",{style:{background:"white",borderRadius:"8px",padding:"1.5rem",marginBottom:"1.5rem",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",border:"1px solid #dee2e6"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:s?"1.5rem":"0"},children:[(0,i.jsxs)("h3",{style:{margin:0,color:"#2c3e50",display:"flex",alignItems:"center",gap:"0.5rem"},children:["\uD83D\uDD0D Filtre și Căutare",p&&(0,i.jsx)("span",{style:{background:"#007bff",color:"white",borderRadius:"12px",padding:"2px 8px",fontSize:"12px",fontWeight:"normal"},children:Object.values(r).filter(e=>""!==e&&null!=e).length})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:"0.5rem"},children:[p&&(0,i.jsx)("button",{onClick:l,disabled:n,style:{padding:"0.5rem 1rem",background:"#6c757d",color:"white",border:"none",borderRadius:"6px",cursor:n?"not-allowed":"pointer",fontSize:"14px",opacity:n?.6:1},children:"\uD83D\uDD04 Reset"}),(0,i.jsx)("button",{onClick:()=>d(!s),style:{padding:"0.5rem 1rem",background:"transparent",color:"#007bff",border:"1px solid #007bff",borderRadius:"6px",cursor:"pointer",fontSize:"14px"},children:s?"Ascunde ↑":"Extinde ↓"})]})]}),s&&(0,i.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"1rem",alignItems:"end"},children:t.map(e=>{var t;return(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",color:"#495057",fontSize:"14px",fontWeight:500},children:e.label}),"text"===e.type&&(0,i.jsx)("input",{type:"text",value:r[e.key]||"",onChange:t=>c(e.key,t.target.value),placeholder:e.placeholder,disabled:n,style:{width:"100%",padding:"0.75rem",border:"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",opacity:n?.6:1}}),"select"===e.type&&(0,i.jsxs)("select",{value:r[e.key]||"",onChange:t=>c(e.key,t.target.value),disabled:n,style:{width:"100%",padding:"0.75rem",border:"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",background:"white",opacity:n?.6:1},children:[(0,i.jsx)("option",{value:"",children:e.placeholder||"Selectează..."}),null===(t=e.options)||void 0===t?void 0:t.map(e=>(0,i.jsx)("option",{value:e.value,children:e.label},e.value))]}),"date"===e.type&&(0,i.jsx)("input",{type:"date",value:r[e.key]||"",onChange:t=>c(e.key,t.target.value),disabled:n,style:{width:"100%",padding:"0.75rem",border:"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",opacity:n?.6:1}}),"dateRange"===e.type&&(0,i.jsxs)("div",{style:{display:"flex",gap:"0.5rem"},children:[(0,i.jsx)("input",{type:"date",value:r["".concat(e.key,"_start")]||"",onChange:t=>c("".concat(e.key,"_start"),t.target.value),disabled:n,style:{flex:1,padding:"0.75rem",border:"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",opacity:n?.6:1}}),(0,i.jsx)("span",{style:{alignSelf:"center",color:"#6c757d"},children:"→"}),(0,i.jsx)("input",{type:"date",value:r["".concat(e.key,"_end")]||"",onChange:t=>c("".concat(e.key,"_end"),t.target.value),disabled:n,style:{flex:1,padding:"0.75rem",border:"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",opacity:n?.6:1}})]})]},e.key)})})]})}function n(e){let{values:t,onChange:r,onReset:a,loading:o=!1}=e;return(0,i.jsx)(l,{filters:[{key:"search",label:"Căutare generală",type:"text",placeholder:"Caută după nume proiect, client, ID..."},{key:"status",label:"Status proiect",type:"select",placeholder:"Toate statusurile",options:[{value:"Activ",label:"\uD83D\uDFE2 Activ"},{value:"\xcen lucru",label:"\uD83D\uDFE1 \xcen lucru"},{value:"Suspendat",label:"\uD83D\uDFE0 Suspendat"},{value:"Finalizat",label:"✅ Finalizat"},{value:"Anulat",label:"\uD83D\uDD34 Anulat"}]},{key:"client",label:"Client",type:"select",placeholder:"Toți clienții",options:[{value:"SC T&D PRO ELECTRIC SRL",label:"SC T&D PRO ELECTRIC SRL"},{value:"SC PROD SRL",label:"SC PROD SRL"},{value:"SC BUILD SRL",label:"SC BUILD SRL"}]},{key:"data_start",label:"Perioada \xeenceput",type:"dateRange",placeholder:"Data \xeenceput"},{key:"valoare_min",label:"Valoare minimă (RON)",type:"text",placeholder:"0"},{key:"valoare_max",label:"Valoare maximă (RON)",type:"text",placeholder:"999999"}],values:t,onChange:r,onReset:a,loading:o})}var s=r(8259);function d(e){let{proiect:t,onRefresh:r}=e,[o,l]=(0,a.useState)(!1),[n,d]=(0,a.useState)(!1),c=async()=>{try{d(!0),l(!1),s.Am.info("Se generează factura PDF...");let e=await fetch("/api/actions/invoices/generate-hibrid",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({proiectId:t.ID_Proiect,liniiFactura:[{denumire:"Servicii proiect ".concat(t.Denumire),cantitate:1,pretUnitar:t.Valoare_Estimata||0,cotaTva:19}],observatii:"Factură generată automat pentru proiectul ".concat(t.ID_Proiect)})});console.log("Invoice response status:",e.status);let i=await e.json();if(console.log("Invoice response data:",i),i.success)s.Am.success("Factură PDF generată cu succes!"),i.downloadUrl&&window.open(i.downloadUrl,"_blank"),r&&r();else throw Error(i.error||"Eroare la generarea facturii")}catch(e){console.error("Eroare factură:",e),s.Am.error("Eroare la generarea facturii: ".concat(e instanceof Error?e.message:"Eroare necunoscută"))}finally{d(!1)}},p=async()=>{try{l(!1),s.Am.info("Se generează contractul...");let e=await fetch("/api/actions/contracts/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({proiectId:t.ID_Proiect})}),r=await e.json();r.success?(s.Am.success("Contract generat cu succes!"),r.downloadUrl&&window.open(r.downloadUrl,"_blank")):s.Am.error(r.error||"Eroare la generarea contractului")}catch(e){s.Am.error("Eroare la generarea contractului")}};return(0,i.jsxs)("div",{style:{position:"relative",display:"inline-block"},children:[(0,i.jsx)("button",{onClick:()=>l(!o),disabled:n,style:{padding:"8px 16px",backgroundColor:n?"#95a5a6":"#3498db",color:"white",border:"none",borderRadius:"4px",cursor:n?"not-allowed":"pointer",fontSize:"14px"},children:n?"⏳ Generare...":"⚙️ Acțiuni"}),o&&!n&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{style:{position:"absolute",top:"100%",right:0,backgroundColor:"white",border:"1px solid #ddd",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",zIndex:1e3,minWidth:"200px",marginTop:"4px"},children:(0,i.jsxs)("div",{style:{padding:"8px 0"},children:[(0,i.jsxs)("button",{onClick:c,style:{width:"100%",padding:"12px 16px",backgroundColor:"transparent",border:"none",textAlign:"left",cursor:"pointer",fontSize:"14px",color:"#2c3e50",display:"flex",alignItems:"center",gap:"8px"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="#f8f9fa"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[(0,i.jsx)("span",{children:"\uD83D\uDCB0"}),(0,i.jsx)("span",{children:"Generează Factură PDF"})]}),(0,i.jsx)("div",{style:{height:"1px",backgroundColor:"#eee",margin:"4px 0"}}),(0,i.jsxs)("button",{onClick:p,style:{width:"100%",padding:"12px 16px",backgroundColor:"transparent",border:"none",textAlign:"left",cursor:"pointer",fontSize:"14px",color:"#2c3e50",display:"flex",alignItems:"center",gap:"8px"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="#f8f9fa"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[(0,i.jsx)("span",{children:"\uD83D\uDCC4"}),(0,i.jsx)("span",{children:"Generează Contract"})]})]})}),(0,i.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:999},onClick:()=>l(!1)})]})]})}var c=r(3811);function p(e){let{isOpen:t,onClose:r,onProiectAdded:o}=e,[l,n]=(0,a.useState)(!1),[d,p]=(0,a.useState)([]),[u,x]=(0,a.useState)(!1),[m,b]=(0,a.useState)(""),[g,h]=(0,a.useState)(!1),[f,y]=(0,a.useState)({ID_Proiect:"",Denumire:"",Client:"",selectedClientId:"",Descriere:"",Data_Start:"",Data_Final:"",Status:"Activ",Valoare_Estimata:"",Responsabil:"",Observatii:"",subproiecte:[]});(0,a.useEffect)(()=>{t&&(v(),y(e=>({...e,ID_Proiect:"P".concat(new Date().getFullYear()).concat(String(Date.now()).slice(-3))})))},[t]);let v=async()=>{try{let e=await fetch("/api/rapoarte/clienti"),t=await e.json();t.success&&p(t.data||[])}catch(e){console.error("Eroare la \xeencărcarea clienților:",e)}},j=async e=>{e.preventDefault(),n(!0);try{if(!f.ID_Proiect.trim()){s.Am.error("ID proiect este obligatoriu"),n(!1);return}if(!f.Denumire.trim()){s.Am.error("Denumirea proiectului este obligatorie"),n(!1);return}if(!f.Client.trim()){s.Am.error("Clientul este obligatoriu"),n(!1);return}console.log("Trimitere date proiect:",f),s.Am.info("Se adaugă proiectul...");let e={ID_Proiect:f.ID_Proiect.trim(),Denumire:f.Denumire.trim(),Client:f.Client.trim(),Descriere:f.Descriere.trim(),Data_Start:f.Data_Start||null,Data_Final:f.Data_Final||null,Status:f.Status,Valoare_Estimata:f.Valoare_Estimata?parseFloat(f.Valoare_Estimata):null,Responsabil:f.Responsabil.trim(),Observatii:f.Observatii.trim()},t=await fetch("/api/rapoarte/proiecte",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});console.log("Response status proiect:",t.status);let i=await t.json();console.log("Response data proiect:",i),i.success||t.ok?(f.subproiecte.length>0&&await D(f.ID_Proiect),s.Am.success("Proiect adăugat cu succes!"),o(),r(),S()):(console.error("Eroare API proiect:",i),s.Am.error("Eroare: ".concat(i.error||"Eroare necunoscută")))}catch(e){console.error("Eroare la adăugarea proiectului:",e),s.Am.error("Eroare la adăugarea proiectului")}finally{n(!1)}},D=async e=>{for(let t of f.subproiecte)try{let r={ID_Subproiect:"".concat(e,"_SUB_").concat(t.id),ID_Proiect:e,Denumire:t.denumire,Responsabil:t.responsabil,Status:t.status,Valoare_Estimata:t.valoare?parseFloat(t.valoare):null};await fetch("/api/rapoarte/subproiecte",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})}catch(e){console.error("Eroare la adăugarea subproiectului ".concat(t.denumire,":"),e)}},S=()=>{y({ID_Proiect:"",Denumire:"",Client:"",selectedClientId:"",Descriere:"",Data_Start:"",Data_Final:"",Status:"Activ",Valoare_Estimata:"",Responsabil:"",Observatii:"",subproiecte:[]}),b("")},C=(e,t)=>{y(r=>({...r,[e]:t}))},w=e=>{b(e),y(t=>({...t,Client:e})),h(e.length>0)},k=e=>{b(e.nume),y(t=>({...t,Client:e.nume,selectedClientId:e.id})),h(!1)},_=d.filter(e=>e.nume.toLowerCase().includes(m.toLowerCase())).slice(0,5),R=e=>{y(t=>({...t,subproiecte:t.subproiecte.filter(t=>t.id!==e)}))},z=(e,t,r)=>{y(i=>({...i,subproiecte:i.subproiecte.map(i=>i.id===e?{...i,[t]:r}:i)}))};return t?(0,i.jsxs)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.7)",zIndex:99999,display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},children:[(0,i.jsxs)("div",{style:{background:"white",borderRadius:"8px",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",maxWidth:"900px",width:"100%",maxHeight:"90vh",overflowY:"auto"},children:[(0,i.jsxs)("div",{style:{padding:"1.5rem",borderBottom:"1px solid #dee2e6",background:"#f8f9fa",borderRadius:"8px 8px 0 0"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsx)("h2",{style:{margin:0,color:"#2c3e50"},children:"\uD83D\uDCCB Adaugă Proiect Nou"}),(0,i.jsx)("button",{onClick:r,disabled:l,style:{background:"transparent",border:"none",fontSize:"24px",cursor:"pointer",color:"#6c757d"},children:"\xd7"})]}),(0,i.jsx)("p",{style:{margin:"0.5rem 0 0 0",color:"#7f8c8d",fontSize:"14px"},children:"Completează informațiile pentru noul proiect și subproiectele asociate"})]}),(0,i.jsxs)("form",{onSubmit:j,style:{padding:"1.5rem"},children:[(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"1rem",marginBottom:"1rem"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#2c3e50"},children:"ID Proiect *"}),(0,i.jsx)("input",{type:"text",value:f.ID_Proiect,onChange:e=>C("ID_Proiect",e.target.value),disabled:l,placeholder:"P202501",style:{width:"100%",padding:"0.75rem",border:"1px solid #dee2e6",borderRadius:"6px",fontSize:"14px",fontFamily:"monospace",fontWeight:"bold"}})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#2c3e50"},children:"Status"}),(0,i.jsxs)("select",{value:f.Status,onChange:e=>C("Status",e.target.value),disabled:l,style:{width:"100%",padding:"0.75rem",border:"1px solid #dee2e6",borderRadius:"6px",fontSize:"14px"},children:[(0,i.jsx)("option",{value:"Activ",children:"\uD83D\uDFE2 Activ"}),(0,i.jsx)("option",{value:"Planificat",children:"\uD83D\uDCC5 Planificat"}),(0,i.jsx)("option",{value:"Suspendat",children:"⏸️ Suspendat"})]})]})]}),(0,i.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,i.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#2c3e50"},children:"Denumire Proiect *"}),(0,i.jsx)("input",{type:"text",value:f.Denumire,onChange:e=>C("Denumire",e.target.value),disabled:l,placeholder:"Numele proiectului",style:{width:"100%",padding:"0.75rem",border:"1px solid #dee2e6",borderRadius:"6px",fontSize:"14px"}})]}),(0,i.jsxs)("div",{style:{marginBottom:"1rem",position:"relative"},children:[(0,i.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#2c3e50"},children:"Client *"}),(0,i.jsxs)("div",{style:{display:"flex",gap:"0.5rem"},children:[(0,i.jsxs)("div",{style:{flex:1,position:"relative"},children:[(0,i.jsx)("input",{type:"text",value:m,onChange:e=>w(e.target.value),disabled:l,placeholder:"Caută client sau scrie numele...",style:{width:"100%",padding:"0.75rem",border:"1px solid #dee2e6",borderRadius:"6px",fontSize:"14px"}}),g&&_.length>0&&(0,i.jsx)("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"white",border:"1px solid #dee2e6",borderTop:"none",borderRadius:"0 0 6px 6px",boxShadow:"0 4px 8px rgba(0,0,0,0.1)",zIndex:1e3,maxHeight:"200px",overflowY:"auto"},children:_.map(e=>(0,i.jsxs)("div",{onClick:()=>k(e),style:{padding:"0.75rem",cursor:"pointer",borderBottom:"1px solid #f1f2f6",fontSize:"14px"},onMouseOver:e=>{e.currentTarget.style.background="#f8f9fa"},onMouseOut:e=>{e.currentTarget.style.background="white"},children:[(0,i.jsx)("div",{style:{fontWeight:"bold"},children:e.nume}),e.cui&&(0,i.jsxs)("div",{style:{fontSize:"12px",color:"#7f8c8d"},children:["CUI: ",e.cui]})]},e.id))})]}),(0,i.jsx)("button",{type:"button",onClick:()=>x(!0),disabled:l,style:{padding:"0.75rem 1rem",background:"#27ae60",color:"white",border:"none",borderRadius:"6px",cursor:l?"not-allowed":"pointer",fontSize:"12px",fontWeight:"bold",whiteSpace:"nowrap"},children:"+ Client Nou"})]})]}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginBottom:"1rem"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#2c3e50"},children:"Data \xcenceput"}),(0,i.jsx)("input",{type:"date",value:f.Data_Start,onChange:e=>C("Data_Start",e.target.value),disabled:l,style:{width:"100%",padding:"0.75rem",border:"1px solid #dee2e6",borderRadius:"6px",fontSize:"14px"}})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#2c3e50"},children:"Data Finalizare"}),(0,i.jsx)("input",{type:"date",value:f.Data_Final,onChange:e=>C("Data_Final",e.target.value),disabled:l,style:{width:"100%",padding:"0.75rem",border:"1px solid #dee2e6",borderRadius:"6px",fontSize:"14px"}})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#2c3e50"},children:"Valoare Estimată (RON)"}),(0,i.jsx)("input",{type:"number",value:f.Valoare_Estimata,onChange:e=>C("Valoare_Estimata",e.target.value),disabled:l,placeholder:"15000",style:{width:"100%",padding:"0.75rem",border:"1px solid #dee2e6",borderRadius:"6px",fontSize:"14px"}})]})]}),(0,i.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,i.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#2c3e50"},children:"Responsabil"}),(0,i.jsx)("input",{type:"text",value:f.Responsabil,onChange:e=>C("Responsabil",e.target.value),disabled:l,placeholder:"Numele responsabilului de proiect",style:{width:"100%",padding:"0.75rem",border:"1px solid #dee2e6",borderRadius:"6px",fontSize:"14px"}})]}),(0,i.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,i.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#2c3e50"},children:"Descriere"}),(0,i.jsx)("textarea",{value:f.Descriere,onChange:e=>C("Descriere",e.target.value),disabled:l,placeholder:"Descrierea detaliată a proiectului...",rows:3,style:{width:"100%",padding:"0.75rem",border:"1px solid #dee2e6",borderRadius:"6px",fontSize:"14px",resize:"vertical"}})]}),(0,i.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[(0,i.jsx)("h4",{style:{margin:0,color:"#2c3e50"},children:"\uD83D\uDCCB Subproiecte"}),(0,i.jsx)("button",{type:"button",onClick:()=>{let e={id:Date.now().toString(),denumire:"",responsabil:"",valoare:"",status:"Planificat"};y(t=>({...t,subproiecte:[...t.subproiecte,e]}))},disabled:l,style:{padding:"0.5rem 1rem",background:"#3498db",color:"white",border:"none",borderRadius:"6px",cursor:l?"not-allowed":"pointer",fontSize:"12px",fontWeight:"bold"},children:"+ Adaugă Subproiect"})]}),f.subproiecte.map((e,t)=>(0,i.jsxs)("div",{style:{border:"1px solid #dee2e6",borderRadius:"6px",padding:"1rem",marginBottom:"1rem",background:"#f8f9fa"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[(0,i.jsxs)("h5",{style:{margin:0,color:"#2c3e50"},children:["Subproiect #",t+1]}),(0,i.jsx)("button",{type:"button",onClick:()=>R(e.id),disabled:l,style:{background:"#e74c3c",color:"white",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:"pointer",fontSize:"12px"},children:"\uD83D\uDDD1️"})]}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"0.5rem"},children:[(0,i.jsx)("input",{type:"text",value:e.denumire,onChange:t=>z(e.id,"denumire",t.target.value),disabled:l,placeholder:"Denumire subproiect",style:{padding:"0.5rem",border:"1px solid #dee2e6",borderRadius:"4px",fontSize:"14px"}}),(0,i.jsx)("input",{type:"text",value:e.responsabil,onChange:t=>z(e.id,"responsabil",t.target.value),disabled:l,placeholder:"Responsabil",style:{padding:"0.5rem",border:"1px solid #dee2e6",borderRadius:"4px",fontSize:"14px"}}),(0,i.jsx)("input",{type:"number",value:e.valoare,onChange:t=>z(e.id,"valoare",t.target.value),disabled:l,placeholder:"Valoare (RON)",style:{padding:"0.5rem",border:"1px solid #dee2e6",borderRadius:"4px",fontSize:"14px"}}),(0,i.jsxs)("select",{value:e.status,onChange:t=>z(e.id,"status",t.target.value),disabled:l,style:{padding:"0.5rem",border:"1px solid #dee2e6",borderRadius:"4px",fontSize:"14px"},children:[(0,i.jsx)("option",{value:"Planificat",children:"\uD83D\uDCC5 Planificat"}),(0,i.jsx)("option",{value:"Activ",children:"\uD83D\uDFE2 Activ"}),(0,i.jsx)("option",{value:"Finalizat",children:"✅ Finalizat"})]})]})]},e.id))]}),(0,i.jsxs)("div",{style:{marginBottom:"1.5rem"},children:[(0,i.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#2c3e50"},children:"Observații"}),(0,i.jsx)("textarea",{value:f.Observatii,onChange:e=>C("Observatii",e.target.value),disabled:l,placeholder:"Observații despre proiect...",rows:2,style:{width:"100%",padding:"0.75rem",border:"1px solid #dee2e6",borderRadius:"6px",fontSize:"14px",resize:"vertical"}})]}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"1rem",paddingTop:"1rem",borderTop:"1px solid #dee2e6"},children:[(0,i.jsx)("button",{type:"button",onClick:r,disabled:l,style:{padding:"0.75rem 1.5rem",background:"#6c757d",color:"white",border:"none",borderRadius:"6px",cursor:l?"not-allowed":"pointer",fontSize:"14px",fontWeight:"bold"},children:"Anulează"}),(0,i.jsx)("button",{type:"submit",disabled:l,style:{padding:"0.75rem 1.5rem",background:l?"#bdc3c7":"#27ae60",color:"white",border:"none",borderRadius:"6px",cursor:l?"not-allowed":"pointer",fontSize:"14px",fontWeight:"bold"},children:l?"⏳ Se adaugă...":"\uD83D\uDCBE Adaugă Proiect"})]})]})]}),u&&(0,i.jsx)(c.Z,{isOpen:u,onClose:()=>x(!1),onClientAdded:()=>{v(),x(!1)}})]}):null}function u(e){let{searchParams:t}=e,[r,o]=(0,a.useState)([]),[l,n]=(0,a.useState)(!0),[c,u]=(0,a.useState)(0),[x,m]=(0,a.useState)(!1);(0,a.useEffect)(()=>{b()},[t,c]),(0,a.useEffect)(()=>{if((null==t?void 0:t.invoice_status)&&(null==t?void 0:t.project_id)){let e=t.invoice_status,r=t.project_id;switch(e){case"success":s.Am.success("Factură creată cu succes pentru proiectul ".concat(r,"!"));break;case"cancelled":s.Am.info("Crearea facturii pentru proiectul ".concat(r," a fost anulată."));break;default:s.Am.info("Status factură pentru proiectul ".concat(r,": ").concat(e))}}},[t]);let b=async()=>{try{n(!0);let e=new URLSearchParams;t&&Object.entries(t).forEach(t=>{let[r,i]=t;i&&"invoice_status"!==r&&"project_id"!==r&&e.append(r,i)});let r=await fetch("/api/rapoarte/proiecte?".concat(e.toString())),i=await r.json(),a=await fetch("/api/rapoarte/subproiecte?".concat(e.toString())),l=await a.json();if(i.success){let e=(i.data||[]).map(e=>({...e,tip:"proiect"})),t=[];l.success&&(t=(l.data||[]).map(e=>({ID_Proiect:e.ID_Subproiect,Denumire:e.Denumire,Client:e.Client||"Subproiect",Status:e.Status,Data_Start:e.Data_Start,Data_Final:e.Data_Final,Valoare_Estimata:e.Valoare_Estimata,tip:"subproiect",ID_Proiect_Parinte:e.ID_Proiect})));let r=[];e.forEach(e=>{r.push(e);let i=t.filter(t=>t.ID_Proiect_Parinte===e.ID_Proiect);r.push(...i)}),o(r)}else s.Am.error("Eroare la \xeencărcarea proiectelor"),o([])}catch(e){console.error("Eroare la \xeencărcarea proiectelor:",e),s.Am.error("Eroare de conectare"),o([])}finally{n(!1)}},g=()=>{u(e=>e+1)},h=async()=>{try{s.Am.info("Se generează fișierul Excel...");let r=new URLSearchParams;t&&Object.entries(t).forEach(e=>{let[t,i]=e;i&&"invoice_status"!==t&&"project_id"!==t&&r.append(t,i)});let i=await fetch("/api/rapoarte/proiecte/export?".concat(r.toString()));if(i.ok){var e;let t=await i.blob(),r=window.URL.createObjectURL(t),a=document.createElement("a");a.href=r;let o=i.headers.get("Content-Disposition"),l=o?null===(e=o.split("filename=")[1])||void 0===e?void 0:e.replace(/"/g,""):"Proiecte_".concat(new Date().toISOString().split("T")[0],".xlsx");a.download=l,a.click(),window.URL.revokeObjectURL(r),s.Am.success("Fișier Excel descărcat cu succes!")}else{let e=await i.json();s.Am.error("Eroare la export: ".concat(e.error))}}catch(e){console.error("Eroare la exportul Excel:",e),s.Am.error("Eroare la exportul Excel")}},f=e=>{if(!e)return"";try{let t=new Date(e);if(isNaN(t.getTime()))return"";return t.toLocaleDateString("ro-RO",{year:"numeric",month:"2-digit",day:"2-digit"})}catch(e){return""}},y=e=>e||0===e?new Intl.NumberFormat("ro-RO",{style:"currency",currency:"RON"}).format(e):"",v=e=>{switch(e){case"Activ":return"#27ae60";case"Finalizat":return"#3498db";case"Suspendat":return"#f39c12";case"Arhivat":return"#95a5a6";default:return"#7f8c8d"}},j=e=>{switch(e){case"Activ":return"\uD83D\uDFE2";case"Finalizat":return"✅";case"Suspendat":return"⏸️";case"Arhivat":return"\uD83D\uDCE6";default:return"⚪"}};return l?(0,i.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"300px",fontSize:"16px",color:"#7f8c8d"},children:"⏳ Se \xeencarcă proiectele..."}):(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem",padding:"1rem",background:"#f8f9fa",borderRadius:"8px",border:"1px solid #dee2e6"},children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("h3",{style:{margin:0,color:"#2c3e50"},children:["\uD83D\uDCCB Proiecte găsite: ",r.filter(e=>"proiect"===e.tip).length,r.filter(e=>"subproiect"===e.tip).length>0&&" (+ ".concat(r.filter(e=>"subproiect"===e.tip).length," subproiecte)")]}),(0,i.jsx)("p",{style:{margin:"0.25rem 0 0 0",fontSize:"14px",color:"#7f8c8d"},children:t&&Object.keys(t).length>0?"Rezultate filtrate":"Toate proiectele și subproiectele"})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:"0.5rem"},children:[(0,i.jsx)("button",{onClick:()=>m(!0),style:{padding:"0.5rem 1rem",background:"#27ae60",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:"+ Proiect Nou"}),(0,i.jsx)("button",{onClick:g,style:{padding:"0.5rem 1rem",background:"#3498db",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:"\uD83D\uDD04 Re\xeemprospătează"}),(0,i.jsx)("button",{onClick:h,style:{padding:"0.5rem 1rem",background:"#f39c12",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:"\uD83D\uDCCA Export Excel"})]})]}),0===r.length?(0,i.jsxs)("div",{style:{textAlign:"center",padding:"3rem",background:"#f8f9fa",borderRadius:"8px",border:"2px dashed #dee2e6"},children:[(0,i.jsx)("p",{style:{fontSize:"18px",color:"#7f8c8d",margin:0},children:"\uD83D\uDCCB Nu au fost găsite proiecte"}),(0,i.jsx)("p",{style:{fontSize:"14px",color:"#bdc3c7",margin:"0.5rem 0 0 0"},children:"Verifică filtrele aplicate sau adaugă proiecte noi."})]}):(0,i.jsx)("div",{style:{background:"white",borderRadius:"8px",border:"1px solid #dee2e6",overflow:"visible",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",position:"relative"},children:(0,i.jsxs)("div",{style:{overflow:"auto"},children:[" ",(0,i.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"14px"},children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{style:{background:"#f8f9fa",borderBottom:"2px solid #dee2e6"},children:[(0,i.jsx)("th",{style:{padding:"1rem 0.75rem",textAlign:"left",fontWeight:"bold",color:"#2c3e50"},children:"ID Proiect"}),(0,i.jsx)("th",{style:{padding:"1rem 0.75rem",textAlign:"left",fontWeight:"bold",color:"#2c3e50"},children:"Denumire"}),(0,i.jsx)("th",{style:{padding:"1rem 0.75rem",textAlign:"left",fontWeight:"bold",color:"#2c3e50"},children:"Client"}),(0,i.jsx)("th",{style:{padding:"1rem 0.75rem",textAlign:"center",fontWeight:"bold",color:"#2c3e50"},children:"Status"}),(0,i.jsx)("th",{style:{padding:"1rem 0.75rem",textAlign:"center",fontWeight:"bold",color:"#2c3e50"},children:"Data \xcenceput"}),(0,i.jsx)("th",{style:{padding:"1rem 0.75rem",textAlign:"right",fontWeight:"bold",color:"#2c3e50"},children:"Valoare Estimată"}),(0,i.jsx)("th",{style:{padding:"1rem 0.75rem",textAlign:"center",fontWeight:"bold",color:"#2c3e50"},children:"Acțiuni"})]})}),(0,i.jsx)("tbody",{children:r.map((e,t)=>(0,i.jsxs)("tr",{style:{borderBottom:"1px solid #f1f2f6",background:t%2==0?"white":"#fafbfc"},children:[(0,i.jsxs)("td",{style:{padding:"0.75rem",fontFamily:"monospace",fontWeight:"bold",color:"#2c3e50",paddingLeft:"subproiect"===e.tip?"2rem":"0.75rem"},children:["subproiect"===e.tip&&"└─ ",e.ID_Proiect,"subproiect"===e.tip&&(0,i.jsx)("span",{style:{fontSize:"10px",color:"#7f8c8d",marginLeft:"0.5rem"},children:"(Sub)"})]}),(0,i.jsx)("td",{style:{padding:"0.75rem",color:"#2c3e50",maxWidth:"250px",paddingLeft:"subproiect"===e.tip?"2rem":"0.75rem"},children:(0,i.jsx)("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontStyle:"subproiect"===e.tip?"italic":"normal"},title:e.Denumire,children:e.Denumire})}),(0,i.jsx)("td",{style:{padding:"0.75rem",color:"#2c3e50"},children:e.Client}),(0,i.jsx)("td",{style:{padding:"0.75rem",textAlign:"center"},children:(0,i.jsxs)("span",{style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",padding:"0.25rem 0.5rem",borderRadius:"12px",fontSize:"12px",fontWeight:"bold",color:"white",background:v(e.Status)},children:[j(e.Status)," ",e.Status]})}),(0,i.jsx)("td",{style:{padding:"0.75rem",textAlign:"center",color:"#7f8c8d",fontFamily:"monospace"},children:f(e.Data_Start)}),(0,i.jsx)("td",{style:{padding:"0.75rem",textAlign:"right",fontWeight:"bold",color:e.Valoare_Estimata?"#27ae60":"#bdc3c7"},children:y(e.Valoare_Estimata)}),(0,i.jsx)("td",{style:{padding:"0.75rem",textAlign:"center",position:"relative"},children:(0,i.jsx)(d,{proiect:e,onRefresh:g})})]},"".concat(e.tip,"-").concat(e.ID_Proiect)))})]})]})}),(0,i.jsx)(p,{isOpen:x,onClose:()=>m(!1),onProiectAdded:g})]})}function x(){let e=(0,o.useRouter)(),t=(0,o.useSearchParams)(),[r,l]=(0,a.useState)({search:(null==t?void 0:t.get("search"))||"",status:(null==t?void 0:t.get("status"))||"",client:(null==t?void 0:t.get("client"))||"",data_start_start:(null==t?void 0:t.get("data_start_start"))||"",data_start_end:(null==t?void 0:t.get("data_start_end"))||"",valoare_min:(null==t?void 0:t.get("valoare_min"))||"",valoare_max:(null==t?void 0:t.get("valoare_max"))||""}),s=Object.fromEntries(Object.entries(r).filter(e=>{let[t,r]=e;return""!==r}));return(0,i.jsxs)("div",{style:{padding:"1.5rem"},children:[(0,i.jsxs)("div",{style:{marginBottom:"2rem",borderBottom:"2px solid #e9ecef",paddingBottom:"1rem"},children:[(0,i.jsx)("h1",{style:{margin:0,color:"#2c3e50",fontSize:"2rem",fontWeight:"bold"},children:"\uD83D\uDCCB Management Proiecte"}),(0,i.jsx)("p",{style:{margin:"0.5rem 0 0 0",color:"#7f8c8d",fontSize:"1.1rem"},children:"Gestionează și monitorizează toate proiectele din portofoliu"})]}),(0,i.jsx)("div",{style:{marginBottom:"1.5rem",background:"white",border:"1px solid #dee2e6",borderRadius:"8px",padding:"1.5rem",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:(0,i.jsx)(a.Suspense,{fallback:(0,i.jsx)("div",{style:{padding:"2rem",textAlign:"center",color:"#7f8c8d"},children:"⏳ Se \xeencarcă filtrele..."}),children:(0,i.jsx)(n,{values:r,onChange:t=>{l(t);let r=new URLSearchParams;Object.entries(t).forEach(e=>{let[t,i]=e;i&&r.set(t,i)});let i=r.toString()?"/admin/rapoarte/proiecte?".concat(r.toString()):"/admin/rapoarte/proiecte";e.push(i)},onReset:()=>{l({search:"",status:"",client:"",data_start_start:"",data_start_end:"",valoare_min:"",valoare_max:""}),e.push("/admin/rapoarte/proiecte")}})})}),(0,i.jsx)("div",{style:{background:"white",border:"1px solid #dee2e6",borderRadius:"8px",overflow:"hidden",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:(0,i.jsx)(a.Suspense,{fallback:(0,i.jsx)("div",{style:{padding:"3rem",textAlign:"center",color:"#7f8c8d"},children:"⏳ Se \xeencarcă proiectele..."}),children:(0,i.jsx)(u,{searchParams:s})})}),(0,i.jsx)("div",{style:{marginTop:"2rem",padding:"1rem",background:"#f8f9fa",borderRadius:"6px",border:"1px solid #e9ecef"},children:(0,i.jsxs)("p",{style:{margin:0,fontSize:"14px",color:"#6c757d",textAlign:"center"},children:["\uD83D\uDCA1 ",(0,i.jsx)("strong",{children:"Tip:"}),' Folosește filtrele pentru a găsi rapid proiectele dorite. Click pe "Acțiuni" pentru a gestiona fiecare proiect individual.']})})]})}},4033:function(e,t,r){e.exports=r(8165)}},function(e){e.O(0,[259,811,121,114,744],function(){return e(e.s=9530)}),_N_E=e.O()}]);