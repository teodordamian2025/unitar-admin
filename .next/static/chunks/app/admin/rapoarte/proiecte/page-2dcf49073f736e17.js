(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[578],{9530:function(e,t,r){Promise.resolve().then(r.bind(r,9883))},9883:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return y}});var a=r(6705),i=r(955),o=r(4033);function l(e){let{filters:t,values:r,onChange:o,onReset:l,loading:s=!1}=e,[n,d]=(0,i.useState)(!1),c=(e,t)=>{o({...r,[e]:t})},u=Object.values(r).some(e=>""!==e&&null!=e);return(0,a.jsxs)("div",{style:{background:"white",borderRadius:"8px",padding:"1.5rem",marginBottom:"1.5rem",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",border:"1px solid #dee2e6"},children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:n?"1.5rem":"0"},children:[(0,a.jsxs)("h3",{style:{margin:0,color:"#2c3e50",display:"flex",alignItems:"center",gap:"0.5rem"},children:["\uD83D\uDD0D Filtre și Căutare",u&&(0,a.jsx)("span",{style:{background:"#007bff",color:"white",borderRadius:"12px",padding:"2px 8px",fontSize:"12px",fontWeight:"normal"},children:Object.values(r).filter(e=>""!==e&&null!=e).length})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:"0.5rem"},children:[u&&(0,a.jsx)("button",{onClick:l,disabled:s,style:{padding:"0.5rem 1rem",background:"#6c757d",color:"white",border:"none",borderRadius:"6px",cursor:s?"not-allowed":"pointer",fontSize:"14px",opacity:s?.6:1},children:"\uD83D\uDD04 Reset"}),(0,a.jsx)("button",{onClick:()=>d(!n),style:{padding:"0.5rem 1rem",background:"transparent",color:"#007bff",border:"1px solid #007bff",borderRadius:"6px",cursor:"pointer",fontSize:"14px"},children:n?"Ascunde ↑":"Extinde ↓"})]})]}),n&&(0,a.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"1rem",alignItems:"end"},children:t.map(e=>{var t;return(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",color:"#495057",fontSize:"14px",fontWeight:500},children:e.label}),"text"===e.type&&(0,a.jsx)("input",{type:"text",value:r[e.key]||"",onChange:t=>c(e.key,t.target.value),placeholder:e.placeholder,disabled:s,style:{width:"100%",padding:"0.75rem",border:"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",opacity:s?.6:1}}),"select"===e.type&&(0,a.jsxs)("select",{value:r[e.key]||"",onChange:t=>c(e.key,t.target.value),disabled:s,style:{width:"100%",padding:"0.75rem",border:"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",background:"white",opacity:s?.6:1},children:[(0,a.jsx)("option",{value:"",children:e.placeholder||"Selectează..."}),null===(t=e.options)||void 0===t?void 0:t.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))]}),"date"===e.type&&(0,a.jsx)("input",{type:"date",value:r[e.key]||"",onChange:t=>c(e.key,t.target.value),disabled:s,style:{width:"100%",padding:"0.75rem",border:"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",opacity:s?.6:1}}),"dateRange"===e.type&&(0,a.jsxs)("div",{style:{display:"flex",gap:"0.5rem"},children:[(0,a.jsx)("input",{type:"date",value:r["".concat(e.key,"_start")]||"",onChange:t=>c("".concat(e.key,"_start"),t.target.value),disabled:s,style:{flex:1,padding:"0.75rem",border:"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",opacity:s?.6:1}}),(0,a.jsx)("span",{style:{alignSelf:"center",color:"#6c757d"},children:"→"}),(0,a.jsx)("input",{type:"date",value:r["".concat(e.key,"_end")]||"",onChange:t=>c("".concat(e.key,"_end"),t.target.value),disabled:s,style:{flex:1,padding:"0.75rem",border:"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",opacity:s?.6:1}})]})]},e.key)})})]})}function s(e){let{values:t,onChange:r,onReset:i,loading:o=!1}=e;return(0,a.jsx)(l,{filters:[{key:"search",label:"Căutare generală",type:"text",placeholder:"Caută după nume proiect, client, ID..."},{key:"status",label:"Status proiect",type:"select",placeholder:"Toate statusurile",options:[{value:"Activ",label:"\uD83D\uDFE2 Activ"},{value:"\xcen lucru",label:"\uD83D\uDFE1 \xcen lucru"},{value:"Suspendat",label:"\uD83D\uDFE0 Suspendat"},{value:"Finalizat",label:"✅ Finalizat"},{value:"Anulat",label:"\uD83D\uDD34 Anulat"}]},{key:"client",label:"Client",type:"select",placeholder:"Toți clienții",options:[{value:"SC T&D PRO ELECTRIC SRL",label:"SC T&D PRO ELECTRIC SRL"},{value:"SC PROD SRL",label:"SC PROD SRL"},{value:"SC BUILD SRL",label:"SC BUILD SRL"}]},{key:"data_start",label:"Perioada \xeenceput",type:"dateRange",placeholder:"Data \xeenceput"},{key:"valoare_min",label:"Valoare minimă (RON)",type:"text",placeholder:"0"},{key:"valoare_max",label:"Valoare maximă (RON)",type:"text",placeholder:"999999"}],values:t,onChange:r,onReset:i,loading:o})}let n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",r=document.createElement("div");r.style.cssText="\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    background: ".concat("success"===t?"#27ae60":"error"===t?"#e74c3c":"#3498db",";\n    color: white;\n    padding: 12px 20px;\n    border-radius: 6px;\n    z-index: 10000;\n    font-family: Arial, sans-serif;\n    font-size: 14px;\n    font-weight: 500;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n    max-width: 400px;\n    word-wrap: break-word;\n  "),r.textContent=e,document.body.appendChild(r),setTimeout(()=>{document.body.contains(r)&&document.body.removeChild(r)},"success"===t||"error"===t?4e3:6e3)};function d(e){let{proiect:t,onClose:r,onSuccess:o}=e,[l,s]=(0,i.useState)([{denumire:t.Denumire,cantitate:1,pretUnitar:t.Valoare_Estimata||0,cotaTva:19,tip:"proiect"}]),[d,c]=(0,i.useState)(""),[u,p]=(0,i.useState)(null),[x,m]=(0,i.useState)(!1),[b,g]=(0,i.useState)(!1),[h,f]=(0,i.useState)(!1),[y,v]=(0,i.useState)(!1),[j,D]=(0,i.useState)(""),[S,w]=(0,i.useState)(null),[C,N]=(0,i.useState)(!1),[k,_]=(0,i.useState)([]),[z,E]=(0,i.useState)(!1),R=e=>{if(!e)return"";let t="string"==typeof e?e:e.value;try{return new Date(t).toLocaleDateString("ro-RO")}catch(e){return""}};(0,i.useEffect)(()=>{A(),P()},[t]);let A=async()=>{if(t.Client){f(!0);try{let e=await fetch("/api/rapoarte/clienti?search=".concat(encodeURIComponent(t.Client))),r=await e.json();if(r.success&&r.data&&r.data.length>0){let e=r.data[0];p({id:e.id,denumire:e.nume,cui:e.cui||"",nrRegCom:e.nr_reg_com||"",adresa:e.adresa||"",judet:e.judet,localitate:e.oras,telefon:e.telefon,email:e.email}),e.cui&&D(e.cui),n("✅ Date client preluate din BD: ".concat(e.nume),"success")}else p({denumire:t.Client,cui:"",nrRegCom:"",adresa:""}),n('ℹ️ Client "'.concat(t.Client,'" nu găsit \xeen BD. Completează manual datele.'),"info")}catch(e){console.error("Eroare la \xeencărcarea clientului din BD:",e),p({denumire:t.Client,cui:"",nrRegCom:"",adresa:""}),n("⚠️ Nu s-au putut prelua datele clientului din BD","error")}finally{f(!1)}}},P=async()=>{v(!0);try{let e=await fetch("/api/rapoarte/subproiecte?proiect_id=".concat(encodeURIComponent(t.ID_Proiect))),r=await e.json();if(r.success&&r.data){let e=r.data.map(e=>({ID_Subproiect:e.ID_Subproiect,Denumire:e.Denumire,Valoare_Estimata:e.Valoare_Estimata,Status:e.Status,adaugat:!1}));_(e),e.length>0&&n("\uD83D\uDCCB Găsite ".concat(e.length," subproiecte disponibile pentru factură"),"info")}}catch(e){console.error("Eroare la \xeencărcarea subproiectelor:",e),n("⚠️ Nu s-au putut \xeencărca subproiectele","error")}finally{v(!1)}},I=e=>{if(l.length>1){let t=l[e];"subproiect"===t.tip&&t.subproiect_id&&_(e=>e.map(e=>e.ID_Subproiect===t.subproiect_id?{...e,adaugat:!1}:e)),s(l.filter((t,r)=>r!==e))}},F=(e,t,r)=>{let a=[...l];a[e]={...a[e],[t]:r},s(a)},T=e=>{let t={denumire:"".concat(e.Denumire," (Subproiect)"),cantitate:1,pretUnitar:e.Valoare_Estimata||0,cotaTva:19,tip:"subproiect",subproiect_id:e.ID_Subproiect};s(e=>[...e,t]),_(t=>t.map(t=>t.ID_Subproiect===e.ID_Subproiect?{...t,adaugat:!0}:t)),n('✅ Subproiect "'.concat(e.Denumire,'" adăugat la factură'),"success")},B=async()=>{if(!j.trim()){n("Introduceți CUI-ul clientului","error");return}g(!0),w(null);try{let e=await fetch("/api/anaf/company-info?cui=".concat(encodeURIComponent(j))),t=await e.json();if(t.success){let e=t.data;p({...u,denumire:e.denumire,cui:e.cui,nrRegCom:e.nrRegCom,adresa:e.adresa,judet:e.judet,localitate:e.localitate,telefon:e.telefon,status:e.status,platitorTva:e.platitorTva}),n("✅ Datele au fost actualizate cu informațiile de la ANAF!","success"),"Inactiv"===e.status&&n("⚠️ Atenție: Compania este inactivă conform ANAF!","error"),"Nu"===e.platitorTva&&n("ℹ️ Compania nu este plătitoare de TVA","info")}else w(t.error),n("❌ ".concat(t.error),"error")}catch(t){let e="Eroare la comunicarea cu ANAF";w(e),n(e,"error")}finally{g(!1)}},O=()=>new Promise((e,t)=>{if(window.jsPDF&&window.html2canvas){e();return}let r=document.createElement("script");r.src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js",r.onload=()=>{window.jsPDF=window.jspdf.jsPDF;let r=document.createElement("script");r.src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js",r.onload=()=>{window.html2canvas=window.html2canvas,e()},r.onerror=t,document.head.appendChild(r)},r.onerror=t,document.head.appendChild(r)}),W=async(e,t)=>{try{N(!0),n("\uD83D\uDD04 Se procesează HTML-ul \xeen PDF...","info"),await O();let r=document.createElement("div");r.id="pdf-content",r.style.position="fixed",r.style.left="0px",r.style.top="0px",r.style.width="794px",r.style.height="1000px",r.style.backgroundColor="white",r.style.fontFamily="Arial, sans-serif",r.style.fontSize="4px",r.style.color="#333",r.style.lineHeight="1.0",r.style.padding="15px",r.style.zIndex="-1000",r.style.opacity="1",r.style.transform="scale(1)",r.style.overflow="hidden",r.style.boxSizing="border-box",r.style.display="flex",r.style.flexDirection="column",r.style.justifyContent="space-between";let a=new DOMParser,i=a.parseFromString(e,"text/html"),l=i.querySelector("style"),s=l&&l.textContent||"",d=i.body;if(d){r.innerHTML=d.innerHTML;let e=document.createElement("style");e.id="pdf-styles",e.textContent=s,document.getElementById("pdf-styles")||document.head.appendChild(e)}else r.innerHTML=e;document.body.appendChild(r),await new Promise(e=>setTimeout(e,1e3));let c=new window.jsPDF("p","pt","a4"),u=c.internal.pageSize.getWidth(),p=document.getElementById("pdf-content");await c.html(p||r,{callback:function(e){document.body.removeChild(r);let a=document.getElementById("pdf-styles");a&&document.head.removeChild(a),e.save(t),n("✅ PDF generat și descărcat cu succes!","success"),o(t.replace(".pdf",""),""),N(!1)},margin:[10,10,10,10],width:u-20,windowWidth:u-20,autoPaging:"text",html2canvas:{allowTaint:!0,dpi:96,letterRendering:!0,logging:!1,scale:.75,useCORS:!0,backgroundColor:"#ffffff",height:1e3,width:u-20,scrollX:0,scrollY:0,windowWidth:u-20,windowHeight:1e3,onclone:e=>{let t=e.getElementById("pdf-content");if(t){let r;let a=t.querySelectorAll("*");a.forEach(e=>{e.style.fontSize="3px",e.style.lineHeight="0.8",e.style.margin="0.25px",e.style.padding="0.25px",e.style.marginTop="0.25px",e.style.marginBottom="0.25px",e.style.paddingTop="0.25px",e.style.paddingBottom="0.25px"});let i=t.querySelectorAll("h1, h2, h3, h4, .header h1");i.forEach(e=>{e.style.fontSize="4px",e.style.margin="0.5px 0",e.style.padding="0.5px 0",e.style.fontWeight="bold"});let o=t.querySelectorAll(".invoice-number");o.forEach(e=>{e.style.fontSize="6px",e.style.margin="1px 0",e.style.fontWeight="bold"});let l=t.querySelectorAll("table, th, td");l.forEach(e=>{e.style.fontSize="2.5px",e.style.padding="0.25px",e.style.margin="0",e.style.borderSpacing="0",e.style.borderCollapse="collapse",e.style.lineHeight="0.8"});let s=t.querySelectorAll("div");s.forEach(e=>{e.style.margin="0.25px 0",e.style.padding="0.25px"});let n=t.querySelectorAll("p, span, .info-line, strong");n.forEach(e=>{e.style.fontSize="3px",e.style.lineHeight="0.8",e.style.margin="0.25px 0",e.style.padding="0.25px 0"});let d=e.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,null,!1);for(;r=d.nextNode();){let t=r,a=e.defaultView.getComputedStyle(t),i=parseFloat(a.fontSize);i>4&&(t.style.fontSize="3px !important",t.style.setProperty("font-size","3px","important")),parseFloat(a.marginTop)>2&&(t.style.marginTop="0.5px !important"),parseFloat(a.marginBottom)>2&&(t.style.marginBottom="0.5px !important"),parseFloat(a.paddingTop)>2&&(t.style.paddingTop="0.25px !important"),parseFloat(a.paddingBottom)>2&&(t.style.paddingBottom="0.25px !important")}t.style.fontSize="3px !important",t.style.lineHeight="0.8 !important",t.style.padding="5px !important",t.style.margin="0 !important"}}}})}catch(e){N(!1),console.error("❌ PDF processing error:",e),n("❌ Eroare la generarea PDF: ".concat(e instanceof Error?e.message:"Eroare necunoscută"),"error")}},V=async()=>{if(!(null==u?void 0:u.cui)){n("CUI-ul clientului este obligatoriu","error");return}if(l.some(e=>!e.denumire.trim()||e.pretUnitar<=0)){n("Toate liniile trebuie să aibă denumire și preț valid","error");return}if(!u.denumire.trim()){n("Denumirea clientului este obligatorie","error");return}m(!0);try{n("\uD83D\uDD04 Se generează template-ul facturii...","info");let e=await fetch("/api/actions/invoices/generate-hibrid",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({proiectId:t.ID_Proiect,liniiFactura:l,observatii:d,clientInfo:u})}),r=await e.json();if(r.success&&r.htmlContent)n("✅ Template generat! Se procesează PDF-ul...","success"),await W(r.htmlContent,r.fileName);else throw Error(r.error||"Eroare la generarea template-ului")}catch(e){n("❌ Eroare: ".concat(e instanceof Error?e.message:"Eroare necunoscută"),"error"),m(!1)}finally{C||m(!1)}},L=(()=>{let e=0,t=0;l.forEach(r=>{let a=Number(r.cantitate)||0,i=Number(r.pretUnitar)||0,o=Number(r.cotaTva)||0,l=a*i;e+=l,t+=l*(o/100)});let r=e=>(Number(e)||0).toFixed(2);return{subtotal:r(e),totalTva:r(t),totalGeneral:r(e+t)}})(),U=x||C;return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg max-w-5xl w-full max-h-[95vh] overflow-y-auto shadow-2xl",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-green-50",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:"\uD83D\uDCB0 Generare Factură Hibridă"}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["\uD83D\uDCCA Auto-completare client din BD + selector subproiecte • Proiect: ",t.ID_Proiect]})]}),(0,a.jsx)("button",{onClick:r,className:"text-gray-500 hover:text-gray-700 text-2xl p-2 hover:bg-gray-100 rounded-full transition-colors",disabled:U,children:"✕"})]}),(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[U&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-lg",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),(0,a.jsxs)("span",{className:"text-lg font-medium",children:[x&&!C&&"\uD83D\uDD04 Se generează template-ul...",C&&"\uD83D\uDCC4 Se procesează PDF-ul cu date din BD..."]})]})})}),(0,a.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-blue-100 p-6 rounded-lg border border-blue-200 shadow-sm",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-700 mb-4 flex items-center gap-2",children:"\uD83C\uDFD7️ Informații Proiect"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{className:"bg-white p-3 rounded border",children:[(0,a.jsx)("div",{className:"text-gray-600 text-xs uppercase tracking-wide",children:"ID Proiect"}),(0,a.jsx)("div",{className:"font-mono font-bold text-gray-900",children:t.ID_Proiect})]}),(0,a.jsxs)("div",{className:"bg-white p-3 rounded border",children:[(0,a.jsx)("div",{className:"text-gray-600 text-xs uppercase tracking-wide",children:"Status"}),(0,a.jsx)("div",{className:"font-semibold text-green-600",children:t.Status})]}),(0,a.jsxs)("div",{className:"bg-white p-3 rounded border md:col-span-2",children:[(0,a.jsx)("div",{className:"text-gray-600 text-xs uppercase tracking-wide",children:"Denumire"}),(0,a.jsx)("div",{className:"font-medium text-gray-900",children:t.Denumire})]}),(0,a.jsxs)("div",{className:"bg-white p-3 rounded border",children:[(0,a.jsx)("div",{className:"text-gray-600 text-xs uppercase tracking-wide",children:"Valoare Estimată"}),(0,a.jsx)("div",{className:"font-bold text-green-600",children:t.Valoare_Estimata?"".concat((Number(t.Valoare_Estimata)||0).toLocaleString("ro-RO")," RON"):"N/A"})]}),(0,a.jsxs)("div",{className:"bg-white p-3 rounded border",children:[(0,a.jsx)("div",{className:"text-gray-600 text-xs uppercase tracking-wide",children:"Perioada"}),(0,a.jsxs)("div",{className:"text-sm text-gray-900",children:[R(t.Data_Start)," → ",R(t.Data_Final)]})]})]}),k.length>0&&(0,a.jsxs)("div",{className:"mt-6 pt-4 border-t border-blue-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("h4",{className:"font-semibold text-gray-700 flex items-center gap-2",children:["\uD83D\uDCCB Subproiecte Disponibile (",k.length,")"]}),(0,a.jsxs)("button",{onClick:()=>E(!z),className:"bg-blue-500 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-600 transition-colors flex items-center gap-1",children:[z?"\uD83D\uDC41️ Ascunde":"\uD83D\uDC40 Afișează"," Lista"]})]}),z&&(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-60 overflow-y-auto",children:k.map(e=>(0,a.jsx)("div",{className:"p-4 rounded-lg border-2 transition-all ".concat(e.adaugat?"border-green-300 bg-green-50":"border-gray-200 bg-white hover:border-blue-300 hover:shadow-md"),children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"font-medium text-sm text-gray-900 mb-1",children:["\uD83D\uDCCB ",e.Denumire]}),(0,a.jsxs)("div",{className:"text-xs text-gray-600 space-y-1",children:[(0,a.jsxs)("div",{children:["\uD83D\uDCB0 Valoare: ",e.Valoare_Estimata?"".concat(e.Valoare_Estimata.toLocaleString("ro-RO")," RON"):"Fără valoare"]}),(0,a.jsxs)("div",{children:["\uD83D\uDCCA Status: ",(0,a.jsx)("span",{className:"font-medium",children:e.Status})]})]})]}),(0,a.jsx)("button",{onClick:()=>T(e),disabled:e.adaugat,className:"ml-3 px-3 py-2 rounded-lg text-sm font-medium transition-colors ".concat(e.adaugat?"bg-green-100 text-green-700 cursor-not-allowed":"bg-green-500 text-white hover:bg-green-600"),children:e.adaugat?"✓ Adăugat":"+ Adaugă"})]})},e.ID_Subproiect))})]})]}),(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-700 flex items-center gap-2",children:["\uD83D\uDC64 Informații Client",h&&(0,a.jsx)("span",{className:"text-sm text-blue-600",children:"⏳ Se \xeencarcă din BD..."})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"text",value:j,onChange:e=>D(e.target.value),placeholder:"Introduceți CUI (ex: RO12345678)",className:"px-3 py-2 border border-gray-300 rounded text-sm w-48"}),(0,a.jsx)("button",{onClick:B,disabled:b||!j.trim(),className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed text-sm font-medium",children:b?"⏳ Se preiau...":"\uD83D\uDCE1 Preluare ANAF"})]})]}),S&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded p-3 mb-4",children:(0,a.jsxs)("p",{className:"text-red-800 text-sm",children:["❌ ",S]})}),u&&(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-gray-600 mb-1",children:"Denumire *"}),(0,a.jsx)("input",{type:"text",value:u.denumire,onChange:e=>p({...u,denumire:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-gray-600 mb-1",children:"CUI *"}),(0,a.jsx)("input",{type:"text",value:u.cui,onChange:e=>p({...u,cui:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-gray-600 mb-1",children:"Nr. Reg. Com."}),(0,a.jsx)("input",{type:"text",value:u.nrRegCom,onChange:e=>p({...u,nrRegCom:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-gray-600 mb-1",children:"Telefon"}),(0,a.jsx)("input",{type:"text",value:u.telefon||"",onChange:e=>p({...u,telefon:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded"})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"block text-gray-600 mb-1",children:"Adresa *"}),(0,a.jsx)("input",{type:"text",value:u.adresa,onChange:e=>p({...u,adresa:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded",required:!0})]}),(u.status||u.platitorTva)&&(0,a.jsxs)("div",{className:"col-span-2 flex gap-4 text-xs",children:[u.status&&(0,a.jsxs)("span",{className:"px-2 py-1 rounded ".concat("Activ"===u.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:["Status ANAF: ",u.status]}),u.platitorTva&&(0,a.jsxs)("span",{className:"px-2 py-1 rounded ".concat("Da"===u.platitorTva?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"),children:["TVA: ",u.platitorTva]})]}),u.id&&(0,a.jsx)("div",{className:"col-span-2",children:(0,a.jsxs)("div",{className:"bg-green-100 border border-green-200 rounded p-2 text-xs",children:["✅ ",(0,a.jsx)("strong",{children:"Date preluate din BD:"})," Client ID ",u.id]})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-700 flex items-center gap-2",children:"\uD83D\uDCCB Servicii/Produse"}),(0,a.jsx)("button",{onClick:()=>{s([...l,{denumire:"",cantitate:1,pretUnitar:0,cotaTva:19}])},className:"bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 text-sm",children:"+ Adaugă linie"})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full border-collapse border border-gray-300 text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-gray-100",children:[(0,a.jsx)("th",{className:"border border-gray-300 p-3 text-left",children:"Denumire serviciu/produs *"}),(0,a.jsx)("th",{className:"border border-gray-300 p-3 text-center w-20",children:"Cant."}),(0,a.jsx)("th",{className:"border border-gray-300 p-3 text-center w-32",children:"Pret unit. (RON)"}),(0,a.jsx)("th",{className:"border border-gray-300 p-3 text-center w-20",children:"TVA %"}),(0,a.jsx)("th",{className:"border border-gray-300 p-3 text-center w-32",children:"Total (RON)"}),(0,a.jsx)("th",{className:"border border-gray-300 p-3 text-center w-16",children:"Acț."})]})}),(0,a.jsx)("tbody",{children:l.map((e,t)=>{let r=Number(e.cantitate)||0,i=Number(e.pretUnitar)||0,o=Number(e.cotaTva)||0,s=r*i;return(0,a.jsxs)("tr",{className:"hover:bg-gray-50 ".concat("subproiect"===e.tip?"bg-blue-50":""),children:[(0,a.jsx)("td",{className:"border border-gray-300 p-2",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:["subproiect"===e.tip&&(0,a.jsx)("span",{className:"bg-blue-200 text-blue-800 px-2 py-1 rounded text-xs font-bold",children:"SUB"}),(0,a.jsx)("input",{type:"text",value:e.denumire,onChange:e=>F(t,"denumire",e.target.value),className:"flex-1 p-1 border rounded text-sm",placeholder:"Descrierea serviciului sau produsului...",required:!0})]})}),(0,a.jsx)("td",{className:"border border-gray-300 p-2",children:(0,a.jsx)("input",{type:"number",value:e.cantitate,onChange:e=>F(t,"cantitate",parseFloat(e.target.value)||0),className:"w-full p-1 border rounded text-center text-sm",min:"0",step:"0.01"})}),(0,a.jsx)("td",{className:"border border-gray-300 p-2",children:(0,a.jsx)("input",{type:"number",value:e.pretUnitar,onChange:e=>F(t,"pretUnitar",parseFloat(e.target.value)||0),className:"w-full p-1 border rounded text-right text-sm",min:"0",step:"0.01"})}),(0,a.jsx)("td",{className:"border border-gray-300 p-2",children:(0,a.jsxs)("select",{value:e.cotaTva,onChange:e=>F(t,"cotaTva",parseFloat(e.target.value)),className:"w-full p-1 border rounded text-center text-sm",children:[(0,a.jsx)("option",{value:0,children:"0%"}),(0,a.jsx)("option",{value:5,children:"5%"}),(0,a.jsx)("option",{value:9,children:"9%"}),(0,a.jsx)("option",{value:19,children:"19%"}),(0,a.jsx)("option",{value:21,children:"21%"})]})}),(0,a.jsx)("td",{className:"border border-gray-300 p-2 text-right font-semibold",children:(Number(s+s*(o/100))||0).toFixed(2)}),(0,a.jsx)("td",{className:"border border-gray-300 p-2 text-center",children:(0,a.jsx)("button",{onClick:()=>I(t),disabled:1===l.length,className:"text-red-500 hover:text-red-700 disabled:opacity-30 disabled:cursor-not-allowed",title:"subproiect"===e.tip?"Șterge subproiectul din factură":"Șterge linia",children:"\uD83D\uDDD1️"})})]},t)})})]})})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("div",{className:"w-96 bg-green-50 p-4 rounded-lg border border-green-200",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{children:"Subtotal (fără TVA):"}),(0,a.jsxs)("span",{className:"font-semibold",children:[L.subtotal," RON"]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{children:"TVA:"}),(0,a.jsxs)("span",{className:"font-semibold",children:[L.totalTva," RON"]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-lg font-bold border-t pt-2 border-green-300",children:[(0,a.jsx)("span",{children:"TOTAL DE PLATA:"}),(0,a.jsxs)("span",{className:"text-green-600",children:[L.totalGeneral," RON"]})]})]})})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\uD83D\uDCDD Observații (opțional)"}),(0,a.jsx)("textarea",{value:d,onChange:e=>c(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg text-sm",rows:3,placeholder:"Observații suplimentare pentru factură..."})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center pt-4 border-t border-gray-200",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"ℹ️ Date client auto-completate din BD. Subproiecte disponibile pentru adăugare la factură."}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:r,disabled:U,className:"bg-gray-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-gray-600 disabled:opacity-50",children:"Anulează"}),(0,a.jsx)("button",{onClick:V,disabled:U||!(null==u?void 0:u.cui)||!(null==u?void 0:u.denumire),className:"bg-green-500 text-white px-8 py-3 rounded-lg text-lg font-semibold hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:U?(0,a.jsxs)(a.Fragment,{children:["⏳ ",C?"Se generează PDF cu date BD...":"Se procesează..."]}):(0,a.jsx)(a.Fragment,{children:"\uD83D\uDCB0 Generează Factură din BD"})})]})]})]})]})})}let c=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",r=document.createElement("div");r.style.cssText="\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    background: ".concat("success"===t?"#27ae60":"error"===t?"#e74c3c":"#3498db",";\n    color: white;\n    padding: 12px 20px;\n    border-radius: 6px;\n    z-index: 10000;\n    font-family: Arial, sans-serif;\n    font-size: 14px;\n    font-weight: 500;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n    max-width: 400px;\n    word-wrap: break-word;\n    white-space: pre-line;\n  "),r.textContent=e,document.body.appendChild(r),setTimeout(()=>{document.body.contains(r)&&document.body.removeChild(r)},"success"===t?4e3:"error"===t?5e3:"info"===t&&e.length>200?1e4:6e3)};function u(e){let{proiect:t,onRefresh:r}=e,[o,l]=i.useState(!1),[s,n]=i.useState(!1),u=e=>{if(!e)return"N/A";let t="string"==typeof e?e:e.value;try{return new Date(t).toLocaleDateString("ro-RO")}catch(e){return"N/A"}},m=[{key:"view",label:"Vezi Detalii",icon:"\uD83D\uDC41️",color:"primary"},{key:"edit",label:"Editează",icon:"✏️",color:"secondary"},..."subproiect"!==t.tip?[{key:"add_subproject",label:"Adaugă Subproiect",icon:"\uD83D\uDCC2",color:"success",disabled:"Anulat"===t.Status||"Arhivat"===t.Status}]:[],{key:"divider1",label:"",icon:"",color:"primary",divider:!0},{key:"generate_invoice",label:"Generează Factură PDF",icon:"\uD83D\uDCB0",color:"warning",disabled:"Anulat"===t.Status},{key:"divider2",label:"",icon:"",color:"primary",divider:!0},{key:"mark_completed",label:"Marchează Finalizat",icon:"✅",color:"success",disabled:"Finalizat"===t.Status||"Anulat"===t.Status},{key:"suspend",label:"Suspendă Proiect",icon:"⏸️",color:"warning",disabled:"Suspendat"===t.Status||"Finalizat"===t.Status},{key:"divider3",label:"",icon:"",color:"primary",divider:!0},{key:"delete",label:"subproiect"===t.tip?"Șterge Subproiect":"Șterge Proiect",icon:"\uD83D\uDDD1️",color:"danger"}],b=async e=>{try{switch(e){case"view":await f();break;case"edit":await y();break;case"add_subproject":g();break;case"generate_invoice":h();break;case"mark_completed":await v("Finalizat");break;case"suspend":await v("Suspendat");break;case"delete":await j();break;default:c("Funcție \xeen dezvoltare","info")}}catch(t){console.error("Eroare la ".concat(e,":"),t),c("Eroare la executarea acțiunii: ".concat(e),"error")}},g=()=>{n(!0)},h=()=>{l(!0)},f=async()=>{let e="\uD83D\uDCCB ".concat("subproiect"===t.tip?"SUBPROIECT":"PROIECT",": ").concat(t.ID_Proiect,"\n\n\uD83D\uDCDD Denumire: ").concat(t.Denumire,"\n\uD83D\uDC64 Client: ").concat(t.Client,"\n\uD83D\uDCCA Status: ").concat(t.Status,"\n\uD83D\uDCB0 Valoare: ").concat(t.Valoare_Estimata?"".concat(t.Valoare_Estimata.toLocaleString("ro-RO")," RON"):"N/A","\n\uD83D\uDCC5 \xcencepe: ").concat(u(t.Data_Start),"\n\uD83D\uDCC5 Finalizare: ").concat(u(t.Data_Final),"\n\uD83D\uDC64 Responsabil: ").concat(t.Responsabil||"Neatribuit","\n\uD83D\uDCCD Adresă: ").concat(t.Adresa||"Nespecificată","\n\uD83D\uDCDD Observații: ").concat(t.Observatii||"Fără observații");c(e,"info"),console.log("Detalii proiect:",t)},y=async()=>{let e=confirm("Vrei să editezi ".concat("subproiect"===t.tip?"subproiectul":"proiectul",' "').concat(t.Denumire,'"?\n\nNOTĂ: Funcția de editare va fi implementată \xeen următoarea versiune.'));e&&c("Funcția de editare va fi disponibilă \xeen cur\xe2nd!","info");let r="subproiect"===t.tip?"/admin/rapoarte/subproiecte/".concat(t.ID_Proiect,"/edit"):"/admin/rapoarte/proiecte/".concat(t.ID_Proiect,"/edit");console.log("Ar trebui să redirectionez la:",r),console.log("Date pentru editare:",t)},v=async e=>{let a=confirm('Sigur vrei să schimbi statusul la "'.concat(e,'"?'));if(a)try{let a="subproiect"===t.tip?"/api/rapoarte/subproiecte":"/api/rapoarte/proiecte",i=await fetch(a,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t.ID_Proiect,Status:e})}),o=await i.json();o.success?(c("Status actualizat la: ".concat(e),"success"),null==r||r()):c(o.error||"Eroare la actualizarea statusului","error")}catch(e){c("Eroare la actualizarea statusului","error")}},j=async()=>{let e="subproiect"===t.tip?"subproiectul":"proiectul",a=confirm("Sigur vrei să ștergi ".concat(e," ").concat(t.ID_Proiect,"?\n\nAceastă acțiune nu poate fi anulată!"));if(a)try{let a="subproiect"===t.tip?"/api/rapoarte/subproiecte?id=".concat(encodeURIComponent(t.ID_Proiect)):"/api/rapoarte/proiecte?id=".concat(encodeURIComponent(t.ID_Proiect)),i=await fetch(a,{method:"DELETE"}),o=await i.json();o.success?(c("".concat(e.charAt(0).toUpperCase()+e.slice(1)," șters cu succes!"),"success"),null==r||r()):c(o.error||"Eroare la ștergerea ".concat(e),"error")}catch(t){c("Eroare la ștergerea ".concat(e),"error")}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x,{actions:m,onAction:b,proiect:t}),o&&(0,a.jsx)(d,{proiect:t,onClose:()=>l(!1),onSuccess:(e,t)=>{l(!1),c("Factura ".concat(e," a fost generată cu succes!"),"success"),r&&r()}}),s&&(0,a.jsx)(p,{proiectParinte:t,onClose:()=>n(!1),onSuccess:()=>{c("✅ Subproiect adăugat cu succes!","success"),null==r||r(),c("\uD83D\uDCA1 Poți adăuga \xeencă un subproiect sau \xeenchide modalul!","info")}})]})}function p(e){let{proiectParinte:t,onClose:r,onSuccess:o}=e,[l,s]=i.useState({denumire:"",responsabil:"",dataStart:new Date().toISOString().split("T")[0],dataFinal:"",valoareEstimata:"0",status:"Activ"}),[n,d]=i.useState(!1),u=(e,t)=>{s(r=>({...r,[e]:t}))},p=()=>{s({denumire:"",responsabil:"",dataStart:new Date().toISOString().split("T")[0],dataFinal:"",valoareEstimata:"0",status:"Activ"}),c("\uD83D\uDCCB Formular resetat pentru noul subproiect!","info")},x=async e=>{if(e.preventDefault(),!l.denumire.trim()){c("Denumirea subproiectului este obligatorie","error");return}d(!0);try{let e="".concat(t.ID_Proiect,"_SUB_").concat(Date.now()),r={ID_Subproiect:e,ID_Proiect:t.ID_Proiect,Denumire:l.denumire.trim(),Responsabil:l.responsabil.trim()||null,Data_Start:l.dataStart||null,Data_Final:l.dataFinal||null,Valoare_Estimata:l.valoareEstimata?parseFloat(l.valoareEstimata):null,Status:l.status};console.log("Trimitere subproiect:",r);let a=await fetch("/api/rapoarte/subproiecte",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),i=await a.json();console.log("Răspuns subproiect:",i),i.success?(o(),p()):c(i.error||"Eroare la adăugarea subproiectului","error")}catch(e){console.error("Eroare la adăugarea subproiectului:",e),c("Eroare la adăugarea subproiectului","error")}finally{d(!1)}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-green-50",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:"\uD83D\uDCC2 Adaugă Subproiect Nou"}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["\uD83C\uDFD7️ Proiect părinte: ",(0,a.jsx)("span",{className:"font-mono font-semibold",children:t.ID_Proiect})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:t.Denumire})]}),(0,a.jsx)("button",{onClick:r,className:"text-gray-500 hover:text-gray-700 text-xl p-2 hover:bg-gray-100 rounded-full transition-colors",disabled:n,children:"✕"})]}),(0,a.jsxs)("form",{onSubmit:x,className:"p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"\uD83D\uDCDD Denumire Subproiect *"}),(0,a.jsx)("input",{type:"text",value:l.denumire,onChange:e=>u("denumire",e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-lg",placeholder:"Introduceți denumirea subproiectului...",required:!0,disabled:n})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\uD83D\uDC64 Responsabil"}),(0,a.jsx)("input",{type:"text",value:l.responsabil,onChange:e=>u("responsabil",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Numele responsabilului...",disabled:n})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\uD83D\uDCCA Status"}),(0,a.jsxs)("select",{value:l.status,onChange:e=>u("status",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:n,children:[(0,a.jsx)("option",{value:"Activ",children:"\uD83D\uDFE2 Activ"}),(0,a.jsx)("option",{value:"Planificat",children:"\uD83D\uDCC5 Planificat"}),(0,a.jsx)("option",{value:"Suspendat",children:"⏸️ Suspendat"}),(0,a.jsx)("option",{value:"Finalizat",children:"✅ Finalizat"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\uD83D\uDCC5 Data \xcenceput"}),(0,a.jsx)("input",{type:"date",value:l.dataStart,onChange:e=>u("dataStart",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:n})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\uD83C\uDFC1 Data Finalizare"}),(0,a.jsx)("input",{type:"date",value:l.dataFinal,onChange:e=>u("dataFinal",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:n})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\uD83D\uDCB0 Valoare Estimată (RON)"}),(0,a.jsx)("input",{type:"number",value:l.valoareEstimata,onChange:e=>u("valoareEstimata",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"0.00",min:"0",step:"0.01",disabled:n})]}),(0,a.jsxs)("div",{className:"bg-gradient-to-r from-gray-50 to-blue-50 p-4 rounded-lg border border-gray-200",children:[(0,a.jsx)("h4",{className:"font-semibold text-gray-700 mb-3 flex items-center gap-2",children:"\uD83C\uDFD7️ Informații Proiect Părinte"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{className:"bg-white p-2 rounded border",children:[(0,a.jsx)("div",{className:"text-gray-600 text-xs",children:"CLIENT"}),(0,a.jsx)("div",{className:"font-medium",children:t.Client})]}),(0,a.jsxs)("div",{className:"bg-white p-2 rounded border",children:[(0,a.jsx)("div",{className:"text-gray-600 text-xs",children:"STATUS"}),(0,a.jsx)("div",{className:"font-medium",children:t.Status})]}),(0,a.jsxs)("div",{className:"bg-white p-2 rounded border",children:[(0,a.jsx)("div",{className:"text-gray-600 text-xs",children:"VALOARE"}),(0,a.jsx)("div",{className:"font-medium",children:t.Valoare_Estimata?"".concat(t.Valoare_Estimata.toLocaleString("ro-RO")," RON"):"N/A"})]}),(0,a.jsxs)("div",{className:"bg-white p-2 rounded border",children:[(0,a.jsx)("div",{className:"text-gray-600 text-xs",children:"ADRESĂ"}),(0,a.jsx)("div",{className:"font-medium text-xs",children:t.Adresa||"Nespecificată"})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center gap-3 pt-4 border-t border-gray-200",children:[(0,a.jsx)("button",{type:"button",onClick:r,disabled:n,className:"bg-gray-500 text-white px-6 py-2 rounded-lg font-medium hover:bg-gray-600 disabled:opacity-50 transition-colors",children:"✕ \xcenchide"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{type:"submit",disabled:n||!l.denumire.trim(),className:"bg-blue-500 text-white px-6 py-2 rounded-lg font-medium hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 transition-colors",children:n?(0,a.jsx)(a.Fragment,{children:"⏳ Se adaugă..."}):(0,a.jsx)(a.Fragment,{children:"\uD83D\uDCC2 Adaugă Subproiect"})}),(0,a.jsx)("button",{type:"button",onClick:p,disabled:n,className:"bg-green-500 text-white px-4 py-2 rounded-lg font-medium hover:bg-green-600 disabled:opacity-50 flex items-center gap-1 transition-colors",title:"Resetează formularul pentru a adăuga alt subproiect",children:"➕ Mai adaugă"})]})]})]})]})})}function x(e){let{actions:t,onAction:r,proiect:o}=e,[l,s]=i.useState(!1),[n,d]=i.useState(null),c=async e=>{if(!n){d(e),s(!1);try{await r(e)}finally{d(null)}}};return(0,a.jsxs)("div",{style:{position:"relative",display:"inline-block"},children:[(0,a.jsxs)("button",{onClick:()=>s(!l),disabled:null!==n,style:{padding:"6px 12px",background:n?"#bdc3c7":"#3498db",color:"white",border:"none",borderRadius:"4px",cursor:n?"not-allowed":"pointer",fontSize:"14px",fontWeight:"bold"},children:[n?"⏳":"⚙️"," Acțiuni"]}),l&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:9998},onClick:()=>s(!1)}),(0,a.jsxs)("div",{style:{position:"absolute",top:"100%",right:0,background:"white",border:"1px solid #ddd",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",zIndex:9999,minWidth:"220px",marginTop:"4px"},children:[(0,a.jsxs)("div",{style:{padding:"12px",borderBottom:"1px solid #eee",background:"#f8f9fa"},children:[(0,a.jsxs)("div",{style:{fontSize:"12px",fontWeight:"bold",color:"#2c3e50",marginBottom:"4px"},children:[o.ID_Proiect,"subproiect"===o.tip&&(0,a.jsx)("span",{style:{marginLeft:"8px",fontSize:"10px",background:"#3498db",color:"white",padding:"2px 6px",borderRadius:"3px"},children:"SUB"})]}),(0,a.jsxs)("div",{style:{fontSize:"11px",color:"#7f8c8d"},children:["Status: ",(0,a.jsx)("span",{style:{color:(e=>{switch(e){case"Activ":return"#27ae60";case"Finalizat":return"#3498db";case"Suspendat":return"#f39c12";case"Arhivat":return"#95a5a6";default:return"#7f8c8d"}})(o.Status),fontWeight:"bold"},children:o.Status})]})]}),(0,a.jsx)("div",{style:{padding:"8px 0"},children:t.map(e=>e.divider?(0,a.jsx)("div",{style:{height:"1px",background:"#eee",margin:"8px 0"}},e.key):(0,a.jsxs)("button",{onClick:()=>c(e.key),disabled:e.disabled||n===e.key,style:{width:"100%",padding:"8px 12px",background:"transparent",border:"none",textAlign:"left",cursor:e.disabled||n===e.key?"not-allowed":"pointer",fontSize:"14px",color:e.disabled?"#bdc3c7":"danger"===e.color?"#e74c3c":"#2c3e50",display:"flex",alignItems:"center",gap:"8px",opacity:e.disabled?.5:1,transition:"background-color 0.2s"},onMouseOver:t=>{e.disabled||n===e.key||(t.currentTarget.style.background="danger"===e.color?"#fdf2f2":"#f8f9fa")},onMouseOut:e=>{e.currentTarget.style.background="transparent"},children:[(0,a.jsx)("span",{style:{minWidth:"16px"},children:n===e.key?"⏳":e.icon}),(0,a.jsx)("span",{children:e.label})]},e.key))})]})]})]})}var m=r(8259),b=r(3811);function g(e){let{isOpen:t,onClose:r,onProiectAdded:o}=e,[l,s]=(0,i.useState)(!1),[n,d]=(0,i.useState)([]),[c,u]=(0,i.useState)(!1),[p,x]=(0,i.useState)(""),[g,h]=(0,i.useState)(!1),[f,y]=(0,i.useState)({ID_Proiect:"",Denumire:"",Client:"",selectedClientId:"",Adresa:"",Descriere:"",Data_Start:"",Data_Final:"",Status:"Activ",Valoare_Estimata:"",Responsabil:"",Observatii:"",subproiecte:[]});(0,i.useEffect)(()=>{t&&(v(),y(e=>({...e,ID_Proiect:"P".concat(new Date().getFullYear()).concat(String(Date.now()).slice(-3))})))},[t]);let v=async()=>{try{let e=await fetch("/api/rapoarte/clienti"),t=await e.json();t.success&&d(t.data||[])}catch(e){console.error("Eroare la \xeencărcarea clienților:",e)}},j=async e=>{e.preventDefault(),s(!0);try{if(!f.ID_Proiect.trim()){m.Am.error("ID proiect este obligatoriu"),s(!1);return}if(!f.Denumire.trim()){m.Am.error("Denumirea proiectului este obligatorie"),s(!1);return}if(!f.Client.trim()){m.Am.error("Clientul este obligatoriu"),s(!1);return}console.log("Trimitere date proiect:",f),m.Am.info("Se adaugă proiectul...");let e={ID_Proiect:f.ID_Proiect.trim(),Denumire:f.Denumire.trim(),Client:f.Client.trim(),Adresa:f.Adresa.trim(),Descriere:f.Descriere.trim(),Data_Start:f.Data_Start||null,Data_Final:f.Data_Final||null,Status:f.Status,Valoare_Estimata:f.Valoare_Estimata?parseFloat(f.Valoare_Estimata):null,Responsabil:f.Responsabil.trim(),Observatii:f.Observatii.trim()},t=await fetch("/api/rapoarte/proiecte",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});console.log("Response status proiect:",t.status);let a=await t.json();console.log("Response data proiect:",a),a.success||t.ok?(f.subproiecte.length>0&&await D(f.ID_Proiect),m.Am.success("Proiect adăugat cu succes!"),o(),r(),S()):(console.error("Eroare API proiect:",a),m.Am.error("Eroare: ".concat(a.error||"Eroare necunoscută")))}catch(e){console.error("Eroare la adăugarea proiectului:",e),m.Am.error("Eroare la adăugarea proiectului")}finally{s(!1)}},D=async e=>{for(let t of f.subproiecte)try{let r={ID_Subproiect:"".concat(e,"_SUB_").concat(t.id),ID_Proiect:e,Denumire:t.denumire,Responsabil:t.responsabil,Status:t.status,Valoare_Estimata:t.valoare?parseFloat(t.valoare):null};await fetch("/api/rapoarte/subproiecte",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})}catch(e){console.error("Eroare la adăugarea subproiectului ".concat(t.denumire,":"),e)}},S=()=>{y({ID_Proiect:"",Denumire:"",Client:"",selectedClientId:"",Adresa:"",Descriere:"",Data_Start:"",Data_Final:"",Status:"Activ",Valoare_Estimata:"",Responsabil:"",Observatii:"",subproiecte:[]}),x("")},w=(e,t)=>{y(r=>({...r,[e]:t}))},C=e=>{x(e),y(t=>({...t,Client:e})),h(e.length>0)},N=e=>{x(e.nume),y(t=>({...t,Client:e.nume,selectedClientId:e.id})),h(!1)},k=n.filter(e=>e.nume.toLowerCase().includes(p.toLowerCase())).slice(0,5),_=e=>{y(t=>({...t,subproiecte:t.subproiecte.filter(t=>t.id!==e)}))},z=(e,t,r)=>{y(a=>({...a,subproiecte:a.subproiecte.map(a=>a.id===e?{...a,[t]:r}:a)}))};return t?(0,a.jsxs)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.7)",zIndex:99999,display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},children:[(0,a.jsxs)("div",{style:{background:"white",borderRadius:"8px",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",maxWidth:"900px",width:"100%",maxHeight:"90vh",overflowY:"auto"},children:[(0,a.jsxs)("div",{style:{padding:"1.5rem",borderBottom:"1px solid #dee2e6",background:"#f8f9fa",borderRadius:"8px 8px 0 0"},children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsx)("h2",{style:{margin:0,color:"#2c3e50"},children:"\uD83D\uDCCB Adaugă Proiect Nou"}),(0,a.jsx)("button",{onClick:r,disabled:l,style:{background:"transparent",border:"none",fontSize:"24px",cursor:"pointer",color:"#6c757d"},children:"\xd7"})]}),(0,a.jsx)("p",{style:{margin:"0.5rem 0 0 0",color:"#7f8c8d",fontSize:"14px"},children:"Completează informațiile pentru noul proiect și subproiectele asociate"})]}),(0,a.jsxs)("form",{onSubmit:j,style:{padding:"1.5rem"},children:[(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"1rem",marginBottom:"1rem"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#2c3e50"},children:"ID Proiect *"}),(0,a.jsx)("input",{type:"text",value:f.ID_Proiect,onChange:e=>w("ID_Proiect",e.target.value),disabled:l,placeholder:"P202501",style:{width:"100%",padding:"0.75rem",border:"1px solid #dee2e6",borderRadius:"6px",fontSize:"14px",fontFamily:"monospace",fontWeight:"bold"}})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#2c3e50"},children:"Status"}),(0,a.jsxs)("select",{value:f.Status,onChange:e=>w("Status",e.target.value),disabled:l,style:{width:"100%",padding:"0.75rem",border:"1px solid #dee2e6",borderRadius:"6px",fontSize:"14px"},children:[(0,a.jsx)("option",{value:"Activ",children:"\uD83D\uDFE2 Activ"}),(0,a.jsx)("option",{value:"Planificat",children:"\uD83D\uDCC5 Planificat"}),(0,a.jsx)("option",{value:"Suspendat",children:"⏸️ Suspendat"})]})]})]}),(0,a.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,a.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#2c3e50"},children:"Denumire Proiect *"}),(0,a.jsx)("input",{type:"text",value:f.Denumire,onChange:e=>w("Denumire",e.target.value),disabled:l,placeholder:"Numele proiectului",style:{width:"100%",padding:"0.75rem",border:"1px solid #dee2e6",borderRadius:"6px",fontSize:"14px"}})]}),(0,a.jsxs)("div",{style:{marginBottom:"1rem",position:"relative"},children:[(0,a.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#2c3e50"},children:"Client *"}),(0,a.jsxs)("div",{style:{display:"flex",gap:"0.5rem"},children:[(0,a.jsxs)("div",{style:{flex:1,position:"relative"},children:[(0,a.jsx)("input",{type:"text",value:p,onChange:e=>C(e.target.value),disabled:l,placeholder:"Caută client sau scrie numele...",style:{width:"100%",padding:"0.75rem",border:"1px solid #dee2e6",borderRadius:"6px",fontSize:"14px"}}),g&&k.length>0&&(0,a.jsx)("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"white",border:"1px solid #dee2e6",borderTop:"none",borderRadius:"0 0 6px 6px",boxShadow:"0 4px 8px rgba(0,0,0,0.1)",zIndex:1e3,maxHeight:"200px",overflowY:"auto"},children:k.map(e=>(0,a.jsxs)("div",{onClick:()=>N(e),style:{padding:"0.75rem",cursor:"pointer",borderBottom:"1px solid #f1f2f6",fontSize:"14px"},onMouseOver:e=>{e.currentTarget.style.background="#f8f9fa"},onMouseOut:e=>{e.currentTarget.style.background="white"},children:[(0,a.jsx)("div",{style:{fontWeight:"bold"},children:e.nume}),e.cui&&(0,a.jsxs)("div",{style:{fontSize:"12px",color:"#7f8c8d"},children:["CUI: ",e.cui]})]},e.id))})]}),(0,a.jsx)("button",{type:"button",onClick:()=>u(!0),disabled:l,style:{padding:"0.75rem 1rem",background:"#27ae60",color:"white",border:"none",borderRadius:"6px",cursor:l?"not-allowed":"pointer",fontSize:"12px",fontWeight:"bold",whiteSpace:"nowrap"},children:"+ Client Nou"})]})]}),(0,a.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,a.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#2c3e50"},children:"Adresa Proiect"}),(0,a.jsx)("input",{type:"text",value:f.Adresa,onChange:e=>w("Adresa",e.target.value),disabled:l,placeholder:"Adresa unde se desfășoară proiectul (ex: Str. Exemplu Nr. 1, Bucuresti)",style:{width:"100%",padding:"0.75rem",border:"1px solid #dee2e6",borderRadius:"6px",fontSize:"14px"}})]}),(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginBottom:"1rem"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#2c3e50"},children:"Data \xcenceput"}),(0,a.jsx)("input",{type:"date",value:f.Data_Start,onChange:e=>w("Data_Start",e.target.value),disabled:l,style:{width:"100%",padding:"0.75rem",border:"1px solid #dee2e6",borderRadius:"6px",fontSize:"14px"}})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#2c3e50"},children:"Data Finalizare"}),(0,a.jsx)("input",{type:"date",value:f.Data_Final,onChange:e=>w("Data_Final",e.target.value),disabled:l,style:{width:"100%",padding:"0.75rem",border:"1px solid #dee2e6",borderRadius:"6px",fontSize:"14px"}})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#2c3e50"},children:"Valoare Estimată (RON)"}),(0,a.jsx)("input",{type:"number",value:f.Valoare_Estimata,onChange:e=>w("Valoare_Estimata",e.target.value),disabled:l,placeholder:"15000",style:{width:"100%",padding:"0.75rem",border:"1px solid #dee2e6",borderRadius:"6px",fontSize:"14px"}})]})]}),(0,a.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,a.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#2c3e50"},children:"Responsabil"}),(0,a.jsx)("input",{type:"text",value:f.Responsabil,onChange:e=>w("Responsabil",e.target.value),disabled:l,placeholder:"Numele responsabilului de proiect",style:{width:"100%",padding:"0.75rem",border:"1px solid #dee2e6",borderRadius:"6px",fontSize:"14px"}})]}),(0,a.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,a.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#2c3e50"},children:"Descriere"}),(0,a.jsx)("textarea",{value:f.Descriere,onChange:e=>w("Descriere",e.target.value),disabled:l,placeholder:"Descrierea detaliată a proiectului...",rows:3,style:{width:"100%",padding:"0.75rem",border:"1px solid #dee2e6",borderRadius:"6px",fontSize:"14px",resize:"vertical"}})]}),(0,a.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[(0,a.jsx)("h4",{style:{margin:0,color:"#2c3e50"},children:"\uD83D\uDCCB Subproiecte"}),(0,a.jsx)("button",{type:"button",onClick:()=>{let e={id:Date.now().toString(),denumire:"",responsabil:"",valoare:"",status:"Planificat"};y(t=>({...t,subproiecte:[...t.subproiecte,e]}))},disabled:l,style:{padding:"0.5rem 1rem",background:"#3498db",color:"white",border:"none",borderRadius:"6px",cursor:l?"not-allowed":"pointer",fontSize:"12px",fontWeight:"bold"},children:"+ Adaugă Subproiect"})]}),f.subproiecte.map((e,t)=>(0,a.jsxs)("div",{style:{border:"1px solid #dee2e6",borderRadius:"6px",padding:"1rem",marginBottom:"1rem",background:"#f8f9fa"},children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[(0,a.jsxs)("h5",{style:{margin:0,color:"#2c3e50"},children:["Subproiect #",t+1]}),(0,a.jsx)("button",{type:"button",onClick:()=>_(e.id),disabled:l,style:{background:"#e74c3c",color:"white",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:"pointer",fontSize:"12px"},children:"\uD83D\uDDD1️"})]}),(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"0.5rem"},children:[(0,a.jsx)("input",{type:"text",value:e.denumire,onChange:t=>z(e.id,"denumire",t.target.value),disabled:l,placeholder:"Denumire subproiect",style:{padding:"0.5rem",border:"1px solid #dee2e6",borderRadius:"4px",fontSize:"14px"}}),(0,a.jsx)("input",{type:"text",value:e.responsabil,onChange:t=>z(e.id,"responsabil",t.target.value),disabled:l,placeholder:"Responsabil",style:{padding:"0.5rem",border:"1px solid #dee2e6",borderRadius:"4px",fontSize:"14px"}}),(0,a.jsx)("input",{type:"number",value:e.valoare,onChange:t=>z(e.id,"valoare",t.target.value),disabled:l,placeholder:"Valoare (RON)",style:{padding:"0.5rem",border:"1px solid #dee2e6",borderRadius:"4px",fontSize:"14px"}}),(0,a.jsxs)("select",{value:e.status,onChange:t=>z(e.id,"status",t.target.value),disabled:l,style:{padding:"0.5rem",border:"1px solid #dee2e6",borderRadius:"4px",fontSize:"14px"},children:[(0,a.jsx)("option",{value:"Planificat",children:"\uD83D\uDCC5 Planificat"}),(0,a.jsx)("option",{value:"Activ",children:"\uD83D\uDFE2 Activ"}),(0,a.jsx)("option",{value:"Finalizat",children:"✅ Finalizat"})]})]})]},e.id))]}),(0,a.jsxs)("div",{style:{marginBottom:"1.5rem"},children:[(0,a.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#2c3e50"},children:"Observații"}),(0,a.jsx)("textarea",{value:f.Observatii,onChange:e=>w("Observatii",e.target.value),disabled:l,placeholder:"Observații despre proiect...",rows:2,style:{width:"100%",padding:"0.75rem",border:"1px solid #dee2e6",borderRadius:"6px",fontSize:"14px",resize:"vertical"}})]}),(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"1rem",paddingTop:"1rem",borderTop:"1px solid #dee2e6"},children:[(0,a.jsx)("button",{type:"button",onClick:r,disabled:l,style:{padding:"0.75rem 1.5rem",background:"#6c757d",color:"white",border:"none",borderRadius:"6px",cursor:l?"not-allowed":"pointer",fontSize:"14px",fontWeight:"bold"},children:"Anulează"}),(0,a.jsx)("button",{type:"submit",disabled:l,style:{padding:"0.75rem 1.5rem",background:l?"#bdc3c7":"#27ae60",color:"white",border:"none",borderRadius:"6px",cursor:l?"not-allowed":"pointer",fontSize:"14px",fontWeight:"bold"},children:l?"⏳ Se adaugă...":"\uD83D\uDCBE Adaugă Proiect"})]})]})]}),c&&(0,a.jsx)(b.Z,{isOpen:c,onClose:()=>u(!1),onClientAdded:()=>{v(),u(!1)}})]}):null}let h=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",r=document.createElement("div");r.style.cssText="\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    background: ".concat("success"===t?"#27ae60":"error"===t?"#e74c3c":"#3498db",";\n    color: white;\n    padding: 12px 20px;\n    border-radius: 6px;\n    z-index: 10000;\n    font-family: Arial, sans-serif;\n    font-size: 14px;\n    font-weight: 500;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n    max-width: 400px;\n    word-wrap: break-word;\n  "),r.textContent=e,document.body.appendChild(r),setTimeout(()=>{document.body.contains(r)&&document.body.removeChild(r)},"success"===t||"error"===t?4e3:6e3)};function f(e){let{searchParams:t}=e,[r,o]=(0,i.useState)([]),[l,s]=(0,i.useState)([]),[n,d]=(0,i.useState)(!0),[c,p]=(0,i.useState)(0),[x,m]=(0,i.useState)(!1),[b,f]=(0,i.useState)(new Set);(0,i.useEffect)(()=>{y()},[t,c]),(0,i.useEffect)(()=>{if((null==t?void 0:t.invoice_status)&&(null==t?void 0:t.project_id)){let e=t.invoice_status,r=t.project_id;switch(e){case"success":h("Factură creată cu succes pentru proiectul ".concat(r,"!"),"success");break;case"cancelled":h("Crearea facturii pentru proiectul ".concat(r," a fost anulată."),"info");break;default:h("Status factură pentru proiectul ".concat(r,": ").concat(e),"info")}}},[t]);let y=async()=>{try{d(!0),await Promise.all([v(),j()])}catch(e){console.error("Eroare la \xeencărcarea datelor:",e),h("Eroare de conectare la baza de date","error")}finally{d(!1)}},v=async()=>{try{let e=new URLSearchParams;t&&Object.entries(t).forEach(t=>{let[r,a]=t;a&&"invoice_status"!==r&&"project_id"!==r&&e.append(r,a)});let r=await fetch("/api/rapoarte/proiecte?".concat(e.toString()));if(!r.ok)throw Error("HTTP ".concat(r.status));let a=await r.json();if(a.success){let e=(a.data||[]).map(e=>({...e,tip:"proiect"}));o(e)}else throw Error(a.error||"Eroare la \xeencărcarea proiectelor")}catch(e){console.error("Eroare la \xeencărcarea proiectelor:",e),h("Eroare la \xeencărcarea proiectelor","error"),o([])}},j=async()=>{try{let e=new URLSearchParams;t&&Object.entries(t).forEach(t=>{let[r,a]=t;a&&"invoice_status"!==r&&"project_id"!==r&&e.append(r,a)});let r=await fetch("/api/rapoarte/subproiecte?".concat(e.toString()));if(!r.ok)throw Error("HTTP ".concat(r.status));let a=await r.json();a.success?(s(a.data||[]),console.log("Subproiecte \xeencărcate:",a.data)):(console.warn("Nu s-au găsit subproiecte sau eroare:",a.error),s([]))}catch(e){console.error("Eroare la \xeencărcarea subproiectelor:",e),s([])}},D=()=>{p(e=>e+1),h("Date actualizate!","success")},S=e=>{f(t=>{let r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},w=e=>l.filter(t=>t.ID_Proiect===e),C=async()=>{try{h("Se generează fișierul Excel...","info");let r=new URLSearchParams;t&&Object.entries(t).forEach(e=>{let[t,a]=e;a&&"invoice_status"!==t&&"project_id"!==t&&r.append(t,a)});let a=await fetch("/api/rapoarte/proiecte/export?".concat(r.toString()));if(a.ok){var e;let t=await a.blob(),r=window.URL.createObjectURL(t),i=document.createElement("a");i.href=r;let o=a.headers.get("Content-Disposition"),l=o?null===(e=o.split("filename=")[1])||void 0===e?void 0:e.replace(/"/g,""):"Proiecte_".concat(new Date().toISOString().split("T")[0],".xlsx");i.download=l,i.click(),window.URL.revokeObjectURL(r),h("Fișier Excel descărcat cu succes!","success")}else{let e=await a.json();h("Eroare la export: ".concat(e.error),"error")}}catch(e){console.error("Eroare la exportul Excel:",e),h("Eroare la exportul Excel","error")}},N=e=>{if(!e)return"";try{let t=new Date(e);if(isNaN(t.getTime()))return"";return t.toLocaleDateString("ro-RO",{year:"numeric",month:"2-digit",day:"2-digit"})}catch(e){return""}},k=e=>e||0===e?new Intl.NumberFormat("ro-RO",{style:"currency",currency:"RON"}).format(e):"",_=e=>{switch(e){case"Activ":return"#27ae60";case"Finalizat":return"#3498db";case"Suspendat":return"#f39c12";case"Arhivat":return"#95a5a6";default:return"#7f8c8d"}},z=e=>{switch(e){case"Activ":return"\uD83D\uDFE2";case"Finalizat":return"✅";case"Suspendat":return"⏸️";case"Arhivat":return"\uD83D\uDCE6";default:return"⚪"}};return n?(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"300px",fontSize:"16px",color:"#7f8c8d"},children:"⏳ Se \xeencarcă proiectele..."}):(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem",padding:"1rem",background:"#f8f9fa",borderRadius:"8px",border:"1px solid #dee2e6"},children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{style:{margin:0,color:"#2c3e50"},children:["\uD83D\uDCCB Proiecte găsite: ",r.length,l.length>0&&" (+ ".concat(l.length," subproiecte)")]}),(0,a.jsx)("p",{style:{margin:"0.25rem 0 0 0",fontSize:"14px",color:"#7f8c8d"},children:t&&Object.keys(t).length>0?"Rezultate filtrate":"Toate proiectele și subproiectele"})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:"0.5rem"},children:[(0,a.jsx)("button",{onClick:()=>m(!0),style:{padding:"0.5rem 1rem",background:"#27ae60",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:"+ Proiect Nou"}),(0,a.jsx)("button",{onClick:D,style:{padding:"0.5rem 1rem",background:"#3498db",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:"\uD83D\uDD04 Re\xeemprospătează"}),(0,a.jsx)("button",{onClick:C,style:{padding:"0.5rem 1rem",background:"#f39c12",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:"\uD83D\uDCCA Export Excel"})]})]}),0===r.length?(0,a.jsxs)("div",{style:{textAlign:"center",padding:"3rem",background:"#f8f9fa",borderRadius:"8px",border:"2px dashed #dee2e6"},children:[(0,a.jsx)("p",{style:{fontSize:"18px",color:"#7f8c8d",margin:0},children:"\uD83D\uDCCB Nu au fost găsite proiecte"}),(0,a.jsx)("p",{style:{fontSize:"14px",color:"#bdc3c7",margin:"0.5rem 0 0 0"},children:"Verifică filtrele aplicate sau adaugă proiecte noi."})]}):(0,a.jsxs)("div",{style:{background:"white",borderRadius:"8px",border:"1px solid #dee2e6",overflow:"visible",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",position:"relative"},children:[(0,a.jsx)("div",{style:{overflow:"auto"},children:(0,a.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"14px"},children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{style:{background:"#f8f9fa",borderBottom:"2px solid #dee2e6"},children:[(0,a.jsx)("th",{style:{padding:"1rem 0.75rem",textAlign:"left",fontWeight:"bold",color:"#2c3e50"},children:"Proiect / Subproiect"}),(0,a.jsx)("th",{style:{padding:"1rem 0.75rem",textAlign:"left",fontWeight:"bold",color:"#2c3e50"},children:"Client"}),(0,a.jsx)("th",{style:{padding:"1rem 0.75rem",textAlign:"center",fontWeight:"bold",color:"#2c3e50"},children:"Status"}),(0,a.jsx)("th",{style:{padding:"1rem 0.75rem",textAlign:"center",fontWeight:"bold",color:"#2c3e50"},children:"Data \xcenceput"}),(0,a.jsx)("th",{style:{padding:"1rem 0.75rem",textAlign:"right",fontWeight:"bold",color:"#2c3e50"},children:"Valoare Estimată"}),(0,a.jsx)("th",{style:{padding:"1rem 0.75rem",textAlign:"center",fontWeight:"bold",color:"#2c3e50"},children:"Acțiuni"})]})}),(0,a.jsx)("tbody",{children:r.map((e,t)=>{let r=w(e.ID_Proiect),o=b.has(e.ID_Proiect),l=r.length>0;return(0,a.jsxs)(i.Fragment,{children:[(0,a.jsxs)("tr",{style:{borderBottom:"1px solid #f1f2f6",background:t%2==0?"white":"#fafbfc"},children:[(0,a.jsx)("td",{style:{padding:"0.75rem",color:"#2c3e50",maxWidth:"300px"},children:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[l&&(0,a.jsx)("button",{onClick:()=>S(e.ID_Proiect),style:{background:"none",border:"none",cursor:"pointer",padding:"0.25rem",fontSize:"12px",color:"#3498db"},title:o?"Ascunde subproiectele":"Afișează subproiectele",children:o?"\uD83D\uDCC2":"\uD83D\uDCC1"}),(0,a.jsxs)("div",{style:{flex:1},children:[(0,a.jsxs)("div",{style:{fontFamily:"monospace",fontWeight:"bold",fontSize:"12px",color:"#2c3e50",marginBottom:"0.25rem"},children:["\uD83C\uDFD7️ ",e.ID_Proiect]}),(0,a.jsx)("div",{style:{color:"#2c3e50",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:e.Denumire,children:e.Denumire}),l&&(0,a.jsxs)("div",{style:{fontSize:"11px",color:"#3498db",marginTop:"0.25rem"},children:["\uD83D\uDCCB ",r.length," subproiect",1!==r.length?"e":""]})]})]})}),(0,a.jsxs)("td",{style:{padding:"0.75rem",color:"#2c3e50"},children:[(0,a.jsx)("div",{style:{fontWeight:"bold"},children:e.Client}),e.Responsabil&&(0,a.jsxs)("div",{style:{fontSize:"12px",color:"#7f8c8d"},children:["\uD83D\uDC64 ",e.Responsabil]})]}),(0,a.jsx)("td",{style:{padding:"0.75rem",textAlign:"center"},children:(0,a.jsxs)("span",{style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",padding:"0.25rem 0.5rem",borderRadius:"12px",fontSize:"12px",fontWeight:"bold",color:"white",background:_(e.Status)},children:[z(e.Status)," ",e.Status]})}),(0,a.jsx)("td",{style:{padding:"0.75rem",textAlign:"center",color:"#7f8c8d",fontFamily:"monospace"},children:N(e.Data_Start)}),(0,a.jsx)("td",{style:{padding:"0.75rem",textAlign:"right",fontWeight:"bold",color:e.Valoare_Estimata?"#27ae60":"#bdc3c7"},children:k(e.Valoare_Estimata)}),(0,a.jsx)("td",{style:{padding:"0.75rem",textAlign:"center",position:"relative"},children:(0,a.jsx)(u,{proiect:{...e,tip:"proiect"},onRefresh:D})})]}),o&&r.map((t,r)=>(0,a.jsxs)("tr",{style:{background:"#f8f9ff",borderLeft:"4px solid #3498db",borderBottom:"1px solid #e3f2fd"},children:[(0,a.jsxs)("td",{style:{padding:"0.5rem 0.75rem",paddingLeft:"3rem",color:"#2c3e50"},children:[(0,a.jsxs)("div",{style:{fontFamily:"monospace",fontWeight:"bold",fontSize:"11px",color:"#3498db",marginBottom:"0.25rem"},children:["└─ \uD83D\uDCCB ",t.ID_Subproiect]}),(0,a.jsx)("div",{style:{color:"#2c3e50",fontStyle:"italic",fontSize:"13px"},children:t.Denumire})]}),(0,a.jsxs)("td",{style:{padding:"0.5rem 0.75rem",color:"#2c3e50"},children:[(0,a.jsx)("div",{style:{fontSize:"13px"},children:t.Client||e.Client}),t.Responsabil&&(0,a.jsxs)("div",{style:{fontSize:"11px",color:"#7f8c8d"},children:["\uD83D\uDC64 ",t.Responsabil]})]}),(0,a.jsx)("td",{style:{padding:"0.5rem 0.75rem",textAlign:"center"},children:(0,a.jsxs)("span",{style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",padding:"0.2rem 0.4rem",borderRadius:"8px",fontSize:"11px",fontWeight:"bold",color:"white",background:_(t.Status)},children:[z(t.Status)," ",t.Status]})}),(0,a.jsx)("td",{style:{padding:"0.5rem 0.75rem",textAlign:"center",color:"#7f8c8d",fontFamily:"monospace",fontSize:"12px"},children:N(t.Data_Start)}),(0,a.jsx)("td",{style:{padding:"0.5rem 0.75rem",textAlign:"right",fontWeight:"bold",color:t.Valoare_Estimata?"#3498db":"#bdc3c7",fontSize:"13px"},children:k(t.Valoare_Estimata)}),(0,a.jsx)("td",{style:{padding:"0.5rem 0.75rem",textAlign:"center",position:"relative"},children:(0,a.jsx)(u,{proiect:{ID_Proiect:t.ID_Subproiect,Denumire:t.Denumire,Client:t.Client||e.Client,Status:t.Status,Valoare_Estimata:t.Valoare_Estimata,Data_Start:t.Data_Start,Data_Final:t.Data_Final,tip:"subproiect",Responsabil:t.Responsabil},onRefresh:D})})]},t.ID_Subproiect))]},e.ID_Proiect)})})]})}),r.length>0&&(0,a.jsxs)("div",{style:{padding:"1rem",borderTop:"1px solid #dee2e6",background:"#f8f9fa",display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",textAlign:"center"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{fontSize:"12px",color:"#7f8c8d"},children:"Total Proiecte"}),(0,a.jsx)("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#2c3e50"},children:r.length})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{fontSize:"12px",color:"#7f8c8d"},children:"Total Subproiecte"}),(0,a.jsx)("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#3498db"},children:l.length})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{fontSize:"12px",color:"#7f8c8d"},children:"Valoare Proiecte"}),(0,a.jsx)("div",{style:{fontSize:"16px",fontWeight:"bold",color:"#27ae60"},children:k(r.reduce((e,t)=>e+(t.Valoare_Estimata||0),0))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{fontSize:"12px",color:"#7f8c8d"},children:"Valoare Subproiecte"}),(0,a.jsx)("div",{style:{fontSize:"16px",fontWeight:"bold",color:"#3498db"},children:k(l.reduce((e,t)=>e+(t.Valoare_Estimata||0),0))})]})]})]}),(0,a.jsx)(g,{isOpen:x,onClose:()=>m(!1),onProiectAdded:D})]})}function y(){let e=(0,o.useRouter)(),t=(0,o.useSearchParams)(),[r,l]=(0,i.useState)(!1),[n,d]=(0,i.useState)({search:(null==t?void 0:t.get("search"))||"",status:(null==t?void 0:t.get("status"))||"",client:(null==t?void 0:t.get("client"))||"",data_start_start:(null==t?void 0:t.get("data_start_start"))||"",data_start_end:(null==t?void 0:t.get("data_start_end"))||"",valoare_min:(null==t?void 0:t.get("valoare_min"))||"",valoare_max:(null==t?void 0:t.get("valoare_max"))||""}),c=Object.fromEntries(Object.entries(n).filter(e=>{let[t,r]=e;return""!==r}));return(0,a.jsxs)("div",{style:{padding:"1.5rem"},children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"2rem",borderBottom:"2px solid #e9ecef",paddingBottom:"1rem"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{style:{margin:0,color:"#2c3e50",fontSize:"2rem",fontWeight:"bold"},children:"\uD83D\uDCCB Management Proiecte"}),(0,a.jsx)("p",{style:{margin:"0.5rem 0 0 0",color:"#7f8c8d",fontSize:"1.1rem"},children:"Gestionează și monitorizează toate proiectele din portofoliu"})]}),(0,a.jsx)("button",{onClick:()=>l(!0),style:{padding:"0.75rem 1.5rem",background:"#27ae60",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"16px",fontWeight:"bold",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",transition:"background-color 0.2s"},onMouseOver:e=>{e.currentTarget.style.background="#229954"},onMouseOut:e=>{e.currentTarget.style.background="#27ae60"},children:"+ Proiect Nou"})]}),(0,a.jsx)("div",{style:{marginBottom:"1.5rem",background:"white",border:"1px solid #dee2e6",borderRadius:"8px",padding:"1.5rem",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:(0,a.jsx)(i.Suspense,{fallback:(0,a.jsx)("div",{style:{padding:"2rem",textAlign:"center",color:"#7f8c8d"},children:"⏳ Se \xeencarcă filtrele..."}),children:(0,a.jsx)(s,{values:n,onChange:t=>{d(t);let r=new URLSearchParams;Object.entries(t).forEach(e=>{let[t,a]=e;a&&r.set(t,a)});let a=r.toString()?"/admin/rapoarte/proiecte?".concat(r.toString()):"/admin/rapoarte/proiecte";e.push(a)},onReset:()=>{d({search:"",status:"",client:"",data_start_start:"",data_start_end:"",valoare_min:"",valoare_max:""}),e.push("/admin/rapoarte/proiecte")}})})}),(0,a.jsx)("div",{style:{background:"white",border:"1px solid #dee2e6",borderRadius:"8px",overflow:"hidden",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:(0,a.jsx)(i.Suspense,{fallback:(0,a.jsx)("div",{style:{padding:"3rem",textAlign:"center",color:"#7f8c8d"},children:"⏳ Se \xeencarcă proiectele..."}),children:(0,a.jsx)(f,{searchParams:c})})}),(0,a.jsx)("div",{style:{marginTop:"2rem",padding:"1rem",background:"#f8f9fa",borderRadius:"6px",border:"1px solid #e9ecef"},children:(0,a.jsxs)("p",{style:{margin:0,fontSize:"14px",color:"#6c757d",textAlign:"center"},children:["\uD83D\uDCA1 ",(0,a.jsx)("strong",{children:"Tip:"}),' Folosește filtrele pentru a găsi rapid proiectele dorite. Click pe "Acțiuni" pentru a gestiona fiecare proiect individual.']})}),(0,a.jsx)(g,{isOpen:r,onClose:()=>l(!1),onProiectAdded:()=>{window.location.reload()}})]})}},4033:function(e,t,r){e.exports=r(8165)}},function(e){e.O(0,[259,811,121,114,744],function(){return e(e.s=9530)}),_N_E=e.O()}]);