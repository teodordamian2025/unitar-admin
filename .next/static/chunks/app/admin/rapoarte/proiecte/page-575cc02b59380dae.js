(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[578],{67:function(){},2061:function(){},9530:function(e,t,a){Promise.resolve().then(a.bind(a,9883))},9883:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return T}});var r=a(6705),s=a(955),l=a(4033);function i(e){let{filters:t,values:a,onChange:l,onReset:i,loading:n=!1}=e,[c,o]=(0,s.useState)(!1),d=(e,t)=>{l({...a,[e]:t})},u=Object.values(a).some(e=>""!==e&&null!=e);return(0,r.jsxs)("div",{style:{background:"white",borderRadius:"8px",padding:"1.5rem",marginBottom:"1.5rem",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",border:"1px solid #dee2e6"},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:c?"1.5rem":"0"},children:[(0,r.jsxs)("h3",{style:{margin:0,color:"#2c3e50",display:"flex",alignItems:"center",gap:"0.5rem"},children:["\uD83D\uDD0D Filtre și Căutare",u&&(0,r.jsx)("span",{style:{background:"#007bff",color:"white",borderRadius:"12px",padding:"2px 8px",fontSize:"12px",fontWeight:"normal"},children:Object.values(a).filter(e=>""!==e&&null!=e).length})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:"0.5rem"},children:[u&&(0,r.jsx)("button",{onClick:i,disabled:n,style:{padding:"0.5rem 1rem",background:"#6c757d",color:"white",border:"none",borderRadius:"6px",cursor:n?"not-allowed":"pointer",fontSize:"14px",opacity:n?.6:1},children:"\uD83D\uDD04 Reset"}),(0,r.jsx)("button",{onClick:()=>o(!c),style:{padding:"0.5rem 1rem",background:"transparent",color:"#007bff",border:"1px solid #007bff",borderRadius:"6px",cursor:"pointer",fontSize:"14px"},children:c?"Ascunde ↑":"Extinde ↓"})]})]}),c&&(0,r.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"1rem",alignItems:"end"},children:t.map(e=>{var t;return(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",color:"#495057",fontSize:"14px",fontWeight:500},children:e.label}),"text"===e.type&&(0,r.jsx)("input",{type:"text",value:a[e.key]||"",onChange:t=>d(e.key,t.target.value),placeholder:e.placeholder,disabled:n,style:{width:"100%",padding:"0.75rem",border:"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",opacity:n?.6:1}}),"select"===e.type&&(0,r.jsxs)("select",{value:a[e.key]||"",onChange:t=>d(e.key,t.target.value),disabled:n,style:{width:"100%",padding:"0.75rem",border:"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",background:"white",opacity:n?.6:1},children:[(0,r.jsx)("option",{value:"",children:e.placeholder||"Selectează..."}),null===(t=e.options)||void 0===t?void 0:t.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))]}),"date"===e.type&&(0,r.jsx)("input",{type:"date",value:a[e.key]||"",onChange:t=>d(e.key,t.target.value),disabled:n,style:{width:"100%",padding:"0.75rem",border:"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",opacity:n?.6:1}}),"dateRange"===e.type&&(0,r.jsxs)("div",{style:{display:"flex",gap:"0.5rem"},children:[(0,r.jsx)("input",{type:"date",value:a["".concat(e.key,"_start")]||"",onChange:t=>d("".concat(e.key,"_start"),t.target.value),disabled:n,style:{flex:1,padding:"0.75rem",border:"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",opacity:n?.6:1}}),(0,r.jsx)("span",{style:{alignSelf:"center",color:"#6c757d"},children:"→"}),(0,r.jsx)("input",{type:"date",value:a["".concat(e.key,"_end")]||"",onChange:t=>d("".concat(e.key,"_end"),t.target.value),disabled:n,style:{flex:1,padding:"0.75rem",border:"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",opacity:n?.6:1}})]})]},e.key)})})]})}function n(e){let{values:t,onChange:a,onReset:s,loading:l=!1}=e;return(0,r.jsx)(i,{filters:[{key:"search",label:"Căutare generală",type:"text",placeholder:"Caută după nume proiect, client, ID..."},{key:"status",label:"Status proiect",type:"select",placeholder:"Toate statusurile",options:[{value:"Activ",label:"\uD83D\uDFE2 Activ"},{value:"\xcen lucru",label:"\uD83D\uDFE1 \xcen lucru"},{value:"Suspendat",label:"\uD83D\uDFE0 Suspendat"},{value:"Finalizat",label:"✅ Finalizat"},{value:"Anulat",label:"\uD83D\uDD34 Anulat"}]},{key:"client",label:"Client",type:"select",placeholder:"Toți clienții",options:[{value:"SC T&D PRO ELECTRIC SRL",label:"SC T&D PRO ELECTRIC SRL"},{value:"SC PROD SRL",label:"SC PROD SRL"},{value:"SC BUILD SRL",label:"SC BUILD SRL"}]},{key:"data_start",label:"Perioada \xeenceput",type:"dateRange",placeholder:"Data \xeenceput"},{key:"valoare_min",label:"Valoare minimă (RON)",type:"text",placeholder:"0"},{key:"valoare_max",label:"Valoare maximă (RON)",type:"text",placeholder:"999999"}],values:t,onChange:a,onReset:s,loading:l})}var c=a(3523),o=a(7158),d=a(8253),u=a(5750),x=a(5817),m=a(4280),p=a(1827),g=a(5925),b=a(5453),h=a(6637),f=a(9670),y=a(4136),j=a(9312),v=a(5367),N=a(2549),w=a(2919),D=a(6142);function C(e){let{proiect:t,onClose:a,onSuccess:l}=e,[i,n]=(0,s.useState)(!1),[c,o]=(0,s.useState)(!1),[x,m]=(0,s.useState)(!1),[b,f]=(0,s.useState)([]),[y,v]=(0,s.useState)(null),[C,S]=(0,s.useState)({numarFactura:"",dataFactura:new Date().toISOString().split("T")[0],numeClient:t.Client||"",cuiClient:"",nrRegComClient:"",adresaClient:t.Adresa||"",emailClient:"",telefonClient:"",rataTVA:"19",observatii:""}),[A,E]=(0,s.useState)([{id:"1",descriere:t.Denumire||"",cantitate:1,pretUnitarFaraTVA:t.Valoare_Estimata||0,totalFaraTVA:t.Valoare_Estimata||0}]);(0,s.useEffect)(()=>{_(),k()},[t.ID_Proiect]);let _=async()=>{m(!0);try{let e=await fetch("/api/rapoarte/subproiecte?proiect_id=".concat(encodeURIComponent(t.ID_Proiect)));if(!e.ok)throw Error("HTTP ".concat(e.status));let a=await e.json();a.success?(f(a.subproiecte||[]),console.log("Subproiecte \xeencărcate:",a.subproiecte)):console.warn("Nu s-au putut \xeencărca subproiectele:",a.error)}catch(e){console.error("Eroare la \xeencărcarea subproiectelor:",e)}finally{m(!1)}},k=async()=>{try{let e=await fetch("/api/rapoarte/clienti?search=".concat(encodeURIComponent(t.Client)));if(!e.ok)return;let a=await e.json();if(a.success&&a.clienti&&a.clienti.length>0){let e=a.clienti[0];v(e),S(t=>({...t,cuiClient:e.cui||"",nrRegComClient:e.nr_reg_com||"",adresaClient:e.adresa||t.adresaClient,emailClient:e.email||"",telefonClient:e.telefon||""})),g.Am.success("\uD83D\uDCCA Date client preluate din baza de date!",{duration:3e3,icon:"\uD83D\uDD17"})}}catch(e){console.error("Eroare la căutarea clientului \xeen BD:",e)}},F=e=>{let{name:t,value:a}=e.target;S(e=>({...e,[t]:a}))},R=(e,t,a)=>{E(r=>r.map(r=>{if(r.id===e){let e={...r,[t]:a};return("cantitate"===t||"pretUnitarFaraTVA"===t)&&(e.totalFaraTVA=Number(e.cantitate)*Number(e.pretUnitarFaraTVA)),e}return r}))},T=e=>{A.length>1&&E(t=>t.filter(t=>t.id!==e))},P=e=>{let t="sub_".concat(e.ID_Subproiect),a=A.find(e=>e.id===t);if(a){g.Am.error("Subproiectul este deja adăugat \xeen factură!");return}let r={id:t,descriere:"Subproiect: ".concat(e.Denumire),cantitate:1,pretUnitarFaraTVA:e.Valoare_Estimata||0,totalFaraTVA:e.Valoare_Estimata||0};E(e=>[...e,r]),g.Am.success('Subproiectul "'.concat(e.Denumire,'" a fost adăugat \xeen factură!'))},I=async()=>{if(!C.cuiClient){g.Am.error("Introduceți CUI-ul pentru validare ANAF");return}o(!0);try{let e=await fetch("/api/anaf/company-info",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cui:C.cuiClient})});if(!e.ok)throw Error("HTTP ".concat(e.status));let t=await e.json();if(t.success&&t.data){let e=t.data;S(t=>({...t,numeClient:e.denumire||t.numeClient,nrRegComClient:e.nrRegCom||t.nrRegComClient,adresaClient:e.adresa||t.adresaClient})),g.Am.success("✅ Date validate și completate din ANAF!")}else g.Am.error("Nu s-au găsit date \xeen ANAF pentru acest CUI")}catch(e){console.error("Eroare ANAF:",e),g.Am.error("Eroare la validarea cu ANAF")}finally{o(!1)}},V=A.reduce((e,t)=>e+Number(t.totalFaraTVA),0),z=Number(C.rataTVA),O=V*(z/100),L=V+O,Z=async()=>{if(!C.numarFactura.trim()){g.Am.error("Numărul facturii este obligatoriu");return}if(!C.numeClient.trim()||!C.cuiClient.trim()){g.Am.error("Numele și CUI-ul clientului sunt obligatorii");return}if(A.some(e=>!e.descriere.trim())){g.Am.error("Toate liniile trebuie să aibă o descriere");return}n(!0);try{let e={proiect:{id:t.ID_Proiect,denumire:t.Denumire,client:t.Client},numarFactura:C.numarFactura,dataFactura:C.dataFactura,client:{nume:C.numeClient,cui:C.cuiClient,nrRegCom:C.nrRegComClient,adresa:C.adresaClient,email:C.emailClient,telefon:C.telefonClient,id:(null==y?void 0:y.id)||null},linii:A,subtotal:V,rataTVA:z,totalTVA:O,total:L,observatii:C.observatii};console.log("Generare factură cu datele:",e);let a=await fetch("/api/actions/invoices/generate-hibrid",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok){let e=await a.text();throw Error("HTTP ".concat(a.status,": ").concat(e))}let r=await a.blob(),s=window.URL.createObjectURL(r),i=document.createElement("a");i.href=s,i.download="Factura_".concat(C.numarFactura.replace(/[^a-zA-Z0-9]/g,"_"),".pdf"),document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(s),document.body.removeChild(i),g.Am.success("\uD83D\uDCC4 Factura PDF a fost generată și descărcată!"),l()}catch(e){console.error("Eroare la generarea facturii:",e),g.Am.error("Eroare la generarea facturii: ".concat(e instanceof Error?e.message:"Eroare necunoscută"))}finally{n(!1)}};return(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[95vh] overflow-y-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 bg-blue-50",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h2",{className:"text-xl font-semibold text-gray-900",children:[(0,r.jsx)(h.Z,{className:"w-5 h-5 inline mr-2"}),"Generare Factură Hibridă"]}),(0,r.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["Proiect: ",t.Denumire]})]}),(0,r.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,r.jsx)(N.Z,{className:"w-6 h-6"})})]}),(0,r.jsxs)("div",{className:"p-6 space-y-8",children:[(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,r.jsx)("h3",{className:"text-lg font-medium mb-4 text-gray-900",children:"\uD83D\uDCCB Date Factură"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Număr Factură *"}),(0,r.jsx)("input",{type:"text",name:"numarFactura",value:C.numarFactura,onChange:F,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"ex: 2025-001",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Factură *"}),(0,r.jsx)("input",{type:"date",name:"dataFactura",value:C.dataFactura,onChange:F,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rată TVA"}),(0,r.jsxs)("select",{name:"rataTVA",value:C.rataTVA,onChange:F,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,r.jsx)("option",{value:"19",children:"19%"}),(0,r.jsx)("option",{value:"21",children:"21%"}),(0,r.jsx)("option",{value:"9",children:"9%"}),(0,r.jsx)("option",{value:"5",children:"5%"}),(0,r.jsx)("option",{value:"0",children:"0%"})]})]})]})]}),(0,r.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("h3",{className:"text-lg font-medium text-gray-900",children:[(0,r.jsx)(d.Z,{className:"w-5 h-5 inline mr-2"}),"Date Client",y&&(0,r.jsx)("span",{className:"ml-2 text-xs bg-green-100 text-green-800 px-2 py-1 rounded",children:"Din BD"})]}),(0,r.jsxs)("button",{onClick:I,disabled:c||!C.cuiClient,className:"px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1",children:[(0,r.jsx)(p.Z,{className:"w-4 h-4"}),c?"Validez...":"Validare ANAF"]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nume Client *"}),(0,r.jsx)("input",{type:"text",name:"numeClient",value:C.numeClient,onChange:F,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CUI *"}),(0,r.jsx)("input",{type:"text",name:"cuiClient",value:C.cuiClient,onChange:F,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"ex: RO12345678",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nr. Reg. Com."}),(0,r.jsx)("input",{type:"text",name:"nrRegComClient",value:C.nrRegComClient,onChange:F,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[(0,r.jsx)(D.Z,{className:"w-4 h-4 inline mr-1"}),"Adresă"]}),(0,r.jsx)("input",{type:"text",name:"adresaClient",value:C.adresaClient,onChange:F,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),(0,r.jsx)("input",{type:"email",name:"emailClient",value:C.emailClient,onChange:F,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Telefon"}),(0,r.jsx)("input",{type:"tel",name:"telefonClient",value:C.telefonClient,onChange:F,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]})]}),b.length>0&&(0,r.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("h3",{className:"text-lg font-medium text-gray-900",children:[(0,r.jsx)(u.Z,{className:"w-5 h-5 inline mr-2"}),"Subproiecte Disponibile"]}),x&&(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"Se \xeencarcă..."})]}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:b.map(e=>{var t;let a=A.some(t=>t.id==="sub_".concat(e.ID_Subproiect));return(0,r.jsx)("div",{className:"p-3 rounded-lg border-2 transition-all ".concat(a?"border-green-300 bg-green-100":"border-gray-200 bg-white hover:border-blue-300"),children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h4",{className:"font-medium text-sm text-gray-900 mb-1",children:e.Denumire}),(0,r.jsxs)("p",{className:"text-xs text-gray-600 mb-2",children:["Valoare: ",null===(t=e.Valoare_Estimata)||void 0===t?void 0:t.toLocaleString("ro-RO")," LEI"]}),(0,r.jsxs)("p",{className:"text-xs text-gray-500",children:["Status: ",e.Status]})]}),(0,r.jsx)("button",{onClick:()=>P(e),disabled:a,className:"ml-2 p-1 rounded transition-colors ".concat(a?"text-green-600 cursor-not-allowed":"text-blue-600 hover:bg-blue-100"),title:a?"Deja adăugat":"Adaugă \xeen factură",children:(0,r.jsx)(j.Z,{className:"w-4 h-4"})})]})},e.ID_Subproiect)})})]}),(0,r.jsxs)("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("h3",{className:"text-lg font-medium text-gray-900",children:[(0,r.jsx)(w.Z,{className:"w-5 h-5 inline mr-2"}),"Linii Factură"]}),(0,r.jsxs)("button",{onClick:()=>{let e=(A.length+1).toString();E(t=>[...t,{id:e,descriere:"",cantitate:1,pretUnitarFaraTVA:0,totalFaraTVA:0}])},className:"px-3 py-1 bg-green-600 hover:bg-green-700 text-white text-sm rounded-lg transition-colors flex items-center gap-1",children:[(0,r.jsx)(j.Z,{className:"w-4 h-4"}),"Adaugă Linie"]})]}),(0,r.jsx)("div",{className:"space-y-3",children:A.map((e,t)=>(0,r.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-center bg-white p-3 rounded border",children:[(0,r.jsx)("div",{className:"col-span-5",children:(0,r.jsx)("input",{type:"text",value:e.descriere,onChange:t=>R(e.id,"descriere",t.target.value),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent",placeholder:"Descriere serviciu..."})}),(0,r.jsx)("div",{className:"col-span-2",children:(0,r.jsx)("input",{type:"number",value:e.cantitate,onChange:t=>R(e.id,"cantitate",Number(t.target.value)),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent",min:"0",step:"0.01"})}),(0,r.jsx)("div",{className:"col-span-2",children:(0,r.jsx)("input",{type:"number",value:e.pretUnitarFaraTVA,onChange:t=>R(e.id,"pretUnitarFaraTVA",Number(t.target.value)),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent",min:"0",step:"0.01"})}),(0,r.jsx)("div",{className:"col-span-2",children:(0,r.jsx)("input",{type:"number",value:e.totalFaraTVA.toFixed(2),readOnly:!0,className:"w-full px-2 py-1 text-sm border border-gray-200 rounded bg-gray-50"})}),(0,r.jsx)("div",{className:"col-span-1",children:A.length>1&&(0,r.jsx)("button",{onClick:()=>T(e.id),className:"p-1 text-red-600 hover:bg-red-100 rounded transition-colors",title:"Șterge linia",children:(0,r.jsx)(N.Z,{className:"w-4 h-4"})})})]},e.id))}),(0,r.jsxs)("div",{className:"grid grid-cols-12 gap-2 mt-2 text-xs font-medium text-gray-600",children:[(0,r.jsx)("div",{className:"col-span-5",children:"Descriere"}),(0,r.jsx)("div",{className:"col-span-2",children:"Cantitate"}),(0,r.jsx)("div",{className:"col-span-2",children:"Preț Unit (fără TVA)"}),(0,r.jsx)("div",{className:"col-span-2",children:"Total (fără TVA)"}),(0,r.jsx)("div",{className:"col-span-1",children:"Acțiuni"})]})]}),(0,r.jsx)("div",{className:"bg-gray-100 p-4 rounded-lg",children:(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Subtotal (fără TVA)"}),(0,r.jsxs)("p",{className:"text-lg font-semibold",children:[V.toLocaleString("ro-RO",{minimumFractionDigits:2})," LEI"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["TVA (",z,"%)"]}),(0,r.jsxs)("p",{className:"text-lg font-semibold",children:[O.toLocaleString("ro-RO",{minimumFractionDigits:2})," LEI"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Total"}),(0,r.jsxs)("p",{className:"text-xl font-bold text-blue-600",children:[L.toLocaleString("ro-RO",{minimumFractionDigits:2})," LEI"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Linii factură"}),(0,r.jsx)("p",{className:"text-lg font-semibold",children:A.length})]})]})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Observații"}),(0,r.jsx)("textarea",{name:"observatii",value:C.observatii,onChange:F,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",placeholder:"Observații suplimentare pentru factură..."})]}),(0,r.jsxs)("div",{className:"flex gap-3 pt-4 border-t",children:[(0,r.jsx)("button",{type:"button",onClick:a,className:"flex-1 px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",disabled:i,children:"Anulează"}),(0,r.jsxs)("button",{onClick:Z,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",disabled:i,children:[(0,r.jsx)(h.Z,{className:"w-4 h-4"}),i?"Generez PDF...":"Generează Factură PDF"]})]})]})]})})}var S=a(8203),A=a(7972),E=a(1298);function _(e){let{isOpen:t,onClose:a,onSuccess:l,proiectParinte:i,isSubproiect:n=!1}=e,[c,o]=(0,s.useState)(!1),[d,u]=(0,s.useState)({denumire:"",client:(null==i?void 0:i.Client)||"",status:"Planificat",valoareEstimata:"",dataStart:"",dataFinal:"",responsabil:"",adresa:(null==i?void 0:i.Adresa)||"",observatii:""}),x=e=>{let{name:t,value:a}=e.target;u(e=>({...e,[t]:a}))},m=()=>{let e=[];return d.denumire.trim()||e.push("Denumirea este obligatorie"),d.client.trim()||e.push("Clientul este obligatoriu"),d.dataStart||e.push("Data de start este obligatorie"),d.dataFinal||e.push("Data finală este obligatorie"),d.dataStart&&d.dataFinal&&new Date(d.dataStart)>new Date(d.dataFinal)&&e.push("Data de start nu poate fi după data finală"),d.valoareEstimata&&isNaN(Number(d.valoareEstimata))&&e.push("Valoarea estimată trebuie să fie un număr valid"),e},p=async e=>{e.preventDefault();let t=m();if(t.length>0){g.Am.error(t.join("\n"));return}o(!0);try{let e={denumire:d.denumire.trim(),client:d.client.trim(),status:d.status,valoare_estimata:d.valoareEstimata?Number(d.valoareEstimata):0,data_start:d.dataStart,data_final:d.dataFinal,responsabil:d.responsabil.trim()||null,adresa:d.adresa.trim()||null,observatii:d.observatii.trim()||null,...n&&i&&{id_proiect_parinte:i.ID_Proiect}};console.log("Trimitere date:",e);let t=await fetch(n?"/api/rapoarte/subproiecte":"/api/rapoarte/proiecte",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(console.log("Response status:",t.status),!t.ok){let e=await t.text();throw console.log("Response error text:",e),Error("Eroare HTTP ".concat(t.status,": ").concat(e))}let a=await t.json();if(console.log("Response data proiect:",a),a.success)g.Am.success("".concat(n?"Subproiectul":"Proiectul"," a fost adăugat cu succes!")),u({denumire:"",client:(null==i?void 0:i.Client)||"",status:"Planificat",valoareEstimata:"",dataStart:"",dataFinal:"",responsabil:"",adresa:(null==i?void 0:i.Adresa)||"",observatii:""}),l();else throw Error(a.error||"Eroare la adăugarea ".concat(n?"subproiectului":"proiectului"))}catch(e){console.error("Eroare la submit:",e),g.Am.error("Eroare la adăugarea ".concat(n?"subproiectului":"proiectului",": ").concat(e instanceof Error?e.message:"Eroare necunoscută"))}finally{o(!1)}};return t?(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:n?'Adaugă Subproiect pentru "'.concat(null==i?void 0:i.Denumire,'"'):"Adaugă Proiect Nou"}),(0,r.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,r.jsx)(N.Z,{className:"w-6 h-6"})})]}),(0,r.jsxs)("form",{onSubmit:p,className:"p-6 space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[(0,r.jsx)(h.Z,{className:"w-4 h-4 inline mr-1"}),"Denumire ",n?"Subproiect":"Proiect"," *"]}),(0,r.jsx)("input",{type:"text",name:"denumire",value:d.denumire,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Introduceți denumirea ".concat(n?"subproiectului":"proiectului","..."),required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[(0,r.jsx)(A.Z,{className:"w-4 h-4 inline mr-1"}),"Client *"]}),(0,r.jsx)("input",{type:"text",name:"client",value:d.client,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Introduceți numele clientului...",required:!0})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status *"}),(0,r.jsxs)("select",{name:"status",value:d.status,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,r.jsx)("option",{value:"Planificat",children:"Planificat"}),(0,r.jsx)("option",{value:"In progres",children:"\xcen progres"}),(0,r.jsx)("option",{value:"Suspendat",children:"Suspendat"}),(0,r.jsx)("option",{value:"Finalizat",children:"Finalizat"}),(0,r.jsx)("option",{value:"Anulat",children:"Anulat"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[(0,r.jsx)(E.Z,{className:"w-4 h-4 inline mr-1"}),"Valoare Estimată (LEI)"]}),(0,r.jsx)("input",{type:"number",name:"valoareEstimata",value:d.valoareEstimata,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0",min:"0",step:"0.01"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[(0,r.jsx)(S.Z,{className:"w-4 h-4 inline mr-1"}),"Data Start *"]}),(0,r.jsx)("input",{type:"date",name:"dataStart",value:d.dataStart,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[(0,r.jsx)(S.Z,{className:"w-4 h-4 inline mr-1"}),"Data Finală *"]}),(0,r.jsx)("input",{type:"date",name:"dataFinal",value:d.dataFinal,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[(0,r.jsx)(A.Z,{className:"w-4 h-4 inline mr-1"}),"Responsabil"]}),(0,r.jsx)("input",{type:"text",name:"responsabil",value:d.responsabil,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Nume responsabil..."})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[(0,r.jsx)(D.Z,{className:"w-4 h-4 inline mr-1"}),"Adresa ",n?"Subproiect":"Proiect"]}),(0,r.jsx)("input",{type:"text",name:"adresa",value:d.adresa,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Adresa unde se desfășoară lucrările..."})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Observații"}),(0,r.jsx)("textarea",{name:"observatii",value:d.observatii,onChange:x,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",placeholder:"Observații suplimentare..."})]}),(0,r.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,r.jsx)("button",{type:"button",onClick:a,className:"flex-1 px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",disabled:c,children:"Anulează"}),(0,r.jsx)("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:c,children:c?"Se adaugă...":"Adaugă ".concat(n?"Subproiect":"Proiect")})]})]})]})}):null}function k(e){let{proiect:t,onRefresh:a,isSubproiect:i=!1}=e,[n,c]=(0,s.useState)(!1),[o,d]=(0,s.useState)(!1),[u,x]=(0,s.useState)(!1),[m,p]=(0,s.useState)("bottom"),N=(0,s.useRef)(null);(0,l.useRouter)(),(0,s.useEffect)(()=>{if(n&&N.current){let e=N.current.getBoundingClientRect(),t=window.innerHeight-e.bottom,a=e.top;t<200&&a>200?p("top"):p("bottom")}},[n]);let w=async()=>{let e=confirm("Ești sigur că vrei să ștergi ".concat(i?"subproiectul":"proiectul",': "').concat(t.Denumire,'"?'));if(e){try{let e=await fetch(i?"/api/rapoarte/subproiecte":"/api/rapoarte/proiecte",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t.ID_Proiect})});if(!e.ok)throw Error("Eroare HTTP: ".concat(e.status));let r=await e.json();if(r.success)g.Am.success("".concat(i?"Subproiectul":"Proiectul"," a fost șters cu succes!")),a();else throw Error(r.error||"Eroare la ștergere")}catch(e){console.error("Eroare la ștergere:",e),g.Am.error("Eroare la ștergerea ".concat(i?"subproiectului":"proiectului"))}c(!1)}};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("button",{ref:N,onClick:()=>c(!n),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"Acțiuni",children:(0,r.jsx)(b.Z,{className:"w-4 h-4"})}),n&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"fixed inset-0 z-10",onClick:()=>c(!1)}),(0,r.jsxs)("div",{className:"absolute right-0 z-20 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 ".concat("top"===m?"bottom-full mb-2":"top-full mt-2"),children:[(0,r.jsxs)("button",{onClick:()=>{var e;console.log("Detalii proiect:",t);let a=e=>{try{return new Date(e.value).toLocaleDateString("ro-RO")}catch(e){return"N/A"}},r="\n\uD83C\uDFD7️ DETALII PROIECT\n\n\uD83D\uDCCB Denumire: ".concat(t.Denumire,"\n\uD83C\uDFE2 Client: ").concat(t.Client,"\n\uD83D\uDCCA Status: ").concat(t.Status,"\n\uD83D\uDCB0 Valoare Estimată: ").concat(null===(e=t.Valoare_Estimata)||void 0===e?void 0:e.toLocaleString("ro-RO")," LEI\n\uD83D\uDCC5 Data Start: ").concat(a(t.Data_Start),"\n\uD83D\uDCC5 Data Final: ").concat(a(t.Data_Final),"\n\uD83D\uDC64 Responsabil: ").concat(t.Responsabil||"Neatribuit","\n\uD83D\uDCCD Adresă: ").concat(t.Adresa||"Nespecificată","\n\uD83D\uDCDD Observații: ").concat(t.Observatii||"Fără observații","\n    ").trim();g.Am.success(r,{duration:8e3,style:{background:"#f8fafc",color:"#1e293b",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"12px",whiteSpace:"pre-line",maxWidth:"500px",padding:"16px"}}),c(!1)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[(0,r.jsx)(f.Z,{className:"w-4 h-4"}),"Vezi Detalii"]}),(0,r.jsxs)("button",{onClick:()=>{console.log("Date pentru editare:",t);try{let e="/admin/rapoarte/proiecte/".concat(encodeURIComponent(t.ID_Proiect),"/edit");console.log("Ar trebui să redirectionez la:",e);let a=confirm('Vrei să editezi proiectul "'.concat(t.Denumire,'"?\n\nNOTĂ: Funcția de editare va fi implementată \xeen următoarea versiune.'));a&&g.Am.success("Funcția de editare va fi disponibilă \xeen cur\xe2nd!",{duration:3e3,icon:"⚡"})}catch(e){console.error("Eroare la editare:",e),g.Am.error("Eroare la \xeencărcarea editorului")}c(!1)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[(0,r.jsx)(y.Z,{className:"w-4 h-4"}),"Editează"]}),(0,r.jsx)("hr",{className:"my-1"}),(0,r.jsxs)("button",{onClick:()=>{console.log("Generare factură pentru:",t),d(!0),c(!1)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[(0,r.jsx)(h.Z,{className:"w-4 h-4"}),"Generare Factură"]}),!i&&(0,r.jsxs)("button",{onClick:()=>{console.log("Adaugă subproiect pentru:",t),x(!0),c(!1)},className:"w-full px-4 py-2 text-left text-sm text-blue-700 hover:bg-blue-50 flex items-center gap-2",children:[(0,r.jsx)(j.Z,{className:"w-4 h-4"}),"Adaugă Subproiect"]}),(0,r.jsx)("hr",{className:"my-1"}),(0,r.jsxs)("button",{onClick:w,className:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center gap-2",children:[(0,r.jsx)(v.Z,{className:"w-4 h-4"}),"Șterge ",i?"Subproiect":"Proiect"]})]})]})]}),o&&(0,r.jsx)(C,{proiect:t,onClose:()=>d(!1),onSuccess:()=>{d(!1),a()}}),u&&(0,r.jsx)(_,{isOpen:u,onClose:()=>x(!1),onSuccess:()=>{x(!1),a()},proiectParinte:t,isSubproiect:!0})]})}var F=a(7504);function R(e){let{searchParams:t}=e,[a,l]=(0,s.useState)(!0),[i,n]=(0,s.useState)([]),[b,h]=(0,s.useState)([]),[f,y]=(0,s.useState)(new Set),[j,v]=(0,s.useState)(!1),N=(null==t?void 0:t.search)||"",w=(null==t?void 0:t.status)||"",D=(null==t?void 0:t.client)||"";(0,s.useEffect)(()=>{C()},[N,w,D]);let C=async()=>{l(!0);try{await Promise.all([S(),A()])}catch(e){console.error("Eroare la \xeencărcarea datelor:",e),g.Am.error("Eroare la \xeencărcarea datelor")}finally{l(!1)}},S=async()=>{try{let e=new URLSearchParams;N&&e.append("search",N);let t=await fetch("/api/rapoarte/proiecte?".concat(e));if(!t.ok)throw Error("HTTP ".concat(t.status));let a=await t.json();if(a.success)n(a.proiecte||[]);else throw Error(a.error||"Eroare la \xeencărcarea proiectelor")}catch(e){throw console.error("Eroare la \xeencărcarea proiectelor:",e),e}},A=async()=>{try{let e=new URLSearchParams;N&&e.append("search",N);let t=await fetch("/api/rapoarte/subproiecte?".concat(e));if(!t.ok)throw Error("HTTP ".concat(t.status));let a=await t.json();a.success?h(a.subproiecte||[]):(console.warn("Eroare la \xeencărcarea subproiectelor:",a.error),h([]))}catch(e){console.error("Eroare la \xeencărcarea subproiectelor:",e),h([])}},E=async()=>{v(!0);try{await C(),g.Am.success("Date actualizate!")}catch(e){console.error("Eroare la refresh:",e),g.Am.error("Eroare la actualizarea datelor")}finally{v(!1)}},_=e=>{y(t=>{let a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})},R=e=>b.filter(t=>t.ID_Proiect===e),T=e=>{try{return new Date(e.value).toLocaleDateString("ro-RO")}catch(e){return"N/A"}},P=e=>(null==e?void 0:e.toLocaleString("ro-RO",{minimumFractionDigits:0,maximumFractionDigits:0}))+" LEI",I=e=>(0,r.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat({Planificat:"bg-blue-100 text-blue-800","In progres":"bg-yellow-100 text-yellow-800",Suspendat:"bg-red-100 text-red-800",Finalizat:"bg-green-100 text-green-800",Anulat:"bg-gray-100 text-gray-800"}[e]||"bg-gray-100 text-gray-800"),children:e}),V=i.filter(e=>(!w||e.Status===w)&&(!D||!!e.Client.toLowerCase().includes(D.toLowerCase())));return a?(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Se \xeencarcă proiectele..."})]})}):(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,r.jsx)("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("h3",{className:"text-lg font-medium text-gray-900",children:[(0,r.jsx)(d.Z,{className:"w-5 h-5 inline mr-2"}),"Proiecte & Subproiecte"]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,r.jsxs)("span",{children:[V.length," proiecte"]}),(0,r.jsx)("span",{children:"•"}),(0,r.jsxs)("span",{children:[b.length," subproiecte"]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("button",{onClick:E,disabled:j,className:"px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-white rounded-lg transition-colors disabled:opacity-50 flex items-center gap-1",title:"Actualizează datele",children:[(0,r.jsx)(m.Z,{className:"w-4 h-4 ".concat(j?"animate-spin":"")}),"Actualizează"]}),(0,r.jsxs)("button",{onClick:()=>{try{let e=[];V.forEach(t=>{e.push({Tip:"Proiect",ID:t.ID_Proiect,Denumire:t.Denumire,Client:t.Client,Status:t.Status,"Valoare Estimată (LEI)":t.Valoare_Estimata||0,"Data Start":T(t.Data_Start),"Data Final":T(t.Data_Final),Responsabil:t.Responsabil||"Neatribuit",Adresă:t.Adresa||"Nespecificată"});let a=R(t.ID_Proiect);a.forEach(t=>{e.push({Tip:"Subproiect",ID:t.ID_Subproiect,Denumire:"  → ".concat(t.Denumire),Client:t.Client,Status:t.Status,"Valoare Estimată (LEI)":t.Valoare_Estimata||0,"Data Start":T(t.Data_Start),"Data Final":T(t.Data_Final),Responsabil:t.Responsabil||"Neatribuit",Adresă:t.Adresa||"Nespecificată"})})});let t=F.P6.book_new(),a=F.P6.json_to_sheet(e);a["!cols"]=[{wch:12},{wch:25},{wch:40},{wch:20},{wch:12},{wch:15},{wch:12},{wch:12},{wch:15},{wch:30}],F.P6.book_append_sheet(t,a,"Proiecte & Subproiecte");let r="Proiecte_".concat(new Date().toISOString().slice(0,10),".xlsx");F.NC(t,r),g.Am.success("\uD83D\uDCCA Export Excel realizat cu succes!")}catch(e){console.error("Eroare la export:",e),g.Am.error("Eroare la exportul Excel")}},className:"px-3 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors flex items-center gap-1",title:"Export Excel",children:[(0,r.jsx)(x.Z,{className:"w-4 h-4"}),"Export Excel"]})]})]})}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[(0,r.jsx)("thead",{className:"bg-gray-50 border-b border-gray-200",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Proiect / Subproiect"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Client"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valoare Estimată"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Perioada"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Responsabil"}),(0,r.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acțiuni"})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:0===V.length?(0,r.jsx)("tr",{children:(0,r.jsxs)("td",{colSpan:7,className:"px-6 py-8 text-center text-gray-500",children:[(0,r.jsx)(p.Z,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),"Nu s-au găsit proiecte care să corespundă filtrelor aplicaţe."]})}):V.map(e=>{let t=R(e.ID_Proiect),a=f.has(e.ID_Proiect),s=t.length>0;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsxs)("div",{className:"flex items-center",children:[s&&(0,r.jsx)("button",{onClick:()=>_(e.ID_Proiect),className:"mr-2 p-1 rounded hover:bg-gray-200 transition-colors",children:a?(0,r.jsx)(c.Z,{className:"w-4 h-4 text-gray-600"}):(0,r.jsx)(o.Z,{className:"w-4 h-4 text-gray-600"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(d.Z,{className:"w-4 h-4 text-blue-600"}),(0,r.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.Denumire})]}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["ID: ",e.ID_Proiect]}),s&&(0,r.jsxs)("p",{className:"text-xs text-blue-600 mt-1",children:[t.length," subproiect",1!==t.length?"e":""]})]})]})}),(0,r.jsxs)("td",{className:"px-6 py-4",children:[(0,r.jsx)("p",{className:"text-sm text-gray-900",children:e.Client}),e.Adresa&&(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:e.Adresa})]}),(0,r.jsx)("td",{className:"px-6 py-4",children:I(e.Status)}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsx)("p",{className:"text-sm font-medium text-gray-900",children:P(e.Valoare_Estimata||0)})}),(0,r.jsxs)("td",{className:"px-6 py-4",children:[(0,r.jsx)("p",{className:"text-sm text-gray-900",children:T(e.Data_Start)}),(0,r.jsxs)("p",{className:"text-xs text-gray-500",children:["→ ",T(e.Data_Final)]})]}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsx)("p",{className:"text-sm text-gray-900",children:e.Responsabil||"Neatribuit"})}),(0,r.jsx)("td",{className:"px-6 py-4 text-right",children:(0,r.jsx)(k,{proiect:e,onRefresh:C,isSubproiect:!1})})]},e.ID_Proiect),a&&t.map(e=>(0,r.jsxs)("tr",{className:"bg-blue-25 hover:bg-blue-50 transition-colors border-l-4 border-blue-200",children:[(0,r.jsx)("td",{className:"px-6 py-3",children:(0,r.jsx)("div",{className:"flex items-center ml-8",children:(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(u.Z,{className:"w-3 h-3 text-blue-500"}),(0,r.jsx)("p",{className:"text-sm text-gray-800",children:e.Denumire})]}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["ID: ",e.ID_Subproiect]})]})})}),(0,r.jsxs)("td",{className:"px-6 py-3",children:[(0,r.jsx)("p",{className:"text-sm text-gray-700",children:e.Client}),e.Adresa&&(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:e.Adresa})]}),(0,r.jsx)("td",{className:"px-6 py-3",children:I(e.Status)}),(0,r.jsx)("td",{className:"px-6 py-3",children:(0,r.jsx)("p",{className:"text-sm font-medium text-gray-800",children:P(e.Valoare_Estimata||0)})}),(0,r.jsxs)("td",{className:"px-6 py-3",children:[(0,r.jsx)("p",{className:"text-sm text-gray-800",children:T(e.Data_Start)}),(0,r.jsxs)("p",{className:"text-xs text-gray-500",children:["→ ",T(e.Data_Final)]})]}),(0,r.jsx)("td",{className:"px-6 py-3",children:(0,r.jsx)("p",{className:"text-sm text-gray-800",children:e.Responsabil||"Neatribuit"})}),(0,r.jsx)("td",{className:"px-6 py-3 text-right",children:(0,r.jsx)(k,{proiect:{ID_Proiect:e.ID_Subproiect,Denumire:e.Denumire,Client:e.Client,Status:e.Status,Valoare_Estimata:e.Valoare_Estimata,Data_Start:e.Data_Start,Data_Final:e.Data_Final,Responsabil:e.Responsabil,Adresa:e.Adresa,Observatii:e.Observatii},onRefresh:C,isSubproiect:!0})})]},e.ID_Subproiect))]})})})]})}),V.length>0&&(0,r.jsx)("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50",children:(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Total Proiecte"}),(0,r.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:V.length})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Total Subproiecte"}),(0,r.jsx)("p",{className:"text-lg font-semibold text-blue-600",children:b.length})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Valoare Totală Proiecte"}),(0,r.jsx)("p",{className:"text-lg font-semibold text-green-600",children:P(V.reduce((e,t)=>e+(t.Valoare_Estimata||0),0))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Valoare Totală Subproiecte"}),(0,r.jsx)("p",{className:"text-lg font-semibold text-purple-600",children:P(b.reduce((e,t)=>e+(t.Valoare_Estimata||0),0))})]})]})})]})}function T(){let e=(0,l.useRouter)(),t=(0,l.useSearchParams)(),[a,i]=(0,s.useState)({search:(null==t?void 0:t.get("search"))||"",status:(null==t?void 0:t.get("status"))||"",client:(null==t?void 0:t.get("client"))||"",data_start_start:(null==t?void 0:t.get("data_start_start"))||"",data_start_end:(null==t?void 0:t.get("data_start_end"))||"",valoare_min:(null==t?void 0:t.get("valoare_min"))||"",valoare_max:(null==t?void 0:t.get("valoare_max"))||""}),c=Object.fromEntries(Object.entries(a).filter(e=>{let[t,a]=e;return""!==a}));return(0,r.jsxs)("div",{style:{padding:"1.5rem"},children:[(0,r.jsxs)("div",{style:{marginBottom:"2rem",borderBottom:"2px solid #e9ecef",paddingBottom:"1rem"},children:[(0,r.jsx)("h1",{style:{margin:0,color:"#2c3e50",fontSize:"2rem",fontWeight:"bold"},children:"\uD83D\uDCCB Management Proiecte"}),(0,r.jsx)("p",{style:{margin:"0.5rem 0 0 0",color:"#7f8c8d",fontSize:"1.1rem"},children:"Gestionează și monitorizează toate proiectele din portofoliu"})]}),(0,r.jsx)("div",{style:{marginBottom:"1.5rem",background:"white",border:"1px solid #dee2e6",borderRadius:"8px",padding:"1.5rem",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:(0,r.jsx)(s.Suspense,{fallback:(0,r.jsx)("div",{style:{padding:"2rem",textAlign:"center",color:"#7f8c8d"},children:"⏳ Se \xeencarcă filtrele..."}),children:(0,r.jsx)(n,{values:a,onChange:t=>{i(t);let a=new URLSearchParams;Object.entries(t).forEach(e=>{let[t,r]=e;r&&a.set(t,r)});let r=a.toString()?"/admin/rapoarte/proiecte?".concat(a.toString()):"/admin/rapoarte/proiecte";e.push(r)},onReset:()=>{i({search:"",status:"",client:"",data_start_start:"",data_start_end:"",valoare_min:"",valoare_max:""}),e.push("/admin/rapoarte/proiecte")}})})}),(0,r.jsx)("div",{style:{background:"white",border:"1px solid #dee2e6",borderRadius:"8px",overflow:"hidden",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:(0,r.jsx)(s.Suspense,{fallback:(0,r.jsx)("div",{style:{padding:"3rem",textAlign:"center",color:"#7f8c8d"},children:"⏳ Se \xeencarcă proiectele..."}),children:(0,r.jsx)(R,{searchParams:c})})}),(0,r.jsx)("div",{style:{marginTop:"2rem",padding:"1rem",background:"#f8f9fa",borderRadius:"6px",border:"1px solid #e9ecef"},children:(0,r.jsxs)("p",{style:{margin:0,fontSize:"14px",color:"#6c757d",textAlign:"center"},children:["\uD83D\uDCA1 ",(0,r.jsx)("strong",{children:"Tip:"}),' Folosește filtrele pentru a găsi rapid proiectele dorite. Click pe "Acțiuni" pentru a gestiona fiecare proiect individual.']})})]})}}},function(e){e.O(0,[425,277,121,114,744],function(){return e(e.s=9530)}),_N_E=e.O()}]);