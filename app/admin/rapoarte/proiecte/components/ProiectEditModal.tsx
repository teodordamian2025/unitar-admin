// ==================================================================
// CALEA: app/admin/rapoarte/proiecte/components/ProiectEditModal.tsx
// MODIFICAT: Fix format datÄƒ romÃ¢nesc dd/mm/year + pÄƒstreazÄƒ toate funcÈ›ionalitÄƒÈ›ile
// ==================================================================

'use client';

import { useState, useEffect } from 'react';
import { toast } from 'react-toastify';
import ClientNouModal from '../../clienti/components/ClientNouModal';

interface ProiectEditModalProps {
  proiect: any;
  isOpen: boolean;
  onClose: () => void;
  onProiectUpdated: () => void;
  onProiectDeleted: () => void;
}

interface Client {
  id: string;
  nume: string;
  cui?: string;
  email?: string;
}

export default function ProiectEditModal({ 
  proiect, 
  isOpen, 
  onClose, 
  onProiectUpdated, 
  onProiectDeleted 
}: ProiectEditModalProps) {
  const [loading, setLoading] = useState(false);
  const [clienti, setClienti] = useState<Client[]>([]);
  const [showClientModal, setShowClientModal] = useState(false);
  const [clientSearch, setClientSearch] = useState('');
  const [showClientSuggestions, setShowClientSuggestions] = useState(false);
  
  // âœ… State pentru conversii valutare
  const [cursValutar, setCursValutar] = useState<number | null>(null);
  const [loadingCurs, setLoadingCurs] = useState(false);
  
  const [formData, setFormData] = useState({
    ID_Proiect: '',
    Denumire: '',
    Client: '',
    selectedClientId: '',
    Adresa: '',
    Descriere: '',
    Data_Start: '',
    Data_Final: '',
    Status: 'Activ',
    
    // âœ… Valoare È™i monedÄƒ
    Valoare_Estimata: '',
    moneda: 'RON',
    curs_valutar: '',
    data_curs_valutar: '',
    valoare_ron: '',
    
    // âœ… Status-uri multiple
    status_predare: 'Nepredat',
    status_contract: 'Nu e cazul',
    status_facturare: 'Nefacturat', 
    status_achitare: 'Neachitat', // âœ… FIX: OpÈ›iuni corecte
    
    Responsabil: '',
    Observatii: ''
  });

  // âœ… NOU: FuncÈ›ie pentru formatarea datei Ã®n format romÃ¢nesc pentru afiÈ™are
  const formatDateForDisplay = (dateValue: string): string => {
    if (!dateValue) return '';
    try {
      return new Date(dateValue).toLocaleDateString('ro-RO');
    } catch {
      return dateValue;
    }
  };

  useEffect(() => {
    if (isOpen && proiect) {
      loadClienti();
      loadProiectData();
    }
  }, [isOpen, proiect]);

  // âœ… Effect pentru calcularea cursului valutar
  useEffect(() => {
    if (formData.moneda !== 'RON' && formData.Valoare_Estimata) {
      loadCursValutar();
    } else if (formData.moneda === 'RON') {
      setFormData(prev => ({
        ...prev,
        valoare_ron: prev.Valoare_Estimata,
        curs_valutar: '1',
      }));
      setCursValutar(1);
    }
  }, [formData.moneda, formData.Valoare_Estimata, formData.data_curs_valutar]);

  const loadProiectData = () => {
    // âœ… ÃncarcÄƒ datele existente ale proiectului Ã®n formular
    setFormData({
      ID_Proiect: proiect.ID_Proiect || '',
      Denumire: proiect.Denumire || '',
      Client: proiect.Client || '',
      selectedClientId: '',
      Adresa: proiect.Adresa || '',
      Descriere: proiect.Descriere || '',
      Data_Start: proiect.Data_Start ? formatDateForInput(proiect.Data_Start) : '',
      Data_Final: proiect.Data_Final ? formatDateForInput(proiect.Data_Final) : '',
      Status: proiect.Status || 'Activ',
      
      // âœ… ÃncarcÄƒ valorile existente sau seteazÄƒ default-uri
      Valoare_Estimata: proiect.Valoare_Estimata?.toString() || '',
      moneda: proiect.moneda || 'RON',
      curs_valutar: proiect.curs_valutar?.toString() || '',
      data_curs_valutar: proiect.data_curs_valutar || new Date().toISOString().split('T')[0],
      valoare_ron: proiect.valoare_ron?.toString() || '',
      
      // âœ… ÃncarcÄƒ status-urile existente
      status_predare: proiect.status_predare || 'Nepredat',
      status_contract: proiect.status_contract || 'Nu e cazul',
      status_facturare: proiect.status_facturare || 'Nefacturat',
      status_achitare: proiect.status_achitare || 'Neachitat',
      
      Responsabil: proiect.Responsabil || '',
      Observatii: proiect.Observatii || ''
    });
    
    setClientSearch(proiect.Client || '');
  };

  // âœ… Helper pentru formatarea datei pentru input
  const formatDateForInput = (dateString: string | { value: string }): string => {
    try {
      const dateValue = typeof dateString === 'string' ? dateString : dateString.value;
      const date = new Date(dateValue);
      if (isNaN(date.getTime())) return '';
      
      // âœ… Format ISO pentru input type="date"
      return date.toISOString().split('T')[0];
    } catch {
      return '';
    }
  };

  const loadClienti = async () => {
    try {
      const response = await fetch('/api/rapoarte/clienti');
      const data = await response.json();
      if (data.success) {
        setClienti(data.data || []);
      }
    } catch (error) {
      console.error('Eroare la Ã®ncÄƒrcarea clienÈ›ilor:', error);
    }
  };

  // âœ… FuncÈ›ie pentru Ã®ncÄƒrcarea cursului valutar
  const loadCursValutar = async () => {
    if (formData.moneda === 'RON') return;
    
    setLoadingCurs(true);
    try {
      const response = await fetch(`/api/curs-valutar?moneda=${formData.moneda}&data=${formData.data_curs_valutar}`);
      const data = await response.json();
      
      if (data.success) {
        setCursValutar(data.curs);
        
        const valoareRON = parseFloat(formData.Valoare_Estimata) * data.curs;
        
        setFormData(prev => ({
          ...prev,
          curs_valutar: data.curs.toString(),
          valoare_ron: valoareRON.toFixed(2)
        }));
        
        if (data.source === 'fallback') {
          toast.warning(data.warning || 'Folosind curs aproximativ');
        }
      } else {
        toast.error('Nu s-a putut obÈ›ine cursul valutar');
      }
    } catch (error) {
      console.error('Eroare la obÈ›inerea cursului:', error);
      toast.error('Eroare la obÈ›inerea cursului valutar');
    } finally {
      setLoadingCurs(false);
    }
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    try {
      // ValidÄƒri
      if (!formData.Denumire.trim()) {
        toast.error('Denumirea proiectului este obligatorie');
        setLoading(false);
        return;
      }

      if (!formData.Client.trim()) {
        toast.error('Clientul este obligatoriu');
        setLoading(false);
        return;
      }

      console.log('Actualizare proiect:', formData);
      toast.info('Se actualizeazÄƒ proiectul...');

      // âœ… PregÄƒteÈ™te datele pentru actualizare
      const updateData = {
        id: formData.ID_Proiect,
        Denumire: formData.Denumire.trim(),
        Client: formData.Client.trim(),
        Adresa: formData.Adresa.trim(),
        Descriere: formData.Descriere.trim(),
        Data_Start: formData.Data_Start || null,
        Data_Final: formData.Data_Final || null,
        Status: formData.Status,
        Valoare_Estimata: formData.Valoare_Estimata ? parseFloat(formData.Valoare_Estimata) : null,
        
        // âœ… MonedÄƒ È™i conversii
        moneda: formData.moneda,
        curs_valutar: formData.curs_valutar ? parseFloat(formData.curs_valutar) : null,
        data_curs_valutar: formData.data_curs_valutar || null,
        valoare_ron: formData.valoare_ron ? parseFloat(formData.valoare_ron) : null,
        
        // âœ… Status-uri multiple
        status_predare: formData.status_predare,
        status_contract: formData.status_contract,
        status_facturare: formData.status_facturare,
        status_achitare: formData.status_achitare,
        
        Responsabil: formData.Responsabil.trim(),
        Observatii: formData.Observatii.trim()
      };

      const response = await fetch('/api/rapoarte/proiecte', {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(updateData)
      });

      const result = await response.json();

      if (result.success || response.ok) {
        toast.success('Proiect actualizat cu succes!');
        onProiectUpdated();
        onClose();
      } else {
        console.error('Eroare API:', result);
        toast.error(`Eroare: ${result.error || 'Eroare necunoscutÄƒ'}`);
      }
    } catch (error) {
      console.error('Eroare la actualizarea proiectului:', error);
      toast.error('Eroare la actualizarea proiectului');
    } finally {
      setLoading(false);
    }
  };

  // âœ… NOUÄ‚: FuncÈ›ie pentru È™tergerea proiectului
  const handleDelete = async () => {
    const itemType = proiect.tip === 'subproiect' ? 'subproiectul' : 'proiectul';
    const confirmed = confirm(
      `ATENÈšIE: EÈ™ti sigur cÄƒ vrei sÄƒ È™tergi ${itemType} "${formData.Denumire}"?\n\n` +
      `ID: ${formData.ID_Proiect}\n` +
      `Client: ${formData.Client}\n\n` +
      `AceastÄƒ acÈ›iune nu poate fi anulatÄƒ È™i va È™terge permanent toate datele asociate!`
    );
    
    if (!confirmed) return;

    setLoading(true);
    try {
      const apiEndpoint = proiect.tip === 'subproiect' 
        ? `/api/rapoarte/subproiecte?id=${encodeURIComponent(formData.ID_Proiect)}`
        : `/api/rapoarte/proiecte?id=${encodeURIComponent(formData.ID_Proiect)}`;
      
      const response = await fetch(apiEndpoint, {
        method: 'DELETE'
      });

      const result = await response.json();

      if (result.success) {
        toast.success(`${itemType.charAt(0).toUpperCase() + itemType.slice(1)} È™ters cu succes!`);
        onProiectDeleted();
        onClose();
      } else {
        toast.error(result.error || `Eroare la È™tergerea ${itemType}`);
      }
    } catch (error) {
      console.error('Eroare la È™tergere:', error);
      toast.error(`Eroare la È™tergerea ${itemType}`);
    } finally {
      setLoading(false);
    }
  };

  const handleInputChange = (field: string, value: string) => {
    setFormData(prev => ({
      ...prev,
      [field]: value
    }));
  };

  const handleClientSearch = (value: string) => {
    setClientSearch(value);
    setFormData(prev => ({ ...prev, Client: value }));
    setShowClientSuggestions(value.length > 0);
  };

  const selectClient = (client: Client) => {
    setClientSearch(client.nume);
    setFormData(prev => ({ 
      ...prev, 
      Client: client.nume,
      selectedClientId: client.id 
    }));
    setShowClientSuggestions(false);
  };

  const filteredClients = clienti.filter(client =>
    client.nume.toLowerCase().includes(clientSearch.toLowerCase())
  ).slice(0, 5);

  if (!isOpen) return null;

  return (
    <div style={{
      position: 'fixed',
      top: 0,
      left: 0,
      right: 0,
      bottom: 0,
      background: 'rgba(0,0,0,0.7)',
      zIndex: 99999,
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center',
      padding: '1rem'
    }}>
      <div style={{
        background: 'white',
        borderRadius: '8px',
        boxShadow: '0 8px 32px rgba(0,0,0,0.3)',
        maxWidth: '1100px',
        width: '100%',
        maxHeight: '90vh',
        overflowY: 'auto'
      }}>
        {/* Header */}
        <div style={{
          padding: '1.5rem',
          borderBottom: '1px solid #dee2e6',
          background: '#f8f9fa',
          borderRadius: '8px 8px 0 0'
        }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
            <h2 style={{ margin: 0, color: '#2c3e50' }}>
              âœï¸ EditeazÄƒ {proiect.tip === 'subproiect' ? 'Subproiect' : 'Proiect'}
            </h2>
            <button
              onClick={onClose}
              disabled={loading}
              style={{
                background: 'transparent',
                border: 'none',
                fontSize: '24px',
                cursor: 'pointer',
                color: '#6c757d'
              }}
            >
              Ã—
            </button>
          </div>
          <p style={{ margin: '0.5rem 0 0 0', color: '#7f8c8d', fontSize: '14px' }}>
            ID: <strong>{formData.ID_Proiect}</strong> | ModificÄƒ informaÈ›iile proiectului
          </p>
        </div>

        <form onSubmit={handleSubmit} style={{ padding: '1.5rem' }}>
          {/* InformaÈ›ii de bazÄƒ */}
          <div style={{ 
            display: 'grid', 
            gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', 
            gap: '1rem',
            marginBottom: '1rem'
          }}>
            {/* ID Proiect - Read Only */}
            <div>
              <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold', color: '#2c3e50' }}>
                ID Proiect (Nu se poate modifica)
              </label>
              <input
                type="text"
                value={formData.ID_Proiect}
                disabled={true}
                style={{
                  width: '100%',
                  padding: '0.75rem',
                  border: '1px solid #dee2e6',
                  borderRadius: '6px',
                  fontSize: '14px',
                  fontFamily: 'monospace',
                  fontWeight: 'bold',
                  background: '#f8f9fa',
                  color: '#6c757d'
                }}
              />
            </div>

            {/* Status General */}
            <div>
              <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold', color: '#2c3e50' }}>
                Status General
              </label>
              <select
                value={formData.Status}
                onChange={(e) => handleInputChange('Status', e.target.value)}
                disabled={loading}
                style={{
                  width: '100%',
                  padding: '0.75rem',
                  border: '1px solid #dee2e6',
                  borderRadius: '6px',
                  fontSize: '14px'
                }}
              >
                <option value="Activ">ğŸŸ¢ Activ</option>
                <option value="Planificat">ğŸ“… Planificat</option>
                <option value="Suspendat">â¸ï¸ Suspendat</option>
                <option value="Finalizat">âœ… Finalizat</option>
              </select>
            </div>
          </div>

          {/* Denumire proiect */}
          <div style={{ marginBottom: '1rem' }}>
            <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold', color: '#2c3e50' }}>
              Denumire Proiect *
            </label>
            <input
              type="text"
              value={formData.Denumire}
              onChange={(e) => handleInputChange('Denumire', e.target.value)}
              disabled={loading}
              placeholder="Numele proiectului"
              style={{
                width: '100%',
                padding: '0.75rem',
                border: '1px solid #dee2e6',
                borderRadius: '6px',
                fontSize: '14px'
              }}
            />
          </div>

          {/* Client cu cÄƒutare */}
          <div style={{ marginBottom: '1rem', position: 'relative' }}>
            <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold', color: '#2c3e50' }}>
              Client *
            </label>
            <div style={{ display: 'flex', gap: '0.5rem' }}>
              <div style={{ flex: 1, position: 'relative' }}>
                <input
                  type="text"
                  value={clientSearch}
                  onChange={(e) => handleClientSearch(e.target.value)}
                  disabled={loading}
                  placeholder="CautÄƒ client sau scrie numele..."
                  style={{
                    width: '100%',
                    padding: '0.75rem',
                    border: '1px solid #dee2e6',
                    borderRadius: '6px',
                    fontSize: '14px'
                  }}
                />
                
                {/* Suggestions dropdown */}
                {showClientSuggestions && filteredClients.length > 0 && (
                  <div style={{
                    position: 'absolute',
                    top: '100%',
                    left: 0,
                    right: 0,
                    background: 'white',
                    border: '1px solid #dee2e6',
                    borderTop: 'none',
                    borderRadius: '0 0 6px 6px',
                    boxShadow: '0 4px 8px rgba(0,0,0,0.1)',
                    zIndex: 1000,
                    maxHeight: '200px',
                    overflowY: 'auto'
                  }}>
                    {filteredClients.map(client => (
                      <div
                        key={client.id}
                        onClick={() => selectClient(client)}
                        style={{
                          padding: '0.75rem',
                          cursor: 'pointer',
                          borderBottom: '1px solid #f1f2f6',
                          fontSize: '14px'
                        }}
                        onMouseOver={(e) => {
                          e.currentTarget.style.background = '#f8f9fa';
                        }}
                        onMouseOut={(e) => {
                          e.currentTarget.style.background = 'white';
                        }}
                      >
                        <div style={{ fontWeight: 'bold' }}>{client.nume}</div>
                        {client.cui && (
                          <div style={{ fontSize: '12px', color: '#7f8c8d' }}>
                            CUI: {client.cui}
                          </div>
                        )}
                      </div>
                    ))}
                  </div>
                )}
              </div>
              
              <button
                type="button"
                onClick={() => setShowClientModal(true)}
                disabled={loading}
                style={{
                  padding: '0.75rem 1rem',
                  background: '#27ae60',
                  color: 'white',
                  border: 'none',
                  borderRadius: '6px',
                  cursor: loading ? 'not-allowed' : 'pointer',
                  fontSize: '12px',
                  fontWeight: 'bold',
                  whiteSpace: 'nowrap'
                }}
              >
                + Client Nou
              </button>
            </div>
          </div>

          {/* Adresa */}
          <div style={{ marginBottom: '1rem' }}>
            <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold', color: '#2c3e50' }}>
              Adresa Proiect
            </label>
            <input
              type="text"
              value={formData.Adresa}
              onChange={(e) => handleInputChange('Adresa', e.target.value)}
              disabled={loading}
              placeholder="Adresa unde se desfÄƒÈ™oarÄƒ proiectul"
              style={{
                width: '100%',
                padding: '0.75rem',
                border: '1px solid #dee2e6',
                borderRadius: '6px',
                fontSize: '14px'
              }}
            />
          </div>

          {/* âœ… SECÈšIUNE: Valoare È™i MonedÄƒ */}
          <div style={{ 
            background: '#f8f9fa',
            padding: '1rem',
            borderRadius: '6px',
            marginBottom: '1rem',
            border: '1px solid #dee2e6'
          }}>
            <h4 style={{ margin: '0 0 1rem 0', color: '#2c3e50' }}>ğŸ’° Valoare Proiect</h4>
            
            <div style={{ 
              display: 'grid', 
              gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', 
              gap: '1rem'
            }}>
              <div>
                <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold', color: '#2c3e50' }}>
                  Valoare EstimatÄƒ *
                </label>
                <input
                  type="number"
                  value={formData.Valoare_Estimata}
                  onChange={(e) => handleInputChange('Valoare_Estimata', e.target.value)}
                  disabled={loading}
                  placeholder="15000"
                  style={{
                    width: '100%',
                    padding: '0.75rem',
                    border: '1px solid #dee2e6',
                    borderRadius: '6px',
                    fontSize: '14px'
                  }}
                />
              </div>

              <div>
                <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold', color: '#2c3e50' }}>
                  MonedÄƒ
                </label>
                <select
                  value={formData.moneda}
                  onChange={(e) => handleInputChange('moneda', e.target.value)}
                  disabled={loading}
                  style={{
                    width: '100%',
                    padding: '0.75rem',
                    border: '1px solid #dee2e6',
                    borderRadius: '6px',
                    fontSize: '14px'
                  }}
                >
                  <option value="RON">ğŸ‡·ğŸ‡´ RON (Lei romÃ¢ni)</option>
                  <option value="EUR">ğŸ‡ªğŸ‡º EUR (Euro)</option>
                  <option value="USD">ğŸ‡ºğŸ‡¸ USD (Dolari SUA)</option>
                  <option value="GBP">ğŸ‡¬ğŸ‡§ GBP (Lire sterline)</option>
                </select>
              </div>

              <div>
                <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold', color: '#2c3e50' }}>
                  Data Curs
                  {/* âœ… NOU: AfiÈ™are data Ã®n format romÃ¢nesc */}
                  {formData.data_curs_valutar && (
                    <span style={{ fontSize: '12px', color: '#7f8c8d', fontWeight: 'normal' }}>
                      ({formatDateForDisplay(formData.data_curs_valutar)})
                    </span>
                  )}
                </label>
                <input
                  type="date"
                  value={formData.data_curs_valutar}
                  onChange={(e) => handleInputChange('data_curs_valutar', e.target.value)}
                  disabled={loading || formData.moneda === 'RON'}
                  style={{
                    width: '100%',
                    padding: '0.75rem',
                    border: '1px solid #dee2e6',
                    borderRadius: '6px',
                    fontSize: '14px'
                  }}
                />
              </div>

              <div>
                <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold', color: '#2c3e50' }}>
                  Echivalent RON
                </label>
                <div style={{
                  padding: '0.75rem',
                  border: '1px solid #dee2e6',
                  borderRadius: '6px',
                  background: '#fff',
                  fontSize: '14px',
                  fontWeight: 'bold',
                  color: loadingCurs ? '#6c757d' : '#27ae60'
                }}>
                  {loadingCurs ? 'â³ Se calculeazÄƒ...' : 
                   formData.valoare_ron ? `${parseFloat(formData.valoare_ron).toLocaleString('ro-RO')} RON` : 
                   '0.00 RON'}
                </div>
                {cursValutar && formData.moneda !== 'RON' && (
                  <div style={{ fontSize: '12px', color: '#7f8c8d', marginTop: '4px' }}>
                    Curs: 1 {formData.moneda} = {cursValutar.toFixed(4)} RON
                  </div>
                )}
              </div>
            </div>
          </div>

          {/* âœ… SECÈšIUNE: Status-uri Multiple cu FIX pentru Status Achitare */}
          <div style={{ 
            background: '#e8f5e8',
            padding: '1rem',
            borderRadius: '6px',
            marginBottom: '1rem',
            border: '1px solid #c3e6cb'
          }}>
            <h4 style={{ margin: '0 0 1rem 0', color: '#2c3e50' }}>ğŸ“Š Status-uri Proiect</h4>
            
            <div style={{ 
              display: 'grid', 
              gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', 
              gap: '1rem'
            }}>
              <div>
                <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold', color: '#2c3e50' }}>
                  Status Predare
                </label>
                <select
                  value={formData.status_predare}
                  onChange={(e) => handleInputChange('status_predare', e.target.value)}
                  disabled={loading}
                  style={{
                    width: '100%',
                    padding: '0.75rem',
                    border: '1px solid #dee2e6',
                    borderRadius: '6px',
                    fontSize: '14px'
                  }}
                >
                  <option value="Nepredat">âŒ Nepredat</option>
                  <option value="Predat">âœ… Predat</option>
                </select>
              </div>

              <div>
                <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold', color: '#2c3e50' }}>
                  Status Contract
                </label>
                <select
                  value={formData.status_contract}
                  onChange={(e) => handleInputChange('status_contract', e.target.value)}
                  disabled={loading}
                  style={{
                    width: '100%',
                    padding: '0.75rem',
                    border: '1px solid #dee2e6',
                    borderRadius: '6px',
                    fontSize: '14px'
                  }}
                >
                  <option value="Nu e cazul">â– Nu e cazul</option>
                  <option value="Nesemnat">ğŸ“ Nesemnat</option>
                  <option value="Semnat">âœ… Semnat</option>
                </select>
              </div>

              <div>
                <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold', color: '#2c3e50' }}>
                  Status Facturare
                </label>
                <select
                  value={formData.status_facturare}
                  onChange={(e) => handleInputChange('status_facturare', e.target.value)}
                  disabled={loading}
                  style={{
                    width: '100%',
                    padding: '0.75rem',
                    border: '1px solid #dee2e6',
                    borderRadius: '6px',
                    fontSize: '14px'
                  }}
                >
                  <option value="Nefacturat">âŒ Nefacturat</option>
                  <option value="Facturat">âœ… Facturat</option>
                </select>
              </div>

              <div>
                <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold', color: '#2c3e50' }}>
                  Status Achitare
                </label>
                <select
                  value={formData.status_achitare}
                  onChange={(e) => handleInputChange('status_achitare', e.target.value)}
                  disabled={loading}
                  style={{
                    width: '100%',
                    padding: '0.75rem',
                    border: '1px solid #dee2e6',
                    borderRadius: '6px',
                    fontSize: '14px'
                  }}
                >
                  {/* âœ… FIX: OpÈ›iuni corecte pentru Status Achitare */}
                  <option value="Neachitat">âŒ Neachitat</option>
                  <option value="Achitat">âœ… Achitat</option>
                  <option value="Nu e cazul">â– Nu e cazul</option>
                </select>
              </div>
            </div>
          </div>

          {/* Date È™i responsabil */}
          <div style={{ 
            display: 'grid', 
            gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', 
            gap: '1rem',
            marginBottom: '1rem'
          }}>
            <div>
              <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold', color: '#2c3e50' }}>
                Data Ãnceput
                {/* âœ… NOU: AfiÈ™are data Ã®n format romÃ¢nesc */}
                {formData.Data_Start && (
                  <span style={{ fontSize: '12px', color: '#7f8c8d', fontWeight: 'normal' }}>
                    ({formatDateForDisplay(formData.Data_Start)})
                  </span>
                )}
              </label>
              <input
                type="date"
                value={formData.Data_Start}
                onChange={(e) => handleInputChange('Data_Start', e.target.value)}
                disabled={loading}
                style={{
                  width: '100%',
                  padding: '0.75rem',
                  border: '1px solid #dee2e6',
                  borderRadius: '6px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold', color: '#2c3e50' }}>
                Data Finalizare
                {/* âœ… NOU: AfiÈ™are data Ã®n format romÃ¢nesc */}
                {formData.Data_Final && (
                  <span style={{ fontSize: '12px', color: '#7f8c8d', fontWeight: 'normal' }}>
                    ({formatDateForDisplay(formData.Data_Final)})
                  </span>
                )}
              </label>
              <input
                type="date"
                value={formData.Data_Final}
                onChange={(e) => handleInputChange('Data_Final', e.target.value)}
                disabled={loading}
                style={{
                  width: '100%',
                  padding: '0.75rem',
                  border: '1px solid #dee2e6',
                  borderRadius: '6px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold', color: '#2c3e50' }}>
                Responsabil
              </label>
              <input
                type="text"
                value={formData.Responsabil}
                onChange={(e) => handleInputChange('Responsabil', e.target.value)}
                disabled={loading}
                placeholder="Numele responsabilului"
                style={{
                  width: '100%',
                  padding: '0.75rem',
                  border: '1px solid #dee2e6',
                  borderRadius: '6px',
                  fontSize: '14px'
                }}
              />
            </div>
          </div>

          {/* Descriere */}
          <div style={{ marginBottom: '1rem' }}>
            <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold', color: '#2c3e50' }}>
              Descriere
            </label>
            <textarea
              value={formData.Descriere}
              onChange={(e) => handleInputChange('Descriere', e.target.value)}
              disabled={loading}
              placeholder="Descrierea detaliatÄƒ a proiectului..."
              rows={3}
              style={{
                width: '100%',
                padding: '0.75rem',
                border: '1px solid #dee2e6',
                borderRadius: '6px',
                fontSize: '14px',
                resize: 'vertical'
              }}
            />
          </div>

          {/* ObservaÈ›ii */}
          <div style={{ marginBottom: '1.5rem' }}>
            <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold', color: '#2c3e50' }}>
              ObservaÈ›ii
            </label>
            <textarea
              value={formData.Observatii}
              onChange={(e) => handleInputChange('Observatii', e.target.value)}
              disabled={loading}
              placeholder="ObservaÈ›ii despre proiect..."
              rows={2}
              style={{
                width: '100%',
                padding: '0.75rem',
                border: '1px solid #dee2e6',
                borderRadius: '6px',
                fontSize: '14px',
                resize: 'vertical'
              }}
            />
          </div>

          {/* Butoane */}
          <div style={{ 
            display: 'flex', 
            justifyContent: 'space-between', 
            gap: '1rem',
            paddingTop: '1rem',
            borderTop: '1px solid #dee2e6'
          }}>
            {/* âœ… Buton È˜TERGE Ã®n stÃ¢nga */}
            <button
              type="button"
              onClick={handleDelete}
              disabled={loading}
              style={{
                padding: '0.75rem 1.5rem',
                background: loading ? '#bdc3c7' : '#e74c3c',
                color: 'white',
                border: 'none',
                borderRadius: '6px',
                cursor: loading ? 'not-allowed' : 'pointer',
                fontSize: '14px',
                fontWeight: 'bold'
              }}
            >
              {loading ? 'â³ Se È™terge...' : 'ğŸ—‘ï¸ È˜terge Proiect'}
            </button>
            
            {/* Butoane AnuleazÄƒ È™i SalveazÄƒ Ã®n dreapta */}
            <div style={{ display: 'flex', gap: '1rem' }}>
              <button
                type="button"
                onClick={onClose}
                disabled={loading}
                style={{
                  padding: '0.75rem 1.5rem',
                  background: '#6c757d',
                  color: 'white',
                  border: 'none',
                  borderRadius: '6px',
                  cursor: loading ? 'not-allowed' : 'pointer',
                  fontSize: '14px',
                  fontWeight: 'bold'
                }}
              >
                AnuleazÄƒ
              </button>
              
              <button
                type="submit"
                disabled={loading}
                style={{
                  padding: '0.75rem 1.5rem',
                  background: loading ? '#bdc3c7' : '#27ae60',
                  color: 'white',
                  border: 'none',
                  borderRadius: '6px',
                  cursor: loading ? 'not-allowed' : 'pointer',
                  fontSize: '14px',
                  fontWeight: 'bold'
                }}
              >
                {loading ? 'â³ Se salveazÄƒ...' : 'ğŸ’¾ SalveazÄƒ ModificÄƒrile'}
              </button>
            </div>
          </div>
        </form>
      </div>

      {/* Modal Client Nou */}
      {showClientModal && (
        <ClientNouModal
          isOpen={showClientModal}
          onClose={() => setShowClientModal(false)}
          onClientAdded={() => {
            loadClienti();
            setShowClientModal(false);
          }}
        />
      )}
    </div>
  );
}
